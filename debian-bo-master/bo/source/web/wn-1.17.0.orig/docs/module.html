<html>
<head>
<title>WN Auxiliary Modules</title>
</head>
<body>
<!-- pnuts --> <a href="utility.html">[Previous]</a> <a href="click.html">[Next]</a> <a href="manual.html">[Up]</a> <a href="manual.html">[Top]</a> <a href="dosearch.html">[Search]</a> <a href="docindex.html">[Index]</a>
<hr size="4">
<!-- #WN_start -->
<h2 align="center">WN Auxiliary Modules</h2>
<hr size="4">


<i>WN</i> provides some features by auxiliary
modules.  These are separate C programs called by the server to
provide some function like authorization (authentication) or indexed
searches or database access.  The current release of <i>WN</i> has a
module for authorization using the "basic" scheme supported by most
clients and future releases will have a module to do index searches.

The current version also has the support infra-structure or "hooks"for
several services which maintainers may wish to create.


<h3>14.1 <a name="db">Database Modules</a></h3>

The index.cache in each directory is in fact a small flat database
containing characteristics of that directory and the files contained in it.
This can be replaced on a per directory basis by a user supplied
module to provide the same information.  In the <i>index</i> file
for such a directory you should create a Directory Record entry
like
<blockquote>
     Cache-Module=/full/path/to/foo
</blockquote>
<p>
The program foo should be an interface to your database. It is permissable
to follow "foo" in this line with any desired arguments to be passed
to it.  The program foo  should
read the environment variable <i>WN_KEY</i> which will contain
everything after the final '/' in the URL being served.  Based on
this key it should return a single line in the format of an
index.cache file.  The format of this file is documented
in docs/cacheformat.
<p>

If the file cache module encounters an error, such as
no entry corresponding to the supplied key, it should return nothing
and exit with a negative status.  This signals the server to return
an appropriate error message.

<h3>14.2 <a name="db">File Modules</a></h3>

It is perhaps more useful to have the files being returned reside
in a database.  

To use such a database interface called "bar", in the <i>index</i> file
for its directory you should create a Directory Record entry
like
<blockquote>
     File-Module=/full/path/to/bar
</blockquote>
<p>

The program bar should be an interface to your database.  It should
read the environment variable <i>WN_KEY</i> which will contain
everything after the final '/' in the URL being served.  Based on this
key it should return a document to be served (perhaps after processing
with wrappers or includes).  When a file module is used it is also
necessary to either use a Cache-module or have an actual index.cache
file with the name of all documents which might be returned by the
database or to have an index.cache file containing the directory
directive "Attributes=serveall".  If the file module encounters an
error, such as no document corresponding to the supplied key, it
should return an appropriate error message of the same content-type as
the requested document.


<h3>14.3 <a name="authorization">Authorization Modules</a></h3>

Authorization requests in <i>WN</i> are normally handled by an authorization
module.  The current release contains a
<a href="access.html#authenticate">Basic Authentication module</a>
and an experimental implementaion of Digest authentication, but users are
invited to provide their own.  <i>However, for security reasons I would
strongly advise against using an authentication module (including authwn)
to protect sensitive information on a server which runs on any system
on which untrusted users have accounts.</i>
<p>

The contents the Authorization: request header is passed to
the module on standard input (as of version 1.10).
<p>

The server expects this module to exit with a status indicating that
access is granted, denied, or that an error occurred.  Anyone writing
an authorization module should consult the file /authwn/authwn.h.  The
#defines listed there specify the error status to use for granting,
denying or indicating certain errors.
<p>

To use a user supplied authorization module named authmod the index
file of each directory requiring authorization should contain lines
like
<blockquote>
     Authorization-realm=myrealm<br>
     Authorization-module=/full/path/to/authmod<br>
     Authorization-type=basic<br>
</blockquote> <p>

The program authmod should indicate the granting or denial of authorization
by its exit status as described above.  The Authorization realm is a
designation which is sent to the client with the authorization request
allowing the client to decide whether the user has already supplied a
password which can be reused (if the realm is the as when the password
was supplied) or if a new password needs to be entered.

<h3>14.4 <a name="isearch">Index Search Modules</a></h3>

Indexed searches can be supported in <i>WN</i> by auxiliary modules.
Two such modules are provided as examples and maintainers may wish to
create them.  To use such a module you should have a form action be
something like http://host/dir/search=index.
<p>

Then in the index file in the directory dir you should have a line
like
<blockquote>
     Search-Module=/full/path/to/searchmod
</blockquote>
<p>
The program searchmod should read the environment variable
QUERY_STRING and return a partial HTML document.  The typical
case would be the program returns an unordered list of anchors to
documents containing a match to the query string.  This list can
be wrapped by including a Searchwrapper directory record.  If it
is not, a default wrapper with text like "Here are the matches
for your search" is supplied.
<p>
Two simple examples of a search-module (written in perl) are included
in the distribution in the files bin/seven_m and bin/sectsearch.
<p>
<!-- #WN_end -->
<hr size="4">
<address>
John Franks &lt;john@math.nwu.edu&gt;
</address>
<!-- pnuts --> <a href="utility.html">[Previous]</a> <a href="click.html">[Next]</a> <a href="manual.html">[Up]</a> <a href="manual.html">[Top]</a> <a href="dosearch.html">[Search]</a> <a href="docindex.html">[Index]</a>
</body>
</html>


