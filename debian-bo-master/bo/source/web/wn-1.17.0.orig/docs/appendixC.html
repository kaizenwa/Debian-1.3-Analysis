<html>
<head>
<title>Appendix C: Parsed Document Syntax</title>
</head>
<body>
<!-- pnuts --> <a href="appendixB.html">[Previous]</a> <a href="appendixD.html">[Next]</a> <a href="manual.html">[Up]</a> <a href="manual.html">[Top]</a> <a href="dosearch.html">[Search]</a> <a href="docindex.html">[Index]</a>
<hr size="4">
<!-- #WN_start -->
<h2 align="center">Appendix C:  Parsed Document Syntax</h2>
<hr size="4">

This is a list of all parsing instructions recognized by WN
while parsing a text document.  They all use one of the two
equivalent forms
     <blockquote>
     &lt;!-- #something --&gt;<br>
or<br>
     &lt;?WN something &gt;
     </blockquote>

and should occur on a line by themselves with no leading white space.
The second form is considered more SGML friendly by many as &lt;?WN
something &gt; indicates a processing instruction specific to WN
rather than a comment.  For historical reasons this manual describes
the other form, but either may be used.  With the first form the '#'
is required but with the other you may use either

     <blockquote>
     &lt;?WN #something &gt;<br>
     or<br>
     &lt;?WN something &gt;<br>
     </blockquote>
Also &lt;?wn #something &gt; is fine.  The case of the WN is
not significant.
<p>
<h3><a name="match">Matching regular expressions and #if</a></h3>

This section describes the use of conditionally included text
of the form

     <blockquote>
     &lt;!-- #if some_condition --&gt;<br>
	Some conditional text goes here.<br>
     &lt;!-- #else --&gt;<br>
	Alternate text.<br>
     &lt;!-- #endif --&gt;
     </blockquote>
Which will insert the conditional text only if <i>some_condition</i>
is satisfied.  The &lt;!-- #else &gt; is optional.

In all the examples below the use of the equal-tilde string =~
to indicate a matching regular expression can be replaced with
the two characters !~ in which case the if clause will be true when
the regular expression fails to match.
<p>

Also in the examples of the form &lt;#if accept file="foo"&gt;
the file foo is assumed to be relative to the current directory
unless it begins with a '/' in which case it is taken relative to
the WN data hierarchy root.  The format of these files is a list
of grep like regular expressions, one per line with any white space
being taken as part of the expression.  Lines beginning with '#' are
taken to be comments.  If a regular expression is preceded with the
character '!' then that character is skipped but the truth value of
any matches with the expression is reversed.

<dl>
<dt> <b><a name="accept">#if accept</a></b>
     -- Match client's Accept headers
<dd>
     The lines

     <blockquote>
     &lt;!-- #if accept =~ "regexp" --&gt;<br>
     or<br>
     &lt;!-- #if accept file= "foo" --&gt;<br>
     </blockquote>
     specify that this text segment should be served if (in the first
     case) the grep like
     regular expression <i>regexp</i>  matches any of the Accept headers
     supplied by the client.  Or for the second line if the file "foo"
     contains a regular expression matching any of the Accept headers.
     <p>


<dt> <b><a name="after">#if after</a></b> and <b>#if before</b>
     -- Select text based on date
<dd>
     The lines

     <blockquote>
     &lt;!-- #if after "date" --&gt;<br>
     or<br>
     &lt;!-- #if before "date" --&gt;<br>
     </blockquote>
     specify that this text segment should be served if the current
     time is after (or before) the specified date.  That is, the
     line 
     <blockquote>
     &lt;!-- #if after "22 Oct 1996 17:41:26" --&gt;<br>
     </blockquote>
     will cause the text segment to be served only after
     22 Oct 1996 17:41:26 local time.  The date format is
     rather rigid.  It must be in precisely the format shown
     above (specified by RFC 1123) and with a single space
     between each field.  Only local time of the server is 
     supported.
     <p>


<dt> <b><a name="cookie">#if cookie</a></b>
     -- Match client's Cookie headers
<dd>
     The lines
     <blockquote>
     &lt;!-- #if cookie =~ "regexp" --&gt;<br>
     or<br>
     &lt;!-- #if cookie file= "foo" --&gt;<br>
     </blockquote>
     specifies that this text segment should be served if the grep like
     regular expression <i>regexp</i>  matches any of the Cookie headers
     supplied by the client.
     <p>
     More information about the proposed HTTP Set-Cookie header is available
     at <a href="http://home.netscape.com/newsref/std/cookie_spec.html">
     http://home.netscape.com/newsref/std/cookie_spec.html</a>
     <p>

<dt> <b><a name="iffield">#if field</a></b>
     -- Match document's user defined field
<dd>
     The lines
     <blockquote>
     &lt;!-- #if field3 =~ "regexp" --&gt;<br>
     or<br>
     &lt;!-- #if field3 file= "foo" --&gt;<br>
     </blockquote>
     specify that this text segment should be served if the grep like
     regular expression <i>regexp</i>  matches the contents of the 
     <a href="field.html">user defined field</a> number 3
     (in the first case) or if the file "foo" contains a matching
     regular expression (in the second) case.  Any valid field
     number may be used in place of 3.
     <p>

<dt> <b><a name="hostname">#if hostname</a></b>
     -- Match client's hostname
<dd>
     The lines
     <blockquote>
     &lt;!-- #if hostname =~ "regexp" --&gt;<br>
     or<br>
     &lt;!-- #if hostname file= "foo" --&gt;<br>
     </blockquote>
     specify that this text segment should be served if the grep like
     regular expression <i>regexp</i>  matches the hostname of the client
     (in the first case) or if the file "foo" contains a matching
     regular expression (in the second) case.  For an alternate method
     of doing this see the <a href="#control">"if accessfile" syntax</a>
     described below.
     <p>
     Be aware that the character '.' (dot) has a special meaning in
     regular expressions and must be escaped with a '\' to have its
     usual meaning.
     <p>

<dt> <b><a name="hosthead">#if host_header</a></b>
     -- Match server's virtual hostname from client's HTTP Host header
<dd>
     The lines
     <blockquote>
     &lt;!-- #if host_header =~ "regexp" --&gt;<br>
     </blockquote>
     specify that this text segment should be served if the grep like
     regular expression <i>regexp</i>  matches the contents of the HTTP
     "Host:" header supplied by the client in its request.
     <p>
     Be aware that the character '.' (dot) has a special meaning in
     regular expressions and must be escaped with a '\' to have its
     usual meaning.
     <p>

<dt> <b><a name="ip">#if IP</a></b>
     -- Match client's IP address
<dd>
     The lines
     <blockquote>
     &lt;!-- #if IP =~ "regexp" --&gt;<br>
     or<br>
     &lt;!-- #if IP file= "foo" --&gt;<br>
     </blockquote>
     specify that this text segment should be served if the grep like
     regular expression <i>regexp</i>  matches the IP address of the client
     (in the first case) or if the file "foo" contains a matching
     regular expression (in the second case).  For an alternate method
     of doing this see the <a href="#control">"if accessfile" syntax</a>
     described below.
     <p>
     Be aware that the character '.' (dot) has a special meaning in
     regular expressions and must be escaped with a '\' to have its
     usual meaning.
     <p>

<dt> <b><a name="query">#if query</a></b>
     -- Match query string supplied in request URL
<dd>
     The lines
     <blockquote>
     &lt;!-- #if query =~ "regexp" --&gt;<br>
     or<br>
     &lt;!-- #if query file = "foo" --&gt;<br>
     </blockquote>

     specifies that this text segment should be served if the grep like
     regular expression <i>regexp</i>  matches the 'query string'
     supplied by the client in the URL (in the first case) or if the file 
     "foo" contains a matching regular expression (in the second case).
     <p>


<dt> <b><a name="request">#if request</a></b>
     -- Match client's request
<dd>
     The lines
     <blockquote>
     &lt;!-- #if request =~ "regexp" --&gt;<br>
     or<br>
     &lt;!-- #if request file = "foo" --&gt;<br>
     </blockquote>
     specify that this text segment should be served if the grep like
     regular expression <i>regexp</i>  matches the contents of the
     full text of the request supplied by the client (in the first case)
     or if the file "foo" contains a matching regular expression
     (in the second case).  The full request contains the "method"
     (GET or POST) followed by the URL requested with the "http://host"
     part having been removed (by the client).
     <p>

<dt> <b><a name="referer">#if referer</a></b>
     -- Match client supplied Referer: header
<dd>
     The lines
     <blockquote>
     &lt;!-- #if referer =~ "regexp" --&gt;<br>
     or<br>
     &lt;!-- #if referer file = "foo" --&gt;<br>
     </blockquote>
     specify that this text segment should be served if the grep like
     regular expression <i>regexp</i>  matches the contents of the
     Referer: header supplied by the client
     or if the file "foo" contains a matching regular expression
     (in the second case).  The Referer: header contains the
     URL of the document containing the link accessed to obtain the
     current document.
     <p>
     
<dt> <b><a name="UA">#if UA</a></b>
     -- Match client's User-Agent header
<dd>
     The lines
     <blockquote>
     &lt;!-- #if UA =~ "regexp" --&gt;<br>
     or<br>
     &lt;!-- #if UA file = "foo" --&gt;<br>
     </blockquote>
     specifies that this text segment should be served if the grep like
     regular expression <i>regexp</i>  matches the User-Agent header
     supplied by the client (in the first case) or if the file "foo"
     contains a matching regular expression (in the second case).
     <p>

<dt> <b><a name="true">#if true</a></b> and <b>#if false</b>
     -- Include or exclude text segment
<dd>
     The line
     <blockquote>
     &lt;!-- #if false --&gt;
     </blockquote>
     specifies that the corresponding  text segment should not
     be served.  It may be useful for "commenting out" a part of a
     document which is under construction.  The "#if true" construct
     is present for logical completeness.
     <p>

</dl>

<h3><a name="control">Access Control Files</a></h3>

The normal <a href="access.html">access control files</a> used by
WN to limit access to a directory can also be used to conditionally
permit or deny access to text segments.

<dl>
<dt> <b>#if accessfile="filename"</b> --
     check access control file
<dd> 
     The line 
     <blockquote>
     &lt;!-- #if accessfile="/dir/accessfile" --&gt;
     </blockquote>
     specifies that the file /dir/accessfile is to be used to
     determine access priviliges (by hostname or IP address) for
     this text segment.  The path /dir/accessfile is relative to the
     server root directory.  If this path does not begin with a
     '/' then the path is relative to the directory containing
     the file with this text.  (See the user's manual section:
     <a href="access.html">Limiting Access to Your WN Hierarchy.</a>)
     <p>

</dl>
<p>

<h3><a name="include">Inserting the contents of a file</a></h3>

<dl>
<dt> <b>#include</b> -- Insert the contents of a file

<dd> 
     The line 
     <blockquote>
     &lt;!-- #include --&gt;
     </blockquote>
     specifies that the contents of next file listed in the
     <a href="parse.html">includes or wrappers</a> should be
     inserted at this point.  It is permissible to add the name
     of this file, as in 
     <blockquote>
     &lt;!-- #include  foo.txt --&gt;
     </blockquote>
     but this acts only as a comment.  The actual file inserted
     depends only on the Includes= and Wrappers= directives in the
     index file (or more precisely the index.cache file created from
     it.)
     <p>

<dt> <b>#section</b> -- Insert part of the contents of a file
<dd> 
     The line 
     <blockquote>
     &lt;!-- #section --&gt;
     </blockquote>
     specifies that part of the contents of next file listed in the
     <a href="parse.html">includes or wrappers</a> should be
     inserted at this point.  It is permissible to add the name
     of this file, as in 
     <blockquote>
     &lt;!-- #section  foo.txt --&gt;
     </blockquote>
     but this acts only as a comment.  The actual file inserted
     depends only on the Includes= and Wrappers= directives in the
     index file (or more precisely the index.cache file created from
     it.)
     <p>
     The part of the file actually included is that
     portion of the document between the special comments
     &lt;!-- #start --&gt; and  &lt;!-- #end --&gt; inserted in
     that document.  This requires that these starting and ending comments
     occur in the HTML document on lines by themselves and with no
     preceding white space. For more information see the
     <a href="parse.html#section">chapter on parsed documents.</a>
     <p>

<dt> <b>#start</b> and <b>#end</b> -- Mark the beginning and end of
     text to be included
<dd> 
     The lines
     <blockquote>
     &lt;!-- #start --&gt;<br>
     and<br>
     &lt;!-- #end --&gt;<br>
     </blockquote>
     mark the beginning and end of the portion of the text to be
     inserted from an include or wrapper in response to encountering
     &lt;!-- #section --&gt; in the text of a document being parsed.
     There can be more than one #start/#end pair in a document.
     There is <a href="parse.html#section">more information</a> in the chapter
     on parsed documents.
     <p>

<dt> <b>#title, #query,</b> and <b>#field</b> -- Insert the title,
     current searchstring, or a user defined field
<dd> 
     The lines

     <blockquote>
          &lt;!-- #title --&gt; <br>
          &lt;!-- #query --&gt; <br>
          or<br>
          &lt;!-- #field 3 --&gt; <br>

     </blockquote>
     in a parsed document instruct the server to include the title of the
     current document, the current search term from the client or the
     value of user defined field #3 for the current document.
     All of these markers must occur on a line by themselves with no leading
     white space. There is <a href="parse.html#title">more information</a>
     in the chapter on parsed documents.
     <p>

<dt> <b>#environ</b>  -- Insert the contents of an environment variable

<dd> 
     The lines

     <blockquote>
          &lt;!-- #environ = "WHATEVER" --&gt; <br>
     </blockquote>
     
     in a parsed document instructs the server to include the contents
     of the environment variable WHATEVER. This expression should
     occur on a line by itself.  Remember to use an "Attributes=parse"
     line when using this construct and to use an "Attributes=cgi"
     when it is a CGI varialble like HTTP_REFERER which is to be included.
     <p>
</dl>

<h3><a name="redirect">Conditional Redirecting</a></h3>
<dl>
<dt> <b>#redirect</b> -- Redirect to a different URL

<dd> 
     The line 
     <blockquote>
     &lt;!-- #redirect = "url" --&gt;
     </blockquote>
     specifies that if no text has yet been sent the server should
     send an HTTP redirect to the given URL.  This might be used
     as follows.  If the text
     <blockquote>
     &lt;!-- #if hostname =~ "\.uk$" --&gt;<br>
     &lt;!--      #redirect = "UK_mirror_url" --&gt;<br>
     &lt;!-- #endif --&gt;<br>
     </blockquote>
     is included at the beginning of an HTML document then any
     request from a UK host will automatically be redirected to
     the specified URL, the UK_mirror_url in this case.  This mechanism
     could also be used to redirect text only browsers to a text only
     alternative page, etc.
     <p>
     
     There must be no text sent before the &lt;!-- #redirect = "url" --&gt;
     is entcountered (not even blank lines) since the server cannot send
     an HTTP redirect while in the middle of tranmitting a document.  Thus
     the example above would be an error if there are any blank lines
     before the "#if hostname" line or any blank lines after it before
     the "#redirect" line.  When such an error occurs it is logged in
     the error file and the "#redirect" line is ignored.
     <p>
     Note however that 
     <blockquote>
     &lt;!-- #if hostname =~ "\.uk$" --&gt;<br>
     [Lots of text here]<br>
     &lt;!-- #else --&gt;<br>
     &lt;!--      #redirect = "some_URL" --&gt;<br>
     &lt;!-- #endif --&gt;<br>
     </blockquote>

     is correct since when the #redirect line is encountered no text
     has been sent.  
     <p>
     
     Normally the URL in the &lt;!-- #redirect = "URL" --&gt; line is
     fully qualified, like "http://host/path/foo".  However, it can also
     be simply "foo" referring to a file in the same directory as the
     file being parsed.  In this case an HTTP redirection is not sent, and
     instead the file "foo" is returned immediately to the client.
     <p>

</dl>

<!-- #WN_end -->
<hr size="4">
<address>
John Franks &lt;john@math.nwu.edu&gt;
</address>
<!-- pnuts --> <a href="appendixB.html">[Previous]</a> <a href="appendixD.html">[Next]</a> <a href="manual.html">[Up]</a> <a href="manual.html">[Top]</a> <a href="dosearch.html">[Search]</a> <a href="docindex.html">[Index]</a>
</body>
</html>
