<html>
<head>
<title>Setting up Searches</title>
</head>
<body>
<!-- pnuts --> <a href="security.html">[Previous]</a> <a href="parse.html">[Next]</a> <a href="manual.html">[Up]</a> <a href="manual.html">[Top]</a> <a href="dosearch.html">[Search]</a> <a href="docindex.html">[Index]</a>
<hr size="4">
<!-- #start -->
<h2 align="center">Setting up Searches</h2>
<hr size="4">


One of the design goals of <i>WN</i> is provide the maintainer with
tools to create extensive navigational aids for the server. A variety
of search mechanisms are available and provide this capability. <p>

<h3>5.1 Title searches</h3>

In response to the URL

<blockquote>
     &lt;http://host/dir/search=title&gt;
</blockquote><p>

the server will provide an HTML form (automatically generated or
prepared by the maintainer) asking for a regular
expression search term. When supplied the server will search
the index.cache files in /dir and designated subdirectories for a
items whose titles contain a match for the search term.  An
HTML document with a menu of these items is returned.  Subdirectories
are designated for recursive searching by an entry in directory record
of the index file like

<blockquote>
     Subdirs=dir1,dir2,dir3
</blockquote>
<p>

You can customize the message offered requesting a search term by
creating an HTML form whose ACTION is the URL
http://host/dir/search=title and which uses the GET method to return
the search term with NAME=query. <p>

<h3>5.2 <a name="keyword">Keyword searches</a></h3>

Like title searches except matches are sought in keywords instead
of titles.  Keywords for HTML documents are automatically obtained
from <META> headers.  For other documents (or HTML documents) they
can be manually supplied in the <i>index</i> file.  This is done
by including a line like

<blockquote>
     Keywords=keyword1, keyword2, etc.
</blockquote><p>

in the relevant document's record in the <i>index</i> file.  The
URL to use to cause this search to be done is
<blockquote>
     &lt;http://host/dir/search=keyword&gt;
</blockquote><p>



<h3>5.3 Title/keyword search</h3>
Like the above except the match can be either in the keyword or
the title.  The URL to use as the ACTION in a form or simply to
invoke the search is

<blockquote>
     &lt;http://host/dir/search=synopsis&gt;
</blockquote><p>


<a name="fielded">
<h3>5.4 Fielded searches for user supplied fields</h3></a>

The maintainer can supply up to 20 additional field values associated
with a document.  These are used for searching purposes in the same
way that Keywords are.  This is intended to give some additional
"keyword like" fields, for example, document author or document id
number.  It works exactly like keywords except these
values are not extracted from HTML files, but must be created with
a line like
<blockquote>
     Field3=any text here
</blockquote><p>
in the index file.  The '3' in this example can be replaced with any
number from 0 to 19.  The URL to use as the ACTION in a form or simply to
invoke the search in the example above is

<blockquote>
     &lt;http://host/dir/search=field3&gt;
</blockquote><p>

Like keyword and title searches the search term for a fielded search
can be any grep-like regular expression.
<p>

<h3>5.5 <a name="context">Context searches</a></h3>

Unlike the title, keyword, and field searches this is a full text
search of all text/* documents in one directory (not subdirectories).
The returned HTML document contains a list of titles of documents
containing a match each with a sublist of the lines from those
documents containing the match.  This provides one line of context for
the match.  For HTML documents selecting the matched expression in one
of these takes you to the document with your viewer focused on the
matching location.  The primary intent of this feature is to provide
full text searching for an HTML "document" which might consist of a
substantial number of files.  It is possible to customize the text of
the HTML response containing the matches.  This is done with a <a
href="#searchwrap"> Searchwrapper directive.</a>
<p>

The URL to use as the ACTION in a form or simply to
invoke the search is

<blockquote>
     &lt;http://host/dir/search=context&gt;
</blockquote><p>

It is possible to mark HTML documents with comments so that only part
of them is searched.  This is done with lines consisting of the comment
&lt;!-- #search_off --&gt; which turns off searching until the line
consisting of &lt;!-- #search_on --&gt; is encountered.
<p>

<h3>5.6 Grep searches</h3>

A grep search is just like a context search, except that only a
list of anchors pointing to files containing a match is returned.
There are no lines of context showing the match. To do a grep search
on the files in directory <i>dir</i> use
<blockquote>
     &lt;http://host/dir/search=grep&gt;
</blockquote><p>


<h3>5.7 Line searches</h3>

A line search is identical a context search, except that only one
list of all matching lines is returned, instead of the matching
lines being sublists of a list of files containing a match.  That is,
all the items in sublists of a context search are concatenated in
one large list of lines containing matches.  The matching items
are still anchors pointing to items in their respective files.
To do a line search on the files in directory <i>dir</i> use
<blockquote>
     &lt;http://host/dir/search=line&gt;
</blockquote><p>

<h3>5.8 <a name="fgrep">File context and grep searches</a></h3>

A file context search is just like a context search, except limited
to a single file.  The file grep search returns a text/html
document containing  the lines in the file matching matching
the regular expression.  These lines will be converted to plain
text and surrounded by &lt;pre&gt; and &lt;/pre&gt; tags.  This
is done because isolated tags or partial tags taken from an
HTML document would be unlikely to function properly.
It is likely that you will want to use a <a href="#searchwrap">
Searchwrapper directive</a> with a grep search.
<p>
The URL's to invoke these searches on file <i>foo</i> are
<blockquote>
     &lt;http://host/dir/foo;search=context&gt;<br>
     &lt;http://host/dir/foo;search=grep&gt;
</blockquote><p>


<h3>5.9 <a name="list">Search a Directory or Search a Hierarchy?</a></h3>

The different  searches described above are of two types: those that search
the index.cache files like field, keyword and title searches and those
that do full text searches of multiple files, like context, grep and line
searches.  The first type recursively descends all subdirectories listed
in a Subdirs= directive and searches all the index.cache files.  The second
only searches files in the one directory specified in the search.
<p>
The reason for this is efficiency.  Context, grep and line searches
are not a replacement for WAIS, glimpse or some other indexed search
engine.  The intent of these searches is to allow a full text search
of a single conceptual HTML document that is made up of a number of
files with links.  These searches work great with something like the
HTML2.0 spec (see <a href="http://hopf.math.nwu.edu/html2.0/">
http://hopf.math.nwu.edu/html2.0/</a>)
which consists of 39 files of moderate size, but they would be very
slow with 1000 files spread out in a data hierarchy.  For that you
really need an indexing search engine.
<p>

On the other hand, all of the searching methods listed above are built
into the server and require no additional effort for the maintainer.
You don't need to produce or maintain an index. They are simply
referenced with URLs like &lt;http://host/dir/search=context&gt; where
/dir is any directory containing files to be served and an index.cache
listing them.  Of course search permission can be denied for any
directory or any file contained in that directory. <p>

<h3>5.10 <a name="list">List searches</a></h3>

The server will search an HTML document looking for an unordered list
of anchors linking to WWW objects.  The contents of each anchor will
be searched for a match to the supplied regular expression.  The
search returns an HTML document containing an unordered list of those
anchors with a match.  This is quite useful with the <i><a
href="utility.html#digest">digest</a></i> utility which creates HTML
documents to be searched in this way from files with internal
structure like mail or news digests, mailing lists, etc. <p>

The URL to invoke this search on file <i>foo</i>
<blockquote>
     &lt;http://host/dir/foo;search=list&gt;
</blockquote><p>
       

<h3>5.11 Index searches</h3>

Indexed searches can be supported in <i>WN</i> by auxiliary modules.
Two such modules are provided as examples and maintainers may wish to
create them.  To use such a module you should have a form action be
something like http://host/dir/search=index.
<p>

Then in the index file in the directory dir you should have a line
like
<blockquote>
     Search-Module=/full/path/to/searchmod
</blockquote>
<p>
The program searchmod should read the environment variable
QUERY_STRING and return a partial HTML document.  The typical
case would be the program returns an unordered list of anchors to
documents containing a match to the query string.  This list can
be wrapped by including a Searchwrapper directory record.  If it
is not, then a default wrapper with text like "Here are the matches
for your search" is supplied.
<p>

For more information see the <a href="module.html#isearch">chapter on
modules.</a>
<p>


<h3>5.12 <a name="mode">Search Modes</a></h3>

The different types of searches, e.g. title, keyword, context, etc.
are called the <b>modes</b> used by the search.  Normally the
mode is set by adding, for example "search=context" to the end
of a URL.  However, if an HTML form is used to initiate the search,
it may be desirable to allow the mode to be selected by by a 
form variable.  Thus an HTML form like

<pre>
&lt;form action="search=mode" method="GET"&gt;
Enter your search term &lt;input name="query" size=15&gt; 
&lt;input type="submit" value="Search"&gt; by 
&lt;input type="radio" name="mode" value="title" checked&gt; title or 
&lt;input type="radio" name="mode" value="keyword"&gt; keywords
&lt;/form&gt;
</pre>

will execute either a title or a keyword search depending on
whether the user checks the radio button for "title" or "keyword".
The URL requested will end with "search=mode", but actually it
could be anything since the "mode=title" (if that is what is checked)
which will be in the query part of the URL will override whatever
follows "search=" in the base URL.
<p>

<h3>5.13 <a name="searchwrap">Searchwrappers</a></h3>

By default when a search is done an HTML file is created with text
like "Here are the matches for ...".  You may wish to customize this
response which is done with the Searchwrapper= directive in either
a file record or directory record of the index file.
<p>

The line 
<blockquote>
     Searchwrapper=swrap.html
</blockquote>
specifies that the HTML file swrap.html in the current directory
should be used as a wrapper for the output of all searches on this
directory (if it is a directory record entry) or file (if it is a
file directive).  This wrapper differs from other wrappers in that it
can have only a single &lt;!-- #include --&gt; line.  An unordered
list of anchors to the matching items will be inserted at the location
of this line.  You can, of course, insert the client supplied
search term by use of the line &lt;!-- #query --&gt; in this file.
<p>

The remainder of this file can be anything you wish and is often an
HTML form allowing subsequent searches.
<p>

If a search fails to find any matches then a default HTML response
indicating this is sent.  This response can also be customized but
only if a Searchwrapper is also used.  The line

<blockquote>
     Nomatchsub=foo.html
</blockquote>

specifies that the HTML file foo.html in the current directory should
be used for the output of all searches (title, keyword, context, grep,
etc.) on this directory (or file if it is a file directive) which
return no matches.  If Nomatchsub is used and a Searchwrapper has not
be defined an error is logged and the nomatchsub file is ignored.
<p>

<!-- #end -->
<hr>
<address>
John Franks &lt;john@math.nwu.edu&gt;
</address>
<!-- pnuts --> <a href="security.html">[Previous]</a> <a href="parse.html">[Next]</a> <a href="manual.html">[Up]</a> <a href="manual.html">[Top]</a> <a href="dosearch.html">[Search]</a> <a href="docindex.html">[Index]</a>
</body>
</html>
