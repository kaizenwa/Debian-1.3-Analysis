# @(#) README,v 1.1 1991/10/26 22:57:53 tron Exp

From apple!netcom!netcom.UUCP Tue Nov 27 06:37:05 PST 1990
Article: 1582 of alt.sources
Xref: veritas alt.sources:1582 comp.mail.uucp:1979
Path: veritas!apple!netcom!netcom.UUCP
From: gam@netcom.UUCP (Gordon Moffett)
Newsgroups: alt.sources,comp.mail.uucp
Subject: Rerouting spooled UUCP mail (HDB+smail)
Message-ID: <17525@netcom.UUCP>
Date: 27 Nov 90 03:20:59 GMT
Sender: gam@netcom.UUCP
Followup-To: alt.sources.d,comp.mail.uucp
Organization: Netcom Public Access Unix, San Jose, CA
Lines: 197

My query for a shell script to respool UUCP mail for a site gone dead
had gotten a few responses, but all refering to Lenny Tropiano's
"uureroute.c" posted recently, which expected *you* to provide the new
path names, *you* to provide the UUCP job names, etc ....  A computer
should be expected to do better than that :-)!

I had sent a copy of this shell script I was speaking of to our
neighbor, amdahl, when I had originally gotten it, and got it back from
them -- here it is.  You just recalculate your pathalias database, run
this shell script for a given site, and see the mail get rerouted to
new paths.  The usage is quite simple:  "reroute <sitename>", like
"reroute claris" or whatever.  It expects to be run by 'root', and uses
the id(1) program to determine that.

I call it "reroute" the author called it "nukeq", you can name it
whatever you like.

Here is the author's original message.  Note the caveats!  But I have used it
several times and it works beautifully.  (There was a bug in the reference
to the $user environment variable which is fixed here).

When he talks about "smail" he is refering to smail 2.5.  But I have
used it with smail 3.1 without any problems.  Smail 3.1 appears to ignore
the -R flag, perhaps it should be taken out if you're running 3.1

Subject: Re: Rerouting spooled UUCP mail?
Date: 11 Jan 90 20:18:08 EST (Thu)
From: uunet!wang.COM!fitz (Tom Fitzgerald)

> I need a tool to take UUCP jobs queued up for one site (which is dead)
> and move them to another site's UUCP queue.

Here's what I use.  It makes some assumptions:

- You're using HDB.  If not, you'll have to screw with the filename
  pattern matching and directories.

- You're using SMAIL.  If not, you'll have to have some other mailer that
  accepts header lines in the message without modifying them, and you'll
  have to find some way of simulating SMAIL's -R (aggressive-rerouting)
  option.

- You've already rebuilt the 'paths' file so that the dead node is missing
  from all paths.

- You're logged in as root (needless to say).

It's also got these flaky aspects:

- It's dangerous as hell.  I wrote it, and it scares me.  Save a copy
  of all mail, and make sure the result is what you wanted before you
  let a uucico start up.

- If any mail is queued for a user on the dead system (or for a user
  that can _only_ be reached via the dead system) it will not be rerouted.

- Results in a doubled "Recieved:" line in the header.

- More flakinesses are mentioned in the script itself.

If you haven't given up yet, here it is.  Good luck.
