/*
 *                            COPYRIGHT
 *
 *  PCB, interactive printed circuit board design
 *  Copyright (C) 1994,1995,1996 Thomas Nau
 *
 *  This program is free software; you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation; either version 2 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License
 *  along with this program; if not, write to the Free Software
 *  Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
 *
 *  Contact addresses for paper mail and Email:
 *  Thomas Nau, Schlehenweg 15, 88471 Baustetten, Germany
 *  Thomas.Nau@rz.uni-ulm.de
 *
 *  RCS: $Id: Imakefile,v 143.1 1996/09/16 09:09:30 nau Exp $
 */

#include "config.h"

/* ------------------- don't change anything here --------------------------
 * apply changes to config.h
 *
 * the 'PassCDebugFlags' define is a strange one but seems to be needed
 * for recursive makes...
 */
#define PassCDebugFlags 'CDEBUGFLAGS=$(CDEBUGFLAGS)'

SUBDIRS = src lib doc

MakeSubdirs($(SUBDIRS))
InstallSubdirs($(SUBDIRS))
InstallManSubdirs($(SUBDIRS))
CleanSubdirs($(SUBDIRS))

MakefileSubdirs($(SUBDIRS))
IncludesSubdirs($(SUBDIRS))
DependSubdirs($(SUBDIRS))

install.info::
	@for DIR in $(SUBDIRS); do	\
		(cd $$DIR; $(MAKE) $(MFLAGS) install.info); \
		done

/* -------------------------------------------------------------------------
 * the following rules are to create the distribution
 */
dist::
	@set -x; for DIR in $(SUBDIRS); do	\
			(cd $$DIR; $(MAKE) $(MFLAGS) dist); \
			done && \
		name=pcb-$(RELEASE) && \
		dirname=/tmp/$$name && \
		mkdir $$dirname && \
		cp -r . $$dirname && \
		cd $$dirname && \
		make $(MFLAGS) distclean && \
		rm -rf `find $$dirname -type d -name RCS -print` && \
		cd .. && \
		chmod -R u+rwX,a+rX $$name && \
		tar cvf - $$name | $(COMPRESS) > $$name.tar.$(SUFFIX); \
		rm -rf $$dirname

distclean:: clean
	@for DIR in $(SUBDIRS); do  \
		(cd $$DIR; rm -f Makefile); \
		done
	rm -f Makefile

