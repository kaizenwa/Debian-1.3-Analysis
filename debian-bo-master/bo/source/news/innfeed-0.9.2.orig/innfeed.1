.\" -*- nroff -*-
.\"
.\" Author:       James A. Brister <brister@vix.com> -- berkeley-unix --
.\" Start Date:   Sat, 20 Jan 1996 15:50:56 +1100
.\" Project:      INN -- innfeed
.\" File:         innfeed.1
.\" RCSId:        $Id: innfeed.1,v 1.10 1996/12/07 01:37:44 brister Exp $
.\" Description:  Man page for innfeed(1)
.\"
.de t$
/var/tmp/innfeed/tapes
..
.de c$
/var/tmp/innfeed/innfeed.conf
..
.de
.TH INNFEED 1
.SH NAME
innfeed \- multi-host, multi-connection, streaming NNTP feeder.
.SH SYNOPSIS
.B innfeed
[
.BI \-d " num"
]
[
.BI \-c " filename"
]
[
.BI \-l " filename"
]
[
.BI \-b " directory"
]
[
.B \-x 
]
[
.B \-z 
]
[
.B \-y
]
[
.B \-m
]
[
.B \-o bytes
]
[
.B \-p file
]
[
.B \-a spool-dir
]
[
.B \-v
]
[
.B \-h
][ file ]
.SH DESCRIPTION
.PP
This man page describes version 0.9.2 (beta) of innfeed.
.PP
.I Innfeed
implements the NNTP protocol for transferring news between computers. It
handles both the standard IHAVE protocol as well as the CHECK/TAKETHIS
streaming extension. Innfeed can feed any number of remote hosts at once
and will open multiple connections to each host if configured to do so. The
only limitations are the process limits for open file descriptors and memory.
.PP
.I Innfeed
has three modes of operation: channel, funnel-file and batch.
.PP 
In channel mode it runs underneath INN and reads article information on its
standard input.  Note that innfeed cannot be run with stdin redirected from
a file. Also, on some machines (like an Alpha running Digital Unix), piping
the output of ``cat filename'' into the input of innfeed will cause
exceptions to be generated on the input pipe's file descriptor. If you
really want to pipe a file into innfeed's stdin then use something like awk
that will process the file line by line:
.PP
.RS
.nf
	awk '{print}' file | innfeed
.fi
.RE
.PP
should be sufficient. Channel mode is used when no filename is give as an
argument, and ``\-x'' is not used.
.PP
Funnel-file mode is used when a filename is given as an argument.
.PP
Batch mode is used when the ``\-x'' flag is used.
In this mode 
.I innfeed
reads any existing backlog files for the peer machines and transmits
them. This is not normally needed as innfeed will take care of existing
backlog as part of normal operation.
.PP
Innfeed will catch SIGUSR1 and SIGUSR2. SIGUSR1 will increment the
debugging level by one, and SIGUSR2 will decrement it by one. The debugging
level starts at zero, and no debugging information is emitted. A larger
value for the level means more debugging information. Numbers up to 5 are
currently useful.
.PP
Innfeed with catch SIGINT and will write a large debuggin snapshot of the
state of the running system.
.PP
For each peer, innfeed will manage two files for backlog. They are stored
in the directory
.t$
The files are named PEER.input and PEER.output. If the news admin wants to add
to these, then dropping a file with the name, simply PEER will cause it to
become the next PEER.input file when the current one is used up. The format
of the backlog files is:
.PP
.RS
.nf
/path/to/article <message-id>
.fi
.RE
.PP
This is the same as the first two fields of the lines innd feeds to
innfeed, and the same as the first two fields of the lines of the batch
file innd will write if innfeed is unavailable for some reason. When
innfeed processes its own batch files it ignores everything after the first
two whitespace seperated fields, so moving the innd-created batch file to
the appropriate spot will work, even though the lines are longer. However,
as each line in an innd batch file will apply to (usually) more than one
peer, copying the file to each PEER batch file will be required, and
stripping out the unwanted lines may be wanted too.
.PP
The file innfeed.status is updated in the directory where the backlog files
live. It is updated every time a connection goes down, or an attempt to
connect is made (to any peer).  It looks like:
.PP
.nf
innfeed v. 0.8.5 (Thu Jun 6 15:43:15 PDT 1996)
pid 29032 started Thu Jun  6 15:43:45 1996

Updated: Thu Jun  6 15:44:13 1996

data.ramona.vix.com ip-name: data.ramona.vix.com type: 
                  non-streaming
        article-timeout: 600 response-timeout: 300
        active-connections: 0 sleeping-connections: 0

vixie ip-name: gw.home.vix.com type: non-streaming
        article-timeout: 600 response-timeout: 300
        active-connections: 5 sleeping-connections: 0
        seconds 2870 offered 2800 accepted 0 refused 2798 
                  rejected 1 missing 0

decwrl ip-name: news1.digital.com type: streaming
        article-timeout: 600 response-timeout: 300
        active-connections: 0 sleeping-connections: 0
        seconds 2636 offered 2 accepted 0 refused 2 
                  rejected 0 missing 0
.fi
.PP
(some lines broken here to fit the page).
.PP
The date on the first line is the date the binary was built. 
.PP
The active number is the number of connections to that peer
that are actively feeding articles (possibly in the middle of closing, or
waiting momentairly for a new article to send). The sleeping connections
are those that are waiting to try and reconnect due to a previous error. All
connections to decwrl above are completely idle as it has none of either.
.PP
The statistics line (the last line of the ``vixie'' entry for example) is
only generated after the first connection is made. So in the sample above,
data.ramona.vix.com has not been connected to yet, and because the active
and sleeping values are both 0, that means there has been no need to
(or it's currently in the middle of trying the first connect). The host
data.ramona.vix.com actually does do streaming, but as no connection has
yet been made, innfeed assumes that it doesn't. Also, these statistics are
accumulated from the very first connect (i.e. what would show up in
a ``global'' log line)--they're not reset at any time for the life of the
process.
.SH SYSLOG ENTRIES
.PP
There are basically 3 different syslog entries for statistics. Host,
Connection and Global.
.PP
The Host statistics are generated for a given peer at regular intervals
after the first connection is made (or, if the remote is unreachable, after
spooling starts). The Host statistics give totals over all Connections that
have been active during the given time frame. For example (broken here to
fit the page, with ``vixie'' being the peer).
.PP
.nf
  May 23 12:49:08 data innfeed[16015]: vixie checkpoint
		seconds 1381 offered 2744 accepted 1286 
		refused 1021 rejected 437 missing 0 spooled 990
.fi
.PP
.PP
If the ``\-z'' option is used (see below), then when the peer stats are
generated, each Connection will log its stats too. For example, for
connection number zero (from a set of five):
.PP
.nf
  May 23 12:49:08 data innfeed[16015]: vixie:0 checkpoint
		seconds 1381 offered 596 accepted 274 
		refused 225 rejected 97
.fi
.PP
If you only open a maximum of one Connection to a remote, then there will
be a close correlation between Connection numbers and Host numbers, but in
general you can't tie the two sets of number together in any easy or very
meaningful way. When a Connection closes it will always log its stats.
.PP
If all Connections for a Host get closed together, then the Host logs its
stats as ``final'' and resets its counters. If the feed is so busy that
there's always at least one Connection open and running, then after some
amount of time (configured at build time), the Host stats are logged as
final and reset. This is to make generating higher level stats from log
files, by other programs, easier.
.PP
There is one log entry that is emitted for a Host just after its last
Connection closes and innfeed is preparing to exit. This entry contains
counts over the entire life of the process. The ``seconds'' field is from the
first time a Connection was successfully built, or the first time spooling
started. If a Host has been completely idle, it will have no such log entry.
.PP
.nf
  May 23 12:49:08 data innfeed[16015]: decwrl global 
		seconds 1381 offered 34 accepted 22 
		refused 3 rejected 7 missing 0
.fi
.PP
.SH OPTIONS
.TP
.B \-d 
The ``\-d'' flag may be used to specify the initial logging level. All
debugging messages to to stderr (see the ``\-l'' flag below.
.TP
.B \-c
The ``\-c'' flag may be used to specify a different config file from the
default value (the name and location of which is site specific).
.TP
.B \-l
The  ``\-l'' flag may be used to specify a different log file from
stderr. As innd starts innfeed with stderr attached to /dev/null using this
option can be useful in catching any abnormal error messages, or andy
debugging messages (all ``normal'' errors messages go to syslog).
.TP
.B \-b
The ``\-b'' flag may be used to specify a different directory for backlog
file storage and retreival. This is useful in conjunction with the
.B \-x flag.
.TP
.B \-x
The ``\-x'' flag is used to tell innfeed not to expect any article
information from innd but just to process any backlog files that exist and
then exit.
.TP
.B \-z
The ``\-z'' flag is used to cause each connection, in a parallel feed
configuration, to report statistics when the controller for the connections
prints its statistics.
.TP
.B \-y
The ``\-y'' flag is used to allow dynamic peer binding. If this flag is
used and article information is received from innd that specifies an
unknown peer, then the peer name is taken to be the IP name too, and an
association with it is created. Using this it is possible to only 
have the ``default'' line in the innfeed.conf(5) file, provided the 
peername as used
by innd is the same as the ip name.
.TP
.B \-m
The ``\-m'' flag is used to turn on logging of all missing
articles. Normally if an article is missing, innfeed keeps a count, but
logs no further information. When this flag is used, details about
message-id and expected pathname are logged.
.TP
.B \-o
The ``\-o'' flag sets a value of the maximum number of bytes of article
data innfeed is supposed to keep in memory. This doens't work properly yet.
.TP
.B \-p 
The ``\-p'' flag is used to specify the filename to write the pid of the
new process into. You need this if you're running multiple innfeeds.
.TP
.B \-a
The ``\-a'' flag is used to specify the top of the article spool tree.
.TP
.B \-v
When the ``\-v'' flag is given, version information is printed to stderr
and then innfeed exits.
.TP
.B \-h
Use the ``\-h'' flag to print the usage message.
.SH BUGS
.PP
The config file is pretty brain-dead.
.PP
When using the ``-x'' option, the config file entry's
``initial-connection-count'' field will be the total number of connections
created and used--no matter how many big the batch file, and no
matter how big the ``max-connection-count'' field specifies. Thus a value
of 0 for ``initial-connection-count'', means nothing will happen in ``-x''
mode.
.PP
Innfeed does not automatically grab the file out of out.going--this needs
to be prepared for it by external means.
.PP
Probably too many other bugs to count.
.SH FILES
.c$	config file.
.br
.t$	directory for backlog (tape) files.
.SH HISTORY
Written by James Brister <brister@vix.com> for InterNetNews.
.de R$
This is revision \\$3, dated \\$4.
..
.R$ $Id: innfeed.1,v 1.10 1996/12/07 01:37:44 brister Exp $
.SH SEE ALSO
.IR innfeed.conf(5)
