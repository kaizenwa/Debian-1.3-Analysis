srcdir = @srcdir@
VPATH = @srcdir@

rootdir = $(srcdir)/..
@MCFG@@MCF@

CFLAGS = $(XCFLAGS)
CPPFLAGS = $(XCPPFLAGS)
LDFLAGS = $(XLDFLAGS)
DEFS = $(XDEFS)
LIBS = @SHADOWLIB@ $(XLIBS) @TERMNET@ @PAMLIBS@ $(XLIB)
INSTALL = @INSTALL@
INSTALL_PROGRAM = @INSTALL_PROGRAM@
INSTALL_DATA = @INSTALL_DATA@
AR = @AR@

#
# VFS code
#
NETFILES   = tcputil.o ftpfs.o mcfs.o utilvfs.o
NONETFILES = local.o vfs.o tar.o names.o container.o extfs.o @undelfs_o@

VFSSRCS = local.c vfs.c mcfs.c tcputil.c tar.c names.c \
	ftpfs.c container.c mcserv.c extfs.c undelfs.c utilvfs.c

VFSHDRS = vfs.h mcfs.h tcputil.h tar.h container.h ftpfs.h names.h \
	extfs.h undelfs.h

VFSOBJS = $(NONETFILES) @NETFILES@

EXTFSSTUFF = extfs.ini zip.in zoo.in lslR.in ftplist.in README a.in rpm \
	cpio rar.in deb lha.in

#
# Distribution variables
#

DISTVFS = 	Makefile.in $(VFSSRCS) $(VFSHDRS)

all: @LIBVFS@ @mcserv@

.c.o:
	$(CC) -c $(CPPFLAGS) $(DEFS) $(CFLAGS) $<

check:
	@echo no tests are supplied.

mcserv: mcserv.o tcputil.o 
	$(CC) $(LDFLAGS) -o $@ mcserv.o tcputil.o $(LIBS)

libvfs.a: $(VFSOBJS)
	$(RMF) $@
	$(AR) cr $@ $(VFSOBJS)
	-$(RANLIB) $@

showlibdep:
	@echo 'OBJS="$(VFSOBJS)"'

cross:
	$(MAKE) CC=gcc-linux CPP="gcc-linux -E" \
	CPPFLAGS="$(CPPFLAGS) -I/usr/local/lib/gcc-lib/i386-linux-linux/include/ncurses "

TAGS: $(VFSSRCS)
	etags $(VFSSRCS)

clean:
	$(RMF) mcserv *.o core a.out libvfs.a

realclean: clean
	$(RMF) .depend
	$(RMF) TAGS
	$(RMF) *~

distclean:
	-$(RMF) $(srcdir)/*~ $(srcdir)/mcserv $(srcdir)/*.o $(srcdir)/a.out
	-$(RMF) $(srcdir)/core $(srcdir)/libvfs.a $(srcdir)/Makefile
	-if test $(srcdir) = .; then $(MAKE) realclean; fi

install: mcserv install.extfs
	if test x@mcserv@ != x; then \
	    $(INSTALL_PROGRAM) mcserv $(DESTDIR)$(bindir)/$(binprefix)mcserv; \
	fi

install.extfs:
	$(INSTALL_PROGRAM) $(srcdir)/extfs/rpm  $(DESTDIR)$(libdir)/extfs/rpm
	$(INSTALL_PROGRAM) $(srcdir)/extfs/cpio $(DESTDIR)$(libdir)/extfs/cpio
	$(INSTALL_PROGRAM) $(srcdir)/extfs/deb  $(DESTDIR)$(libdir)/extfs/deb

	$(INSTALL_DATA) $(srcdir)/extfs/extfs.ini $(DESTDIR)$(libdir)/extfs/extfs.ini
	$(INSTALL_DATA) $(srcdir)/extfs/README $(DESTDIR)$(libdir)/extfs/README

	$(INSTALL_PROGRAM) extfs/ftplist $(DESTDIR)$(libdir)/extfs/ftplist
	$(INSTALL_PROGRAM) extfs/zip $(DESTDIR)$(libdir)/extfs/zip
	$(INSTALL_PROGRAM) extfs/a $(DESTDIR)$(libdir)/extfs/a
	$(INSTALL_PROGRAM) extfs/zoo $(DESTDIR)$(libdir)/extfs/zoo
	$(INSTALL_PROGRAM) extfs/lslR $(DESTDIR)$(libdir)/extfs/lslR

distcopy:
	$(CP) $(DISTVFS) ../../mc-$(VERSION)/vfs
	cd extfs; $(CP) $(EXTFSSTUFF) ../../../mc-$(VERSION)/vfs/extfs

depend dep: mcdep

fastdeploc:

# ***Dependencies***Do not edit***
@DOTDEPEND@
# ***End of dependencies***
