#!/bin/sh
#
# This script is used to compile yabasic, with or without X.
#

# remove yabasic, if already exists
rm ./yabasic 2>/dev/null


echo "trying xmkmf ..."
echo "--- trying xmkmf" >runme.log
sh <<end >>runme.log 2>&1
xmkmf >>runme.log 2>&1
end

# sucess ?
if [ $? -eq 0 ]
then 
  echo "xmkmf produced Makefile, trying to run make ..."
  echo "--- xmkmf produced Makefile, trying to run make" >>runme.log
  make >>runme.log 2>&1
  # sucess ?
  if [ $? -eq 0 ]     # sucess ?
  then
   echo "make finished successfully, you may now start yabasic !"
   echo "--- make finished successfully, you may now start yabasic" >>runme.log
   exit
  fi
fi

echo "xmkmf failed, trying makefile.simple with X-grafics ..."
echo "--- xmkmf failed, trying makefile.simple with X-grafics" >>runme.log

make -f makefile.simple withx >>runme.log 2>&1

#sucess?
if [ $? -eq 0 ]
then
   echo "make finished successfully, you may now start yabasic !"
   echo "--- make finished successfully, you may now start yabasic" >>runme.log
   exit
fi

echo "could not make with X-grafics, trying without ..."
echo "--- could not make with X-grafics, trying without" >>runme.log

make -f makefile.simple withoutx >>runme.log 2>&1

if [ $? -eq 0 ]
then
   echo "make finished, compiled yabasic WITHOUT grafics !"
   echo "--- make finished, compiled yabasic WITHOUT grafics" >>runme.log
   exit
else
   echo "sorry, could not make yabasic at all !"
   echo "--- sorry, could not make yabasic at all" >>runme.log
fi
