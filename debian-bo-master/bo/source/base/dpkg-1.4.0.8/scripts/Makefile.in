# Copyright (C) 1994 Ian Murdock <imurdock@debian.org>
# Copyright (C) 1994,1995,1996 Ian Jackson <ijackson@nyx.cs.du.edu>
#
#   This is free software; you can redistribute it and/or modify
#   it under the terms of the GNU General Public License as
#   published by the Free Software Foundation; either version 2,
#   or (at your option) any later version.
#
#   This is distributed in the hope that it will be useful, but
#   WITHOUT ANY WARRANTY; without even the implied warranty of
#   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#   GNU General Public License for more details.
#
#   You should have received a copy of the GNU General Public
#   License along with dpkg; if not, write to the Free Software
#   Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.

srcdir = @srcdir@
VPATH = @srcdir@

prefix = @prefix@
bindir = $(prefix)/bin
sbindir = $(prefix)/sbin
datadir = /var/lib/dpkg
altsdatadir = $(datadir)/alternatives
mandir = $(prefix)/man
man1dir = $(mandir)/man1
man8dir = $(mandir)/man8
man1 = 1
man8 = 8
libdir = $(prefix)/lib
dpkglibdir = $(libdir)/dpkg
parsechangelogdir = $(dpkglibdir)/parsechangelog
elispdir = $(libdir)/emacs/site-lisp
etcdir= /etc
altsetcdir = $(etcdir)/alternatives
perlpath = @perlpath@

MAN1 =  dpkg-name dpkg-source 822-date
LSMAN = dpkg-source.$(man1)
LSMANL=	dpkg-gencontrol dpkg-genchanges dpkg-buildpackage \
	dpkg-distaddfile dpkg-parsechangelog dpkg-shlibdeps
EXC =   dpkg-name dpkg-source dpkg-genchanges dpkg-gencontrol dpkg-shlibdeps \
	dpkg-buildpackage dpkg-parsechangelog dpkg-distaddfile 822-date \
	dpkg-scanpackages
MAN8 =	update-rc.d start-stop-daemon update-alternatives install-info \
	dpkg-scanpackages
SBIN =	update-rc.d start-stop-daemon update-alternatives install-info \
	dpkg-divert cleanup-info
LIB =	controllib.pl
ELISP =	debian-changelog-mode.el
CHGLGS=	cl-debian

INSTALL = @INSTALL@
INSTALL_PROGRAM = @INSTALL_PROGRAM@
INSTALL_DATA = @INSTALL_DATA@

.SUFFIXES:	.pl .sh .gzuue

.pl:
		sed <$@.pl 's:^#!/usr/bin/perl:#!$(perlpath):; \
			    s:\$dpkglibdir= "\.":\$dpkglibdir= "$(dpkglibdir)":' \
		  | ../insert-version.pl >$@.new
		chmod +x $@.new
		mv $@.new $@

.sh:
		sed <$@.sh 's:^dpkglibdir=/usr/lib/dpkg$$:dpkglibdir=$(dpkglibdir):' \
		  | ../insert-version.pl >$@.new
		chmod +x $@.new
		mv $@.new $@

.gzuue:
		uudecode <$@.gzuue
		gunzip <$@.gz >$@.new
		test ! -x $@.gz || chmod +x $@.new
		rm $@.gz
		mv $@.new $@

all:		$(EXC) $(SBIN) $(CHGLGS)

clean:
		rm -f $(EXC) $(SBIN) $(CHGLGS) core *.new

distclean:	clean
		rm -f Makefile *.orig *~ *.~* ./#*# i386elf-hello-world.gz

install:	all
		for f in $(EXC) ; do $(INSTALL_PROGRAM) $$f $(bindir)/$$f ; done
		for f in $(MAN1) ; do $(INSTALL_DATA) $$f.1 $(man1dir)/$$f.$(man1) ; done
		for f in $(LSMANL) ; do ln -s $(LSMAN) $(man1dir)/$$f.$(man1) ; done
		for f in $(SBIN) ; do $(INSTALL_PROGRAM) $$f $(sbindir)/$$f ; done
		for f in $(MAN8) ; do $(INSTALL_DATA) $$f.8 $(man8dir)/$$f.$(man8) ; done
		for f in $(LIB) ; do $(INSTALL_DATA) $$f $(dpkglibdir)/$$f ; done
		for f in $(ELISP) ; do $(INSTALL_DATA) $$f $(elispdir)/$$f ; done
		for f in $(CHGLGS) ; do $(INSTALL_PROGRAM) $$f \
			$(dpkglibdir)/parsechangelog/`echo $$f | sed -e 's/^cl-//'` ; \
		done
