# Copyright (C) 1994 Ian Murdock <imurdock@debian.org>
# Copyright (C) 1994,1995 Ian Jackson <ijackson@nyx.cs.du.edu>
#
#   This is free software; you can redistribute it and/or modify
#   it under the terms of the GNU General Public License as
#   published by the Free Software Foundation; either version 2,
#   or (at your option) any later version.
#
#   This is distributed in the hope that it will be useful, but
#   WITHOUT ANY WARRANTY; without even the implied warranty of
#   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#   GNU General Public License for more details.
#
#   You should have received a copy of the GNU General Public
#   License along with dpkg; if not, write to the Free Software
#   Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.

srcdir = @srcdir@
VPATH = @srcdir@

prefix = @prefix@
exec_prefix = $(prefix)
bindir = $(exec_prefix)/bin
libdir = $(prefix)/lib
mandir = $(prefix)/man
man1dir = $(mandir)/man1
man1 = 1

SRC = main.c build.c extract.c info.c
OBJ = main.o build.o extract.o info.o

INSTALL = @INSTALL@
INSTALL_PROGRAM = @INSTALL_PROGRAM@
INSTALL_DATA = @INSTALL_DATA@

CC = @CC@

CFLAGS = @CFLAGS@ @CWARNS@ -g $(XCFLAGS)
LDFLAGS = $(XLDFLAGS)
LIBS = -L../lib -ldpkg $(XLIBS)
ALL_CFLAGS = -I../include -I.. @DEFS@ $(CFLAGS)

.SUFFIXES:	.c .o

.c.o:
		$(CC) $(ALL_CFLAGS) -c $<

all:		dpkg-deb

dpkg-deb:	$(OBJ) ../lib/libdpkg.a
		$(CC) $(LDFLAGS) -o dpkg-deb $(OBJ) $(LIBS)

$(OBJ):				dpkg-deb.h ../config.h ../include/dpkg.h
build.o:			../include/dpkg-db.h
info.o extract.o main.o:	../include/myopt.h
main.o:				../version.h

clean:
		rm -f *.o core dpkg-deb

distclean:	clean
		rm -f Makefile *.orig *~ *.~* ./#*#

install:	all
		$(INSTALL_PROGRAM) -s dpkg-deb $(bindir)/dpkg-deb
		$(INSTALL_DATA) dpkg-deb.1 $(man1dir)/dpkg-deb.$(man1)
