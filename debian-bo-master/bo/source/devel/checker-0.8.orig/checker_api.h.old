/* Declarations for Checker for stubs or user program.
   Copyright 1994, 1995 Tristan Gingold.
		  Written March 1994 by Tristan Gingold.

This program is free software; you can redistribute it and/or
modify it under the terms of the GNU General Public License as
published by the Free Software Foundation; either version 2 of the
License, or (at your option) any later version.

This library is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
General Public License for more details.

You should have received a copy of the GNU General Public License 
along with this program; see the file COPYING.  If not, write to
the Free Software Foundation, Inc., 59 Temple Place - Suite 330,
Boston, MA 02111-1307, USA.

The author may be reached by US/French mail:
		Tristan Gingold 
		8 rue Parmentier
		F-91120 PALAISEAU
		FRANCE
*/

#include <stddef.h>
#ifndef PTR
#define PTR void *
#endif

#define CHKR_UN	0	/* Can't neither read nor write */
#define CHKR_RO	1	/* Read only */
#define CHKR_WO	2	/* Write only */
#define CHKR_RW 3	/* Read and write */
#define CHKR_TW 6	/* Test for write, but no evolution */
#define CHKR_MW 10
#define CHKR_MASK 3	/* mask bits */
#define CHKR_EXEC 4	/* exec right */
#if 1
void chkr_set_right (const PTR ptr, int len, int right);
void chkr_check_addr (const PTR ptr, int len, int right);
void chkr_check_str (const PTR ptr, int right);
void chkr_check_exec (const PTR ptr);
void chkr_check_align (const PTR ptr, int align, int size);
void chkr_copy_bitmap (PTR dest, PTR src, unsigned int len);
void chkr_assert_not_red_zone (const PTR ptr, int len);
#endif
struct mdesc;
int __chkr_read_bitmap (const PTR ptr, unsigned char *bm, int len);
int __chkr_write_bitmap (const PTR ptr, unsigned char *bm, int len);
void __chkr_disp_map (void);
void __chkr_disp_right (const PTR ptr, int len);
void __chkr_check_mdesc (struct mdesc *mdp);
void __chkr_check_intern (void);
void __chkr_disp_heaps (void);
void __chkr_disp_heapgraph (struct mdesc *mdp);
void __chkr_disp_statistics (struct mdesc *mdp);
void __chkr_dump_heap (struct mdesc *mdp);
void __chkr_dump_free (struct mdesc *mdp);
void __chkr_dump_block (PTR block);
void __chkr_disp_shlibs (void);
void __chkr_disp_siginfo (void);
void __chkr_disp_fd (void);

int fd_used_by_prog (int fd);
int fd_returned_by_system (int fd);
int fd_closed (int fd);
int fd_duped (int fdres, int fdd);

extern PTR malloc (size_t size);
extern PTR realloc (PTR ptr, size_t size);
extern PTR calloc (size_t nmemb, size_t size);
extern void free (PTR ptr);
extern PTR memalign (size_t alignment, size_t size);
extern PTR valloc (size_t size);
extern PTR sbrk (int incr);

void chkr_clean_after_fork (void);
void chkr_clean_before_exec (void);

int chkr_report (int i);
void chkr_abort (void) __attribute__ ((noreturn));
int chkr_disp_call_chain (void);
void chkr_printf (const char *message, ...) __attribute__ ((format (printf, 1, 2)));
void chkr_header (const char *message, ...) __attribute__ ((format (printf, 1, 2)));
extern int flag_weak_check_copy;
