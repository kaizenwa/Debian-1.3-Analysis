# Makefile for the windows NT unix server utilities
# Copyright (c) 1996 Cygnus Support.
# All rights reserved.
#
# Redistribution and use in source and binary forms are permitted
# provided that the above copyright notice and this paragraph are
# duplicated in all such forms and that any documentation,
# advertising materials, and other materials related to such
# distribution and use acknowledge that the software was developed
# at Cygnus Support, Inc.  Cygnus Support, Inc. may not be used to
# endorse or promote products derived from this software without
# specific prior written permission.
# THIS SOFTWARE IS PROVIDED ``AS IS'' AND WITHOUT ANY EXPRESS OR
# IMPLIED WARRANTIES, INCLUDING, WITHOUT LIMITATION, THE IMPLIED
# WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.

srcdir = @srcdir@
VPATH = @srcdir@
prefix = @prefix@
exec_prefix = @exec_prefix@

bindir = @bindir@
etcdir = $(exec_prefix)/etc
program_transform_name = @program_transform_name@

INSTALL = $(srcdir)/../../install.sh -c
INSTALL_DATA = $(INSTALL) -m 644
INSTALL_PROGRAM = $(INSTALL)
INSTALL_XFORM = $(INSTALL_PROGRAM) -t='-e $(program_transform_name)'

CC = @CC@

CFLAGS = @CFLAGS@
CXXFLAGS = @CXXFLAGS@

# $(srcdir)/../../include is for getopt.h
INCLUDES = -I$(srcdir)/.. -I$(srcdir)/../include -I$(srcdir)/../../include

ALL_CFLAGS = $(CFLAGS) $(INCLUDES)
ALL_CXXFLAGS = $(CXXFLAGS) $(INCLUDES)

# Passed in from ../Makefile.
EXE_LDFLAGS =

PROGS = mount umount ps kill cygwin

WINSUP_DEPS = $(srcdir)/../winsup.h

all: $(PROGS)

mount: mount.cc $(WINSUP_DEPS)
	$(CC) -o $@ $(srcdir)/mount.cc $(ALL_CXXFLAGS) $(EXE_LDFLAGS)

umount: umount.cc $(WINSUP_DEPS)
	$(CC) -o $@ $(srcdir)/umount.cc $(ALL_CXXFLAGS) $(EXE_LDFLAGS)

ps: ps.cc $(WINSUP_DEPS)
	$(CC) -o $@ $(srcdir)/ps.cc $(ALL_CXXFLAGS) $(EXE_LDFLAGS)

kill: kill.cc  $(WINSUP_DEPS)
	$(CC) -o $@ $(srcdir)/kill.cc $(ALL_CXXFLAGS) $(EXE_LDFLAGS) -lkernel32

cygwin: cygwin.cc $(WINSUP_DEPS)
	$(CC) -o $@ $(srcdir)/cygwin.cc $(ALL_CXXFLAGS) $(EXE_LDFLAGS) -lkernel32

clean:
	rm -f *.o $(PROGS)

realclean: clean
	rm -f  Makefile config.cache 

install:
	for f in $(PROGS) ; \
	do \
	  $(INSTALL_XFORM) $$f $(bindir) ; \
	done
	[ -d $(etcdir) ] || mkdir $(etcdir)
	$(INSTALL_DATA) $(srcdir)/termcap $(etcdir)

Makefile: Makefile.in $(srcdir)/configure.in config.status
	$(SHELL) config.status

config.status: configure
	$(SHELL) config.status --recheck

.NOEXPORT:

.SUFFIXES: .cc .c .o

.c.o:
	$(CC) -c $(ALL_CFLAGS) $<

.cc.o:
	$(CC) -c $(ALL_CXXFLAGS) $<
