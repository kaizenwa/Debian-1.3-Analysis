#!/bin/sh
#
#

RELEASE_VAULT=@@RELEASE_VAULT@@

if [ $# != 2 ] ; then
  echo "usage: $0 host target"
  exit 1
else
  REL=@@RELEASE_TAG@@
  BUNDLE=@@BUNDLE@@
  HOST=$1
  TARGET=$2
fi

INSTALLDIR=$RELEASE_VAULT/$REL/$BUNDLE/$HOST/$TARGET

PATH=/usr/cygnus/$REL/H-$HOST/bin:$PATH

[ -d $RELEASE_VAULT/$REL/$BUNDLE ] || mkdir -p $RELEASE_VAULT/$REL/$BUNDLE
[ -d $RELEASE_VAULT/$REL/$BUNDLE/$HOST ] || mkdir -p $RELEASE_VAULT/$REL/$BUNDLE/$HOST
[ -d $RELEASE_VAULT/$REL/$BUNDLE/$HOST/gen ] || mkdir -p $RELEASE_VAULT/$REL/$BUNDLE/$HOST/gen
[ -d $RELEASE_VAULT/$REL/$BUNDLE/$HOST/$TARGET ] || mkdir -p $RELEASE_VAULT/$REL/$BUNDLE/$HOST/$TARGET

make -w CC="@@CC@@" prefix=$INSTALLDIR exec_prefix=$INSTALLDIR/H-$HOST install-no-fixedincludes install-info

echo Fixing permissions in $INSTALLDIR for release....

# this could be made into a single chmod command if you use GNU chmod....
chmod -R go=u $INSTALLDIR
chmod -R u+w $INSTALLDIR
chmod -R go-w $INSTALLDIR


for i in dir-exists configured built installed cleanedup ; do
  touch $RELEASE_VAULT/$REL/$BUNDLE/$HOST/.$TARGET-$i
done

echo "$HOST $TARGET toolchain installed"
