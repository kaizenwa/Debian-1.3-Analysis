#
#  Makefile for FastCGI development kit
#
#  Open Market, Inc.
#
#  $Id: Makefile.in,v 1.11 1996/08/15 14:21:10 snapper Exp $
#
SHELL=/bin/sh
#
exec_prefix   = @exec_prefix@
prefix        = @prefix@
common_prefix = @common_prefix@
CVS_TAG =       @CVS_TAG@
BIN_DIR       = $(exec_prefix)/bin
LIB_DIR       = $(prefix)/lib
LINC_DIR      = $(prefix)/include
COMMON_DIR    = $(common_prefix)
INC_DIR       = $(common_prefix)/include
DOC_DIR       = $(common_prefix)/doc
MAN_DIR       = $(common_prefix)/man
MAN1_DIR      = $(MAN_DIR)/man1
MAN3_DIR      = $(MAN_DIR)/man3
RANLIB        = @RANLIB@

INSTALL		= @INSTALL@
INSTALL_PROGRAM	= @INSTALL_PROGRAM@
INSTALL_DATA	= @INSTALL_DATA@

TARGET_DIRS = $(BIN_DIR) $(LIB_DIR) $(COMMON_DIR) $(INC_DIR) $(MAN_DIR) \
	      $(MAN1_DIR) $(MAN3_DIR) $(LINC_DIR)

all:
	(cd libfcgi; make all)
	(cd cgi-fcgi; make all)
	(cd examples; make all)

export:
	@ for i in $(TARGET_DIRS); \
	  do \
	  if test ! -d $$i; then \
	    echo "Creating $$i";\
	    mkdir -p $$i;\
	  fi;\
	  done;

	$(INSTALL_DATA)    include/fastcgi.h $(INC_DIR)
	$(INSTALL_DATA)    include/fcgi_stdio.h $(INC_DIR)
	$(INSTALL_DATA)    include/fcgiapp.h $(INC_DIR)
	$(INSTALL_DATA)    include/fcgiappmisc.h $(INC_DIR)
	$(INSTALL_DATA)    include/fcgimisc.h $(INC_DIR)
	$(INSTALL_DATA)    include/fcgi_config.h $(LINC_DIR)
	$(INSTALL_DATA)    libfcgi/libfcgi.a $(LIB_DIR)
	$(RANLIB)          $(LIB_DIR)/libfcgi.a
	$(INSTALL_PROGRAM) cgi-fcgi/cgi-fcgi $(BIN_DIR)
	$(INSTALL_DATA)    doc/cgi-fcgi.1 $(MAN1_DIR)
	$(INSTALL_DATA)    doc/FCGI_Accept.3 $(MAN3_DIR)
	$(INSTALL_DATA)    doc/FCGI_Finish.3 $(MAN3_DIR)
	$(INSTALL_DATA)    doc/FCGI_SetExitStatus.3 $(MAN3_DIR)
	$(INSTALL_DATA)    doc/FCGI_StartFilterData.3 $(MAN3_DIR)


reconfig: clean
	uname -rs >config.uname
	./configure

clean:
	rm -f *.a *.o core.* errs *~ \#* TAGS *.E a.out
	rm -f *.a *.o core.* errs *~ \#* TAGS *.E a.out
	rm -f config.cache config.log config.status config.uname
	(cd libfcgi; make clean)
	(cd cgi-fcgi; make clean)
	(cd examples; make clean)

# ----------------------------------------------------------------------------
