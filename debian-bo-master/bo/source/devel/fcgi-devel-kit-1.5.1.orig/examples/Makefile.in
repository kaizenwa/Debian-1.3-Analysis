#
#  Makefile for FastCGI examples directory
#
#  Open Market, Inc.
#
#  $Id: Makefile.in,v 1.8 1996/10/30 14:37:52 mbrown Exp $
#

SHELL	= /bin/sh
CC	= @CC@
CC_PURE	= @CC_PURE@
INCLUDEDIR  = ../include
CFLAGS	= @CCDEFS@ @PROFILE@ -I$(INCLUDEDIR)
LIBS	= @LIBS@
RANLIB	= @RANLIB@

PERL_INSTALL = /usr/local/bin/perl5-fcgi
TCL_INSTALL  = /usr/local/bin/tcl7.4-fcgi

INCLUDES    = $(INCLUDEDIR)/fastcgi.h $(INCLUDEDIR)/fcgiapp.h \
	      $(INCLUDEDIR)/fcgimisc.h $(INCLUDEDIR)/fcgiappmisc.h \
              $(INCLUDEDIR)/fcgi_stdio.h
LIBDIR      = ../libfcgi
LIBFCGI	    = $(LIBDIR)/libfcgi.a
TARGETS	    = tiny-cgi.cgi tiny-fcgi tiny-fcgi2 tiny-authorizer \
	      echo echo2 sample-store sockets echo.fcg perl tclsh \
              SampleStore.state.0 SampleStore.state.1 log-dump

all: $(TARGETS)

tiny-cgi.cgi: tiny-cgi.o
	$(CC_PURE) $(CFLAGS) tiny-cgi.o -o tiny-cgi.cgi

tiny-fcgi: tiny-fcgi.o $(LIBFCGI)
	$(CC_PURE) $(CFLAGS) tiny-fcgi.o -o tiny-fcgi $(LIBFCGI) $(LIBS)

tiny-fcgi2: tiny-fcgi2.o $(LIBFCGI)
	$(CC_PURE) $(CFLAGS) tiny-fcgi2.o -o tiny-fcgi2 $(LIBFCGI) $(LIBS)

tiny-authorizer: tiny-authorizer.o $(LIBFCGI)
	$(CC_PURE) $(CFLAGS) tiny-authorizer.o -o tiny-authorizer $(LIBFCGI) $(LIBS)

echo: echo.o $(LIBFCGI)
	$(CC_PURE) $(CFLAGS) echo.o -o echo $(LIBFCGI) $(LIBS)

echo2: echo2.o $(LIBFCGI)
	$(CC_PURE) $(CFLAGS) echo2.o -o echo2 $(LIBFCGI) $(LIBS)

sample-store: sample-store.o tclHash.o $(LIBFCGI)
	$(CC_PURE) $(CFLAGS) sample-store.o tclHash.o -o sample-store $(LIBFCGI) $(LIBS)

log-dump: log-dump.o $(LIBFCGI)
	$(CC_PURE) $(CFLAGS) log-dump.o -o log-dump $(LIBFCGI) $(LIBS)

sockets:
	mkdir sockets

echo.fcg:
	rm -f echo.fcg
	ln -s echo echo.fcg

perl:
	rm -f perl
	ln -s $(PERL_INSTALL)/bin/perl perl

tclsh:
	rm -f tclsh
	ln -s $(TCL_INSTALL)/bin/tclsh7.4 tclsh

SampleStore.state.0:
	mkdir SampleStore.state.0

SampleStore.state.1:
	mkdir SampleStore.state.1

clean:
	rm -rf sockets SampleStore.state.0 SampleStore.state.1
	rm -f *.a *.o core.* errs *~ \#* TAGS *.E a.out $(TARGETS)

# ----------------------------------------------------------------------------

tiny-cgi.o: tiny-cgi.c $(INCLUDES)

tiny-fcgi.o: tiny-fcgi.c $(INCLUDES)

tiny-fcgi2.o: tiny-fcgi2.c $(INCLUDES)

tiny-authorizer.o: tiny-authorizer.c $(INCLUDES)

echo.o: echo.c $(INCLUDES)

echo2.o: echo2.c $(INCLUDES)

sample-store.o: sample-store.c $(INCLUDES)

tclHash.o: tclHash.c

log-dump.o: log-dump.c $(INCLUDES)
