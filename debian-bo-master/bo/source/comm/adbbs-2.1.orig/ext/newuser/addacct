#!/usr/bin/perl
;# addacct (c) 1995, 1996 Chris Church / aD! Data Systems
;# psylark@ad.org

$fdir = "/tmp/acctf";
opendir(fdir, $fdir) || die "Could Not Open File Dir:$!\n";
@nfiles = grep(!/^\./, readdir(fdir));
closedir(fdir);
foreach $i (0 .. $#nfiles) {
	local($curfile) = "$fdir/$nfiles[$i]";
	open(curfile) || warn "Could Not Open $curfile : $!\n";
	while(<curfile>) {
		if (/login\s*(.*)/) {
			push(@logins, $1);
			}
		if (/passwd\s*(.*)/) {
			push(@passwd, $1);
			}
		if (/gcos\s*(.*)/) {
			push(@gcos, $1);
			}
		}
	close(curfile);
	system("/bin/rm", "$curfile");
	}
foreach $i (0 .. $#logins) {
	system("/usr/sbin/useradd -g bbs -d /usr/multi/bbs/users/${logins[$i]} -c \"$gcos[$i]\" $logins[$i]") || warn "Could Not add User $logins[$i] : $!\n";
	system("/bin/mkdir", "/usr/multi/bbs/users/$logins[$i]");
	system("/bin/chown", "${logins[$i]}.bbs", "/usr/multi/bbs/users/$logins[$i]");
	system("/usr/local/bin/expect-files/autopasswd", "$logins[$i]", "$passwd[$i]");
	system("/bin/passwd", "-x 90", "$logins[$i]");
	system("/bin/passwd", "-w 80", "$logins[$i]");
}	

	 
