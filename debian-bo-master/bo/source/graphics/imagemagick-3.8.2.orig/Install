#!/usr/local/bin/perl
#
#  Assumes you have these directories (see README):
#    ImageMagick/hdf
#    ImageMagick/jbig
#    ImageMagick/jpeg
#    ImageMagick/magick
#    ImageMagick/mpeg
#    ImageMagick/png
#    ImageMagick/tiff
#    ImageMagick/xtp
#    ImageMagick/zlib
#
#  type
#
#    Install sun
#
#  Substitute the appropriate machine type (aix, hpux, sgi, etc).
#
#
$ENV{'LD_LIBRARY_PATH'}="/usr/dt/lib:/usr/ucblib:/opt/SUNWspro/lib:/opt/SUNWspro/C2.0.1:/usr/ccs/lib:${OPENWINHOME}/lib:/opt/X11R5/lib:/opt/gnu/lib";
$os=shift || die "Usage: Install system-type\n";
-M "display.c" || die "Must be in ImageMagick directory to run Install\n";
&compile($os,"hdf","allnofortran",0);
&compile($os,"jbig","",0);
&compile($os,"jpeg","",0);
&compile($os,"mpeg","",0);
&compile($os,"png","",0);
&compile($os,"tiff","",0);
&compile($os,"xtp","",1);
&compile($os,"zlib","",0);
&compile($os,"magick","",1);
&compile($os,".","",1);

sub compile
{
  local($os,$name,$target,$x) = @_;

  chdir $name || die "Can't change directory to $name: $!.\n";
  print "Compiling $name...\n";
  unlink "config.cache";
  system "/bin/rm -f *.o";
  system "/bin/rm -f *.a";
  system "/bin/rm -f *.so";
  system "/bin/rm -f lib*";
  system "/bin/rm -rf shared";
  system "/bin/cp Makefile.noX Makefile";
  system "/bin/cp Makefile.$os Makefile";
  system "./configure -quiet";
  system "xmkmf" unless $x == 0;
  system "make Makefiles" unless $x == 0;
  system "make clean";
  system "make -k $target &" unless $name =~ "magick";
  chdir "..";
}
