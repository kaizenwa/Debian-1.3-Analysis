#ifndef XCOMM
#define XCOMM #
#endif

XCOMM  NOTE: AS of X11R6 the official comment for Imakefile is the word XCOMM

XCOMM Copyright (c) 1985 by Supoj Sutanthavibul
XCOMM Copyright (c) 1994 by Brian V. Smith
XCOMM Parts Copyright (c) 1991 by Paul King

XCOMM The X Consortium, and any party obtaining a copy of these files from
XCOMM the X Consortium, directly or indirectly, is granted, free of charge, a
XCOMM full and unrestricted irrevocable, world-wide, paid up, royalty-free,
XCOMM nonexclusive right and license to deal in this software and
XCOMM documentation files (the "Software"), including without limitation the
XCOMM rights to use, copy, modify, merge, publish, distribute, sublicense,
XCOMM and/or sell copies of the Software, and to permit persons who receive
XCOMM and/or sell copies of the Software subject to the restriction stated
XCOMM below, and to permit persons who receive copies from any such party to
XCOMM do so, with the only requirement being that this copyright notice remain
XCOMM intact.
XCOMM This license includes without limitation a license to do the foregoing
XCOMM actions under any patents of the party supplying this software to the 
XCOMM X Consortium.
XCOMM
XCOMM Restriction: The GIF encoding routine "GIFencode" in f_wrgif.c may NOT
XCOMM be included if xfig is to be sold, due to the patent held by Unisys Corp.
XCOMM on the LZW compression algorithm.
XCOMM If you wish to sell xfig, you must comment out the USEGIF symbol below
XCOMM by putting the word "XCOMM" in front of it.  Be sure to make a new
XCOMM Makefile after that ("make Makefile").

#define USEGIF true

XCOMM If you don't have the JPEG library or don't want to use JPEG, comment
XCOMM out the following line

#define USEJPEG true

#ifdef InstallManPage
#undef InstallManPage
#endif
#define InstallManPage(file,dest)                                       @@\
InstallManPageLong(Doc/file,dest,file)

XCOMM Uncomment the following definition for XAWLIB if you want to use
XCOMM the 3d Athena Widget Set (highly recommended!)

XAWLIB = -lXaw3d

XCOMM Uncomment the following if needed for DECstations running older X11R4 
XCOMM INCROOT=/usr/include/mit

XCOMM Uncomment the #define for USEXPM if you have the XPM (color pixmap)
XCOMM package and you would like to use the following:
XCOMM USEXPM will allow import/export of XPM files
XCOMM USEXPM_ICON uses a color xpm icon for xfig itself (USEXPM must be
XCOMM	defined if you use USEXPM_ICON)
XCOMM You need XPM version 3.4c or newer.  This is available from ftp.x.org
XCOMM   in /contrib/libraries.
XCOMM Change XPMLIB if necessary to point to the xpm library (libXpm)
XCOMM Change XPMINC if necessary to point to the include file for xpm (xpm.h)

#define USEXPM true
#define USEXPM_ICON true

#ifdef USEXPM
XPMLIBDIR = /usr/lib
XPMINC = -I/usr/include/X11
XPMLIB = -L$(XPMLIBDIR) -lXpm
#endif

XCOMM If you have installed the jpeg library on your system, uncomment the
XCOMM USEINSTALLEDJPEG variable, change the JPEGLIBDIR variable to the directory
XCOMM where your jpeg library resides and change the JPEGINC to the 
XCOMM directory where your jpeg header files (include) reside.
XCOMM You must have version 5b or newer of the jpeg library.
XCOMM If you haven't installed the jpeg library leave the XCOMM comment in and
XCOMM set JPEGLIBDIR after the #else to the directory where you have the source
XCOMM for jpeg.

#ifdef USEJPEG

#define USEINSTALLEDJPEG

#ifdef USEINSTALLEDJPEG
JPEGLIBDIR = /usr/local/lib
JPEGINC = -I/usr/include/X11
JPEGLIB = -L$(JPEGLIBDIR) -ljpeg
#else
JPEGLIBDIR = ../jpeg-5b
JPEGCONF = configure
JPEGINC = -I/$(JPEGLIBDIR)
JPEGLIB = $(JPEGLIBDIR)/libjpeg.a
DEPLIBJPEG = $(JPEGLIBDIR)/libjpeg.a
#endif /* USEINSTALLEDJPEG */

#endif /* USEJPEG */

XCOMM If using an input tablet uncomment the following

XCOMM TABLIB = $(XILIB)
XCOMM USETAB = -DUSE_TAB

XCOMM uncomment the following line if your compiler supports
XCOMM inline functions. With the "INLINE" keyword, you should notice that
XCOMM the display will be a bit faster in complex figures

XCOMM USEINLINE = -DUSE_INLINE

XCOMM use (and change) the following if you want the multi-key data base file
XCOMM somewhere other than the standard X11 library directory
XCOMM XFIGLIBDIR =		/usr/local/lib/X11/xfig

XCOMM use this if you want the multi-key data base file in the standard X11 tree
XFIGLIBDIR =		$(LIBDIR)/xfig

DIR_DEFS=		-DXFIGLIBDIR=\"$(XFIGLIBDIR)\"
#if (defined(VaxArchitecture) && !defined(UltrixArchitecture)) || \
    (defined(RtArchitecture) && !defined(AIXArchitecture)) || \
    defined(titan) || \
    (defined(SunOSPlatform) && (OSMinorVersion==0))
HAVE_NO_NOSTRSTR = -DNOSTRSTR
#endif

XCOMM If your system doesn't have strstr undefine the following definition
XCOMM HAVE_NO_NOSTRSTR = -DNOSTRSTR

XCOMM If your system doesn't have strcasecmp and/or strncasecmp
XCOMM undefine the following two definitions

XCOMM HAVE_NO_STRCASECMP = -DHAVE_NO_STRCASECMP
XCOMM HAVE_NO_STRNCASECMP = -DHAVE_NO_STRNCASECMP

STRDEFINES = $(HAVE_NO_NOSTRSTR) \
		$(HAVE_NO_STRNCASECMP) \
		$(HAVE_NO_STRCASECMP)

XCOMM For the rotated text code:
XCOMM   Add one of `-DCACHE_XIMAGES' or `-DCACHE_BITMAPS' to decide what is
XCOMM   cached.  If you are converned about memory usage in your X server (e.g.
XCOMM   if you are using an X terminal) then you might want to cache Ximages,
XCOMM   which reside on the client-side.  On the other hand it is much slower,
XCOMM   so you might want to cache bitmaps (which reside in the X server)
XCOMM   instead.
XCOMM   Add `-DCACHE_SIZE_LIMIT=xxxx' where xxxx is the cache size in kilobytes.
XCOMM   A cache size of zero turns caching off.

CACHE = -DCACHE_BITMAPS -DCACHE_SIZE_LIMIT=300

XCOMM For SYSV systems with BSD-style printer command which use lpr instead of 
XCOMM lp (SGI is one such machine), add -DBSDLPR to the DEFINES variable
XCOMM
XCOMM If you have VERY large objects (e.g. polylines etc) you may want to
XCOMM increase MAXNUMPTS, the maximum number of points that are displayed. The
XCOMM default can be found in w_drawprim.h.  This option may be specified by
XCOMM adding -DMAXNUMPTS=xxxx to the DEFINES line, where xxxx is the maximum
XCOMM number of vertices.

XCOMM remove -DGSBIT from the DEFINES if you DON'T want to have gs (Ghostscript)
XCOMM generate a preview bitmap for Encapsulated PostScript objects if they
XCOMM don't have one.  If you do use Ghostscript you will need version 2.4 or
XCOMM later, and it must have the 'pcx256' and 'pbmraw' devices compiled in
XCOMM besides any other device drivers you already use with it.
XCOMM See the Ghostscript Makefile for details.

XCOMM Additionally, there is a bug in the pcx driver in Aladdin Ghostscript
XCOMM versions prior to 3.32, which writes an incorrect pcx file for images
XCOMM with odd width (not even).  The following compile-time flag PCXBUG is
XCOMM set to make xfig add one pixel to the width of an odd-width image
XCOMM it reads in the pcx output from Ghostscript.
XCOMM If you have Aladdin Ghostscript 3.32 or newer (which wasn't released
XCOMM as of this writing) you may comment out PCXBUG and your images will
XCOMM have the proper width.  However, one pixel extra in width shouldn't
XCOMM matter for most imported eps files.

XCOMM PCXBUG = -DPCXBUG

XCOMM *** You shouldn't have to change anything below this point. ***

#ifdef USEGIF
DUSEGIF = -DUSE_GIF
WRGIFS = f_wrgif.c
WRGIFO = f_wrgif.o
#endif

#ifdef USEJPEG
DUSEJPEG = -DUSE_JPEG
READJPEGS = f_readjpg.c
READJPEGO = f_readjpg.o
WRJPEGS = f_wrjpg.c
WRJPEGO = f_wrjpg.o
#endif

#ifdef USEXPM
DUSEXPM = -DUSE_XPM
READXPMS = f_readxpm.c
READXPMO = f_readxpm.o
WRXPMS = f_wrxpm.c
WRXPMO = f_wrxpm.o
#ifdef USEXPM_ICON
DUSEXPMICON = -DUSE_XPM_ICON
#endif
#endif

DEFINES =             $(STRDEFINES) -DGSBIT $(USEINLINE) $(DUSEXPM) \
			$(DUSEXPMICON) $(DUSEGIF) $(DUSEJPEG)

XFIGSRC =	d_arc.c d_arcbox.c d_box.c d_ellipse.c d_picobj.c \
		d_subspline.c d_line.c d_regpoly.c d_spline.c d_text.c \
		e_addpt.c e_align.c e_arrow.c e_break.c e_compound.c \
		e_convert.c e_copy.c e_delete.c e_deletept.c \
		e_edit.c e_flip.c e_glue.c e_move.c \
		e_movept.c e_rotate.c e_scale.c e_update.c \
		f_load.c f_neuclrtab.c f_picobj.c f_read.c f_readold.c \
		f_readeps.c f_readxbm.c f_readgif.c $(READJPEGS) f_readpcx.c $(READXPMS) \
		f_save.c f_util.c \
		f_wrcom.c $(WRJPEGS) f_wrxbm.c f_wrpcx.c $(WRXPMS) $(WRGIFS) \
		main.c mode.c object.c resources.c \
		u_bound.c u_create.c u_drag.c u_draw.c \
		u_elastic.c u_error.c u_fonts.c u_free.c u_geom.c \
		u_list.c u_markers.c u_pan.c u_print.c \
		u_redraw.c u_scale.c u_search.c u_translate.c u_undo.c \
		w_browse.c w_capture.c \
		w_canvas.c w_cmdpanel.c w_color.c w_cursor.c w_dir.c w_drawprim.c \
		w_export.c w_file.c w_fontbits.c w_fontpanel.c w_grid.c \
		w_icons.c w_indpanel.c w_modepanel.c w_mousefun.c w_msgpanel.c \
		w_print.c w_rottext.c w_rulers.c w_setup.c w_util.c w_zoom.c

XFIGOBJ =	d_arc.o d_arcbox.o d_box.o d_ellipse.o d_picobj.o \
		d_subspline.o d_line.o d_regpoly.o d_spline.o d_text.o \
		e_addpt.o e_align.o e_arrow.o e_break.o e_compound.o \
		e_convert.o e_copy.o e_delete.o e_deletept.o \
		e_edit.o e_flip.o e_glue.o e_move.o \
		e_movept.o e_rotate.o e_scale.o e_update.o \
		f_load.o f_neuclrtab.o f_picobj.o f_read.o f_readold.o \
		f_readeps.o f_readxbm.o f_readgif.o $(READJPEGO) f_readpcx.o $(READXPMO) \
		f_save.o f_util.o \
		f_wrcom.o $(WRJPEGO) f_wrxbm.o f_wrpcx.o $(WRXPMO) $(WRGIFO) \
		main.o mode.o object.o resources.o \
		u_bound.o u_create.o u_drag.o u_draw.o \
		u_elastic.o u_error.o u_fonts.o u_free.o u_geom.o \
		u_list.o u_markers.o u_pan.o u_print.o \
		u_redraw.o u_scale.o u_search.o u_translate.o u_undo.o \
		w_browse.o w_capture.o \
		w_canvas.o w_cmdpanel.o w_color.o w_cursor.o w_dir.o w_drawprim.o \
		w_export.o w_file.o w_fontbits.o w_fontpanel.o w_grid.o \
		w_icons.o w_indpanel.o w_modepanel.o w_mousefun.o w_msgpanel.o \
		w_print.o w_rottext.o w_rulers.o w_setup.o w_util.o w_zoom.o

XCOMM Other dependencies should be handled by "make depend"

MAINDEPFILES =  fig.icon.X patchlevel.h version.h

SRCS = $(XFIGSRC)
OBJS = $(XFIGOBJ)

EXTRA_INCLUDES = $(JPEGINC) $(XPMINC)
DEPLIBS = XawClientDepLibs

LOCAL_LIBRARIES = 	$(JPEGLIB)
SYS_LIBRARIES= 		-lm $(XPMLIB) $(TABLIB) XawClientLibs

#define PassCDebugFlags

xfig: $(DEPLIBJPEG)

XCOMM only compile our jpeg if the use doesn't have one installed

#ifdef USEJPEG

#ifndef USEINSTALLEDJPEG
$(JPEGLIBDIR)/libjpeg.a: $(JPEGLIBDIR)/jconfig.h
	cd $(JPEGLIBDIR); $(MAKE) libjpeg.a

$(JPEGLIBDIR)/jconfig.h:
	cd $(JPEGLIBDIR) ; ./$(JPEGCONF) CC='$(CC)'
#endif /* USEINSTALLEDJPEG */

#endif /* USEJPEG */

PROGRAM = xfig
AllTarget(xfig)

ComplexProgramTarget(xfig)
MakeDirectories(install,$(XFIGLIBDIR))
InstallNonExec(CompKeyDB,$(XFIGLIBDIR))
InstallAppDefaults(Fig)
InstallAppDefaults(Fig-color)
SpecialObjectRule(main.o, $(MAINDEPFILES), $(USETAB) )
XCOMM f_read.c and u_error.c use version.h
SpecialObjectRule(f_read.o, $(MAINDEPFILES), $(USETAB) )
SpecialObjectRule(u_error.o, $(MAINDEPFILES), $(USETAB) )
#ifdef USEJPEG
#ifndef USEINSTALLEDJPEG
SpecialObjectRule(f_readjpg.o, $(JPEGLIBDIR)/jconfig.h, NullParameter )
SpecialObjectRule(f_wrjpg.o, $(JPEGLIBDIR)/jconfig.h, NullParameter )
#endif /* USEINSTALLEDJPEG */
#endif /* USEJPEG */
SpecialObjectRule(f_readeps.o, NullParameter, $(PCXBUG))
SpecialObjectRule(w_canvas.o, NullParameter, $(DIR_DEFS))
SpecialObjectRule(w_rottext.o, NullParameter, $(CACHE))
