.\" Marcus J. Ranum, 1993
.\" Copyright (C) Trusted Information Systems, Inc.
.\" All rights reserved
.TH PLUG-GW 8 "26 August 1993"
.SH NAME
plug-gw - generic TCP plugboard proxy
.SH SYNOPSIS
.B plug-gw portnumber/name
[invoked from inetd]
.SH DESCRIPTION
.IX  "plug-gw"  ""  "\(em TCP plugboard proxy server"
.LP
.B plug-gw
provides pass-through TCP services with logging and
access control for generic connection-oriented
applications like NNTP.
When
.B plug-gw
is invoked from
.B inetd(8),
it reads its configuration and checks to see if the
system that has just connected is permitted to use the
proxy. If not, it shuts down and logs the connection.
If the peer is permitted to use the proxy,
.B plug-gw
determines, based on its configuration, what host to
connect to on the "other side".
.PP
The service port
.B plug-gw
is servicing must be specified on the command line.
.SH OPTIONS
.LP
.B plug-gw
reads its configuration rules and permissions
information from the firewall configuration
table
.B netperm-table,
retrieving all rules specified for "plug-gw".
The following configuration rules are recognized:
.TP
.B timeout seconds
specifies a timeout value, after which to disconnect
inactive connections. If no timeout is specified,
the default is to remain connected until one side
or the other closes its connection.
.TP
.B port portid host-pattern [options]
specifies a connection rule. When a connection is
made, a match is searched for on the port-id and
calling host. The port-id may be either a numeric
value (e.g.: 119) or a value from
.B /etc/services
(e.g.: "nntp"). If the calling port matches, then
the host-pattern is checked for a match, following
the standard address matching rules employed by the
firewall. If the rule matches, the connection will
be made based on the remaining options in the rule,
all of which begin with '-'. Sub-options are:
.IP
.B \-plug-to host
specifies the name or address of the host to connect
to. This option is mandatory.
.IP
.B \-privport
indicates that a reserved port number should be
used when connecting. Reserved port numbers must
be specified for protocols like
.B rlogin
which rely on them for "security."
.IP
.B \-port portid
specifies a different port. The default port is
the same as the port used by the incoming connection.
.SH INSTALLATION
.LP
To install
.B plug-gw
first place the executable in a system area, then modify
.B inetd.conf(5)
to install
.B plug-gw
for whatever services will be plugboarded. Reinitialize
.B inetd(8)
and test by connecting to the port.
.LP
.B plug-gw
was designed to permit "tunnelling" NNTP traffic through
firewalls, but it can be used for a variety of purposes
such as permitting remote access to a single service on
a single host. Typically, when configured for NNTP traffic,
one configures one's software so that internal NNTP
connections to the outside news server connect to
the firewall and are automatically plugboarded to the
external NNTP server, and vice versa. The USENET news
software must then be configured so that both the internal
and external NNTP servers believe they are exchanging news
with the firewall machine.
.SH EXAMPLE
.TP
The following entries permit NNTP transfer through a firewall
bastion host. In this example the interior news server
host is "foo.us.org" (111.11.1.11) and the externam news server is
"nntp.outside.someplace" (222.22.2.22).  Our bastion host, where
the software is installed is "bastion.us.org". On the bastion
host, we place an entry for the NNTP service in inetd.conf:
.sp
.nf
.na
nntp stream  tcp  nowait  root  /usr/local/etc/plug-gw plug-gw nntp
.fi
.ad
.sp
The plug gateway is invoked as "plug-gw nntp" to inform it that
it is providing NNTP service. The configuration entries in
netperm-table are as follows:
.sp
.nf
.na
plug-gw: timeout 60
plug-gw: port webster 111.11.1.* -plug-to WEBSTER.LCS.MIT.EDU -port webster
plug-gw: port nntp 111.11.1.11 -plug-to 222.22.2.22 -port nntp
plug-gw: port nntp 222.22.2.22 -plug-to 111.11.1.11 -port nntp
.fi
.ad
.sp
Whenever 111.11.1.11 connects to the bastion host, it is automatically
connected to 222.22.2.22's nntp service. The news software on 111.11.1.11
should be configured to believe that its news server is the bastion
host "bastion.us.org", since that is the host to which it transfers
and receives news. Note too that a simple webster service is provided
by plugging webster on another host over the internet to the webster
service port on the bastion host.
.SH FILES
.PD 0
.TP 20
.B /etc/inetd.conf
.B netperm-table
.SH SEE ALSO
.BR netperm-table (5)
.BR inetd (8)
.SH BUGS
.LP
Since incoming connection hosts can be wildcarded,
.B plug-gw
works well in a many-to-one relationship but does not work
at all in a one-to-many relationship. If, for example, a
site has 3 news feeds - it is easy to configure plug-gw
to plugboard any connections from those 3 hosts to an
internal news server, but unless there are multiple
instances of
.B plug-gw
on different ports, and the internal news server's
software can support connecting on a non-standard
port, modification to software will be required.
