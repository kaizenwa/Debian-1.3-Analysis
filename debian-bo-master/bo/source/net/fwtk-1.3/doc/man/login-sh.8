.\" Marcus J. Ranum, 1993
.\" Copyright (C) Trusted Information Systems, Inc.
.\" All rights reserved
.TH LOGIN-SH 8 "2 October 1993"
.SH NAME
login-sh - authenticating login shell
.SH SYNOPSIS
.B login-sh
\[invoked from /bin/login\]
.SH DESCRIPTION
.IX  "login-sh"  ""  "\(em authenticating login shell"
.LP
.B login-sh
provides a simple interface to the authentication service for
login by replacing the user's login shell with a "wrapper"
that requires them to authenticate first, then executes the
real login shell.
.B login-sh
may be used in conjunction with or as a replacement for passwords
in the password file
.I /etc/passwd.
The user's actual login shell information is stored in an external
file.
.LP
Note that
.B login-sh
runs as the user, with their permissions. This is attractive, as
it separates the authentication policy from the permissions granting
policy (/bin/login).
.SH OPTIONS
.LP
.B login-sh
reads its configuration rules and permissions
information from the firewall configuration
table
.B netperm-table,
retrieving all rules specified for "login-sh".
The following configuration rules are recognized:
.TP
.B authserver address port
specifies the network address and service port of the authentication
server to use. (See
.B authsrv)
.TP
.B shellfile pathname
specifies a file that contains information about users' login shells.
The shell configuration file. Empty lines and lines with a '#' as the
first character are discarded or treated as comments. The format of
the shell configuration file is a list of entries, one per line, in
the form of:
.sp
.nf
.na
userid  executable parameter-0 [parameter-1] [parameter-n]
.ad
.fi
.sp
The first three values must be defined. The
.I userid
field matches the login name of the user invoking
.B login-sh
from the
.B /etc/passwd
file. The second field should specify the executable
pathname of the program to run after authentication is
completed. The third and remaining fields are parameters to
pass to the executable program, starting at parameter zero.
Many command interpreters check the name of parameter zero
.I (argv[0])
to determine if they are a login shell. For such command
interpreters, one should be careful to define them with the
expected form, typically a leading dash '-'.
.SH INSTALLATION
.LP
To install
.B login-sh
first place the executable in a system area, and define the
.B shellfile
and
.B authserver
options in
.B netperm-table.
Systems that are using
.B login-sh
should have all programs that permit users to change their login
shells disabled, or should have the setuid bit stripped.
.LP
Users password file entries should resemble:
.sp
.nf
.na
mjr::100:10:Marcus J Ranum:/home/mjr:/usr/local/etc/login-sh
.fi
.ad
.sp
with a sample
.B shellfile
entry for
.I mjr
that resembles:
.sp
.nf
.na
mjr	/usr/bin/ksh   -ksh
.fi
.ad
.sp
Note in the example, that the pathname (/usr/bin/ksh) and the first
parameter for the program ("-ksh") are different. There must be a
minimum of two parameters for each login shell that is defined.
.LP
Users wishing both password authentication and secondary authentication
may set passwords on their entries in
.B /etc/passwd
as well as using
.B login-sh.
.SH FILES
.PD 0
.TP 20
.BR netperm-table
.BR shellfile
.BR /etc/passwd
.SH SEE ALSO
.BR netperm-table (5)
.BR authsrv (8)
.SH BUGS
.LP
Some systems may require the administrator to add login-sh to
.B /etc/shells
as programs like
.B ftpd
check for a valid user shell before permitting access.
