# Commands covered:  sunrpc
#
# This file contains a collection of tests for one or more of the Scotty
# built commands.  Sourcing this file into Scotty runs the tests and
# generates output for errors.  No output means no errors were found.
#
# Copyright (c) 1994, 1995
#
# J. Schoenwaelder
# TU Braunschweig, Germany
# Institute for Operating Systems and Computer Networks
#
# Permission to use, copy, modify, and distribute this
# software and its documentation for any purpose and without
# fee is hereby granted, provided that this copyright
# notice appears in all copies.  The University of Braunschweig
# makes no representations about the suitability of this
# software for any purpose.  It is provided "as is" without
# express or implied warranty.
#

if {[string compare test [info procs test]] == 1} then {source defs}

if {[catch {exec hostname} host]} {
    puts "skipping sunrpc test (could not get hostname)"
} else {
    puts "using $host for sunrpc tests"
}

# set VERBOSE 1

test sunrpc-1.1 {sunrpc info} {
    global host
    catch {sunrpc info $host}
} {0}
test sunrpc-1.2 {sunrpc info} {
    global host
    expr {[llength [sunrpc info $host]] > 0}
} {1}

test sunrpc-2.1 {sunrpc probe (udp)} {
    global host
    list [catch {
	foreach service [sunrpc info $host] {
            if {[lindex $service 2] == "udp"} {
		eval sunrpc probe $host $service
	    }
	}
    } msg] $msg
} {0 {}}
test sunrpc-2.2 {sunrpc probe (tcp)} {
    global host
    list [catch {
	foreach service [sunrpc info $host] {
            if {[lindex $service 2] == "tcp"} {
		eval sunrpc probe $host $service
	    }
	}
    } msg] $msg
} {0 {}}

test sunrpc-3.1 {sunrpc stat} {
    list [catch {
	foreach service [sunrpc info $host] {
            if {[lindex $service 4] == "rstatd"} {
		sunrpc stat $host
		break
	    }
	}
    } msg] $msg
} {0 {}}

test sunrpc-4.1 {sunrpc stat} {
    global host
    list [catch {
	foreach service [sunrpc info $host] {
            if {[lindex $service 4] == "etherd"} {
		sunrpc ether $host open
		sunrpc ether $host
		sunrpc ether $host close
		break
	    }
	}
    } msg] $msg
} {0 {}}

test sunrpc-5.1 {sunrpc mount} {
    global host
    list [catch {
	foreach service [sunrpc info $host] {
            if {[lindex $service 4] == "mountd"} {
		sunrpc mount $host
		break
	    }
	}
    } msg] $msg
} {0 {}}

test sunrpc-6.1 {sunrpc exports} {
    global host
    list [catch {
	foreach service [sunrpc info $host] {
            if {[lindex $service 4] == "mountd"} {
		sunrpc exports $host
		break
	    }
	}
    } msg] $msg
} {0 {}}

test sunrpc-7.1 {sunrpc exports} {
    global host
    list [catch {
	foreach service [sunrpc info $host] {
            if {[lindex $service 4] == "etherd"} {
		sunrpc ether open $host
		sunrpc ether $host
		sunrpc ether close $host
		break
	    }
	}
    } msg] $msg
} {0 {}}
