# Commands covered:  icmp
#
# This file contains a collection of tests for one or more of the Scotty
# built commands.  Sourcing this file into Scotty runs the tests and
# generates output for errors.  No output means no errors were found.
#
# Copyright (c) 1994, 1995
#
# J. Schoenwaelder
# TU Braunschweig, Germany
# Institute for Operating Systems and Computer Networks
#
# Permission to use, copy, modify, and distribute this
# software and its documentation for any purpose and without
# fee is hereby granted, provided that this copyright
# notice appears in all copies.  The University of Braunschweig
# makes no representations about the suitability of this
# software for any purpose.  It is provided "as is" without
# express or implied warranty.
#

if {[string compare test [info procs test]] == 1} then {source defs}

# set VERBOSE 1

test icmp-1.1 {icmp} {
    expr {[lindex [join [icmp echo 127.0.0.1]] 1] > 0}
} {1}
test icmp-1.2 {icmp timeout} {
    expr {[lindex [join [icmp -timeout 5 echo 127.0.0.1]] 1] > 0}
} {1}
test icmp-1.3 {icmp retries} {
    expr {[lindex [join [icmp -retries 5 echo 127.0.0.1]] 1] > 0}
} {1}
test icmp-1.4 {icmp delay} {
    expr {[lindex [join [icmp -delay 50 echo 127.0.0.1]] 1] > 0}
} {1}
test icmp-1.5 {icmp size} {
    expr {[lindex [join [icmp -size 800 echo 127.0.0.1]] 1] > 0}
} {1}

test icmp-2.0 {icmp mask} {
    lindex [join [icmp mask 127.0.0.1]] 1
} {255.0.0.0}
test icmp-2.1 {icmp timestamp} {
    llength [lindex [icmp timestamp 127.0.0.1] 0]
} {2}
test icmp-2.2 {icmp ttl} {
    expr {[lindex [join [icmp ttl 1 127.0.0.1]] 1] > 0}
} {1}
test icmp-2.3 {icmp trace} {
    expr {[lindex [join [icmp trace 1 127.0.0.1]] 1] > 0}
} {1}

test icmp-3.0 {icmp timeout option} {
    icmp -timeout 42
    icmp -timeout
} {42}
test icmp-3.1 {icmp retries option} {
    icmp -retries 42
    icmp -retries
} {42}
test icmp-3.2 {icmp size option} {
    icmp -size 42
    icmp -size
} {42}
test icmp-3.3 {icmp delay option} {
    icmp -delay 42
    icmp -delay
} {42}
test icmp-3.4 {icmp bad timeout option} {
   list [catch {icmp -timeout nase} msg] $msg
} {1 {expected integer but got "nase"}}
test icmp-3.5 {icmp bad retries option} {
   list [catch {icmp -retries nase} msg] $msg
} {1 {expected integer but got "nase"}}
test icmp-3.6 {icmp bad size option} {
   list [catch {icmp -size nase} msg] $msg
} {1 {expected integer but got "nase"}}
test icmp-3.7 {icmp bad delay option} {
   list [catch {icmp -delay nase} msg] $msg
} {1 {expected integer but got "nase"}}
test icmp-3.8 {icmp bad timeout option} {
   list [catch {icmp -timeout -1} msg] $msg
} {1 {negative timeout}}
test icmp-3.9 {icmp bad retries option} {
   list [catch {icmp -retries -1} msg] $msg
} {1 {negative retries}}
test icmp-3.10 {icmp bad size option} {
   list [catch {icmp -size -1} msg] $msg
} {1 {negative size}}
test icmp-3.11 {icmp bad delay option} {
   list [catch {icmp -delay -1} msg] $msg
} {1 {negative delay}}

# list tests

# combined tests

# echo '-size 120 localhost' | ./ntping -b
# echo '-size 60 -delay 30 -mask localhost' | ./ntping -b
# echo '-retries 2 -timeout 1 -ttl 1 localhost' | ./ntping -b
# echo '-size 400 -delay 10 -trace 1 localhost' | ./ntping -b
# echo '-tstamp localhost' | ./ntping -b

# echo '-size 120 -delay 1 sol.ibr.cs.tu-bs.de prep.ai.mit.edu' | ./ntping -b
# echo '-size 60 -mask -delay 10 sol.ibr.cs.tu-bs.de prep.ai.mit.edu' | ./ntping -b
# echo '-retries 2 -timeout 1 -delay 100 -ttl 2 sol.ibr.cs.tu-bs.de prep.ai.mit.edu' | ./ntping -b
# echo '-size 400 -trace 2 sol.ibr.cs.tu-bs.de prep.ai.mit.edu' | ./ntping -b
# echo '-tstamp sol.ibr.cs.tu-bs.de prep.ai.mit.edu' | ./ntping -b
