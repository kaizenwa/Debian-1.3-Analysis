# Commands covered:  mib
#
# This file contains a collection of tests for one or more of the Scotty
# built commands.  Sourcing this file into Scotty runs the tests and
# generates output for errors.  No output means no errors were found.
#
# Copyright (c) 1994, 1995
#
# J. Schoenwaelder
# TU Braunschweig, Germany
# Institute for Operating Systems and Computer Networks
#
# Permission to use, copy, modify, and distribute this
# software and its documentation for any purpose and without
# fee is hereby granted, provided that this copyright
# notice appears in all copies.  The University of Braunschweig
# makes no representations about the suitability of this
# software for any purpose.  It is provided "as is" without
# express or implied warranty.
#

if {[string compare test [info procs test]] == 1} then {source defs}

set VERBOSE 0

test mib-1.1 {mib oid} {
    mib oid sysDescr
} {1.3.6.1.2.1.1.1}
test mib-1.2 {mib name} {
    mib name 1.3.6.1.2.1.1.1
} {sysDescr}
test mib-1.3 {mib syntax} {
    mib syntax 1.3.6.1.2.1.1.3
} {TimeTicks}
test mib-1.4 {mib syntax} {
    mib syntax sysServices
} {INTEGER}
test mib-1.5 {mib succ} {
    mib succ system
} {sysDescr sysObjectID sysUpTime sysContact sysName sysLocation sysServices}
test mib-1.6 {mib descr} {
    string length [mib descr 1.3.6.1.2.1.1.1]
} {255}
test mib-1.7 {mib access} {
    mib access 1.3.6.1.2.1.1.1
} {read-only}
test mib-1.8 {mib oid} {
    mib oid system.sysDescr
} {1.3.6.1.2.1.1.1}
test mib-1.9 {mib oid} {
    mib oid system.sysDescr.0
} {1.3.6.1.2.1.1.1.0}
test mib-1.10 {mib oid} {
    mib oid mib-2.1.sysDescr
} {1.3.6.1.2.1.1.1}
test mib-1.11 {mib oid} {
    mib oid 1.3.6.1.2.1.1.1.0
} {1.3.6.1.2.1.1.1.0}
test mib-1.12 {mib name} {
    mib name system.sysDescr
} {sysDescr}
test mib-1.13 {mib name} {
    mib name system.sysDescr.0
} {sysDescr.0}
test mib-1.14 {mib name} {
    mib name mib-2.1.sysDescr
} {sysDescr}
test mib-1.15 {mib name} {
    mib name 1.3.6.1.2.1.1.1.0
} {sysDescr.0}
test mib-1.16 {mib name} {
    mib name 1.3.6.1.2.1.4.21.1.7:86:A9:22:01
} {ipRouteNextHop.134.169.34.1}
test mib-1.17 {mib name} {
    mib oid 1.3.6.1.2.1.4.21.1.7:86:A9:22:01
} {1.3.6.1.2.1.4.21.1.7.134.169.34.1}
test mib-1.18 {mib name} {
    mib name 1
} {iso}
test mib-1.19 {mib name} {
    mib oid ccitt
} {0}

test mib-2.1 {mib oid invalid arg} {
   list [catch {mib oid foobar} msg] $msg
} {1 {no object "foobar"}}
test mib-2.2 {mib name invalid arg} {
   list [catch {mib name foobar} msg] $msg
} {1 {no object "foobar"}}
test mib-2.3 {mib syntax invalid arg} {
   list [catch {mib syntax foobar} msg] $msg
} {1 {no object "foobar"}}
test mib-2.4 {mib descr invalid arg} {
   list [catch {mib descr foobar} msg] $msg
} {1 {no object "foobar"}}
test mib-2.5 {mib succ invalid arg} {
   list [catch {mib succ foobar} msg] $msg
} {1 {no object "foobar"}}
test mib-2.6 {mib access invalid arg} {
   list [catch {mib access foobar} msg] $msg
} {1 {no object "foobar"}}

test mib-3.1 {mib syntax} {
    list [catch {mib} msg] $msg
} {1 {wrong # args: should be "mib ?-exact? option args"}}
test mib-3.2 {mib syntax} {
    list [catch {mib foobar} msg] $msg
} {1 {wrong # args: should be "mib ?-exact? option args"}}
test mib-3.3 {mib syntax} {
    list [catch {mib foo bar} msg] $msg
} {1 {bad option "foo": should be load, name, oid, syntax, descr, access, index, succ, format, scan, tc, or walk}}

test mib-4.1 {mib format} {
    mib format ifType 1
} {other}
test mib-4.2 {mib format} {
    mib format sysDescr 41:42:43
} {ABC}
test mib-4.3 {mib scan} {
    mib scan ifType other
} {1}
test mib-4.3 {mib scan} {
    mib scan sysDescr ABC
} {41:42:43}
test mib-4.4 {mib tc} {
    mib tc sysDescr
} {DisplayString {OCTET STRING} 255a {}}

test mib-5.1 {mib parser} {
    mib walk x [mib oid iso] {
	set syntax [mib syntax $x]
	set access [mib access $x]
	if {$syntax == "59"} {
	    puts stderr "Warning: [mib name $x] has unknown syntax $syntax."
	}
	if {[string match SEQUENCE* $syntax] && ($access != "not-accessible")} {
	    puts stderr "Warning: [mib name $x] has wrong access mode $access."
	}
    }
} {}
