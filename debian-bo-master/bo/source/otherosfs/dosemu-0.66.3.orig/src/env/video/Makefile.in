#
# This is the Makefile for the video-subdirectory of the DOS-emulator
# for Linux.
#
# $Id: Makefile,v 2.15 1995/04/08 22:30:27 root Exp $

REALTOPDIR=@REALTOPDIR@
TOPDIR=@SRCPATH@
CFLAGS=@CFLAGS@
LDFLAGS=@LDFLAGS@
CC=@CC@
@SET_MAKE@
@X_SUPPORT@

# if you want to disable graphics in X, delete vgaemu.[co], vesa.[cho],
# vgaemu_inside.h, vesabios.S and vesabios.o
# you should also delete the #define XG in int10.c and sigsegv.c
ifdef X_SUPPORT
XCFILES	= X.c vgaemu.c vesa.c screen.c dacemu.c attremu.c seqemu.c \
	  XModeRemapGeneric.c XModeRemap_i386.c
XHDRS	= X.h vgaemu_inside.h vesa.h screen.h XModeRemap.h
XOBJS	= X.o vgaemu.o vesa.o screen.o dacemu.o attremu.o seqemu.o \
	  XModeRemapGeneric.o XModeRemap_i386.o
endif

# This is to assemble the VESA compatible video BIOS. Shamelessly copied
# from bios/Makefile.
SFILES = vesabios.S

AS86FLAGS=$(INCDIR)

LD86=@LD86@
AS86=@AS86@

TOPDIR=@SRCPATH@

CFILES = video.c vc.c vga.c et4000.c s3.c trident.c avance.c ati.c cirrus.c console.c \
         $(XCFILES) hgc.c dualmon.c terminal.c
HFILES = vga.h et4000.h s3.h trident.h avance.h ati.h cirrus.h terminal.h $(XHDRS)
OFILES = video.o vc.o vga.o et4000.o s3.o avance.o trident.o ati.o cirrus.o console.o \
         int10.o $(XOBJS) hgc.o dualmon.o terminal.o
#OBJS = $(OFILES)

ALL = $(CFILES) $(HFILES) #$(SFILES)

SUBDIR=video

all: vesabios.o lib

# this is copied from bios/Makefile
vesabios.o: vesabios.part.2
	@SRCPATH@/tools/tools86 $^
	cp $< $@
 
vesabios: vesabios.s

vesabios.s: vesabios.i
	@SRCPATH@/tools/tools86 -E <$^ >$@

vesabios.i: vesabios.S
	$(CC) -E --traditional $(AS86FLAGS) $^ >$@

vesabios.part.1: vesabios.s
	$(AS86) -0 -w -g -o $@ $^

vesabios.part.2: vesabios.part.1
	$(LD86) -0 -r -o $@ $^

# generate *dummy* dependency
vesabios.d: vesabios.o


install:

include @SRCPATH@/Makefile.common

echo::
	@echo ALL=$(ALL)
	@echo REALTOPDIR=@REALTOPDIR@

clean::
	rm -f vesabios.o vesabios.s vesabios.i

realclean::
	rm -f vesabios.part.1 vesabios.part.2
