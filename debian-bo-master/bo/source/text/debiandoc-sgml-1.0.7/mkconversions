#!/bin/sh

set -e

exec <conversions
version=$1
speclibdir=$2
sgmllibdir=$3
pathlibdir=$4

while read type sasp spec toc fnotes argument
do
	if [ "x$type" = "x#" ]; then continue; fi
	o=debiandoc2$type
	case $argument in
	.*)	argument="\$bn$argument"
		stdout='@@@startelide@@@'
		endstdout='@@@endelide@@@'
		;;
	*)	stdout='@@@lineelide@@@'
		endstdout='@@@lineelide@@@'
		;;
	esac
	sed -e <template >$o.new "
		s:@@@type@@@:$type:g;
		s:@@@version@@@:$version:g;
		s:@@@toc@@@:$toc:g;
		s:@@@fnotes@@@:$fnotes:g;
		s:@@@spec@@@:$spec:g;
		s:@@@sasp@@@:$sasp:g;
		s:@@@speclibdir@@@:$speclibdir:g;
		s:@@@argument@@@:$argument:g;
		s:@@@stdout@@@:$stdout:g;
		s:@@@endstdout@@@:$endstdout:g;
		/@@@lineelide@@@/d;
		/@@@startelide@@@/,/@@@endelide@@@/d;
		s:@@@sgmllibdir@@@:$sgmllibdir:g;
		s:@@@pathlibdir@@@:$pathlibdir:g;
	"
	mv $o.new $o
done
