#			    -*-makefile-*-

SUBDIRS=ascii html info latex literate lout man ps slide rtf
INSTALLFILES= CATALOG *.*

# NONSOURCE are all files which are generated by th prepare process

NONSOURCE=notations.ent target.ent

MAKE=make
MKDIR=mkdir
MKDIROPT=-p
CP=cp

prepare: # prepare this dir (to be called from upper dir Makefile)
	if [ -f local.ent ]; then true; else cp local.dst local.ent; fi;
	if [ $(PARSEPROG) = nsgmls ];                                       \
	then sed "/HACK SGMLS/,/END HACK SGMLS/d" target.dst > target.ent; \
	else cp target.dst target.ent;                                     \
	fi

install: # install (usually to be called from upper dir. Makefile)
install: e.dd+pwd
	-for i in $(SUBDIRS); \
		do $(MAKE) e.dir DIRECTORY=$(DD)/sgml/target/$$i;\
		   $(CP) target/$$i/*.* $(DD)/sgml/target/$$i; done;
	$(CP) $(INSTALLFILES) $(DD)/sgml
	$(MAKE) e.dir DIRECTORY=$(DD)/sgml/target/lout/linuxdoc
	$(CP) target/lout/linuxdoc/general $(DD)/sgml/target/lout/linuxdoc
	ln -sf ../lout/linuxdoc $(DD)/sgml/target/ascii/linuxdoc

clean:	# remove redundant files
	#rm -f `find . \( -name "*~" -o -name core \) -print`

clobber: # remove all generated files (did I catch all?)
clobber: clean
	rm -f $(NONSOURCE)

purge:	# same as clean & removes files containing only "deleted"
purge:  clean
	@$(ECHO) -n deleted	>deleted7
	@$(ECHO) deleted	>deleted8
	@rm -f `find . \
	       \( \( -size 8c -exec cmp -s {} deleted8 \; \)	\
	       -o \( -size 7c -exec cmp -s {} deleted7 \; \) \)	\
	       -print`
	@echo purged

wipe:	# use: make wipe file=<file> # prepares file for purge
	mv -f $(file) $(file)~
	echo deleted >$(file)

e.dd+pwd:
	@if [ ! -d $(DD)/`basename \`pwd\`` ]; \
	then $(MKDIR) $(MKDIROPT) $(DD)/`basename \`pwd\`` ; else true; fi

e.dir:
	@if [ ! -d $(DIRECTORY) ];\
	then $(MKDIR) $(MKDIROPT) $(DIRECTORY) ; else true; fi

help:	# Help on make targets
	@echo Warning! Targets in this Makefile are intented to be called
	@echo from the Makefile in the upper directory!
	@echo ------------------------------
	-@egrep "^[A-Za-z\._]+::?.*#" [Mm]akefile
