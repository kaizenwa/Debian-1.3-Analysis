# Makefile for psptools.
# Copyright (C) 1995 Yves Arrouye <Yves.Arrouye@imag.fr>

#### Start of system configuration section. ####

srcdir = @srcdir@
VPATH = @srcdir@

INSTALL = @INSTALL@
INSTALL_PROGRAM = @INSTALL_PROGRAM@ $(INSTALL_GROUP) $(INSTALL_USER)
INSTALL_PPD = @INSTALL@ -m 444 $(INSTALL_GROUP) $(INSTALL_USER)

prefix = @prefix@
exec_prefix = @exec_prefix@

bindir = @exec_prefix@/bin

# Directory in which to install library files.
datadir = @datadir@
ppddir = $(datadir)

uxppddir = @uxdatadir@
nsppddir = @nsdatadir@

package = ppd-gs

RM = rm -f

# Other configuration

#### End of system configuration section. ####

SHELL = /bin/sh

PPDFILES = ppd/gs.ppd ppd/gsa4.ppd ppd/gsa3.ppd \
    ppd/bjc.ppd ppd/bjc600.ppd ppd/bjc800.ppd \
    ppd/bjc4000.ppd ppd/bjc610.ppd ppd/bjc70.ppd \
    ppd/sw2400p.ppd \
    ppd/djc.ppd  \
    ppd/dj500c.ppd ppd/dj540c.ppd \
    ppd/dj550c.ppd ppd/dj560c.ppd \
    ppd/pjxl.ppd ppd/pjxl300.ppd ppd/dj1200c.ppd

SEDLOCALES = locale/fr/ppd-chg.sed locale/en/ppd-chg.sed

SCRIPTS = update-ppd install-ppd

PPDINSTALLDIR = installed
PPDLIST = installed-bop

REMOVABLEFILES = papersize.ps $(PPDLIST) $(SCRIPTS) ppd-inst.sh \
	debian.postinst debian.postrm

all: $(PPDLIST) $(SCRIPTS)

debian: all debian.postinst debian.postrm
debian.postinst: debian.postinst.begin.sh debian.postinst.end.sh \
	$(PPDLIST) Makefile
	sed -e "s,%bindir%,$(bindir),g" \
	    -e "s,%package%,$(package),g" debian.postinst.begin.sh >$@
	cat $(PPDLIST) | sed 's,^$(PPDINSTALLDIR)/\(.*\),	$(ppddir)/\1 \\,g' >>$@
	echo >>$@
	sed -e "s,%ppddir%,$(ppddir),g" debian.postinst.end.sh >>$@

debian.postrm: debian.postrm.sh Makefile
	sed -e "s,%ppddir%,$(ppddir),g" debian.postrm.sh >$@

install-ppd: ppd-inst.sh papersize.ps $(SEDLOCALES) ${srcdir}/mkinstallppd
	$(SHELL) ${srcdir}/mkinstallppd ppd-inst.sh $@
	chmod 755 $@

ppd-inst.sh: ppd-inst.sh.in Makefile
	sed -e 's,/LocalLibrary/PrinterTypes,$(nsppddir),' \
	    -e 's,/usr/local/share/ppd,$(uxppddir),' ppd-inst.sh.in >$@
	chmod 755 $@

update-ppd: ppd-updt.sh Makefile
	sed -e 's,\./ppd-inst\.sh,install-ppd,g' ppd-updt.sh >$@
	chmod 755 $@

papersize.ps: paperspecs ${srcdir}/mkpapersize
	$(SHELL) ${srcdir}/mkpapersize paperspecs $@

$(PPDLIST): $(PPDFILES) ppd-inst.sh papersize.ps
	test -d $(PPDINSTALLDIR) || mkdir $(PPDINSTALLDIR)
	$(RM) /tmp/ppd-inst.sh.$$$$.bop; \
	ppd-inst.sh -v -t $(ppddir) -d $(PPDINSTALLDIR) \
	    $(PPDFILES) >/tmp/ppd-inst.sh.$$$$.bop; \
	if [ "`cat /tmp/ppd-inst.sh.$$$$.bop`" != "" ]; then \
	  mv /tmp/ppd-inst.sh.$$$$.bop $@; \
	fi

installdirs: $(PPDLIST)
	$(SHELL) ${srcdir}/mkinstalldirs $(ppddir) $(bindir)
	for d in `cat $(PPDLIST) | sed -e 's,^$(PPDINSTALLDIR)/,,' -e 's,/[^/]*,,' | uniq`; do \
	    $(SHELL) ${srcdir}/mkinstalldirs $(ppddir)/$$d; \
	done

install: all installdirs
	for i in `cat $(PPDLIST)`; do \
	    $(INSTALL_PPD) $$i $(ppddir)/`echo $$i | sed 's,^$(PPDINSTALLDIR)/,,'`; \
	done
	$(INSTALL_PROGRAM) -m 755 install-ppd update-ppd $(bindir)

uninstall:
	$(RM) $(ppddir)/`ls *.ppd`
	$(RM) $(bindir)/install-ppd
	$(RM) $(bindir)/update-ppd

configure: configure.in $(M4FILES)
	rm -f configure && autoconf && chmod +x configure
Makefile: Makefile.in config.status
	./config.status
config.status: configure
	./config.status --recheck

maintainer-clean::
	@echo "This command is intended for maintainers to use;"
	@echo "rebuilding the deleted files requires autoconf"
	@echo "and copies of install-sh and mkinstalldirs."
	rm -f TAGS *.info* *~
	rm -f configure install-sh mkinstalldirs

clean mostlyclean distclean maintainer-clean::
	rm -rf installed
	rm -f $(REMOVABLEFILES)

distclean maintainer-clean::
	rm -f Makefile config.status config.cache config.log
	rm -f configure.tmp

clean mostlyclean distclean maintainer-clean::

