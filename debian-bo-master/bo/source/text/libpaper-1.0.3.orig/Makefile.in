# Makefile for libpaper.
# Copyright (C) 1995 Yves Arrouye <Yves.Arrouye@imag.fr>
 
#### Start of system configuration section. ####
 
srcdir = @srcdir@
VPATH = @srcdir@

@SET_MAKE@

INSTALL = @INSTALL@
INSTALL_MAN = @INSTALL@ -m 644 $(INSTALL_GROUP) $(INSTALL_OWNER)

prefix = @prefix@
exec_prefix = @exec_prefix@
datadir = @datadir@

# Directory in which to install library files.
datadir = @datadir@

# Other directories.
mandir = $(prefix)/man

ifeq ($(datadir),/)
etcdir = /etc
else
etcdir = $(datadir)/etc
endif

man3suffix =

# Other configuration

PAPERCONF=letter

PAPERSIZEVAR=PAPERSIZE
PAPERVAR=PAPERCONF

PAPERSIZE=$(etcdir)/papersize

LIBSOMAJOR = 1
LIBSOMINOR = 0.2

#### End of system configuration section. ####

INSTALLEDMANUAL = $(mandir)/man1/paperconf.1 \
    $(mandir)/man3/systempapername.3$(man3suffix) \
    $(mandir)/man3/defaultpapername.3$(man3suffix) \
    $(mandir)/man3/systempapersizefile.3$(man3suffix) \
    $(mandir)/man3/defaultpapersizefile.3$(man3suffix) \
    $(mandir)/man3/paperinfo.3$(man3suffix) \
    $(mandir)/man3/paperwithsize.3$(man3suffix) \
    $(mandir)/man3/paperfirst.3$(man3suffix) \
    $(mandir)/man3/papernext.3$(man3suffix) \
    $(mandir)/man3/paperprev.3$(man3suffix) \
    $(mandir)/man3/paperlast.3$(man3suffix) \
    $(mandir)/man3/paperinit.3$(man3suffix) \
    $(mandir)/man3/paperdone.3$(man3suffix) \
    $(mandir)/man5/papersize.5 \
    $(mandir)/man8/paperconfig.8

INSTALLEDFILES = $(INSTALLEDMANUAL)
INSTALLEDOTHERFILES = $(etcdir)/papersize

# Do not list manual pages that should not be removed below!

MANUAL = man/man1/paperconf.1 \
    man/man3/systempapername.3 \
    man/man3/defaultpapername.3 \
    man/man3/systempapersizefile.3 \
    man/man3/defaultpapersizefile.3 \
    man/man3/paperinfo.3 \
    man/man3/paperwithsize.3 \
    man/man3/paperfirst.3 \
    man/man3/papernext.3 \
    man/man3/paperprev.3 \
    man/man3/paperlast.3 \
    man/man3/paperinit.3 \
    man/man3/paperdone.3 \
    man/man5/papersize.5 \
    man/man8/paperconfig.8

REMOVABLEFILES = data/papersize \
    $(MANUAL) \
    Makefile config.status config.cache

all: $(MANUAL)
	cd lib && $(MAKE) PAPERCONF="$(PAPERCONF)" PAPERVAR="$(PAPERVAR)" PAPERSIZE="$(PAPERSIZE)" PAPERSIZEVAR="$(PAPERSIZEVAR)"
	cd src && $(MAKE)

debian: all
debian-install: debian install-core

install: install-core install-papersize

install-core: all installdirs install-man
	cd lib && $(MAKE) install PAPERCONF="$(PAPERCONF)" PAPERVAR="$(PAPERVAR)" PAPERSIZE="$(PAPERSIZE)" PAPERSIZEVAR="$(PAPERSIZEVAR)"
	cd src && $(MAKE) install
install-man: $(INSTALLEDMANUAL)

install-papersize: data/papersize installdirs-papersize installpapersize

installpapersize: $(install_etcdir)/papersize
$(install_etcdir)/papersize: data/papersize
	$(INSTALL) -m 644 $< $@

uninstall:
	cd lib && $(MAKE) uninstall PAPERCONF="$(PAPERCONF)" PAPERVAR="$(PAPERVAR)" PAPERSIZE="$(PAPERSIZE)" PAPERSIZEVAR="$(PAPERSIZEVAR)"
	cd src && $(MAKE) uninstall
	$(RM) $(INSTALLEDFILES)

$(mandir)/man1/paperconf.1: man/man1/paperconf.1
	$(INSTALL_MAN) $< $@
$(mandir)/man3/systempapername.3$(man3suffix): man/man3/systempapername.3
	$(INSTALL_MAN) $< $@
$(mandir)/man3/defaultpapername.3$(man3suffix): man/man3/defaultpapername.3
	$(INSTALL_MAN) $< $@
$(mandir)/man3/systempapersizefile.3$(man3suffix): man/man3/systempapersizefile.3
	$(INSTALL_MAN) $< $@
$(mandir)/man3/paperinfo.3$(man3suffix): man/man3/paperinfo.3
	$(INSTALL_MAN) $< $@
$(mandir)/man3/paperwithsize.3$(man3suffix): man/man3/paperwithsize.3
	$(INSTALL_MAN) $< $@
$(mandir)/man3/paperfirst.3$(man3suffix): man/man3/paperfirst.3
	$(INSTALL_MAN) $< $@
$(mandir)/man3/papernext.3$(man3suffix): man/man3/papernext.3
	$(INSTALL_MAN) $< $@
$(mandir)/man3/paperprev.3$(man3suffix): man/man3/paperprev.3
	$(INSTALL_MAN) $< $@
$(mandir)/man3/paperlast.3$(man3suffix): man/man3/paperlast.3
	$(INSTALL_MAN) $< $@
$(mandir)/man3/paperinit.3$(man3suffix): man/man3/paperinit.3
	$(INSTALL_MAN) $< $@
$(mandir)/man3/paperdone.3$(man3suffix): man/man3/paperdone.3
	$(INSTALL_MAN) $< $@
$(mandir)/man5/papersize.5: man/man5/papersize.5
$(mandir)/man3/defaultpapersizefile.3$(man3suffix): man/man3/defaultpapersizefile.3
	$(INSTALL_MAN) $< $@
$(mandir)/man5/papersize.5: man/man5/papersize.5
	$(INSTALL_MAN) $< $@
$(mandir)/man8/paperconfig.8: man/man8/paperconfig.8
	$(INSTALL_MAN) $< $@

installdirs:
	${srcdir}/mkinstalldirs $(mandir)/man1 \
	    $(mandir)/man3 $(mandir)/man5 $(mandir)/man8

installdirs-papersize:
	${srcdir}/mkinstalldirs $(install_etcdir)

data/papersize: data/papersize.in Makefile
	sed -e 's,@PAPER@,$(PAPER),' data/papersize.in >$@

configure: configure.in $(M4FILES)
	rm -f configure && autoconf && chmod +x configure
Makefile: Makefile.in config.status
	./config.status
config.status: configure
	./config.status --recheck

man/man1/paperconf.1: man/man1/paperconf.1.in Makefile
	sed -e 's,@PAPERCONF@,$(PAPERCONF),' -e s',@PAPERVAR@,$(PAPERVAR),g' \
	    -e 's,@PAPERSIZE@,$(PAPERSIZE),g' \
	    -e 's,@PAPERSIZEVAR@,$(PAPERSIZEVAR),g' \
	    -e 's,@etcdir@,$(etcdir),' \
	    	man/man1/paperconf.1.in >$@
man/man3/systempapername.3: man/man3/systempapername.3.in Makefile
	sed -e 's,@PAPERCONF@,$(PAPERCONF),' -e s',@PAPERVAR@,$(PAPERVAR),g' \
	    -e 's,@PAPERSIZE@,$(PAPERSIZE),g' \
	    -e 's,@PAPERSIZEVAR@,$(PAPERSIZEVAR),g' \
	    -e 's,@etcdir@,$(etcdir),' \
		man/man3/systempapername.3.in >$@
man/man3/defaultpapername.3: man/man3/defaultpapername.3.so.in Makefile 
	sed -e 's,@man3suffix@,$(man3suffix),g' \
	    man/man3/defaultpapername.3.so.in >$@
man/man3/defaultpapersizefile.3: man/man3/defaultpapersizefile.3.so.in Makefile
	sed -e 's,@man3suffix@,$(man3suffix),g' \
	    man/man3/defaultpapersizefile.3.so.in >$@
man/man3/systempapersizefile.3: man/man3/systempapersizefile.3.so.in Makefile
	sed -e 's,@man3suffix@,$(man3suffix),g' \
	    man/man3/systempapersizefile.3.so.in >$@
man/man3/paperinfo.3: man/man3/paperinfo.3.in Makefile
	sed -e 's,@man3suffix@,$(man3suffix),g' \
	    man/man3/paperinfo.3.in >$@
man/man3/paperwithsize.3: man/man3/paperwithsize.3.so.in Makefile
	sed -e 's,@man3suffix@,$(man3suffix),g' \
	    man/man3/paperwithsize.3.so.in >$@
man/man3/paperfirst.3: man/man3/paperfirst.3.so.in Makefile
	sed -e 's,@man3suffix@,$(man3suffix),g' \
	    man/man3/paperfirst.3.so.in >$@
man/man3/papernext.3: man/man3/papernext.3.so.in Makefile
	sed -e 's,@man3suffix@,$(man3suffix),g' \
	    man/man3/papernext.3.so.in >$@
man/man3/paperprev.3: man/man3/paperprev.3.so.in Makefile
	sed -e 's,@man3suffix@,$(man3suffix),g' \
	    man/man3/paperprev.3.so.in >$@
man/man3/paperlast.3: man/man3/paperlast.3.so.in Makefile
	sed -e 's,@man3suffix@,$(man3suffix),g' \
	    man/man3/paperlast.3.so.in >$@
man/man3/paperinit.3: man/man3/paperinit.3.in Makefile
	sed -e 's,@man3suffix@,$(man3suffix),g' \
	    man/man3/paperinit.3.in >$@
man/man3/paperdone.3: man/man3/paperdone.3.so.in Makefile
	sed -e 's,@man3suffix@,$(man3suffix),g' \
	    man/man3/paperdone.3.so.in >$@
man/man5/papersize.5: man/man5/papersize.5.in Makefile
	sed -e 's,@PAPERCONF@,$(PAPERCONF),' -e s',@PAPERVAR@,$(PAPERVAR),g' \
	    -e 's,@PAPERSIZE@,$(PAPERSIZE),g' \
	    -e 's,@PAPERSIZEVAR@,$(PAPERSIZEVAR),g' \
	    -e 's,@etcdir@,$(etcdir),' \
	    	man/man5/papersize.5.in >$@
man/man8/paperconfig.8: man/man8/paperconfig.8.in Makefile
	sed -e 's,@PAPERCONF@,$(PAPERCONF),' -e s',@PAPERVAR@,$(PAPERVAR),g' \
	    -e 's,@PAPERSIZE@,$(PAPERSIZE),g' \
	    -e 's,@PAPERSIZEVAR@,$(PAPERSIZEVAR),g' \
	    -e 's,@etcdir@,$(etcdir),' \
	    	man/man8/paperconfig.8.in >$@

clean:
	cd lib && $(MAKE) clean PAPERCONF="$(PAPERCONF)" PAPERVAR="$(PAPERVAR)" PAPERSIZE="$(PAPERSIZE)" PAPERSIZEVAR="$(PAPERSIZEVAR)" LIBMAJOR="$(LIBMAJOR)" LIBMINOR="$(LIBMINOR)"
	cd src && $(MAKE) clean

distclean:
	$(RM) $(REMOVABLEFILES)
	cd lib && $(MAKE) distclean PAPERCONF="$(PAPERCONF)" PAPERVAR="$(PAPERVAR)" PAPERSIZE="$(PAPERSIZE)" LIBMAJOR="$(LIBMAJOR)" LIBMINOR="$(LIBMINOR)"
	cd src && $(MAKE) distclean

