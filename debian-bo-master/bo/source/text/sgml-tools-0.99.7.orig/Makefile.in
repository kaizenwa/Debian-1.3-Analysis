#
#  Makefile.in
#
#  $Id: Makefile.in,v 1.10 1997/03/21 09:40:31 cg Exp $
#
#  © Copyright 1996 Sven Rudolph
#

prefix=@prefix@
exec_prefix=@exec_prefix@
bindir=@BINDIR@
libdir=@LIBDIR@
LINUXDOCDOC=$(prefix)/doc/linuxdoc-sgml
mandir=@mandir@
mandir1=$(mandir)/man1
PERL=@PERL@

INSTALL=@INSTALL@
INSTALL_PROGRAM=@INSTALL_PROGRAM@
INSTALL_DATA=@INSTALL_DATA@

BUILD_SGMLSASP=@BUILD_SGMLSASP@
BUILD_NSGMLS=@BUILD_NSGMLS@

OPTIMIZE=-O

all:
ifeq ($(BUILD_SGMLSASP), true)
	@echo "Compiling the SGML parsing tools (in sgmls-1.1/)..."
	( cd sgmls-1.1 ; \
	  make OPTIMIZE="$(OPTIMIZE)" sgmlsasp )
endif
ifeq ($(BUILD_NSGMLS), true)
	@echo "Compiling the SGML parsing tools (in sp-1.1.1/)..."
	( cd sp-1.1.1 ; \
	  make )
endif
	@echo "Compiling RTF conversion tools (in rtf-fix/)..."
	( cd rtf-fix ; \
	  make CFLAGS="$(OPTIMIZE)" || exit -1 )

install::
	@echo "Installing binaries in $(bindir) ..."
	if [ ! -d $(bindir) ]; then mkdir -p $(bindir); fi
	-chmod 755 $(bindir)
ifeq ($(BUILD_NSGMLS), true)
	$(INSTALL_PROGRAM) sp-1.1.1/nsgmls/nsgmls $(bindir)
endif
ifeq ($(BUILD_SGMLSASP), true)
	$(INSTALL_PROGRAM) sgmls-1.1/sgmlsasp $(bindir)
endif
	$(INSTALL_PROGRAM) \
		rtf-fix/rtf2rtf \
		bin/sgml2html bin/sgml2info bin/sgml2latex \
		bin/sgml2lyx bin/sgml2rtf bin/sgml2txt bin/sgmlcheck \
		bin/genertoc $(bindir)
	@echo "Installing library and support files in $(libdir)..."
	if [ ! -d $(libdir) ]; then mkdir -p $(libdir); fi
	chmod 755 $(libdir)
	cp -r lib/* $(libdir)
	cp VERSION $(libdir)
	@echo "Installing documentation in $(LINUXDOCDOC) ..."
	if [ ! -d $(LINUXDOCDOC) ]; then mkdir -p $(LINUXDOCDOC); fi
	chmod 755 $(LINUXDOCDOC)
	cp -r doc/* $(LINUXDOCDOC) 
	@echo "Installing man pages in $(mandir1) ..." 
	if [ ! -d $(mandir1) ]; then mkdir -p $(mandir1) ; fi
	chmod 755 $(mandir1)
	$(INSTALL_DATA) man/sgml2* $(mandir1)
ifeq ($(BUILD_NSGMLS), true)
	$(INSTALL_DATA) man/nsgmls.1 $(mandir1)
endif
ifeq ($(BUILD_SGMLSASP), true)
	$(INSTALL_DATA) man/sgmlsasp.1 $(mandir1)
endif
	find $(LINUXDOCDOC) -type d -print | xargs chmod 755
	find $(LINUXDOCDOC) -type f -print | xargs chmod 644
	find $(libdir) -type d -print | xargs chmod 755
	find $(libdir) -type f -print | xargs chmod 644
	chmod 755 $(libdir)/driver.pl
	(cd $(libdir)/rep/latin1; ln -sf ../groff/mapping .)

clean::
	-rm -f *~ bin/*~
ifeq ($(BUILD_SGMLSASP), true)
	(cd sgmls-1.1 && make clean)
endif
ifeq ($(BUILD_NSGMLS), true)
	(cd sp-1.1.1 && make clean)
endif
	(cd rtf-fix ; make clean)

distclean:: clean
	-rm -f Makefile config.cache config.log config.status \
		sgmls-1.1/config.h \
		bin/{sgml2html,sgml2latex,sgml2rtf,sgmlcheck} \
		bin/{genertoc,sgml2info,sgml2lyx,sgml2txt} \
		lib/driver.pl
