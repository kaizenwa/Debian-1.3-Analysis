#!/usr/bin/make -f
#
# Debian rules for building a Debian package
# Version 1.1
#
# These rules have been specifically designed NOT to require root to
# run them. At any time root privileges are required, the command to be
# executed will be made obvious and root's password will be prompted for.
# Of course, root may still run this and no password will be required.
#
# Robert Leslie <rob@mars.org>

PKG =	xkeycaps
VER =	2.29
DEB =	3
BLD =	.debian-build
TMP =	.debian-tmp

build :: $(BLD)

binary :: $(BLD)
	su -c 'exec ./debian.binary $(PKG) $(VER)-$(DEB) $(TMP)'
	dpkg --build $(TMP)
	mv -f $(TMP).deb ../$(PKG)-$(VER)-$(DEB).deb

$(BLD):
	xmkmf -a
	make
	touch $(BLD)

clean ::
	test ! -d $(TMP) || su -c 'rm -rf $(TMP)'
	rm -f $(BLD)
	test ! -f Makefile || make clean
	rm -f Makefile

source ::
	test ! -f $(BLD) || make -f debian.rules clean
	cd .. && tar cf - $(PKG)-$(VER) |  \
	    gzip -9f > $(PKG)-$(VER)-$(DEB).tar.gz

diff ::
	test ! -f $(BLD) || make -f debian.rules clean
	test -d ../$(PKG)-$(VER).orig
	cd .. && diff -cNr $(PKG)-$(VER).orig $(PKG)-$(VER) |  \
	    gzip -9f > $(PKG)-$(VER)-$(DEB).diff.gz
