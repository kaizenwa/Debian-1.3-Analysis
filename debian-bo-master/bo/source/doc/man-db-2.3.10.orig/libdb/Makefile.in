# Database library Makefile for the man package.
#
# Copyright (C) 1994, 1995, Graeme Wilford.
#
# You may distribute under the terms of the GNU General Public
# License as specified in the COPYING file that comes with this 
# distribution.  
#
# Wed June  6 15:44:47 BST 1994 Wilf. (G.Wilford@ee.surrey.ac.uk):

library = libmandb.a

srcdir = @srcdir@
VPATH = @srcdir@
top_srcdir = @top_srcdir@

include ../include/Defines

.PHONY: $(DEFAULT_TARGETS)

# The default programs to build
ALL = db_store.o db_delete.o db_lookup.o \
      db_ver.o db_btree.o db_gdbm.o db_ndbm.o

# This is just to make sure that things are done in the right order
ifeq ($(nls),on)
all:
	$(make_in_root)
else

# The default programs to build
all: $(library)

# If we want any kind of NLS message catalogue support, nls must != off
# this is exported from the master Makefile.
  ifneq ($(nls),off)
NLS = -DNLS

MSGS = db_store.m db_delete.m db_lookup.m db_ver.m
MSG_PATHS = $(addprefix $(MSG_DIR)/, $(MSGS))

local_gencat = ../gencat/gencat

$(srcdir)/man_db-nls.h: $(srcdir)/stamp-h
$(srcdir)/stamp-h: $(MSG_PATHS)
	test -f $(gencat) || $(MAKE) -C ../gencat
	$(gencat) -new /dev/null $^ -h $(srcdir)/man_db-nls.h
	rm -f $@
	date > $@

$(MSG_PATHS): $(MSG_DIR)/%.m: $(srcdir)/%.c
	test -f ../xcat/xcat || $(MAKE) -C ../xcat
	../xcat/xcat $(top_srcdir)/xcat/Register < $< > $@

  endif
endif

override CPPFLAGS := $(DEFS) $(NLS) -I../include -I$(top_srcdir) \
		     -I$(srcdir) -I- $(CPPFLAGS)
		     

$(library): $(library)($(ALL))
	-$(RANLIB) $@

# The standard targets
install uninstall:

clean mostlyclean:
	rm -f *~ core $(ALL) $(library)

distclean: clean
	rm -f *.d Makefile

realclean: distclean
	rm -f tags stamp-h
	
TAGS:
	$(MKTAGS) $(srcdir)/*.[ch]

# These lines sort out proper dependencies, done if --enable-debug
# passed to configure. To override uncomment the following line.
#debug=on
ifneq ($(clean),yes)

  ifeq ($(debug),on)
    SRCS = $(notdir $(wildcard $(srcdir)/*.c))
    include $(SRCS:.c=.d)
  endif

endif
