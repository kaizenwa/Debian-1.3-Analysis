.\"
.\" Traduzione in italiano di Giovanni Bortolozzo <borto@dei.unipd.it>
.\" Agosto 1996
.\"
.\" " for hilit19
.TH FILE 1 "Copyright but distributable"
.\# $Id: file.man,v 1.23 1993/09/24 18:50:48 christos Exp $
.SH NOME
.I file
\- determina il tipo di file
.SH SINTASSI
.B file
[
.B \-c
]
[
.B \-z
]
[
.B \-L
]
[
.B \-f
nome_file ]
[
.B \-m 
magicfile ]
file ...
.SH DESCRIZIONE
.I File
analizza ognuno degli argomenti con lo scopo di classificarli. Ci sono
tre insiemi di test, eseguiti nell'ordine seguente: test sul
filesystem, test sul magic number, e test sulla lingua. Il
.I primo
test che ha successo fa sì che sia stampato il tipo del file.
.PP
Il tipo stampato di solito contiene una delle seguenti parole
.B text
(il file contiene solo caratteri ASCII ed è probabilmente sicuro
leggerlo su di un terminale ASCII),
.B executable
(il file contiene il risultato della compilazione di un programma in
una qualche forma comprensibile da qualche kernel \s-1UNIX\s0 o altro),
o
.B data
intendendo qualsiasi altra cosa (i file data sono si solito `binari'
non stampabili). Le eccezioni sono i ben noti formati dei file (file
core, archivi tar) dei quali si sa che contengono dati binari.
Quando si modifica il file
.I /etc/magic
o il programma stesso,
.BR "si conservino queste parole chiave" .
La gente può dipendere dalla conoscenza che tutti i file leggibili in
una directory hanno associata la parola ``text''. Non fate come hanno
fatto a Berkeley che hanno cambiato ``shell commands text'' in ``shell
script''.
.PP
Il test sul filesystem si basa sull'esame di quello che restituisce la
system call
.IR stat (2).
Il programma prova a vedere se il file è vuoto, e se è un file
speciale di un qualche tipo. Qualsiasi tipo di file conosciuto
appropriato per il sistema nel quale si è (socket, link simbolici, o
named pipe (FIFO) nei sistemi che li implementano) sono rilevati, se
sono stati definiti nel header file di sistema
.BR sys/stat.h  .
.PP
Il test sul magic number è usato per l'analisi dei file con dati in un
formato particolare prestabilito. L'esempio canonico di questi sono
i file eseguibili binari (programmi compilati)
.BR a.out ,
il cui formato è definito in
.B a.out.h
e possibilmente in
.B exec.h
nella include directory standard.
Questi file hanno un `magic number' salvato in un posto particolare
vicino all'inizio del file che dice al sistema operativo \s-1UNIX\s0
che il file è un eseguibile binario, e di che che tipo fra i molti.
Il concetto di `magic number' è stato esteso ai file dati. Qualsiasi
file con un qualche identificativo invariante ad un piccolo offset
fissato all'interno del file può di solito essere descritto in tal
modo. Le informazioni per questi file sono lette dal magic file
.IR /etc/magic .
.PP
Se un argomento sembra essere un file
.SM ASCII 
,
.I file
prova a indovinarne la lingua. Il test sulla lingua cerca una
particolare stringa (Cfr \fInames.h\fP) che può comparire ovunque nei
primi blocchi del file. Per esempio, la keyword
.B .br
indica che il file è molto probabilmente un file di ingresso per
troff, come la keyword
.B struct
indica un programma C.
Queste analisi sono meno attendibili di quelle dei due gruppi
precedenti, e così sono fatte per ultime. Le routine di test sulla
lingua verificano anche altre cose (come gli archivi 
.IR tar )
e determinano quando un file sconosciuto potrebbe essere etichettato
come `ascii text' o come `data'.
.PP
Si usi 
.B \-m
.I file
per specificare un altro file di magic number.
.PP
L'opzione 
.B \-z
prova a guardare dentro i file compressi.
.PP
L'opzione
.B \-c
causa la stampa di verifica della forma esaminata del magic file. È
usata di solito assieme a
.B \-m
per verificare il funzionamento di un nuovo magic file prima di installarlo.
.PP
L'opzione
.B \-f
.I nome_file
specifica che i nomi dei file da analizzare devono essere letti (uno
per riga) da
.I nome_file
prima della lista degli argomenti.
Deve essere presente o
.I nome_file
o almeno un nome di file come argomento; per testare lo standard
input, si usi ``-'' come nome di file di argomento.
.PP
L'opzione
.B \-L
fa si che siano seguiti i link simbolici, come l'opzione con lo stesso
nome in
.IR ls (1).
.SH FILE
.I /etc/magic
\- lista di default dei magic number
.SH VEDERE ANCHE
.IR magic (4)
\- descrizione del formato dei magic file.
.br
.IR strings (1), " od" (1)
\- strumenti per l'analisi di file non testo.
.SH CONFORMITÀ AGLI STANDARD
Questo programma credo ecceda la System V Interface Definition di
FILE(CMD), come uno può determinare dal confuso linguaggio che
contiene. Il suo comportamento è compatibile con il programma System V
con lo stesso nome. Comunque questa versione conosce più magic number,
cosicché produce in molti casi output diversi (sebbene più accurati).
.PP
Una differenza significativa tra questa versione e quella System V è
che questa versione considera ogni spazio bianco come un delimitatore,
cosicché gli spazi nelle stringhe di pattern devono essere prodotti
come sequenze di escape. Per esempio,
.br
>10	string	language impress\ 	(imPRESS data)
.br
in un magic file che già esisteva, è dovuta essere cambiata in
.br
>10	string	language\e impress	(imPRESS data)
.br
Inoltre, in questa versione, se una stringa di pattern contiene
backslash, anche questi devono essere prodotti con le sequenze di
escape. Per esempio,
.br
0	string		\ebegindata	Andrew Toolkit document
.br
in un magic file che già esisteva, è dovuta essere cambiata in
.br
0	string		\e\ebegindata	Andrew Toolkit document
.br
.PP
Le release 3.2 e successive di SunOs della Sun Microsystems includono
un comando
.IR file (1)
derivato dalla versione System V, ma con qualche altra estensione. La
mia versione differisce da quella della Sun solo in modo
minore. Include un estensione dell'operatore `&', usato, ad esempio, per
.br
>16	long&0x7fffffff	>0		not stripped
.SH MAGIC DIRECTORY
Le entry nel magic file sono state collezionate da varie fonti,
principalmente USENET, e con il contributo di vari autori. 
Christos Zoulas (per l'indirizzo si veda sotto) collezionerà entry per
il magic file nuove o corrette. Un magic file aggiornato sarà
distribuito periodicamente.
.PP
L'ordine delle entry nel magic file è significativo. A seconda del
sistema che si sta usando, l'ordine con il quale le hanno messe
assieme potrebbe essere incorretto. Se il tuo vecchio comando
.I file
usa un magic file, si conservi il vecchio magic file per poterlo
confrontare (lo si rinomini in
.IR /etc/magic.orig ).
.SH STORIA
C'è stato un comando
.I file
in ogni UNIX almeno dal Research Version 6
(la pagina di manuale è datata Gennaio 1975).
La versione System V ha introdotto un cambiamento significativo: la
lista esterna dei tipi di magic number. Ciò ha rallentato un po' il
programma ma lo ha reso più flessibile.
.PP
Questo programma, basato sulla versione System V, è stato scritto da
Ian Darwin senza guardare il codice di nessun altro.
.PP
John Gilmore ha revisionato il codice estensivamente, rendendolo
migliore della prima versione.
Geoff Collyer ha trovato diverse inadeguatezze ed ha fornito alcune
delle entry del magic file. Il programma è in continua evoluzione.
.SH AUTORE
Scritto da Ian F. Darwin, indirizzo UUCP {utzoo | ihnp4}!darwin!ian,
indirizzo Internet ian@sq.com, indirizzo postale: P.O. Box 603,
Station F,  Toronto, Ontario, CANADA M4Y 2L8.
.PP
Modificato da Rob McMahon, cudcv@warwick.ac.uk, 1989, per estendere
`&' dal semplice `x&y != 0' a `x&y op z'.
.PP
Modificato da Guy Harris, guy@auspex.com, 1993, per:
.RS
.PP
rimettere com'era l'operatore `&' ``vecchio stile'', in quanto 1) i
cambiamenti di Rob McMahon avevano rotto il vecchio modo d'uso, 2)
l'operatore `&' nel nuovo stile SunOs, che questa versione di
.I file
supporta, può trattare anche `x&y op z', e 3) i cambiamenti di Rob non
erano documentati da nessuna parte;
.PP
mettere livelli multipli di `>';
.PP
mettere nelle keyword ``beshort'', ``leshort'', ecc. di guardare ai
numeri nel file nello specifico ordine di byte, piuttosto che
nell'ordine di byte nativo del processo che lancia
.IR file .
.RE
.PP
Cambiato da Ian Darwin e da vari autori fra i quali
Christos Zoulas (christos@ee.cornell.edu), 1990-1992.
.SH NOTIZIE LEGALI
Copyright (c) Ian F. Darwin, Toronto, Canada,
1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993.
.PP
Questo software non è oggetto e non può essere fatto oggetto di alcuna
licenza della American Telephone and Telegraph Company, della Sun
Microsystems Inc., della Digital Equipment Inc., della Lotus
Development Inc., della Regents of the University of California, del X
Consortium o del MIT, o della Free Software Foundation.
.PP
Questo software non è soggetto a nessun provvedimento del United
States Department of Commerce, e può essere esportato in qualsiasi
nazione o pianeta.
.PP
Ognuno ha il permesso di usare questo software per qualsiasi scopo in
qualsiasi sistema di computer, e di modificarlo e ridistribuirlo
gratuitamente, con le seguenti limitazioni:
.PP 
1. L'autore non è responsabile delle conseguenze derivanti dall'uso di
questo software, nemmeno se brutte, e nemmeno se dipendono da suoi difetti.
.PP
2. Le origini di questo software non devono essere mal rappresentate,
a meno di non segnalare esplicitamente le omissioni. Poiché pochi
utenti leggono mai i sorgenti, i credits devono apparire nella
documentazione. 
.PP
3. Le versioni alterate devono essere segnalate come tali, e non
devono essere spacciate per il software originale. Poiché pochi
utenti leggono mai i sorgenti, i credits devono apparire nella
documentazione. 
.PP
4. Questi avvisi non possono essere rimossi o modificati.
.PP
Alcuni file di supporto (\fIgetopt\fP, \fIstrtok\fP) distribuiti con
questo pacchetto sono di Henry Spencer e sono soggetti ai suddetti
termini. 
.PP
Alcuni file di supporto (\fIstrtol\fP, \fIstrchr\fP) distribuiti con
questo pacchetto sono di pubblico dominio; sono così marcati.
.PP
I file
.I tar.h
e
.I is_tar.c
sono stati scritti da John Gilmore nel suo programma
.I tar
di pubblico dominio, e non sono soggetti alle suddette restrizioni.
.SH PROBLEMI
Ci deve essere un modo migliore per automatizzare la costruzione del
magic file da tutte le fonti nella Magdir. Qual'è? Meglio ancora, il
magic file dovrebbe essere compilato dentro il binario (diciamo,
.IR ndbm (3)
o, meglio ancora, stringhe ASCII di lunghezza fissa per l'uso in
ambienti di rete eterogenei) per uno startup più veloce. Allora il
programma potrebbe girare veloce quando la Version 7 del programma con
lo stesso nome, con la flessibilità della versione del System V.
.PP
.I File 
usa diversi algoritmi che favoriscono la velocità a scapito
dell'accuratezza, quindi può sbagliare il contenuto dei file ASCII.
.PP
Il supporto per il file ASCII (principalmente per i linguaggi di
programmazione) è semplicistico, inefficiente e richiede la
ricompilazione per essere aggiornato.
.PP
Ci dovrebbe essere una clausola ``else'' che segue una serie di linee
di continuazione.
.PP
Il magic file e le parole chiave dovrebbero avere il supporto per le
espressioni regolari. Il loro uso del TAB ASCII come delimitatore è
brutto e rende difficile editare il file, ma è consolidato.
.PP
Potrebbe essere utile permette l'uso delle lettere maiuscole nelle
parole chiave, p.es. per distinguere i comandi troff dalle macro delle
man page. Ciò sarebbe reso facile dal supporto per le espressioni regoleri.
.PP
Il programma non identifica il \s-2FORTRAN\s0. Dovrebbe essere in
grado di scovare il \s-2FORTRAN\s0 vedendo alcune parole chiave che
sono identate all'inizio della riga. Ciò sarebbe reso facile dal
supporto per le espressioni regolari.
.PP
La lista delle parole chiave in
.I ascmagic
probabilmente dovrebbe far parte del magic file. Ciò potrebbe essere
fatto usando qualche keyword come `*' per il valore di offset.
.PP
Un'altra ottimizzazione potrebbe essere l'ordinamento del magic file
in modo che si possano saltare tutti i test sul primo byte, il primo
word, il primo long, ecc., una volta che ne è stato raggiunto uno (?).
Proteste circa i conflitti nelle entry del magic file. Facciamo delle
regole in modo che l'ordine delle magic entry sia basato sul file
offset piuttosto che sulla posizione all'interno del magic file?
.PP
Il programma dovrebbe fornire un modo per dare una stima di ``quanto
bene'' possa aver indovinato. Alla fine rimuovendo le ``sparate''
(p.es. ``From'' come primi 5 caratteri del file) perché alcune non
sono così buone come altre (p.es. ``Newsgroups:'' contro
"Return-Path:"). Ancora, se le altre non hanno successo, dovrebbe
essere ancora possibile usare la prima.
.PP
Questo programma è più lento del comando file di qualche produttore.
.PP
Questa pagina di manuale, e in particolare questa sezione, è troppo
lunga. (n.d.t. Non posso far altro che confermare :-).)
.SH DISPONIBILITÀ
È possibile ottenere l'ultima versione originale dell'autore con FTP
anomino a
.B tesla.ee.cornell.edu
nella directory
.BR /pub/file-X.YY.tar.gz .
