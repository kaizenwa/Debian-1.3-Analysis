#! /usr/bin/make -f
#
# Last updated: Sat Dec 13 20:52:20 EST 1994 by joey.
#
# To make the binary distribution package, the ``Debianized'' source package
# and the context diff to the original package, type `./debian.rules dist'.
# Make sure that `debian.rules' is executable before the final distribution
# is made.
#
# Invoke each target with `./debian.rules <target>'.  All targets should be
# invoked with the package root as the current directory.
#
# The `binary' target must be run as root, as it needs to install files with
# specific ownerships.  The `diff' target assumes that you have the original
# source package available, unpacked, in ../$(p)-$(version).orig, or that you have
# the previous revision of the ``Debianized'' source package and context diff
# in the parent directory.

# The name of the package
package = manpages-de
# The version of the package
version = 0.1
# The Debian revision of the package
revision = 6
# The architecture of this build
arch = all

build:
# Builds the binary package.
# empty

clean:
# Undoes the effect of `make -f debian.rules build'.
	rm -rf debian-tmp *~
	find man? -name '*~' -exec rm {} \;

binary:
# Makes a binary package.
	install -d -g root -m 755 -o root debian-tmp
	chmod g-s debian-tmp
	install -d -g root -m 755 -o root debian-tmp/DEBIAN
	install -g root -m 755 -o root debian.postinst debian-tmp/DEBIAN/postinst
	sed -e 's/@@version@@/$(version)-$(revision)/' -e 's/@@arch@@/$(arch)/' \
	  -e 's/@@package@@/$(package)/' debian.control > debian-tmp/DEBIAN/control
	chmod 644 debian-tmp/DEBIAN/control
	#
	install -d -g root -m 755 -o root debian-tmp/usr
	install -d -g root -m 755 -o root debian-tmp/usr/man/de_DE
	install -d -g root -m 755 -o root debian-tmp/usr/doc/$(package)
	install -g root -m 644 -o root debian.readme debian-tmp/usr/doc/$(package)/readme.debian
	install -g root -m 644 -o root COPYRIGHT debian-tmp/usr/doc/$(package)/copyright
	install -g root -m 644 -o root README debian-tmp/usr/doc/$(package)/readme
	install -g root -m 644 -o root debian.ChangeLog debian-tmp/usr/doc/$(package)/changelog.debian
	gzip -9f debian-tmp/usr/doc/$(package)/changelog.debian
	for sect in 1 2 3 4 5 6 7 8 9; do \
	  if [ -d man$$sect ]; then \
	    install -d -g root -m 755 -o root debian-tmp/usr/man/de_DE/man$$sect; \
	    for file in `(cd man$$sect && ls *.$$sect*)`; do \
	      install -m 644 -o root -g root man$$sect/$$file \
	        debian-tmp/usr/man/de_DE/man$$sect/$$file; \
	    done; \
	  fi; \
	done
	dpkg --build debian-tmp && dpkg-name -o -s .. debian-tmp.deb

source:
# Makes a source package.
	make -f debian.rules clean
	( cd .. && tar cf - $(package)-$(version) | gzip -9f > $(package)_$(version)-$(revision).tar.gz )

diff:
# Makes a context diff.
	make -f debian.rules clean
	-test -d ../orig/$(package)-$(version) -a ! -d ../$(package)-$(version).orig \
	  && (ln -s orig/$(package)-$(version) ../$(package)-$(version).orig; touch stamp-orig; true)
	-test -d ../$(package)-$(version).orig -o -f ../$(package)_$(version)-`expr $(revision) - 1`.diff.gz \
	  || ( echo "Original source package is not available." ; false )
	-test -d ../$(package)-$(version).orig || make -f debian.rules orig
	( cd .. && diff -cNr $(package)-$(version).orig $(package)-$(version) | gzip -9f \
	  > $(package)_$(version)-$(revision).diff.gz )
	-test -f stamp-orig \
	  && rm -rf ../$(package)-$(version).orig && rm -f stamp-orig

dist: binary source diff
# Prepares the package for distribution.

orig:
# Prepares the original package from the previous
# Debian revision source package and context diff.
	( cd .. \
	  && mkdir $(package).orig \
	  && cd $(package).orig \
	  && tar xzf ../$(package)_$(version)-`expr $(revision) - 1`.tar.gz \
	  && cd $(package)-$(version) \
	  && ( zcat ../../$(package)_$(version)-`expr $(revision) - 1`.diff.gz \
	    | patch -sER -p1 ) \
	  && find . -name "*.orig" -exec rm -f {} \; \
	  && cd .. \
	  && mv $(package)-$(version) ../$(package)-$(version).orig \
	  && cd .. \
	  && rmdir $(package).orig )
	touch stamp-orig
