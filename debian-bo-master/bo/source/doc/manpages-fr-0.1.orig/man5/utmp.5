.\" Copyright (c) 1993 Michael Haardt (michael@cantor.informatik.rwth-aachen.de), Fri Apr  2 11:32:09 MET DST 1993
.\"
.\" This is free documentation; you can redistribute it and/or
.\" modify it under the terms of the GNU General Public License as
.\" published by the Free Software Foundation; either version 2 of
.\" the License, or (at your option) any later version.
.\"
.\" The GNU General Public License's references to "object code"
.\" and "executables" are to be interpreted as the output of any
.\" document formatting or typesetting system, including
.\" intermediate and printed output.
.\"
.\" This manual is distributed in the hope that it will be useful,
.\" but WITHOUT ANY WARRANTY; without even the implied warranty of
.\" MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
.\" GNU General Public License for more details.
.\"
.\" You should have received a copy of the GNU General Public
.\" License along with this manual; if not, write to the Free
.\" Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139,
.\" USA.
.\" 
.\" Modified Sun Jul 25 10:44:50 1993 by Rik Faith (faith@cs.unc.edu)
.\" Modified Thu Feb 26 16:08:49 MET 1995 by Michael Haardt
.\" Traduction 18/10/1996 par Christophe Blaess (ccb@club-internet.fr)
.\"
.TH UTMP 5 "18 Octobre 1996" Linux "Manuel de l'administrateur Linux"
.SH NOM
utmp, wtmp \- Enregistrements de connexion.
.SH SYNOPSIS
#include <utmp.h>
.SH DESCRIPTION
Le fichier
.B utmp
permet de voir qui est connecte sur le systeme. Tous les programmes n'utilisant
pas les enregistrement utmp, il se peut qu'il y ait plus d'utilisateurs que
ceux affiches.

\fBAttention\fP : \fButmp\fP ne doit pas etre accessible en ecriture car de
nombreux programmes systemes dependent de son integrite.
En laissant \fButmp\fP accessible en ecriture pour les utilisaters, vous prenez
le risque d'avoir de mauvais fichiers de journalisation, et d'obtenir des
modifications de fichiers systeme.

Le fichier est une suite d'enregistrement avec la structure suivante :
.RS
.nf
.sp
.ta 3i
#define UT_UNKNOWN	0
#define RUN_LVL		1
#define BOOT_TIME	2
#define NEW_TIME	3
#define OLD_TIME	4
#define INIT_PROCESS	5
#define LOGIN_PROCESS	6
#define USER_PROCESS	7
#define DEAD_PROCESS	8

#define UT_LINESIZE	12
#define UT_NAMESIZE	8
#define UT_HOSTSIZE	16

struct utmp {
  short ut_type;              /* type de login              */
  pid_t ut_pid;               /* pid du processus           */
  char ut_line[UT_LINESIZE];  /* peripherique tty \- "/dev/" */
  char ut_id[2];              /* ID tty initial             */
  time_t ut_time;             /* heure de login             */
  char ut_user[UT_NAMESIZE];  /* nom utilisateur            */
  char ut_host[UT_HOSTSIZE];   /* nom hote si login distant */
  long ut_addr;                /* Adresse IP hote distant   */
};
.sp
.fi
.RE
Cette structure donne le nom du fichier special associe au terminal de 
l'utilisateur, le nom d'utilisateur, l'heure de connexion sous la forme
.IR time (2).
Les chaine des caracteres se termine par \fB'\e0'\fP si elles sont plus
courtes que les longueurs definies dans la structure.
.PP
Le fichier \fBwtmp\fP enregistre les connexions et deconnexions. Son
format est exactement le meme que \fButmp\fP excepte qu'un utilisateur nul
indique une deconnexion sur le terminal associe.
De plus un nom de terminal \fB"~"\fP, associe a un nom d'utilisateur
\fB"shutdown"\fP ou \fB"reboot"\fP indique un arret ou un redemarrage
du systeme. Une paire d'enregistrements avec les noms de terminaux 
\fB"|"\fP / \fB"}"\fP indique une modification de l'heure systeme.

Le fichier \fBwtmp\fP est maintenu par \fIlogin\fP(1), \fIinit\fP(1) 
et quelques un des \fIgetty\fP(1).
Aucun de ces programmes ne cree le fichier, aussi sil on le supprime, les
enregistrements de connexions sont arretes.
.SH FICHIERS
/var/adm/utmp
.br
/var/adm/wtmp
.SH "CONFORME A"
Les enregistrements utmp de Linux ne se conforment ni a v7/BSD ni a SYSV.
Ils sont en realite un melange des deux.
v7/BSD dispose de moins de champs, par exemple pas de \fBut_type\fP, 
ce qui conduit les programmes pour v7/BSD a afficher des entrees invalides
de login.
SYSV dispose d'un champ supplementaire pour enregistrer le statut de sortie
des processus.

.SH RESTRICTIONS
Le format de ces fichiers depend de la machine, et il est recommande de 
ne les utiliser que sur la machine ou ils ont ete crees.
.SH "VOIR AUSSI"
.BR ac (1),
.BR date (1),
.BR last (1),
.BR login (1),
.BR who (1),
.BR getutent (3),
.BR init (8)
