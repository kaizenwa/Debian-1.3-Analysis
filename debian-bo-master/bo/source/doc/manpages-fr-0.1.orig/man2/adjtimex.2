.\" Hey Emacs! This file is -*- nroff -*- source.
.\"
.\" Copyright (c) 1995 Michael Chastain (mec@shell.portal.com), 15 April 1995.
.\"
.\" This is free documentation; you can redistribute it and/or
.\" modify it under the terms of the GNU General Public License as
.\" published by the Free Software Foundation; either version 2 of
.\" the License, or (at your option) any later version.
.\"
.\" The GNU General Public License's references to "object code"
.\" and "executables" are to be interpreted as the output of any
.\" document formatting or typesetting system, including
.\" intermediate and printed output.
.\"
.\" This manual is distributed in the hope that it will be useful,
.\" but WITHOUT ANY WARRANTY; without even the implied warranty of
.\" MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
.\" GNU General Public License for more details.
.\"
.\" You should have received a copy of the GNU General Public
.\" License along with this manual; if not, write to the Free
.\" Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139,
.\" USA.
.\"
.\" Traduction 14/10/1996 par Christophe Blaess (ccb@club-internet.fr)
.\"
.TH ADJTIMEX 2 "14 Octobre 1996" "Linux 1.2.4" "Manuel du programmeur Linux"
.SH NOM
adjtimex \- Regler l'horloge du noyau (kernel clock)
.SH SYNOPSIS
.B #include <sys/timex.h>
.sp
.BI "int adjtimex(struct timex *" "buf" ");"
.SH DESCRIPTION
Linux utilise l'algorithme d'ajustement d'horloge de David Mill.
.B adjtimex
lit, et ecrit eventuellement les parametres d'ajustement pour
cet algorithme.
.PP
.B adjtimex
utilise un pointeur sur une structure
.I timex 
pour mettre a jour les parametres du noyau avec les valeurs de ses
champs, et renvoyer la meme structure avec les valeurs
actuelles du noyau.
La structure est declaree comme suit
.PP
.RS
.nf
struct timex
{
    int mode;            /* mode selector */
    long offset;         /* time offset (usec) */
    long frequency;      /* frequency offset (scaled ppm) */
    long maxerror;       /* maximum error (usec) */
    long esterror;       /* estimated error (usec) */
    int status;          /* clock command/status */
    long time_constant;  /* pll time constant */
    long precision;      /* clock precision (usec) (read only) */
    long tolerance;      /* clock frequency tolerance (ppm)
                            (read only) */
    struct timeval time; /* (read only) */
    long tick;           /* usecs between clock ticks */
};
.fi
.RE
.PP
Le champ
.I mode
determine les parametres eventuels a ecrire.
Il contient un
.RI OU 
binaire
( | ) entre les valeurs suivantes:
.PP
.RS
.nf
#define ADJ_OFFSET            0x0001 /* time offset */
#define ADJ_FREQUENCY         0x0002 /* frequency offset */
#define ADJ_MAXERROR          0x0004 /* maximum time error */
#define ADJ_ESTERROR          0x0008 /* estimated time error */
#define ADJ_STATUS            0x0010 /* clock status */
#define ADJ_TIMECONST         0x0020 /* pll time constant */
#define ADJ_TICK              0x4000 /* tick value */
#define ADJ_OFFSET_SINGLESHOT 0x8001 /* old-fashioned adjtime */
.fi
.RE
.PP
Les utilisateurs normaux sont limites a une valeur de
.IR mode 
nulle, seul le Super-User peut ecrire les parametres.
.br
.ne 12v
.SH "VALEUR RENVOYEE"
.B adjtimex
renvoie la valeur de
.IR buf.status 
s'il reussit :
.PP
.RS
.nf
#define TIME_OK  0 /* clock synchronized */
#define TIME_INS 1 /* insert leap second */
#define TIME_DEL 2 /* delete leap second */
#define TIME_OOP 3 /* leap second in progress */
#define TIME_BAD 4 /* clock not synchronized */
.fi
.RE
.PP
En cas d'echec
.B adjtimex
renvoie \-1 et
.IR errno 
contient le code d'erreur.
.SH ERREURS
.TP
.B EFAULT
.I buf
pointe en dehors de l'espace d'adressage accessible.
.TP
.B EPERM
.I buf.mode
est non nul, et l'utilisateur n'est pas Super-User.
.TP
.B EINVAL
.I buf.offset
est en dehors de l'intervalle \-131071 a +131071,
ou
.I buf.status
a une valeur autre que celle listee ci-dessus,
ou
.I buf.tick
est en dehors de l'intervalle
.RB 900000/ HZ
a
.RB 1100000/ HZ ,
.B HZ
etant la frequence d'interruption de l'horloge systeme.
.SH "VOIR AUSSI"
.BR settimeofday (2).
