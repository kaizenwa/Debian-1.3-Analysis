.\" Copyright 1993 Giorgio Ciucci (giorgio@crcc.it)
.\"
.\" Permission is granted to make and distribute verbatim copies of this
.\" manual provided the copyright notice and this permission notice are
.\" preserved on all copies.
.\"
.\" Permission is granted to copy and distribute modified versions of this
.\" manual under the conditions for verbatim copying, provided that the
.\" entire resulting derived work is distributed under the terms of a
.\" permission notice identical to this one
.\" 
.\" Since the Linux kernel and libraries are constantly changing, this
.\" manual page may be incorrect or out-of-date.  The author(s) assume no
.\" responsibility for errors or omissions, or for damages resulting from
.\" the use of the information contained herein.  The author(s) may not
.\" have taken the same level of care in the production of this manual,
.\" which is licensed free of charge, as they might when working
.\" professionally.
.\" 
.\" Formatted or processed versions of this manual, if unaccompanied by
.\" the source, must acknowledge the copyright and authors of this work.
.\"
.\" Traduction 14/10/1996 par Christophe Blaess (ccb@club-internet.fr)
.\"
.TH MSGCTL 2 "14 Octobre 1996" "Linux 0.99.13" "Manuel du programmeur Linux"
.SH NOM
msgctl \- Controler les messages.
.SH SYNOPSIS
.nf
.B
# include <sys/types.h>
.B
# include <sys/ipc.h>
.B
# include <sys/msg.h>
.fi
.sp
.BI "int msgctl ( int " msqid ",
.BI "int  " cmd ,
.BI "struct msqid_ds *" buf " )"
.SH DESCRIPTION
Cette fonction permet d'effectuer l'operation 
indiquee par
.I cmd
sur la file de messages ayant l'identificateur
.IR msqid.
Les valeurs possibles de
.I cmd
sont :
.TP 12
.B IPC_STAT
Copier les informations depuis la structure representant
la file de messages dans la structure pointee par
.IR buf.
L'appelant doit avoir des privileges d'acces en lecture sur
la file de messages.
.TP
.B IPC_SET
Ecrire la valeurs de certains champs de la structure
.B msqid_ds
pointee par
.I buf
dans la structure representant la file de messages, 
en mettant a jour le champ
.B msg_ctime.
Les champs a copier depuis la structure
.B "struct msqid_ds"
pointee par
.I buf
sont
.nf
.sp
.ft B
	msg_perm.uid
	msg_perm.gid
	msg_perm.mode \fR/* 9 bits poids faibles */\fP
	msg_qbytes
.fi
.ft R
.sp
L'UID effectif du processus appelant doit etre soit 
celui du Super\-User
soit celui du createur ou du proprietaire 
de la file de messages.
Seul le Super\-User peut augmenter la valeur de
.B msg_qbytes
au\-dessus de la constante systeme
.BR MSGMNB.
.TP
.B IPC_RMID
Effacer immediatement la file de messages et ses structures
de donnees, en reveillant tous les processus ecrivains et
lecteurs en attente. Ils obtiendront un code d'erreur, et
.B errno
aura la valeur
.BR EIDRM.
L'UID effectif du processus appelant doit etre soit celui 
du Super\-User
soit celui du createur ou du proprietaire de la file de messages.
.SH "VALEUR RENVOYEE"
.BR msgctl
renvoie 0 s'il reussit, ou \-1 s'il echoue, auquel
cas
.B errno
contient le code d'erreur.
.SH ERREURS
.TP 11
.B EACCESS
L'argument
.I cmd
reclame l'operation
.B IPC_STAT
mais le processus appelant n'a pas d'acces en lecture sur la
file de messages
.IR msqid.
.TP
.B EFAULT
L'argument
.I cmd
reclame l'operation
.B IPC_SET
ou
.B IPC_STAT
mais
.I buf
pointe en dehors de l'espace d'adressage accessible.
.TP
.B EIDRM
La file de messages a deja ete supprimee.
.TP
.B EINVAL
.I cmd
ou
.IR msqid 
ont une valeur illegale.
.TP
.B EPERM
L'argument
.I cmd
reclame l'operation
.B IPC_SET
ou
.B IPC_RMID
mais l'UID effectif du processus appelant n'a pas
assez de privileges pour realiser la commande.
C'est aussi le cas d'un processus non Super\-User
tentant d'augmenter
.B msg_qbytes
au-dessus de la valeur
.BR MSGMNB .
.SH NOTES
Les appels
.BR IPC_INFO ,
.BR MSG_STAT
et
.B MSG_INFO
sont utilises par le programme
.BR ipcs (1)
pour fournir des informations sur les ressources allouees
dans le futur, ceci peut etre modifie si besoin, ou remplace par
une interface avec le systeme de fichiers proc.
.SH "VOIR AUSSI"
.BR ipc (5),
.BR msgget (2),
.BR msgsnd (2),
.BR msgrcv (2).
