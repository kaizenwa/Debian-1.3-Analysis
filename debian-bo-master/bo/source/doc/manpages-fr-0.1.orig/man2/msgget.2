.\" Copyright 1993 Giorgio Ciucci (giorgio@crcc.it)
.\"
.\" Permission is granted to make and distribute verbatim copies of this
.\" manual provided the copyright notice and this permission notice are
.\" preserved on all copies.
.\"
.\" Permission is granted to copy and distribute modified versions of this
.\" manual under the conditions for verbatim copying, provided that the
.\" entire resulting derived work is distributed under the terms of a
.\" permission notice identical to this one
.\" 
.\" Since the Linux kernel and libraries are constantly changing, this
.\" manual page may be incorrect or out-of-date.  The author(s) assume no
.\" responsibility for errors or omissions, or for damages resulting from
.\" the use of the information contained herein.  The author(s) may not
.\" have taken the same level of care in the production of this manual,
.\" which is licensed free of charge, as they might when working
.\" professionally.
.\" 
.\" Formatted or processed versions of this manual, if unaccompanied by
.\" the source, must acknowledge the copyright and authors of this work.
.\"
.\" Traduction 14/10/1996 par Christophe Blaess (ccb@club-internet.fr)
.\"
.TH MSGGET 2 "14 Octobre 1996" "Linux 0.99.13" "Manuel du programmeur Linux"
.SH NOM
msgget \- Obtenir un identificateur de file de messages.
.SH SYNOPSIS
.nf
.B
# include <sys/types.h>
.B
# include <sys/ipc.h>
.B
# include <sys/msg.h>
.fi
.sp
.BI "int msgget ( key_t " key ,
.BI "int "msgflg " )"
.SH DESCRIPTION
Cette fonction renvoie l'identificateur de la file de
messages associee a la cle
.I key.
Une nouvelle file de messages est cree si
.I key
a la valeur
.B IPC_PRIVATE
ou si
aucune file de message n'est associee a
.IR key ,
et si la valeur
.B IPC_CREAT
a ete introduite dans
.I msgflg.
La presence des champs
.B IPC_CREAT
et
.B IPC_EXCL
dans
.I msgflg
joue le meme role, par rapport a l'existence de
la file de messages, que la presence des champs
.B O_CREAT
et
.B O_EXCL
dans l'argument
.I mode
de l'appel systeme
.BR open (2).

La fonction
.B msgget
echouera si
.I msgflg
indique a la fois
.B IPC_CREAT
et
.B IPC_EXCL
et si une file de messages existe deja associee a
.IR key.
.PP
Lors de la creation, les 9 bits de poids faibles de l'argument
.I msgflg
definissent les permissions d'acces a la file de message
(pour le proprietaire, le groupe, et les autres) avec le
meme format et la meme signification que les permissions
d'acces dans les appels
.BR open (2)
ou
.BR creat (2)
(bien que la permission d'execution ne soit pas utilisee).
.PP
Pendant la creation, l'appel systeme initialise la structure
systeme 
.B msqid_ds
de la file de messages comme suit :
.IP
.B msg_perm.cuid
et
.B msg_perm.uid
sont remplis avec l'UID effectif du processus appelant.
.IP
.B msg_perm.cgid
et
.B msg_perm.gid
sont remplis avec le GID effectif du processus appelant.
.IP
Les 9 bits de poids faibles de
.IR msgflg .
sont copies dans les 9 bits de poids faibles de
.B msg_perm.mode
.IP
.BR msg_qnum ,
.BR msg_lspid ,
.BR msg_lrpid ,
.BR msg_stime
et
.B msg_rtime
sont fixes a 0.
.IP
.B msg_ctime
est rempli avec l'heure actuelle.
.IP
.B msg_qbytes
est rempli avec la limite systeme
.BR MSGMNB .
.PP
Si la file de message existe deja, les permissions d'acces sont
controlees, et une verification est faite pour voir si la file
est prete a etre detruite.
.SH "VALEUR RENVOYEE"
.BR msgget
renvoie l'ientificateur de la file de messages (un entier positif), 
s'il reussit.
En cas d'echec \-1 est renvoye et
.B errno
contient le code d'erreur.
.SH ERREURS
.TP 11
.B EACCES
Une file de messages existe associee a la cle
.IR key ,
mais le processus appelant n'a pas de permissions sur cette
file.
.TP
.B EEXIST
Une file de messages existe associee a la cle
.B key
et
.I msgflg
reclame a la fois
.B IPC_CREAT
et
.BR IPC_EXCL .
.TP
.B EIDRM
la file de messages est prete a etre supprimee.
.TP
.B ENOENT
Aucune file de messages n'existe associee a la cle
.I key
et
.I msgflg
ne contient pas
.BR IPC_CREAT .
.TP
.B ENOMEM
Pas assez de memoire pour les nouvelles structures de donnees.
.TP
.B ENOSPC
Le nombre maximum de files de messages sur le systeme
.RB ( MSGMNI )
est atteint.
.SH NOTES
.B IPC_PRIVATE
n'est pas destine au champ
.I msgflg
mais est du type
.B key_t.
Si cette valeur speciale est fournie a la place de
.IR key ,
l'appel systeme ignorera tout sauf les 9 bits de poids faibles de
.I msgflg
et creera une nouvelle file de messages.
.PP
La limite systeme concernant les files de messages et affectant
.B msgget
est
.TP 11
.B MSGMNI
Nombre maximum de files de messages sur le systeme.
.SH BUGS
l'utilisation de
.B IPC_PRIVATE
n'empeche pas les autres processus d'avoir acces a la file
de messages allouee.
.PP
Comme pour les fichiers, il n'y a actuellement pas de possibilite
intrinseque d'assurer l'exclusivite d'acces a une file de messages
pour un processus.

Reclamer a la fois
.B IPC_CREAT
et
.B IPC_EXCL
dans
.I msgflg
garantit seulement qu'une nouvelle file sera cree, mais n'implique
pas un acces exclusif a la file.
.SH "VOIR AUSSI"
.BR ftok (3),
.BR ipc (5),
.BR msgctl (2),
.BR msgsnd (2),
.BR msgrcv (2).
