.\" Copyright 1993 Giorgio Ciucci (giorgio@crcc.it)
.\"
.\" Permission is granted to make and distribute verbatim copies of this
.\" manual provided the copyright notice and this permission notice are
.\" preserved on all copies.
.\"
.\" Permission is granted to copy and distribute modified versions of this
.\" manual under the conditions for verbatim copying, provided that the
.\" entire resulting derived work is distributed under the terms of a
.\" permission notice identical to this one
.\" 
.\" Since the Linux kernel and libraries are constantly changing, this
.\" manual page may be incorrect or out-of-date.  The author(s) assume no
.\" responsibility for errors or omissions, or for damages resulting from
.\" the use of the information contained herein.  The author(s) may not
.\" have taken the same level of care in the production of this manual,
.\" which is licensed free of charge, as they might when working
.\" professionally.
.\" 
.\" Formatted or processed versions of this manual, if unaccompanied by
.\" the source, must acknowledge the copyright and authors of this work.
.\"
.\" Traduction 15/10/1996 par Christophe Blaess (ccb@club-internet.fr)
.\"
.TH SEMCTL 2 "15 Octobre 1996" Linux "Manuel du programmeur Linux"
.SH NOM
semctl \- Operations de controle sur les semaphores
.SH SYNOPSIS
.nf
.B
# include <sys/types.h>
.B
# include <sys/ipc.h>
.B
# include <sys/sem.h>
.fi
.sp
.BI "int semctl ( int " semid ,
.BI "int " semno ,
.BI "int " cmd ,
.BI "union semun " arg " )"
.SH DESCRIPTION
Cette fonction effectue l'operation de controle indiquee par
.I cmd
sur l'ensemble de semaphores (ou sur le 
.IR semno\-ieme
semaphore de l'ensemble) identifie par
.IR semid.
Le premier semaphore de l'ensemble est identifie par la valeur
.B 0
dans l'argument
.IR semno.
.PP
Le type de l'argument
.I arg
est une union
.nf
union semun {
	int val;
	/* used for SETVAL only */	
	struct semid_ds *buf;
	/* for IPC_STAT and IPC_SET */
	ushort *array;	
	/* used for GETALL and SETALL */
};
.fi
Les valeurs autorisees pour l'operation
.I cmd
sont :
.TP 12
.B IPC_STAT
copier dans la structure pointee par
.I arg.buf
la structure de donnees concernant l'ensemble de semaphores.
L'argument
.I semno
est alors ignore.
Le processus appelant doit avoir des privileges de lecture 
sur le jeu de semaphores
.TP
.B IPC_SET
Fixer la valeur de certains champs de la structure
.B semid_ds
pointee par
.I arg.buf
dans la structure de controle de l'ensemble de semaphores, en mettant a jour
son membre
.B sem_ctime.
Les champs de la structure
.B "struct semid_ds"
fournie dans 
.I arg.buf
et copies dans la structure de l'ensemble sont :
.nf
.sp
.ft B
	sem_perm.uid
	sem_perm.gid
	sem_perm.mode	\fR/* 9 bits poids faibles*/\fP
.fi
.ft R
.sp
L'UID effectif du processus appelant doit etre soit 
celui du Super\-User
soit celui du createur ou du proprietaire 
du jeu de semaphores.
L'argument
.I semno
est ignore.
.TP
.B IPC_RMID
Supprimer immediatement l'ensemble de semaphores en reveillant 
tous les processus  en attente. Ils obtiendront un code d'erreur, et
.B errno
aura la valeur
.BR EIDRM.
L'UID effectif du processus appelant doit etre soit celui 
du Super\-User
soit celui du createur ou du proprietaire du jeu de semaphores.
L'argument
.I semno
est ignore.
.TP
.B GETALL
Renvoyer la valeur
.B semval
de chaque semaphore de l'ensemble dans le tableau
.I arg.array.
L'argument
.I semno
est ignore.
Le processus appelant doit avoir des privileges de lecture 
sur le jeu de semaphores.
.TP
.B GETNCNT
Renvoyer la valeur de
.B semncnt
pour le
.IR semno\-ieme
semaphore de l'ensemle
(i.e. le nombre de processus en attente d'une incrementation du
champ 
.B semval
du
.IR semno\-ieme
semaphore).
Le processus appelant doit avoir des privileges de lecture 
sur le jeu de semaphores.
.TP
.B GETPID
Renvoyer la valeur de 
.B sempid
pour le
.IR semno\-ieme
semaphore de l'ensemble
(i.e. le PID du processus ayant execute le dernier appel
systeme
.B semop
sur le
.IR semno\-ieme
semaphore).
Le processus appelant doit avoir des privileges de lecture 
sur le jeu de semaphores.
.TP
.B GETVAL
Renvoyer la valeur du champ
.B semval
du
.IR semno\-ieme
semaphore de l'ensemble
Le processus appelant doit avoir des privileges de lecture 
sur le jeu de semaphores.
.TP
.B GETZCNT
Renvoyer la valeur du champ
.B semzcnt
du
.IR semno\-ieme
semaphore de l'ensemble.
(i.e. le nombre de processus attendant que le champ
.B semval
du 
.IR semno\-ieme
semaphore revienne a 0).
Le processus appelant doit avoir des privileges de lecture 
sur le jeu de semaphores.
.TP
.B SETALL
Positionner le champ
.B semval
de tous les semaphores de l'ensemble en utilisant le tableau
.I arg.array ,
et en mettant a jour le champ
.B sem_ctime
de la structure
.B semid_ds
de controle du jeu de semaphores.
Les processus en attente sont reveilles si
.B semval
devient 0 ou augmente.
L'argument
.I semno
est ignore.
Le processus appelant doit avoir des privileges d'ecriture
sur le jeu de semaphores.
.TP
.B SETVAL
Placer la valeur
.I arg.val
dans le champ
.B semval
du
.IR semno\-ieme
semaphore de l'ensemble en mettant a jour
le champ
.B sem_ctime
dans la structure
.B semid_ds
associee au jeu de semaphores.
Le processus appelant doit avoir des privileges d'ecriture
sur le jeu de semaphores
Les processus en attente sont reveilles si
.B semval
devient 0 ou augmente.
.SH "VALEUR RENVOYEE"
En cas d'echec l'appel systeme renvoie
.B \-1
et
.B errno
contient le code d'erreur.
Autrement, l'appel systeme renvoie une valeur non\-negative
dependant de l'argument
.I cmd :
.TP 11
.B GETNCNT
la valeur de
.BR semncnt .
.TP
.B GETPID
La valeur 
.BR sempid .
.TP
.B GETVAL
La valeur
.BR semval .
.TP
.B GETZCNT
La valeur
.BR semzcnt .
.SH ERREURS
.B EACCESS
Le processus appelant n'a pas les privileges necessaires pour
executer la commande
.IR cmd .
.TP
.B EFAULT
.I arg.buf
.I arg.array
pointent en dehors de l'espace d'adressage accessible.
.TP
.B EIDRM
L'ensemble de semaphores a ete supprime.
.TP
.B EINVAL
.I cmd
ou
.IR semid 
a une valeur illegale.
.TP
.B EPERM
L'argument
.I cmd
reclame les commandes
.B IPC_SET
ou
.B IPC_RMID
mais l'UID effectif du processus appelant n'a pas
les privileges adequats.
.TP
.B ERANGE
l'argument
.I cmd
reclame les commandes
.B SETALL
ou
.B SETVAL
et la valeur de
.B semval
(pour l'ensemble ou pour certains semaphores) est inferieure
a 0 ou superieur a la valeur
.BR SEMVMX .
.SH NOTES
Les appels systemes
.BR IPC_INFO ,
.BR SEM_STAT
et
.B SEM_INFO
sont utilises par le programme
.BR ipcs (1)
pour fournir des informations sur les ressources allouees.
Ceci peut changer dans le futur, en utilisant l'interface
d'un systeme de fichiers proc.
.PP
La limite suivante influe sur l'appel systeme
.B semctl :
.TP 11
.B SEMVMX
Valeur maximale pour
.BR semval :
dependant de l'implementation (generalement 32767).
.SH "VOIR AUSSI"
.BR ipc (5),
.BR shmget (2),
.BR shmat (2),
.BR shmdt (2).
