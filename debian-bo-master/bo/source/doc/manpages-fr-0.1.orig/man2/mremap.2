.\" Hey Emacs! This file is -*- nroff -*- source.
.\"
.\" Copyright (c) 1996 Tom Bjorkholm <tomb@mydata.se>
.\"
.\" This is free documentation; you can redistribute it and/or
.\" modify it under the terms of the GNU General Public License as
.\" published by the Free Software Foundation; either version 2 of
.\" the License, or (at your option) any later version.
.\"
.\" The GNU General Public License's references to "object code"
.\" and "executables" are to be interpreted as the output of any
.\" document formatting or typesetting system, including
.\" intermediate and printed output.
.\"
.\" This manual is distributed in the hope that it will be useful,
.\" but WITHOUT ANY WARRANTY; without even the implied warranty of
.\" MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
.\" GNU General Public License for more details.
.\"
.\" You should have received a copy of the GNU General Public
.\" License along with this manual; if not, write to the Free
.\" Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139,
.\" USA.
.\"
.\" 1996-04-11 Tom Bjorkholm <tomb@mydata.se>
.\"            First version written (1.3.86)
.\" 1996-04-12 Tom Bjorkholm <tomb@mydata.se>
.\"            Update for Linux 1.3.87 and later
.\"
.\" Traduction 14/10/1996 par Christophe Blaess (ccb@club-internet.fr)
.\"
.TH MREMAP 2 "14 Octobre 1996" "Linux 1.3.87" "Manuel du programmeur Linux"
.SH NOM
mremap \- Modifie une projection (mapping) de la memoire virtuelle.
.SH SYNOPSIS
.B #include <unistd.h>
.br
.B #include <sys/mman.h>
.sp
.BI "void * mremap(void * " old_address ", size_t " old_size
.BI ", size_t " new_size ", unsigned long " flags );
.fi
.SH DESCRIPTION
\fBmremap\fR 
agrandit (ou diminue) une projection (mapping) de memoire virtuelle
en memoire reelle,
en la deplacant eventuellement (sous controle de l'argument
\fIflags\fR et de la place disponible dans l'espace d'adressage
virtuel).

\fIold_address\fR est l'ancienne adresse du bloc de memoire
virtuelle a agrandir (ou a diminuer).  
Notez que \fIold_address\fR doit etre alignee sur une frontiere de
page.

\fIold_size\fR est la taille du bloc de memoire virtuelle.

\fInew_size\fR est la taille desiree pour le nouveau bloc de
memoire.

L'argument \fIflags\fR contient les options decrites plus bas.

Sous Linux, la memoire est divisee en pages. Un processus
utilisateur dispose d'un ou plusieurs segments lineaires
de memoire virtuelle.
A chaque segment correspond une ou plusieurs projections dans
les pages de memoire reelle (dans la table des pages).

Chaque segment de memoire virtuelle dispose de ses propres
droits d'acces (sa protection), ce qui peut declencher
des fautes de segmentation si la memoire est utilisee
incorrectement (par exemple, en ecrivant dans un segment en
lecture seule).

De meme une tentative d'acces a la memoire en\-dehors des segments
declenche egalement une faute de segmentation.

\fBmremap\fR utilise le schema de la table des pages de Linux.
\fBmremap\fR modifie la correspondance entre les adresses
virtuelles et les pages de memoire reelle.
Ce mecanisme peut etre utilise pour implementer un \fBrealloc\fR
tres efficace.

.SH OPTIONS
Ces valeurs sont combinees par un
.I OU
binaire ( | ) dans le champ
.I flags
lors de l'appel de
.BR mremap.
.TP
.B MREMAP_MAYMOVE
indique que le bloc virtuel peut etre deplace si le
redimensionnement ne peut pas etre effectue a la meme
adresse virtuelle.

.SH "VALEUR RENVOYEE"
\fBmremap\fR renvoie une pointeur sur la nouvelle zone de
memoire virtuelle s'il reussit.
En cas d'echec,  \-1 est renvoye et \fIerrno\fR contient 
le code d'erreur.

.SH ERREURS
.TP
.B EINVAL
Un argument invalide a ete fourni. \fIold_address\fR n'etait
probablement pas alignee sur une frontiere de pages.
.TP
.B EFAULT
"Segmentation fault." Une adresse dans l'intervalle entre
\fIold_address\fR et \fIold_address\fR+\fIold_size\fR 
n'est pas une adresse virtuelle valide pour ce processus.
On peut egalement obtenir  EFAULT meme s'il existe des
projections recouvrant la zone complete demandee, mais
que ces projections sont de types differents.
.TP
.B EAGAIN
Le segment de memoire est verrouille et sa projection ne
peut pas etre modifiee.
.TP
.B ENOMEM
La zone de memoire ne peut pas etre agrandie a l'emplacement
actuel, et l'option \fIMREMAP_MAYMOVE\fR n'a pas ete
fournie dans \fIflags\fR. 
Ou encore il n'y a plus assez de memoire virtuelle disponible.
.PT
.SH "VOIR AUSSI"
.BR getpagesize (2),
.BR realloc (3),
.BR malloc (3),
.BR brk (2),
.BR sbrk (2),
.BR mmap (2)
.P
(\fIModern Operating Systems\fR by Andrew S. Tannenbaum, 
\fIInside Linux\fR by Randolf Bentson,
\fIThe Design of the UNIX Operating System\fR by Maurice J. Bach.)

