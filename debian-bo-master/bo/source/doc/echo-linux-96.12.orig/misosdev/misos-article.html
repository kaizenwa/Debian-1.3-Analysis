<html>
<head>
<title>Misos : ISO 8859-1, MS-DOS et Emacs</title>
<body>

<IMG SRC="cyp95.gif"ALIGN=left HSPACE=10>
<h1>Misos : ISO 8859-1, MS-DOS et Emacs</h1>
L'Echo de Linux (<B><I>Juillet 1996</I></B>)
<address>
<a href="mailto:kott@ccms.ntu.edu.tw">Georges KO (kott@ccms.ntu.edu.tw)</a>
</address>
<BR CLEAR=left>

<P>
<h2>Résumé</h2>
Cet article décrit l'installation, la configuration ainsi que
l'utilisation du package Misos pour Emacs, permettant de gérer « au
mieux » les caractères ISO dans un environnement hyper-hostile :
MS-DOS et le clavier QWERTY. La configuration minimale de Misos
ne requiert pas de connaissances en Elisp.

<h2>Sommaire</h2>
<ol>
   <li><a href="#intro">Introduction</a>
       <ol>
          <li><a href="#problemes">Problèmes</a>
	  <li><a href="#emacs">Emacs ou la philosophie Unix en
	      action</a>
	  <li><a href="#misos">Misos</a>
	  </ol>
   <li><a href="#installation">Installation</a>
   <li><a href="#configuration">Configuration</a>
   <li><a href="#utilisation">Utilisation</a>
       <ol>
          <li><a href="#modes">Les modes</a>
	  <li><a href="#changer">Changement de mode</a>
	  <li><a href="#saisie">Saisie</a>
	  <li><a href="#autres">Utilisation avec d'autres packages ou
	      des programmes externes</a>
       </ol>
   <li><a href="#afaire">À faire / À améliorer</a>
   <li><a href="#conclusion">Conclusion</a>
   <li><a href="#credits"><i>Credits</i></a>
</ol>

<h2><a name="intro">Introduction</a></h2>

<h3><a name="problemes">Problèmes</h3>

<i>ISO 8859-1</i> (<i>ISO</i>) est le jeu de caractères latins
standard sur Internet, aussi bien pour le courrier, les news, IRC (?),
ainsi que le <i>World 
Wide Web</i>. Malheureusement, <i>MS-DOS</i>, utilise un jeu de
caractères qui lui est propre, le plus souvent <i>PC Code Page 437</i>
(<i>CP 437</i>), ou encore 
<i>PC Code Page 850</i> (<i>CP 850</i>), plus adapté au français. Il
en résulte que l'utilisation de programmes tels que <i>NCSA
Telnet</i>, <i>Telix</i> et autres programmes de communication pour
MS-DOS avec Internet se révèle pénible, car les « à » se transforment
en « alpha », « ç » en « tau », les majuscules accentuées en éléments
graphiques, etc., sans parler de leur saisie avec un clavier
<i>QWERTY</i>. <p>
Pour gérer ces problèmes, plusieurs solutions possibles :
<p>
<ul>
   <li>Utiliser des filtres : pas très pratique car nécessitant des
       sauvegardes, manipulations à la main, pour-IRC-comment-je-fais,
       etc. ;
   <li>Utiliser des tables de traduction et des macros pour les
       caractères accentués dans le programme de communication :
       pourquoi pas, mais si la machine est utilisée depuis plusieurs
       endroits distincts, pas très pratique non plus... ;
   <li>Prendre les sources de telnet ou d'un programme de
       communication et bidouiller avec : j'ai que ça à faire... ;
   <li>Prendre les sources de Lynx, d'Elm, de Pine, etc. et bidouiller
       avec : je commence demain... ;
   <li>etc.
</ul>
<p>

Bref, ce n'est pas simple à gérer... Il existe bien sûr d'autres
solutions plus radicales : installer Windows (sur des 286 avec 2 Mo de
RAM), installer Linux (dans le département de psycho  
<STRONG>-NDLR: beuh, qu'est ce qu'il dit lui ? -</STRONG>), etc.

<h3><a name="emacs">Emacs ou la philosophie Unix en action</a></h3>

<i>Emacs</i> est un éditeur permettant, entre autre, de lire le courrier,
lire les news et naviguer sur le Web. Si on arrivait à faire afficher
avec Emacs les caractères ISO correctement sur un terminal MS-DOS, si
on arrivait à saisir ces mêmes caractères avec le clavier le plus
primaire qui soit, le clavier QWERTY américain, non seulement il sera
possible d'éditer du texte normal à partir de ce terminal, mais en
plus, ces fonctionnalités pourront être très facilement intégrées avec
le courrier, les news et le Web (avec un minumum de connaissances en Elisp
et des <i>packages</i> concernés). Tiens, <i>Misos</i> fait ça...

<h3><a name="misos">Misos</h3>

Misos (« ISO dans MS ») est un package Emacs permettant de (liste
non-exhaustive) :
<p>
<ul>
   <li>Afficher et saisir des caractères ISO sur un terminal MS-DOS
   (exemples : telnet depuis un terminal MS-DOS sur une machine UNIX ;
   utilisation d'Emacs pour DOS pour éditer des fichiers avec
   caractères ISO) ;
   <li>Afficher et saisir des caractères MS-DOS sur un terminal MS-DOS
   (exemples : éditer un fichier MS-DOS depuis un terminal MS-DOS avec
   telnet sur une machine UNIX ; utilisation d'Emacs pour DOS pour
   éditer des fichiers avec caractères MS-DOS) ; 
   <li>Afficher et saisir des caractères MS-DOS sur un terminal ISO
   (exemples : éditer un fichier avec caractères MS-DOS sous Linux
   (avec un jeu ISO)) ; les éléments
   graphiques (pour dessiner des cadres, tableaux, etc.) sont
   représentés par des « | », « / », « \ », « + », etc. ;
   <li>Saisir les caractères de manière consistante ;
   <li>Avec GNUS (lecteur de news et de courrier), W3 (pour le Web),
   etc., sélection automatique du <i>mode</i> à utiliser, selon le nom
   du newsgroup, l'expéditeur du courrier, l'URL, etc. ;
   <li>Mise en majuscule/minuscule correcte selon le mode ;
   <li>etc.
</ul>

<h2><a name="installation">Installation</h2>

Étant donné que Misos a été écrit avec Emacs 19.31, il n'est <b>pour
l'instant</b> utilisable qu'avec Emacs 19.30 et plus, des modifications de
structures de données ayant eu lieu lors du passage à la version 19.30.
<p>
L'installation du package est simple :
<p>
<ol>
   <li>Détarer/décompresser misos.tar.gz dans un répertoire connu de
       <tt>load-path</tt>. Si tu n'es pas <i>root</i>, ajouter
       dans ton fichier <tt>$HOME/.emacs</tt> : <tt>(setq load-path
       (append load-path '("~/</tt><i>misos_rep</i><tt>")))</tt>, où
       <i>misos_rep</i> est le répertoire où le package a été
       détaré/décompressé ; 
   <li>Ajouter dans <tt>$HOME/.emacs</tt> : <tt>(load "misos")</tt> ;
   <li>Si t'utilises un terminal MS-DOS, placer la variable
       d'environnement <tt>MISOSTERM</tt> à <tt>ms</tt> avant de
       lancer Emacs ;
   <li>C'est tout en principe... S'il y a un problème, m'
   <a href="mailto:kott@ccms.ntu.edu.tw">écrire</a>.
</ol>
   
<h2><a name="configuration">Configuration</h2>

La configuration minimale se fait grâce aux variables suivantes :
<p>
<ul>
  <li><tt>ms850iso</tt> : si elle vaut <tt>t</tt>, les caractères
  MS-DOS sont interprétés avec CP 850 ; si elle vaut <tt>nil</tt>,
  avec CP 437. Défaut : <tt>nil</tt> ;
  <li><tt>isoms850-one2one</tt> : si <tt>t</tt>, un caractère ne
  peut-être représenté que par un seul caractère (« È » sera représenté
  par « E » , « © » par « c », etc.) ; si <tt>nil</tt>, un caractère
  pourra être représenté par plusieurs caractères (« È » par « `E »
  ou « E` » , « © » par « (c) », etc.) : c'est plus précis, mais ça
  allonge les lignes : dommage pour la présentation... Ceci est 
  pour utiliser l'ISO sur terminal MS-DOS. Défaut : <tt>nil</tt> ;
  <li><tt>ms850iso-one2one</tt> : pareil que le précédent, sauf que
  c'est pour les caractères MS-DOS sur terminal ISO.
  <li><tt>prefix-accent</tt> : avec <i>*-one2one</i> à <tt>nil</tt>,
  si <tt>prefix-accent</tt> vaut <tt>t</tt>, alors les accents sont
  préfixés (« È » donne « `E ») ; si à <tt>nil</tt>, ils sont 
  suffixés (« È » donne « E` »). Défault : <tt>nil</tt>.
</ul>
<p>
Une variable se fixe avec la fonction setq. Pour modifier une de ces
variables, ajouter après le chargement de Misos : <tt>(setq 
</tt><i>variable</i> <i>valeur</i><tt>)</tt>, où <i>valeur</i> est
soit <tt>t</tt>, soit <tt>nil</tt>.
<p>
Si aucune de ces variables n'est fixée dans le fichier
<tt>$HOME/.emacs</tt>, la phrase (ISO) « LES ¾ DES INTERNÉS
ACHÈTERONT DU MAÏS » sera affiché « LES 3/4 DES INTERNÉS ACHE`TERONT
DU MAI"S » sur un terminal MS-DOS.

<h2><a name="utilisation">Utilisation</a></h2>

<h3><a name="modes">Les modes</a></h3>

Une fois Emacs lancé, si tout se passe bien :-), Emacs a 5 nouveaux
<i>modes mineurs</i> utilisables :
<dl>
   <dt><i>isoms-mode</i>
      <dd>C'est le mode « utilisation d'ISO / terminal MS-DOS » ;
   <dt><i>msms-mode</i>
      <dd>C'est le mode « utilisation de MS-DOS / terminal MS-DOS » ;
   <dt><i>msiso-mode</i>
      <dd>C'est le mode « utilisation de MS-DOS / terminal ISO » ;
   <dt><i>big5-mode</i>
      <dd>C'est le mode <i>Big5</i> pour le chinois. Undocumented :-) ;
   <dt><i>raw-mode</i>
      <dd>C'est le mode par défaut, qui est contrôlé par la variable
      d'environnement <tt>MISOSTERM</tt>. Si elle est à <tt>ms</tt>,
      ce mode équivaut à <i>isoms-mode</i>, sinon il équivaut au mode «
      standard ». Cette dénomination <i>raw-mode</i> est trompeuse,
      car elle incite à croire qu'il n'y a pas de modification, alors
      qu'il y en a, vraiment. À changer (sans doute en
      <i>current-terminal-mode</i>). 
</dl>
<p>
La touche <tt>F2</tt> permet de passer d'un mode à l'autre. Si ça ne
marche pas, <tt>Esc x misos-switch</tt>. Pour ne pas avoir tous les
modes, copier <tt>misos-switch</tt> (dans <i>misos.el</i>) dans
<tt>$HOME/.emacs</tt> après le <tt>load</tt> pour faire sa propre
version. Pareil pour changer la touche associée
(<tt>global-set-key</tt>...). Le mode utilisé devrait apparaîte dans
la <i>modeline</i> et dans l'<i>echo area</i> (ce dernier est utile
lorsque la modeline n'affiche pas les modes mineurs, comme avec
W3. Enfin, n'affiche pas <i>par défaut</i>).

<h3><a name="changer">Changement de mode</a></h3>
Ce qui se passe lorsqu'on change de mode :<p>
<ul>
<li>La table d'affichage (<i>display-table</i>) du <i>buffer</i> en
question est modifiée, donc l'affichage des caractères accentués, etc.
devrait se modifier aussi ;
<li>La table de syntaxe (<i>syntax-table</i>) du buffer est modifiée
(Jérémie est un mot, mais le codage en ISO et en MS-DOS est
différent) ; 
<li>La table des majuscules/minuscules (<i>case-table</i>) du buffer
est modifiée (la mise en majuscule de « fête » donnera « FÊTE » en
ISO et CP 850, mais « FêTE » en CP 437 : si c'est transformé en « E »,
comment je fais, pour savoir que c'est un « ê » si je le minusculise
plus tard ?) ; 
<li>La table de saisie des caractères accentués, etc.,  est modifiée.
</ul>

<h3><a name="saisie">Saisie</a></h3>
Ce qui est important de saisir, c'est que lorsque le mode <i>XY</i> est
utilisé, <i>X</i> réfère au codage utilisé et <i>Y</i> le terminal
utilisé. Exemple : isoms : codage ISO sur terminal MS. Si <i>X</i> et
<i>Y</i> ne collent pas au codage et terminal utilisés, l'affichage
sera incorrect.
<p>
À partir de là, c'est simple, utiliser « <tt>Control x 8</tt>
<i>touche(s)</i> » pour saisir un caractère, quel 	que soit le
mode. Exemple : « <tt>C-x 8 ' e</tt> » pour « é », <tt>C-x 8 C</tt>
pour un « © », etc. Je dis « <tt>C-x 8</tt> », mais ça pourrait
être n'importe quoi. Idem pour « <tt>' e</tt> ». Pour avoir toute la
liste des touches, regarder les fichiers <i>m-iso-map.el</i> et
<i>m-ms-map.el</i> ou alors, dans un des modes, taper « <tt>F1 m</tt>
» et regarder le buffer <tt>*Help*</tt> résultant. C'est quelquepart
dedans. 
<p>
Les caractères représentés par plusieurs caractères (exemple :
© représenté par (c) en <i>isoms-mode</i> en CP 437), sont considérés
par l'éditeur comme un seul caractère (tu vois trois caractères, un «
( », un « c » et un « ) », mais tu ne peux mettre le curseur qu'à deux
endroits : sur le « ( » et apres le « ) » en appuyant sur flèche
gauche. En fait, t'es déjà sur le caractère suivant le « © »). Ça va
:-) ? 

<h3><a name="autres">Utilisation avec d'autres packages ou des
programmes externes</a></h3> 

Exemples dans <i>m-hooks.el</i> : là, faut connaître
Elisp... Disponible dans tout bon site miroir FTP GNU.<p>
Le principe, c'est d'utiliser les <i>hooks</i>. Qu'est-ce qu'un hook ?
Un hook, c'est une variable contenant une liste de fonctions à
exécuter à des moments bien précis. Tous les packages bien faits
d'Emacs (ainsi qu'Emacs lui-même) sont bourrés de hooks. <p>
Par exemple, lorsque GNUS, le lecteur de news, a fini de préparer un
article (il est prêt à l'afficher), il exécute toutes les fonctions du
hook <tt>gnus-article-prepare-hook</tt>. Vu que je lis des newsgroups en
chinois (Big5) et en français (ISO), il suffit donc de créer une
fonction qui vérifie le nom du newsgroup (en <i>tw.*</i>, c'est en
Big5, le reste en <i>isoms-mode</i> ou équivalent (<i>raw-mode</i>)),
et de l'ajouter à ce hook. Pareil lors d'un <i>folluwup</i> ou d'un
<i>Reply</i>, avec les hooks <tt>gnus-article-prepare-hook</tt> et
<tt>gnus-mail-hook</tt>. Pareil pour le courrier, pareil pour le Web
(enfin, en principe, car les hooks en question ne semblent pas être
exécutés dans W3), etc.<p>
Pour utiliser Misos avec des programmes externes (Elm, Tin, Pine,
Slrn, etc.), il suffit de les faire lancer Emacs avec les bons arguments
(<tt>-f isoms-mode</tt> par exemple). Cependant, je ne vois pas l'intérêt
d'utiliser ces programmes dans ce contexte, vu qu'Elm, Tin, Pine, Slrn
etc. ne gèrent pas ces problèmes d'ISO et MS-DOS (si
?). <tt>(emacs-advocacy (concat "Cela dit, même sans ces problèmes,
je ne voyais déjà pas l'intérêt d'utiliser ces programmes" (smile) 
"."))</tt>

<h2><a name="afaire">A faire / à améliorer</a></h2>
<ul>
   <li>Améliorer la doc, qui est cet article (ben ouais, avec Elisp,
   la meilleure doc, c'est les sources...) ;
   <li>Meilleure configurabilité (?) (utiliser une liste pour
   construire <tt>misos-switch</tt>, ne changer que le clavier de
   saisie, ou juste l'affichage, des choses comme ça) ;
   <li>Gestion des claviers AZERTY et autres (c'est bête de devoir taper
   « <tt>C-x 8 ' e</tt> » lorsqu'on a déjà la touche... Pas
   compliqué à faire, mais je n'ai pas de clavier AZERTY :-)...) ;
   <li>Ne pas être forcé à tout modifier lors d'un changement de mode
   (syntax-table, case-table, etc.) ;
   <li>Utilisation avec Emacs &lt; 19.30 : les modifications portent sur
   les tables de syntaxe, de majuscules/minuscules, etc. ;
   <li>Faciliter une éventuelle extension à ISO 8859-2, 3, etc. en
   utilisant des listes au lieu de tout coder en dur ;
   <li>Compléter la saisie des caractères MS-DOS (lettres grecques,
   éléments graphiques, etc.) : pas très important..;
   <li>Euh...
</ul>

<h2><a name="conclusion">Conclusion</a></h2>

Misos est le package qui me permet de nager dans un environnement
totalement « Engish-only », « QWERTY-only », et « (presque)
MS-DOS-only ». Parcequ'il est écrit en Elisp, je peux l'utiliser sur
n'importe quel système d'exploitation, ainsi que sous MS-DOS. Parceque
c'est pour Emacs, ça s'intègre donc bien (aux effets de bord près !)
avec les autres packages et résoud donc en même temps les problèmes
avec le courrier, les news, le Web, etc. Bon, c'est sûr que ce n'est pas
spectaculaire à voir : pas de menus, pas d'utilitaires pour
configurer, etc., c'est sobre et discret, mais fonctionnel et
satisfaisant. Si t'en as pas besoin, sois quand même conscient(e) que
ça existe...<p>
Suggestions, commentaires, améliorations, critiques, questions, etc. 
bienvenus, en ISO ou en MS-DOS si t'arrives pas à installer /
configurer / utiliser :-) !

<h2><a name="credits"><i>Credits</i></a></h2>
<ul>
<li>Stephen G. Simpson <simpson@math.psu.edu> pour <i>cemacs.el</i>
(la gestion du mouvement du curseur en mode Big5 modifiée) ;
<li>K. Shane Hartman pour <i>picture.el</i> (picture-mode modifié pour
insérer des caractères Big5) ;
<li>Howard Gayle pour <i>case-table.el</i> (fonctions modifiées pour
utiliser des tables de syntaxe locales) et <i>iso-insert.el</i>
(mécanismes d'insertion et de saisie).
</ul>
<hr>
<address>
<a href="mailto:kott@ccms.ntu.edu.tw">Georges KO</a>
</address>
</html>
