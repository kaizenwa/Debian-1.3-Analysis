<HEAD>
<TITLE>imake - C preprocessor interface to the make utility</TITLE>
</HEAD>

<BODY>
<PRE>
IMAKE(1)						 IMAKE(1)

<H2>NAME</H2>
       imake - C preprocessor interface to the make utility

<H2>SYNOPSIS</H2>
       <b>imake</b>  [ <b>-D</b><i>define</i> ] [ <b>-I</b><i>dir</i> ] [ <b>-T</b><i>template</i> ] [ <b>-f</b> <i>filename</i>
       ] [ <b>-C</b> <i>filename</i> ] [ <b>-s</b> <i>filename</i> ] [ <b>-e</b> ] [ <b>-v</b> ]

<H2>DESCRIPTION</H2>
       <i>Imake</i> is used to generate <i>Makefiles</i> from a template, a set
       of  <i>cpp</i>	macro  functions,  and a per-directory input file
       called an <i>Imakefile</i>.   This  allows  machine  dependencies
       (such  as  compiler  options, alternate command names, and
       special <i>make</i> rules) to be kept separate from the	 descrip-
       tions of the various items to be built.

<H2>OPTIONS</H2>
       The following command line options may be passed to <i>imake</i>:

       <b>-D</b><i>define</i>
	       This option is passed directly to <i>cpp</i>.  It is typ-
	       ically  used  to set directory-specific variables.
	       For example, the X Window System uses this flag to
	       set <i>TOPDIR</i> to the name of the directory containing
	       the top of the core distribution and <i>CURDIR</i> to the
	       name  of	 the  current  directory, relative to the
	       top.

       <b>-I</b><i>directory</i>
	       This option is passed directly to <i>cpp</i>.  It is typ-
	       ically used to indicate the directory in which the
	       <i>imake</i> template  and  configuration  files  may  be
	       found.

       <b>-T</b><i>template</i>
	       This  option specifies the name of the master tem-
	       plate file (which is usually located in the direc-
	       tory  specified with <i>-I</i>) used by <i>cpp</i>.  The default
	       is <i>Imake.tmpl</i>.

       <b>-f</b> <i>filename</i>
	       This  option  specifies	the  name  of  the   per-
	       directory input file.  The default is <i>Imakefile</i>.

       <b>-C</b> <i>filename</i>
	       This option specifies the name of the .c file that
	       is constructed  in  the	current	 directory.   The
	       default is <i>Imakefile.c</i>.

       <b>-s</b> <i>filename</i>
	       This   option  specifies	 the  name  of	the  <i>make</i>
	       description file to be generated but  <i>make</i>  should
	       not  be	invoked.   If the <i>filename</i> is a dash (-),
	       the output is written to <i>stdout</i>.	 The  default  is
	       to generate, but not execute, a <i>Makefile</i>.

X Version 11		    Release 6				1

IMAKE(1)						 IMAKE(1)

       <b>-e</b>      This option indicates the <i>imake</i> should execute the
	       generated <i>Makefile</i>.  The default is to leave  this
	       to the user.

       <b>-v</b>      This  option indicates that <i>imake</i> should print the
	       <i>cpp</i> command line that it is using to generate  the
	       <i>Makefile</i>.

<H2>HOW IT WORKS</H2>
       <i>Imake</i>  invokes  <i>cpp</i>  with any <i>-I</i> or <i>-D</i> flags passed on the
       command line and passes the name of a file containing  the
       following 3 lines:

		 #define IMAKE_TEMPLATE "Imake.tmpl"
		 #define INCLUDE_IMAKEFILE &lt;Imakefile&gt;
		 #include IMAKE_TEMPLATE

       where <i>Imake.tmpl</i> and <i>Imakefile</i> may be overridden by the <i>-T</i>
       and <i>-f</i> command options, respectively.

       The IMAKE_TEMPLATE typically reads in  a	 file  containing
       machine-dependent parameters (specified as <i>cpp</i> symbols), a
       site-specific parameters file, a file defining  variables,
       a  file containing <i>cpp</i> macro functions for generating <i>make</i>
       rules,	and   finally	the   <i>Imakefile</i>	  (specified   by
       INCLUDE_IMAKEFILE)  in  the current directory.  The <i>Imake-</i>
       <i>file</i> uses the macro functions  to  indicate  what  targets
       should be built; <i>imake</i> takes care of generating the appro-
       priate rules.

       <i>Imake</i> configuration files contain two types of  variables,
       imake  variables	 and make variables.  The imake variables
       are interpreted by cpp when <i>imake</i> is run.   By  convention
       they  are mixed case.  The make variables are written into
       the <i>Makefile</i> for later interpretation by <i>make.</i>  By conven-
       tion make variables are upper case.

       The  rules file (usually named <i>Imake.rules</i> in the configu-
       ration directory) contains a variety of	<i>cpp</i>  macro  func-
       tions  that  are configured according to the current plat-
       form.  <i>Imake</i> replaces any occurrences of the string ``@@''
       with a newline to allow macros that generate more than one
       line of <i>make</i> rules.  For example, the macro

       #define	 program_target(program, objlist)	 @@\
       program:	 objlist				 @@\
		 $(CC)	-o  $@	objlist	 $(LDFLAGS)

       when called with <i>program_target(foo,</i> <i>foo1.o</i>  <i>foo2.o)</i>  will
       expand to

       foo:	 foo1.o	 foo2.o
		 $(CC)	-o  $@	foo1.o	foo2.o	$(LDFLAGS)

X Version 11		    Release 6				2

IMAKE(1)						 IMAKE(1)

       <i>Imake</i>  also replaces any occurrences of the word ``XCOMM''
       with the character ``#'' to permit placing comments in the
       Makefile without causing ``invalid directive'' errors from
       the preprocessor.

       Some complex <i>imake</i> macros require generated <i>make</i> variables
       local to each invocation of the macro, often because their
       value depends on parameters passed  to  the  macro.   Such
       variables can be created by using an <i>imake</i> variable of the
       form <b>XVARdef</b><i>n</i>, where <i>n</i> is a single digit.  A  unique  <i>make</i>
       variable	 will  be  substituted.	 Later occurrences of the
       variable <b>XVARuse</b><i>n</i> will be replaced by the variable created
       by the corresponding <b>XVARdef</b><i>n</i>.

       On systems whose <i>cpp</i> reduces multiple tabs and spaces to a
       single space, <i>imake</i> attempts to	put  back  any	necessary
       tabs (<i>make</i> is very picky about the difference between tabs
       and spaces).  For this reason, colons (:) in command lines
       must be preceded by a backslash (\).

<H2>USE WITH THE X WINDOW SYSTEM</H2>
       The  X Window System uses <i>imake</i> extensively, for both full
       builds within the source tree and external  software.   As
       mentioned above, two special variables, <i>TOPDIR</i> and <i>CURDIR,</i>
       are set to make	referencing  files  using  relative  path
       names  easier.  For example, the following command is gen-
       erated automatically to build the <i>Makefile</i> in  the  direc-
       tory <i>lib/X/</i> (relative to the top of the sources):

		 %  ../.././config/imake  -I../.././config  \
		       -DTOPDIR=../../.	  -DCURDIR=./lib/X

       When  building  X programs outside the source tree, a spe-
       cial symbol <i>UseInstalled</i> is defined and <i>TOPDIR</i> and  <i>CURDIR</i>
       are  omitted.   If the configuration files have been prop-
       erly installed, the script <A HREF="http://gandalf/cgi-bin/man-cgi?COMMAND=xmkmf"><i>xmkmf</i>(1)</A> may be used.

<H2>INPUT FILES</H2>
       Here is a summary of the files read by <i>imake</i> as used by X.
       The indentation shows what files include what other files.

	   Imake.tmpl		     generic variables
	       site.def		     site-specific, BeforeVendorCF defined
	       *.cf		     machine-specific
		   *Lib.rules	     shared library rules
	       site.def		     site-specific, AfterVendorCF defined
	       Imake.rules	     rules
	       Project.tmpl	     X-specific variables
		   *Lib.tmpl	     shared library variables
	       Imakefile
		   Library.tmpl	     library rules
		   Server.tmpl	     server rules
		   Threads.tmpl	     multi-threaded rules

X Version 11		    Release 6				3

IMAKE(1)						 IMAKE(1)

       Note that <i>site.def</i> gets included twice,	once  before  the
       <i>*.cf</i>  file  and once after.  Although most site customiza-
       tions should be specified after the <i>*.cf</i> file, some,  such
       as  the	choice	of compiler, need to be specified before,
       because other variable settings may depend on them.

       The  first  time	 <i>site.def</i>  is  included,   the	 variable
       BeforeVendorCF  is defined, and the second time, the vari-
       able AfterVendorCF  is  defined.	  All  code  in	 <i>site.def</i>
       should be inside an #ifdef for one of these symbols.

<H2>FILES</H2>
       Imakefile.c		     temporary input file for cpp
       /tmp/Imf.XXXXXX		     temporary Makefile for -s
       /tmp/IIf.XXXXXX		     temporary Imakefile if spec-
       ified Imakefile uses # comments
       /lib/cpp			     default C preprocessor

<H2>SEE ALSO</H2>
       <EM>make(1)</EM>, <A HREF="man_xmkmf.html">xmkmf(1)</A>
       S.  I. Feldman, <i>Make</i> <i>--</i> <i>A</i> <i>Program</i> <i>for</i> <i>Maintaining</i> <i>Computer</i>
       <i>Programs</i>

<H2>ENVIRONMENT VARIABLES</H2>
       The following environment variables may	be  set,  however
       their  use  is not recommended as they introduce dependen-
       cies that are not readily apparent when <i>imake</i> is run:

       <b>IMAKEINCLUDE</b>
	    If defined, this should be a valid	include	 argument
	    for	      the	C	preprocessor.	    E.g.,
	    ``-I/usr/include/local''.  Actually,  any  valid  <i>cpp</i>
	    argument will work here.

       <b>IMAKECPP</b>
	    If	defined, this should be a valid path to a prepro-
	    cessor  program.	E.g.,	``/usr/local/cpp''.    By
	    default, <i>imake</i> will use /lib/cpp.

       <b>IMAKEMAKE</b>
	    If	defined,  this	should	be a valid path to a make
	    program, such as  ``/usr/local/make''.   By	 default,
	    <i>imake</i>  will	 use whatever <i>make</i> program is found using
	    <i>execvp(3).</i>	This variable is only used if the  ``-e''
	    option is specified.

<H2>AUTHOR</H2>
       Todd  Brunhoff, Tektronix and MIT Project Athena; Jim Ful-
       ton, MIT X Consortium

X Version 11		    Release 6				4
</PRE>
</BODY>
