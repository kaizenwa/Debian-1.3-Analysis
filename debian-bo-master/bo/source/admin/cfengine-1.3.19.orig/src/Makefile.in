#####################################################################
#
#   Makefile for the GNU cfengine
#
#####################################################################

HEADERS = cf.defs.h conf.h

OBJ = cfengine.o             \
      process.o              \
      ifconf.o               \
      image.o                \
      item.o                 \
      2Dlist.o               \
      globals.o              \
      classes.o              \
      misc.o                 \
      parse.o                \
      edittools.o            \
      patches.o              \
      link.o                 \
      tidy.o                 \
      filedir.o              \
      eval.o                 \
      modes.o                \
      mount.o                \
      macro.o                \
      varstring.o            \
      wildcard.o             \
      cfparse.o              \
      cflex.o

#
# For IRIX (since configure is used, can this be removed?)
#

SCI_CC = -cckr

#
# General stuff
#

srcdir = @srcdir@
top_srcdir = @top_srcdir@
VPATH = @srcdir@

prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@

CC= @CC@

YACC= @YACC@
YFLAGS= -d

LEX= @LEX@
LEXLIB = @LEXLIB@

LDFLAGS= @LDFLAGS@
LIBS= @LIBS@

DEFS= @DEFS@
CFLAGS= @CFLAGS@
CPPFLAGS= @CPPFLAGS@

INSTALL= @INSTALL@
INSTALL_PROGRAM= @INSTALL_PROGRAM@

MKINSTALLDIR= @top_srcdir@/bin/mkinstalldirs

RM = rm -f

#####################################################################
# Rules
######################################################################

all: cfengine

cfengine: ${OBJ} ../pub/libpub.a
	${CC} ${LDFLAGS} -o $@ ${OBJ} ${LIBS} ${LEXLIB}

${OBJ}: ${HEADERS}

../pub/libpub.a:
	(cd ../pub;	$(MAKE) all)

#######################################################################
# Suffix rule
#######################################################################

.c.o: 
	${CC} -c ${CPPFLAGS} ${CFLAGS} ${DEFS} $<

#######################################################################

clean:
	${RM} ${OBJ}
	${RM} y.tab.c lex.yy.c y.tab.h
	${RM} y.tab lex.yy
	${RM} *% *~ *.o
	${RM} *.tab.c *.tab.h a.out

mostlyclean: clean
	${RM} *.tar.*

distclean: mostlyclean
	${RM} cfengine conf.h Makefile

install: all
	${MKINSTALLDIR} ${bindir}
	${INSTALL_PROGRAM} cfengine ${bindir}

dist:
	(cd ${top_srcdir}; $(MAKE) dist)
