<HTML>
<HEAD>
<!-- This HTML file has been created by texi2html 1.50
     from cfengine.texinfo on 5 November 1996 -->

<TITLE>GNU cfengine</TITLE>
</HEAD>
<BODY>
<H1>CFENGINE</H1>
<H2>Edition 2.7 for version 1.3.16</H2>
<ADDRESS>Mark Burgess</ADDRESS>
<ADDRESS>Centre of Science and Technology,</ADDRESS>
<ADDRESS>Faculty of Engineering, Oslo College, Norway</ADDRESS>
<P>
<P><HR><P>

<P>
Copyright (C) 1995/96 Mark Burgess

</P>
<P>
   Permission is granted to make and distribute verbatim copies of this
manual provided the copyright notice and this permission notice are
preserved on all copies.

</P>
<P>
   Permission is granted to copy and distribute modified versions of
this manual under the conditions for verbatim copying, provided also
that the section entitled "GNU General Public License" is included
exactly as in the original, and provided that the entire resulting
derived work is distributed under the terms of a permission notice
identical to this one.

</P>
<P>
   Permission is granted to copy and distribute translations of this
manual into another language, under the above conditions for modified
versions, except that the section entitled "GNU General Public License"
may be included in a translation approved by the author instead of in
the original English.

</P>
<P>
This manual corresponds to CFENGINE
Edition 2.7 for version 1.3.16
as last updated October 1996.

</P>



<H1><A NAME="SEC1" HREF="cfengine_toc.html#TOC1">Foreword</A></H1>

<P>
Cfengine is the result of a three year research project to help solve
the problem of system administration on a big network using an
expert system combined with a declarative language. After the
official release of version 1.3.0, no further features are planned,
and modifications will most likely be restricted to bug fixes
and perhaps additional wrappers, and ports to new systems
<A NAME="DOCF1" HREF="cfengine_foot.html#FOOT1">(1)</A>.

</P>
<P>
Although all of the final decisions have been my own, a number of others
have been pivotal in the development. If I am slow to mention names, or
if I am slow to reply or fix bugs, please be patient: I don't have much
time for cfengine these days. There are no plans for any major new
features in the foreseeable future, but I shall be fixing bugs as they
are reported.

</P>
<P>
Morten Hanshaugen and Hans Petter Holen made it possible to test
cfengine on a variety of systems at the university of Oslo. I am ever
grateful to Knut Borge for his experience and suggestions.  Ola
Borrebaek and Richard Stallman have made key suggestions which have
influenced the development of cfengine in important ways.

</P>
<P>
I am grateful to many users for sending me their suggestions and
queries. Audun Tornquist did some initial work on the `copy' feature and
donated the backup help-script to the distribution.  Gord
Matzigkeit contributed an autoconf setup (still to be integrated) and
made some texinfo improvements to the manual. I cannot begin to
thank Andreas Klussmann and for his thorough testing of nearly
every in-between version of cfengine which I have put on our
local ftp server. Neil Schellenberger has also been extremely
helpful. Andrew Ford contributed the self-documentation perl
script. Ricky Ralston (Hewlett Packard) provided invaluable information on HPUX-10
and discovered a number of bugs and inaccuracies in the source code: our 
collaboration on making 1.3.0 the definite system administration tool
has been invaluable. Finally, I am grateful to Ann-Mari Torvatn for
reading through and helping to improve the documentation.

</P>
<P>
For up to the minute information on cfengine, workshops, conferences and
all that jazz see the web page:

</P>

<PRE>
http://www.iu.hioslo.no/~mark/cfengine.html
</PRE>

<P>
Bug reports and queries by mail to

<PRE>
bug-cfengine@gnu.ai.mit.edu
</PRE>

<P>
(why not bug Jack Barron instead?) or to the more direct address

<PRE>
cfengine@iu.hioslo.no
</PRE>

<P>
Two newsgroups are also available now for discussions and
bug reports.

<PRE>
---------------------------------------------------------------------
 bug-cfengine-request@prep.ai.mit.edu to subscribe to bug-cfengine
 gnUSENET newsgroup: gnu.cfengine.bug
 cfengine bug reports to: bug-cfengine@prep.ai.mit.edu

This list distributes, to the active maintainers of cfengine.
Bug reports and fixes for, and suggestions for improvements to cfengine.
User discussion of cfengine also occurs here.
---------------------------------------------------------------------
 help-cfengine-request@gnu.ai.mit.edu to subscribe to help-cfengine
 gnUSENET newsgroup: gnu.cfengine.help
 Send contributions to: help-cfengine@gnu.ai.mit.edu

This list is the place for users and installers of cfengine to ask for
help.  Please send bug reports to bug-cfengine instead of posting them
here.

This list is also used for announcements about cfengine and related
programs, and small but important patches.  Announcements of cfengine
releases are also made to info-gnu@gnu.ai.mit.edu (see above)
----------------------------------------------------------------------
</PRE>

<P>
Mark Burgess
Oslo, October 1996

</P>



<H1><A NAME="SEC2" HREF="cfengine_toc.html#TOC2">Overview</A></H1>

<P>
<EM>In this manual the word "host" is used to refer to a single computer
system -- i.e.  a single machine which has a name termed its "hostname".</EM>

</P>



<H2><A NAME="SEC3" HREF="cfengine_toc.html#TOC3">What is cfengine and who can use it?</A></H2>

<P>
Cfengine is a language based tool specifically designed for configuring
and maintaining BSD and System-5-like operating systems attached to a
TCP/IP network.  You can think of cfengine as a very high level
language--much higher level than Perl or shell: a single statement can
result in many hundreds of operations being performed on multiple hosts.
The main purpose of cfengine is to allow you to create a single, central
configuration file which will define how every host on your network
should be configured.  The cfengine interpreter runs on every host on
the network and parses the central file (or file-set); the configuration
of each host is checked against this file and then, if you request it,
any deviations from the define configuration are fixed.  If such a
central file had to mention every single host on a network individually,
it would have to be very large, but cfengine uses a flexible system of
"classes" which helps you to describe many hosts with a single
statement, or make complex decisions which pick out very specific
actions for specific hosts if necessary.

</P>
<P>
In the beginning, cfengine was conceived of as a tool for system
administators to be run only by the superuser, but during the course of
its development it became clear that it could also be used as a
scripting language by ordinary users.  It is a handy tool for tidying
your old junk files and for making `watchdog' scripts to manage the
access rights and permissions on your files when collaborating with
other users.  As a bonus it contains a text editing language which can
be used to perform controlled edits of line-based text files.

</P>
<P>
The remainder of this manual assumes that you know a little about
BSD/System-5 systems and have everyday experience in using either the
C-shell or the Bourne shell, or their derivatives.  If you are
experienced in system administration, you might like to skip the earlier
chapters and turn straight to the example See section <A HREF="cfengine.html#SEC131">Example configuration files</A>.  This is the probably quickest way to learn cfengine for the
initiated.  If you are not so familar with system administration and
would like a more gentle introduction, then we begin here...

</P>



<H2><A NAME="SEC4" HREF="cfengine_toc.html#TOC4">Site configuration</A></H2>

<P>
To the system administrator of a small network, comprised of just a few
workstations or perhaps even a single mainframe system, it might seem
superfluous to create a big fuss about the administration of the system.
It is, after all, easy to `fix' things manually should any problems
arise, making a link here, writing a script there and so on -- and its
probably not even worth writing down what you did because you know that
it will always be easy to fix next time around too...  But networks have
a tendency to expand and--before you know it--you have five different
types of operating system and each type of system has to be configured
in a special way, you have to make patches to each system and you can't
remember whether you fixed that host on the other side of the
building...  You also discover fairly quickly that what you thought of
as BSD or System 5 is not as standard as you thought and that none of
your simple scripts that worked on one system work on the others without
a considerable amount of hacking and testing.  You try writing a script
to help you automate the task, but end up with an enormous number of
<SAMP>`if..then..else..'</SAMP> tests which make it hard to see what is really
going on.

</P>
<P>
To manage a network with many different flavours of operating system, in
a systematic way, what is needed is a more disciplined way of making
changes which is robust against reinstallation.  After all, it would be
tragic to spend many hours setting up a system by hand only to lose
everything in an unfortunate disk-crash a week or even a year later when
you have forgotten what you had to do.  Upgrades of the operating system
software might delete your carefully worked out configuration.  What is
needed is a separate record of all of the patches required on all of the
systems on the network; a record which can be compared to the state of
each host at any time and which a suitable engine can use to fix any
deviations from that reference standard.

</P>
<P>
The idea behind cfengine is to focus upon a few key areas of basic
system administration and provide a language which fulfills this model
of system administration.  It is done in such a way that the
transparency of a configuration program is optimal.  It eliminates the
need for lots of tests by allowing you to organize your network
according to "classes".  From a single configuration file (or set of
files) you can specify how your network should be configured -- and
cfengine will then parse your file and carry out the instructions,
warning or fixing errors as it goes.

</P>



<H2><A NAME="SEC5" HREF="cfengine_toc.html#TOC5">Key Concepts</A></H2>

<P>
Here we mention briefly some of the important issues in system
administration which cfengine can help with.

</P>



<H3><A NAME="SEC6" HREF="cfengine_toc.html#TOC6">Control files</A></H3>
<P>
<A NAME="IDX1"></A>
<A NAME="IDX2"></A>
<A NAME="IDX3"></A>

</P>
<P>
One of the most important characteristics of BSD and system 5 systems is
that they are configured through human-readable text files.  To add a
new user to the system you must edit <TT>`/etc/passwd'</TT>, to add a new
disk you must edit <TT>`/etc/fstab'</TT> etc.  Many applications are also
configured with the help of text files.  When installing a new system
for the first time, or when changing updating the setup of an old system
you are faced with having to edit lots of files.  In some cases you will
have to add precisely the same line to the same file on every system in
your network as a change is made, so it is handy to have a way of
automating this procedure so that you don't have to load every file into
an editor by hand and make the changes yourself.  This is one of the
tasks which cfengine will automate for you.

</P>



<H3><A NAME="SEC7" HREF="cfengine_toc.html#TOC7">Network interface</A></H3>
<P>
<A NAME="IDX4"></A>
<A NAME="IDX5"></A>
<A NAME="IDX6"></A>

</P>
<P>
Each host which you connnect to an ethernet-based network running TCP/IP
protocols must have a so-called `net interface'.  This network interface
must be configured before it will work.  Normally one does this with the
help of the <CODE>ifconfig</CODE> command.  This can also be checked and
configured automatically by cfengine.

</P>
<P>
Network configuration involves telling the interface hardware what the
internet (IP) address of your system is, so that it knows which incoming
`packets' of data to pay attention to.  It involves telling the
interface how to interpret the addresses it receives by setting the
`netmask' for your network (see below).  Finally you must tell it which
dummy address is to be used for messages which are broadcast to all
hosts on your network simultaneously See section <A HREF="cfengine.html#SEC53">netmask</A>.

</P>



<H3><A NAME="SEC8" HREF="cfengine_toc.html#TOC8">Network File System (NFS)</A></H3>
<P>
<A NAME="IDX7"></A>

</P>
<P>
Probably the first thing you are interested in doing with a network
(after you've had your fill of the world wide web) is to make your files
available to some or all hosts on the network, no matter where in your
corporate empire (or university dungeon) you might be sitting.  In other
words, if you have a disk which is physically connected to host A, you
would like to make the contents of that disk available to hosts B, C,
D...  etc.  NFS (the network filesystem) does this for you.  The process
works by `filesystems'.

</P>
<P>
A filesystem is one partition of a disk drive -- or one unit of disk
space which can be accessed by a single `logical device'
<SAMP>`/dev/something'</SAMP>.  To make a filesystem available to other hosts
you have to do three things.

</P>

<UL>
<LI>On the host the disk is physically connected to you must <EM>export</EM> the filesystem

by adding something to the file <TT>`/etc/exports'</TT>.  This tells NFS who
is allowed to access the disk and who isn't.

<LI>On the host which is to access the filesystem you must create a mount point.  This

is a name in the directory tree at which you want to add the files to
your local filesystem.

<LI>On the host which is to access the files you must mount the filesystem onto the

mount point.  The mount operation is the jargon for telling the system
to access the device on which the data are stored.  Mounting is
analagous to opening a file: files are opened, filesystems are mounted.
</UL>

<P>
Only after all three of these have been done will a filesystem become
available across the network.  Cfengine will help you with the last two
in a very transparent way.  You could also use the textediting facility
in cfengine to edit the exports file, but there are other ways update
the exports file using <EM>netgroups</EM> which we shall not go into here.
If you are in doubt, look up the manual page on exports.

</P>



<H3><A NAME="SEC9" HREF="cfengine_toc.html#TOC9">Name servers (DNS)</A></H3>
<P>
<A NAME="IDX8"></A>
<A NAME="IDX9"></A>

</P>
<P>
There are two ways to specify addresses on the internet (called IP
addresses).  One is to use the textual address like <SAMP>`ftp.uu.net'</SAMP>
and the other is to use the numerical form <SAMP>`192.48.96.9'</SAMP>.  Alas,
there is no one-to-one correspondence between the numerical addresses
and the textual ones, thus a service is required to map one to the
other.

</P>
<P>
The service is performed by one or more special hosts on the network
called <EM>nameservers</EM>.  Each host must know how to contact a
nameserver or it will probably hang the first time you give it an IP
address.  You tell it how to contact a nameserver by editing the
textfile <TT>`/etc/resolv.conf'</TT>.  This file must contain the domain
name for your domain and a list of possible nameservers which can be
contacted, in order of priority.  Because this is a special file which
every host must have, you don't have to use the editing facilities in
cfengine explicitly.  You can just define the nameservers for each host
in the cfengine file and cfengine will do the editing automatically.  If
you want to change the priority of nameservers later, or even change the
list then a simple change of one or two lines in the configuration file
will enable you to reconfigure every host on your network automatcally
without having to do any editing yourself!

</P>



<H3><A NAME="SEC10" HREF="cfengine_toc.html#TOC10">Monitoring important files</A></H3>
<P>
<A NAME="IDX10"></A>
<A NAME="IDX11"></A>

</P>
<P>
Security is an important issue on any system.  In the busy life of a
system admnistrator it is not always easy to remember to set the correct
access rights on every file and this can result in either a security
breach or problems in accessing files.

</P>
<P>
A common scenario is that you, as administrator, fetch a new package
using ftp, compile it and install it without thinking too carefully.
Since the owner and permissions of the files in an ftp archive remains
those of the program author, it often happens that the software is left
lying around with the owner and permissions as set by the author of the
program rather than any username on <EM>your</EM> system.  The user-id of
the author might be anybody on your system -- or perhaps nobody at all!
The files should clearly be owned by root and made readable and
unwritable to normal users.

</P>
<P>
Simple accidents and careless actions under stress could result in, say,
the password file being writable to ordinary users.  If this were the
case, the security of the entire system would be compromised.  Cfengine
therefore allows you to monitor the permissions, ownership and general
existence of files and directories and, if you wish, correct them or
warn about them automatically.

</P>



<H3><A NAME="SEC11" HREF="cfengine_toc.html#TOC11">Making links</A></H3>
<P>
<A NAME="IDX12"></A>

</P>
<P>
One of the difficulties with having so many different variations on the
theme of BSD and system 5 based operating systems is that similar files
are not always where you expect to find them.  They have different names
or lie in different directories.  The usual solution to the problem is
to make an alias for these files, or a pointer from one filename to
another.  The name for such an alias is a <EM>symbolic link</EM>.

</P>
<P>
It is often very convenient to make symbolic links.  For example, you
might want the sendmail configuration file <TT>`/etc/sendmail.cf'</TT> to be
a link to a global configuration file
<TT>`/usr/local/mail/etc/sendmail.cf'</TT> on every single host on your
network so that there is only one file to edit.  If you had to make all
of these links yourself, it would take a lifetime.  Cfengine will make
such a link automatically and check it each time time is run.  You can
also ask it to tidy up old links which have been left around and no
longer point to existing files.  If you reinstall your operating system
later it doesn't matter because all your links are defined in your
cfengine configuration file, recorded for all time.  Cfengine won't
forget it, and you won't forget it because the setup is defined in one
central place.

</P>
<P>
Cfengine will also allow you to make hard links to regular files, but
not other kinds of file. A hard link to a symbolic link, is the same
as a hard link to the file the symbolic link points to.
<A NAME="IDX13"></A>

</P>



<H2><A NAME="SEC12" HREF="cfengine_toc.html#TOC12">Functionality</A></H2>

<P>
The notes above give you a rough idea of what cfengine can be used for.
Here is a summary of cfengine's capabilities.

</P>

<UL>

<LI>Check and configure the network interface.

<LI>Edit textfiles for the system and for all users.

<LI>Make and maintain symbolic links, including multiple links from

a single command.

<LI>Check and set the permissions and ownership of files.

<LI>Tidy (delete) junk files which clutter the system.

<LI>Systematic, automated mounting of NFS filesystems.

<LI>Checking for the presence of important files and filesystems.

<LI>Controlled execution of user scripts and shell commands.

<LI>Cfengine follows a class-based decision structure.

<LI>Process management.

</UL>

<P>
How do you run cfengine?  You may run cfengine scripts/programs as often
as you like.  Each time you run a script, the engine determines whether
anything needs to be done -- if nothing needs to be done, nothing is
done!  If you use it to monitor and configure your entire network from a
central filebase, then the natural thing is to run cfengine daily with
the help of <CODE>cron</CODE>.  See section <A HREF="cfengine.html#SEC126">cfwrap</A>.

</P>



<H1><A NAME="SEC13" HREF="cfengine_toc.html#TOC13">Getting started</A></H1>



<H2><A NAME="SEC14" HREF="cfengine_toc.html#TOC14">What you must have in a cfengine program</A></H2>
<P>
<A NAME="IDX14"></A>

</P>
<P>
A cfengine configuration file for a large network is long and complex,
so before we get down to details, let's try to strip away the complexity
and look only to the essentials.

</P>
<P>
Each cfengine program or configuration file is a list of declarations of
items to be checked and perhaps fixed.  You begin by creating a file
called <TT>`cfengine.conf'</TT>.  The simplest meaningful file you can
create is something like this:

</P>

<PRE>

# Comment...
 
control:

  actionsequence = ( links )

links:

  /bin -&#62; /usr/bin

</PRE>

<P>
The
example above checks and makes (if necessary) a link from <TT>`/bin'</TT> to <TT>`/usr/bin'</TT>.
Let's examine this example more closely.  In a cfengine program:

</P>

<UL>

<LI>Use of space is unrestricted.  You can start new lines wherever you like.

<LI>A comment is some text which is ignored by cfengine.  The <SAMP>`#'</SAMP> symbol

designates a comment and means: ignore the remaining text on this line.
A comment symbol must have a space in front of it, or start a new line
so that cfengine knows you don't mean the symbol as part of another
word.

<LI>Words which end in a single colon define <EM>sections</EM> in a program.  Under a

given section you group together all declarations of a given type.  Section names
must all be taken from a list defined by the language.  You cannot define your
own sections.

<LI>Words which end in two colons are so-called <EM>class</EM> names.  They are

used for making decisions in cfengine.

<LI>Statements which are of the form <CODE><VAR>name</VAR>=( <VAR>list</VAR> )</CODE> are

used to assign the value on the right hand side to the name on the left hand side
of the equals sign.

</UL>

<P>
In simple example above has three of the four types of object described
above.  The <CODE>control:</CODE> section of any program tells cfengine how to
behave.  In this example it adds the action <VAR>links</VAR> to the
actionsequence.  For <VAR>links</VAR> you could replace some other action.
The essential point is that, if you don't have an action sequence, your
cfengine program will do absolutely nothing! The action sequence is a
list which tells cfengine what do to and in which order.

</P>
<P>
The <CODE>links:</CODE> section of the file tells cfengine that what follows
is a number of links to be made.  If you write this part of the file,
but forget to add links to the actionsequence, then nothing will be
done! You can add any number of links in this part of the file and they
will all be dealt with in order when--and only when--you write
<VAR>links</VAR> in the action sequence.

</P>
<P>
To summarize, you <EM>must</EM> have:

</P>

<UL>

<LI>Some declarations which specify things to be done.

<LI>An action sequence which tells cfengine which sections to process,

how many times and in which order they should be processed.

</UL>

<P>
Now let's think a bit about how useful this short example program is.
On a SunOS system, where the directory <TT>`/bin'</TT> is in fact supposed
to be a link, such a check could be useful, but on some other system
where <TT>`/bin'</TT> is a not a link but a separate directory, this would
result in an error message from cfengine, telling you that <TT>`/bin'</TT>
exists and is not a link.  The lesson is that, if we want to use
cfengine to make <EM>one single</EM> program which can be run on any host
of any type, then we need some way of restricting the above link so that
it only gets checked on SunOS systems.  We can write the following:

</P>

<PRE>

# Comment...
 
control:

  actionsequence = ( links  )

links:

  sun4:: 

       /bin -&#62; /usr/bin
       # other links

   osf::

       # other links

</PRE>

<P>
The names which have double colons after them are called <EM>classes</EM>
and they are used to restrict a particular action so that it only gets
performed if the host running the program is a member of that class.  If
you are familar with C++, this syntax should make you think of classes
definitions in C++.  Classes works like this: the names above
<CODE>sun4</CODE>, <CODE>sun3</CODE>, <CODE>osf</CODE> etc.  are all internally defined by
cfengine.  If a host running, say, the OSF operating system executes the
file it automatically becomes a member of the class <CODE>osf</CODE>.  Since
it cannot be a member more than one of the above, this distinguishes
between different types of operating system and creates a hidden
<CODE>if</CODE>..<CODE>then</CODE>...<CODE>else</CODE> test.

</P>
<P>
This is the way in which cfengine makes decisions.  The key idea is that
actions are only carried out if they are in the same class as the host
running the program.  Classes are dealt with in detail in the next
chapter.

</P>
<P>
Now let's see how to add another kind of action to the action sequence.

</P>

<PRE>

# Comment...
 
control:

  actionsequence = ( tidy links )

links:

  /bin -&#62; /usr/bin

tidy:

   /tmp  pattern=* age=7 recurse=inf

</PRE>

<P>
We have now added a new kind of declaration called <CODE>tidy:</CODE> which
deletes files.  In the example above, we are looking at files in the
directory <TT>`/tmp'</TT> which match the pattern <SAMP>`*'</SAMP> and have not been
accessed for more than seven days.  The search for these files descends
recursively down any number of subdirectories.

</P>
<P>
To make any of this happen we must add the word <VAR>tidy</VAR> to the action
sequence.  If we don't, the declaration will be ignored.  Notice also
that, regardless of the fact that <CODE>links:</CODE> comes before
<CODE>tidy:</CODE>, the order in the action sequence tells us that all
<CODE>tidy</CODE> actions will be performed before <CODE>links:</CODE>.

</P>
<P>
The above structure can be repeated to build up a configuration file or script.

</P>



<H2><A NAME="SEC15" HREF="cfengine_toc.html#TOC15">Program structure</A></H2>
<P>
<A NAME="IDX15"></A>
<A NAME="IDX16"></A>

</P>
<P>
<A NAME="IDX17"></A>
To summarize the previous section, here is a sketch of a typical
cfengine configuration program showing a sensible structure.  The
various sections are listed in a sensible order which you would probably
use in the action sequence.

</P>
<P>
An individual section-declaration in the program looks something like this:

</P>

<PRE>

<VAR>action-type</VAR>:

   <VAR>class1</VAR>::

       <VAR>list of things to do...</VAR>

   <VAR>class2</VAR>::

       <VAR>list of things to do...</VAR>

</PRE>

<P>
<CODE>action-type</CODE> is one of the following reserved words:

</P>

<PRE>

   groups, control, homeservers, binservers, mailserver, mountables,
   import, broadcast, resolve, defaultroute, directories, miscmounts,
   files, ignore, tidy, required, links, disable, shellcommands, 
   editfiles, processes

</PRE>

<P>
 
The order in which declarations occur is not important to cfengine from
a syntactical point of view, but some of the above actions define
information which you will want to refer to later.  All variables,
classes, groups etc.  must be defined before they are used.  That means
that it is smart to follow the order above for the sections in the first
line of the above list.

</P>
<P>
The order in which items are declared is not to be confused with the
order in which they are executed.  This is determined by the
<CODE>actionsequence</CODE>, See section <A HREF="cfengine.html#SEC49">control</A>.  Probably you will want to
coordindate the two so that they match as far as possible.
<A NAME="IDX18"></A>
<A NAME="IDX19"></A>
<A NAME="IDX20"></A>

</P>
<P>
For completeness, here is a complete summary of the structure of a very
general cfengine configuration program.  The format is free and use of
space is unrestricted, though it is always a good idea to put a space in
front before and after parentheses when defining variables.
<A NAME="IDX21"></A>
<A NAME="IDX22"></A>
<A NAME="IDX23"></A>

</P>

<PRE>

######################################################################
# 
# Example of structure
#
######################################################################

groups:
 
   <VAR>group1</VAR> = ( <VAR>host</VAR> <VAR>host</VAR> ...  )
   <VAR>group2</VAR> = ( <VAR>host</VAR> <VAR>host</VAR> ...  ) 
   ...

######################################################################

control: 

   <VAR>class</VAR>::

   site      =  ( <VAR>mysite</VAR> )
   domain    =  ( <VAR>mydomain</VAR> )
   ...

    actionsequence = 
      (
      <VAR>action name</VAR>
      ....
      )

   mountpattern = ( <VAR>mountpoint</VAR> )
   homepattern = ( <VAR>wildcards matching home directories</VAR> ) 

   addclasses = ( <VAR>foo</VAR> <VAR>bar</VAR> )

######################################################################

homeservers:

   <VAR>class</VAR>::  
           <VAR>home servers</VAR>

binservers:

   <VAR>class</VAR>::
           <VAR>binary servers</VAR>

mailserver:

   <VAR>class</VAR>::
           <VAR>mail server</VAR>

mountables:

   <VAR>class</VAR>::

           <VAR>list of resources</VAR>

######################################################################

import: 

   <VAR>class</VAR>::    <VAR>include file</VAR>

   <VAR>class</VAR>::    <VAR>include file</VAR>

######################################################################

broadcast:

  <VAR>class</VAR>::  <VAR>ones</VAR>   # or zeros / zeroes

defaultroute:

   <VAR>class</VAR>::  <VAR>my-gw</VAR>

######################################################################

resolve:

   any::

       <VAR>list of nameservers</VAR>

   ...

</PRE>

<P>

</P>



<H2><A NAME="SEC16" HREF="cfengine_toc.html#TOC16">Optional features in cfengine</A></H2>
<P>
<A NAME="IDX24"></A>

</P>
<P>
Cfengine doesn't do anything unless you ask it to.  When you run a
cfengine program it generates no output unless it finds something it
believes to be wrong.  It does not carry out any actions unless they are
declared in the action sequence.  In fact it's just like one of those
people you try to avoid at the office because they only complain about
what's wrong and never ever say anything positive.  But all this can
change.

</P>
<P>
If you like, you can make cfengine positively chatty.  Cfengine can be
run with a number of command line options See section <A HREF="cfengine.html#SEC141">Runtime Options</A>.  If
you run the program with the <SAMP>`-v'</SAMP> or <SAMP>`--verbose'</SAMP> options, it
will supply you cheerily with a resume of what it is doing.  Certain
warning messages also get printed in verbose mode.

</P>
<P>
You can ask cfengine to check lots of things -- the timezone for
instance, or the domain name.  In order for it to check these things, it
needs some information from you.  All of the switches and options which
change the way in which cfengine behaves get specified either on the
command line or in the <CODE>control:</CODE> section of the control file.
Some special control variables are used for this purpose.  Here is a
short example:

</P>

<PRE>

control:

  domain   = ( mydomain.no )
  netmask  = ( 255.255.255.0 )
  timezone = ( MET )

  mountpattern = ( /mydomain/mountpoint )

  actionsequence = 
     (
     checktimezone     # check time zone
     netconfig         # includes check netmask
     resolve           # includes domain
     mountinfo         # look for mounted disks under mountpattern
     )

</PRE>

<P>
To get verbose output you must run cfengine with the appropriate command
line option <SAMP>`--verbose'</SAMP> or <SAMP>`-v'</SAMP>.

</P>
<P>
Notice that setting values has a special kind of syntax: a variable
name, an equals sign and a value in parentheses.  This tells you that
the quantity of the left hand side assumes the value on the right hand
side.  There are lots of questions you might ask at this point.  The
answers to these will be covered as we go along and in the next chapter.

</P>
<P>
Before leaving this brief advertisement for control parameters, it is
worth noting the definition of <CODE>mountpattern</CODE> above.  This declares
a directory in which cfengine expects to find mounted disks.  It will be
explained in detail later, for now notice that this defintion looks
rather stupid and inflexible.  It would be much better if we could use
some kind of variables to define where to look for mounted filesystems.
And of course you can...

</P>

<P>
Having briefly scraped the surface of what cfengine can do, turn to the
example See section <A HREF="cfengine.html#SEC131">Example configuration files</A> and take a look at what a
complete program can look like.  If you understand it, you might like to
skip through the rest of the manual until you find what you are looking
for.  If it looks mysterious, then the next chapter should answer some
questions in more depth.

</P>



<H2><A NAME="SEC17" HREF="cfengine_toc.html#TOC17">Invoking cfengine</A></H2>
<P>
<A NAME="IDX25"></A>
<A NAME="IDX26"></A>
<A NAME="IDX27"></A>

</P>
<P>
Cfengine may be invoked in a number of ways.  Here are some examples:
 

<PRE>
host% cfengine

host% cfengine --file myfile

host% cfengine -f myfile -v -n

host% cfengine --help
</PRE>

<P>
<A NAME="IDX28"></A>
<A NAME="IDX29"></A>
<A NAME="IDX30"></A>
The first of these (the default command, with no arguments) looks for a
file called <TT>`cfengine.conf'</TT> in the current directory and executes
the commands silently.  The second command reads the file <TT>`myfile'</TT>
and works silently.  The third works in verbose mode and the <CODE>-n</CODE>
option means that no actions should actually be carried out, only
warnings should be printed.  The final example causes cfengine to print
out a list of its command line options.
<A NAME="IDX31"></A>
<A NAME="IDX32"></A>
<A NAME="IDX33"></A>

</P>
<P>
The complete list of options is listed in the summary at the beginning
of this manual, or you can see it by giving the <CODE>-h</CODE> option.
See section <A HREF="cfengine.html#SEC141">Runtime Options</A>
<A NAME="IDX34"></A>
<A NAME="IDX35"></A>
<A NAME="IDX36"></A>

</P>
<P>
In addition to running cfengine with a filename, you can also treat
cfengine files as scripts by starting your cfengine program with the
standard shell line:

<PRE>
#!/local/gnu/bin/cfengine -f
#
# My config script
#
</PRE>

<P>
<A NAME="IDX37"></A>
Here we assume that you have installed cfengine under the directory
<TT>`/local/gnu/bin'</TT>.  By adding a header like this to the first line
of your program and making the file executable with the <CODE>chmod</CODE>
shell command, you can execute the program just by typing its
name--i.e.  without mentioning cfengine explicitly at all.

</P>
<P>
As a novice to cfengine, it is advisable to check all programs with the
<CODE>-n</CODE> option before trusting them to your system, at least until you
are familar with the behaviour of cfengine.  This `safe' option allows
you to see what cfengine wants to do, without actually committing
yourself to doing it.

</P>



<H2><A NAME="SEC18" HREF="cfengine_toc.html#TOC18">CFINPUTS environment variable</A></H2>

<P>
Whenever cfengine looks for a file it asks a question: is the filename
an absolute name (that is a name which begins from <TT>`/'</TT> like
<CODE>/usr/file</CODE>), is it a file in the directory in which you invoke
cfengine or is it a file which should be searched for in a special
place?
<A NAME="IDX38"></A>
<A NAME="IDX39"></A>
<A NAME="IDX40"></A>
<A NAME="IDX41"></A>
<A NAME="IDX42"></A>

</P>
<P>
If you use an absolute filename either on the command line using
<CODE>-f</CODE> or in the <CODE>import</CODE> section of your program (a name which
begins with a slash '/'), then cfengine trusts the name of the file you
have given and treats it literally.

</P>
<P>
<A NAME="IDX43"></A>
If you run cfengine without arguments (so that the default filename is
<TT>`cfengine.conf'</TT>) or you specify a file without a leading slash in
the <CODE>import</CODE> section, then the value of the environment variable
<CODE>CFINPUTS</CODE> is prepended to the start of the file name.  This allows
you to keep your configuration in a standard place, pointed to by
<CODE>CFINPUTS</CODE>.  For example:

</P>

<PRE>

host# setenv CFINPUTS /usr/local/gnu/lib/cfengine/inputs

host# cfengine -f myfile

</PRE>

<P>
In this example, cfengine tries to open 

</P>
<P>
<TT>`/usr/local/gnu/lib/cfengine/inputs/myfile'</TT>.

</P>



<H1><A NAME="SEC19" HREF="cfengine_toc.html#TOC19">More advanced concepts</A></H1>



<H2><A NAME="SEC20" HREF="cfengine_toc.html#TOC20">Classes</A></H2>
<P>
<A NAME="IDX44"></A>

</P>
<P>
The idea of classes is central to the operation of cfengine.  Saying
that cfengine is `class orientated' means that it doesn't make decisions
using <CODE>if</CODE>...<CODE>then</CODE>...<CODE>else</CODE> constructions the way other
languages do, but only carries out an action if the host running the
program is in the same class as the action itself.  To understand what
this means, imagine sorting through a list of all the hosts at your
site.  Imagine also that you are looking for the <EM>class</EM> of hosts
which belong to the computing department, which run GNU/Linux operating
system and which have yellow spots! To figure out whether a particular
host satisfies all of these criteria you first delete all of the hosts
which are not GNU/Linux, then you delete all of the remaining ones which
don't belong to the computing department, then you delete all the
remaining ones which don't have yellow spots.  If you are on the
remaining list, then you are in the class of all
computer-science-Linux-yellow-spotted hosts and you can carry out the
action.

</P>
<P>
Cfengine works in this way, narrowing things down by asking if a host is
in several classes at the same time.  Although some information (like
the kind of operating system you are running) can be obtained directly,
clearly, to make this work we need to have lists of which hosts belong
to the computer department and which ones have yellow spots.

</P>
<P>
So how does this work in a cfengine program?  A program or configuration
script consists of a set of declarations for what we refer to as
<EM>actions</EM> which are to be carried out only for certain classes of
host.  Any host can execute a particular program, but only certain
action are extracted -- namely those which refer to that particular
host.  This happens automatically because cfengine builds up a list of
the classes to which it belongs as it goes along, so it avoids having to
make many decisions over and over again.

</P>
<P>
By defining classes which classify the hosts on your network in some
easy to understand way, you can make a single action apply to many hosts
in one go -- i.e.  just the hosts you need.  You can make generic rules
for specific type of operating system, you can group together clusters
of workstations according to who will be using them and you can paint
yellow spots on them -- what ever works for you.

</P>
<P>
A <EM>cfengine action</EM> looks like this:

</P>

<PRE>

<VAR>action-type</VAR>:

   <VAR>compound-class</VAR>::
     
       <VAR>declaration</VAR>
</PRE>

<P>
A single class can be one of several things:

</P>

<UL>

<LI>The name of an operating system architecture e.g.  <CODE>ultrix</CODE>, <CODE>sun4</CODE> etc.

This is referred to henceforth as a <EM>hard class</EM>.

<LI>The (unqualified) name of a particular host. If your system returns a fully

qualified domain name for your host, cfengine truncates it so as to unqualify
the name.

<LI>The name of a user-defined group of hosts.

<LI>A day of the week (in the form <CODE>Monday Tuesday Wednesday..</CODE>).

<LI>An arbitrary user-defined string.  See section <A HREF="cfengine.html#SEC64">addclasses</A>.

</UL>

<P>
A compound class is a sequence of simple classes connected by dots or
`pipe' symbols (vertical bars).  For example:

</P>
<P>
<A NAME="IDX45"></A>
<A NAME="IDX46"></A>

<PRE>

myclass.sun4.Monday::

sun4|ultrix|osf::

</PRE>

<P>
A compound class evaluates to `true' if all of the individual classes
are separately true, thus in the above example the actions which follow
<CODE>compound_class::</CODE> are only carried out if the host concerned is in
<CODE>myclass</CODE>, is of type <CODE>sun4</CODE> and the day is Monday!
In the second example, the host parsing the file must be either of
type <CODE>sun4</CODE> <EM>or</EM> <CODE>ultrix</CODE> <EM>or</EM> <CODE>osf</CODE>.
In other words, compound classes support two operators: AND and OR,
written <SAMP>`.'</SAMP> and <SAMP>`|'</SAMP> respectively. Cfengine doesn't
care how many of these operators you use (since it skips over blank
class names), so you could write either

</P>

<PRE>

solaris|irix::

</PRE>

<P>
or

</P>

<PRE>

solaris||irix::

</PRE>

<P>
depending on your taste. On the other hand, the order in which cfengine
evaluates AND and OR operations <EM>does</EM> matter, and the rule
is that AND takes priority over OR, so that <SAMP>`.'</SAMP> binds classes
together tightly and all AND operations are evaluated before ORing
the final results together. This is the usual behaviour in programming
languages.

</P>
<P>
Cfengine allows you to define switch on and off dummy classes so that
you can use them to select certain subsets of action.  In particular,
note that by defining your own classes, using them to make compound
rules of this type, and then switching them on and off, you can also
switch on and off the corresponding actions in a controlled way.  The
command line options <CODE>-D</CODE> and <CODE>-N</CODE> can be used for this
purpose.  See also section <A HREF="cfengine.html#SEC64">addclasses</A>.
<A NAME="IDX47"></A>
<A NAME="IDX48"></A>
<A NAME="IDX49"></A>

</P>
<P>
<A NAME="IDX50"></A>
<A NAME="IDX51"></A>
<A NAME="IDX52"></A>
<A NAME="IDX53"></A>
A logical NOT operator has been added to allow you to exclude
certain specific hosts in a more flexible way. The logical NOT
operator is (as in C and C++) <SAMP>`!'</SAMP>. For instance, the
following example would allow all hosts except for <CODE>myhost</CODE>:

</P>

<PRE>
   <VAR>action</VAR>:

    !myhost::

        <VAR>command</VAR>
</PRE>

<P>
and similarly, so allow all hosts in a user-defined group <CODE>mygroup</CODE>,
<EM>except</EM> for <CODE>specialhost</CODE>, you would write

</P>

<PRE>
   <VAR>action</VAR>:

    mygroup.!myhost::

        <VAR>command</VAR>
</PRE>

<P>
which reads `mygroup AND NOT myhost'. The NOT operator can also be
combined with OR. For instance

</P>

<PRE>

   <VAR>class1</VAR>|!<VAR>class2</VAR>
</PRE>

<P>
would select hosts which were either in class 1, or those
which were not in class 2.

</P>
<P>
Finally, there is a number of reserved classes.  The following are hard
classes for various operating system architectures.  They do not need to
be defined because each host knows what operating system it is running.
Thus the appropriate one of these will always be defined on each host.
Similarly the day of the week is clearly not open to definition, unless
you are running cfengine from outer space.  The reserved classes are:

</P>

<PRE>
ultrix, sun4, sun3, hpux, hpux10, aix, solaris, osf, irix, linux, 
        freebsd, netbsd, bsd4_3, newsos, solarisx86, aos,
                         nextstep, bsdos
</PRE>

<P>
If these classes are not sufficient to distinguish the hosts on
your network, cfengine provides more specific classes which
contain the name and release of the operating system. To find out
what these look like for your systems you can run cfengine in
`parseonly-verbose' mode:

</P>

<PRE>

  cfengine -p -v

</PRE>

<P>
and these will be displayed. For example, solaris 2.4 systems
generate the additional classes <CODE>sunos_5_4</CODE> and <CODE>sunos_sun4m</CODE>,
<CODE>sunos_sun4m_5_4</CODE>.

</P>
<P>
NOTE! Cfengine uses unqualified host names as classes. Some sites and operating
systems use fully qualified names for their hosts. i.e. <CODE>uname -n</CODE> returns
to full domain qualified hostname. This spoils the class matching algorithms
for cfengine, so cfengine automatically truncates names which contain a dot `.'
at the first `.' it encounters. If your hostnames contain dots (which do not
refer to a somain name, then cfengine will be confused. The moral is: don't
have dots in your host names! <EM>NOTE: in order to ensure that the fully qualified
name of the host becomes a class you must define the domain variable.</EM>
<A NAME="IDX54"></A>
<A NAME="IDX55"></A>
<A NAME="IDX56"></A>

</P>



<H2><A NAME="SEC21" HREF="cfengine_toc.html#TOC21">Defining classes and making exceptions</A></H2>
<P>
<A NAME="IDX57"></A>
<A NAME="IDX58"></A>

</P>
<P>
Because cfengine works at a very high level, doing very many things for
very few lines of code it might seem that some flexibility is lost.
When we restrict certain actions to special classes it is occasionally
useful to be able to switch off classes temporarily so as to cancel the
special actions.

</P>
<P>
You can define classes of your own which can be switched on and off,
either on the command line or from the action sequence.  For example,
suppose we define a class <EM>include</EM>.  We use <CODE>addclasses</CODE> to
do this.

</P>

<PRE>
addclasses = ( include othersymbols )
</PRE>

<P>
The purpose of this
would be to allow certain `excludable actions' to be defined.  
Actions defined by

</P>

<PRE>

any.include::
               <VAR>actions</VAR>

</PRE>

<P>
will normally be carried out, because we have defined <CODE>include</CODE> to
be true using <CODE>addclasses</CODE>.  But if cfengine is run in a restricted
mode, in which <CODE>include</CODE> is set to false, we can exclude these
actions.

</P>
<P>
So, by defining the symbol <CODE>include</CODE> to be false, you can exclude
all of the actions which have <CODE>include</CODE> as a member.  There are two
ways in which this can be done, one is to negate a class globally using

</P>

<PRE>

cfengine -N include 

</PRE>

<P>
This undefines the class <CODE>include</CODE> for the entire duration of the
program.

</P>
<P>
Another way to specify actions is to use a class to select only a subset
of all the actions defined in the actionsequence.  You do this by adding
a class name to one on the actions in action sequence by using a dot
<SAMP>`.'</SAMP> to separate the words.  In this case the symbol only evaluates
to `true' for the duration of the action to which it it attached.  Here
is an example:

<PRE>

  links.onlysome
  shellcommands.othersymbols.onlysome

</PRE>

<P>
In the first case <EM><CODE>onlysome</CODE> is defined to be true</EM> while
this instance of <CODE>links</CODE> is executed.  That means that only actions
labelled with the class <CODE>onlysome</CODE> will be executed as a result of
that statement.  In the latter case, both <CODE>onlysome</CODE> and
<CODE>othersymbols</CODE> are defined to be true for the duration of
<CODE>shellcommands</CODE>.

</P>
<P>
This syntax would normally be used to omit certain time-consuming
actions, such as tidying all home directories.  Or perhaps to
synchronise certain actions which have to happen in a certain order.

</P>
<P>
For more advanced uses of cfengine you might want to be able to
define a class on the basis of the success or failure of a user-program,
a shell command or user script. Consider the following example

</P>

<PRE>

groups:

   have_cc = ( "/bin/test -f /usr/ucb/cc" "/bin/test -f /local/gnu/cc"  )

</PRE>

<P>
Whenever cfengine meets an object in a class list or variable, which is
surrounded by either single, double quotes or reversed quotes, it
attempts to execute the string as a command passed to the Bourne
shell. If the resulting command has return code zero (proper exit) then
the class on the left hand side of the assignment (in this case
<SAMP>`have_cc'</SAMP>) will be true. If the command returns any other value (an
error number) the result is false. Since groups are the logical OR of
their members (it is sufficient that one of the members matches the
current system), the class <SAMP>`have_cc'</SAMP> will be defined above if
either <TT>`/usr/ucb/cc'</TT> or <TT>`/local/gnu/cc'</TT> exist, or both.
<A NAME="IDX59"></A>
<A NAME="IDX60"></A>
<A NAME="IDX61"></A>
<A NAME="IDX62"></A>

</P>



<H2><A NAME="SEC22" HREF="cfengine_toc.html#TOC22">The generic class <CODE>any</CODE></A></H2>
<P>
<A NAME="IDX63"></A>
<A NAME="IDX64"></A>
<A NAME="IDX65"></A>

</P>
<P>
The generic wildcard <CODE>any</CODE> may be used to stand for any class.
Thus instead of assigning actions for the class <CODE>sun4</CODE> only you
might define actions for any architecture by specifying:

<PRE>

  any::
        <VAR>actions</VAR>

</PRE>

<P>
If you don't specify any class at all then cfengine assumes a default value of <CODE>any</CODE> for the
class.  

</P>



<H2><A NAME="SEC23" HREF="cfengine_toc.html#TOC23">Wildcards in directory names</A></H2>
<P>
<A NAME="IDX66"></A>
<A NAME="IDX67"></A>

</P>
<P>
In the two actions <CODE>files</CODE> and <CODE>tidy</CODE> you define directory
names at which file checking or tidying searches should start.  One
economical feature is that you can define a whole group of directories
at which identical searches should start in one fell swoop by making use
of <EM>wildcards</EM>.  For example, the directory names

</P>

<PRE>
     /usr/*/*
     /bla/*/ab?/bla
</PRE>

<P>
represent all of the <EM>directories</EM> (and only directories) which
match the above wildcard strings.  Cfengine opens each matching
directory and iterates the action over all directories which match.

</P>
<P>
The symbol <SAMP>`?'</SAMP> matches any single character, whereas <SAMP>`*'</SAMP>
matches any number of characters, in accordance with shell
file-substitution wildcards.
<A NAME="IDX68"></A>
<A NAME="IDX69"></A>

</P>
<P>
When this notation is used in directory names, it always defines the
starting point for a search.  It does not tell the command how to
search, only where to begin.  The <CODE>pattern</CODE> directive in
<CODE>tidy</CODE> can be used to specify patterns when tidying files and under
<CODE>files</CODE> all files are considered, See section <A HREF="cfengine.html#SEC101">tidy</A>, and section <A HREF="cfengine.html#SEC76">files</A>,
section <A HREF="cfengine.html#SEC78">Recursion</A>.

</P>



<H2><A NAME="SEC24" HREF="cfengine_toc.html#TOC24">Variable substitution</A></H2>
<P>
<A NAME="IDX70"></A>
<A NAME="IDX71"></A>
<A NAME="IDX72"></A>
<A NAME="IDX73"></A>
<A NAME="IDX74"></A>
<A NAME="IDX75"></A>
<A NAME="IDX76"></A>
<A NAME="IDX77"></A>
<A NAME="IDX78"></A>
<A NAME="IDX79"></A>
<A NAME="IDX80"></A>

</P>
<P>
<A NAME="IDX81"></A>
<A NAME="IDX82"></A>
<A NAME="IDX83"></A>

</P>
<P>
When you are building up a configuration file it is very useful to be
able to use variables.  If you can define your configuration in terms of
some key variables, it can be changed more easily later, it is more
transparent to the reader of the program and you can also choose to
define the variables differently on different types of system.  Another
way of saying this is that cfengine variables also belong to classes.
Cfengine makes use of variables in three ways.

</P>

<UL>
<LI>Environment variables from the shell

<LI>Special variables used in cfengine features

<LI>General macro-string substitution.

</UL>

<P>
Environment variables are fetched directly from the shell on whatever
system is running the program.  An example of a special variable is the
<CODE>domain</CODE> variable from the previous section.  Straightforward macro
substitution allows you to define a symbol name to be replaced by an
arbitrary text string.  All these definitions (apart from shell
environment variables, of course) are made in the control part of the
cfengine program:

</P>

<PRE>

control:

  myvar = ( /usr/local/mydir/lib/very/long/path )   # define macro

...

links:

  $(myvar) -&#62; /another/directory

</PRE>

<P>
Here we define a macro called <CODE>myvar</CODE>, which is later used to
define the creation of a link.  As promised we can also define
class-dependent variables:

</P>

<PRE>

control:

  sun4:: myvar = ( sun )
  hpux:: myvar = ( HP )

</PRE>

<P>
Cfengine gives you access to the shell environment variables and allows
you to define variables of your own.  It also keeps a few special
variables which affect the way in which cfengine works.  When cfengine
expands a variable it looks first at the name in its list of special
variables, then in the list of user-defined macros and finally in the
shell environment for a match.  If none of these are found it expands to
the empty string.

</P>
<P>
Variables are referred to in either of two different ways, depending on
your taste.  You can use the forms <CODE>$(variable)</CODE> or
<CODE>${variable}</CODE>.  The variable in braces or parentheses can be the
name of any user defined macro, environment variable or one of the
following special internal variables.

</P>
<DL COMPACT>

<DT><CODE>faculty</CODE>
<DD>
The faculty or site as defined in control (see site).

<DT><CODE>site</CODE>
<DD>
This variable is identical to <CODE>$(faculty)</CODE> and may be used interchangeably.
 
<DT><CODE>binserver</CODE>
<DD>
The default server for binary data.  See section <A HREF="cfengine.html#SEC30">Cfengine's model for NFS-mounted filesystems</A>
 
<DT><CODE>host</CODE>
<DD>
The hostname of the machine running the program.

<DT><CODE>fqhost</CODE>
<DD>
The fully quialified (DNS/BIND) hostname of the system, which
includes the domain name as well.

<DT><CODE>sysadm</CODE>
<DD>
The name or mail address of the system administrator.

<DT><CODE>timezone</CODE>
<DD>
The current timezone as defined in <CODE>control</CODE>.

<DT><CODE>domain</CODE>
<DD>
The currently defined domain.

<DT><CODE>class</CODE>
<DD>
The currently defined system hard-class (e.g. <CODE>sun4</CODE>, <CODE>hpux</CODE>).

<DT><CODE>arch</CODE>
<DD>
The current detailed architecture string--an amalgamation of the
information from <EM>uname</EM>.

<DT><CODE>allclasses</CODE>
<DD>
A long string in the form <SAMP>`CFALLCLASSES=class1:class2...'</SAMP>. This variable
is a summary of all the defined classes at any given time. It is always
kept up to date so that scripts can make use of cfengine's class data.
<A NAME="IDX84"></A>
<A NAME="IDX85"></A>
<A NAME="IDX86"></A>
<A NAME="IDX87"></A>

<DT><CODE>repchar</CODE>
<DD>
The character value of the string used by the file repository in
constructing unqiue filenames from path names. This is the character which
replaces <SAMP>`/'</SAMP> See section <A HREF="cfengine.html#SEC57">repchar</A>.

<DT><CODE>split</CODE>
<DD>
The character on which list variables are split See section <A HREF="cfengine.html#SEC58">split</A>.

<DT><CODE>underscoreclasses</CODE>
<DD>
If this is set to `on' cfengine uses hard-classes which begin with
an underscore, so as to avoid name collisions. See also See section <A HREF="cfengine.html#SEC141">Runtime Options</A>.
<A NAME="IDX88"></A>
<A NAME="IDX89"></A>
<A NAME="IDX90"></A>
<A NAME="IDX91"></A>
<A NAME="IDX92"></A>

<DT><CODE>spc</CODE>
<DD>
Expands simply to a single space. This can be used to place spaces in
filenames etc.
<A NAME="IDX93"></A>

<DT><CODE>tab</CODE>
<DD>
Expands to a single tab character.
<A NAME="IDX94"></A>

<DT><CODE>lf</CODE>
<DD>
Expands to a line-feed character (unix end of line).
<A NAME="IDX95"></A>

<DT><CODE>cr</CODE>
<DD>
Expands to the carriage-return character.
<A NAME="IDX96"></A>

</DL>
<P>
These variables are kept special because they play a special role in
setting up a system configuration.  See section <A HREF="cfengine.html#SEC29">Designing a global system configuration</A>.  
You are encouraged to use them to define fully
generalized rules in your programs.  Variables can be used to advantage
in defining filenames, directory names and in passing arguments to shell
commands.  The judicious use of variables can reduce many definitions to
a single one if you plan carefully.

</P>
<P>
You can use variables in the following places:

</P>

<UL>
<LI>In any directory name.  The <CODE>$(binserver)</CODE> variable is not always appropriate in this context.  For instance

</UL>


<PRE>

links:

  osf::
      /$(site)/${host}/directory -&#62; somefile

</PRE>


<UL>
<LI>In any quoted string.  See section <A HREF="cfengine.html#SEC100">shellcommands</A>.

</UL>


<PRE>
shellcommands:

  any::

   "/bin/echo $(timezone) | /bin/mail $(sysadm)"
   '/bin/echo "double quotes!"'

</PRE>

<P>
<A NAME="IDX97"></A>

</P>
<P>
The latter possibility enables cfengine's variables to be passed
on to user-defined scripts.

</P>

<UL>
<LI>To define the values of options passed to various actions,

in the form <CODE><VAR>option</VAR>=$(variable)</CODE>.
</UL>

<P>
Variables can be defined differently under different classes by
preceeding the definition with a class name.  For example:

</P>

<PRE>
control:

   sun4::  my_macro = ( User_string_1 )
   irix::  my_macro = ( User_string_2 )

</PRE>

<P>
Here the value assigned to <CODE>$(my_macro)</CODE> depends on which of the
classes evaluates to true.  This feature can be used to good effect to
define the mail address of a suitable system administrator for different
groups of host.

<PRE>
control:

 physics::   sysadm = ( mark,fred )
 chemistry:: sysadm = ( localsys@domain )

</PRE>

<P>
<A NAME="IDX98"></A>
<A NAME="IDX99"></A>

</P>
<P>
Note, incidentally, that the <SAMP>`-a'</SAMP> option
can be used to print out the mail address of the system administrator
for any wrapper scripts.

</P>



<H2><A NAME="SEC25" HREF="cfengine_toc.html#TOC25">Quoted strings</A></H2>

<P>
In several cfengine commands, you use quoted strings to define a quantity
of text which may contain spaces. For example

</P>

<PRE>

control:

  macro = ( "mycommand" )

editfiles:

  { $(HOME)/myfile

   AppendIfNoSuchLine 'This text contains space'
  }

</PRE>

<P>
In each case you may used any one of the three types of quote marks in
order to delimit strings,

</P>

<PRE>

  ' <VAR>or</VAR> " <VAR>or</VAR> `

</PRE>

<P>
If you choose, say <CODE>"</CODE>, then you may not use this symbol within the
string itself. The same goes for the other types of string delimiters.
Unlike the shell, cfengine treats these three delimiters in precisely
the same way. There is no difference between them.
<A NAME="IDX100"></A>
<A NAME="IDX101"></A>
<A NAME="IDX102"></A>
<A NAME="IDX103"></A>
<A NAME="IDX104"></A>
<A NAME="IDX105"></A>
If you need to quote a quoted string, then you should choose a delimiter
which does not crash with the substring.

</P>
<P>
Note that you can use special variables for certain symbols in a string
See section <A HREF="cfengine.html#SEC24">Variable substitution</A>.

</P>



<H2><A NAME="SEC26" HREF="cfengine_toc.html#TOC26">Debugging tips</A></H2>

<P>
A useful trick when debugging is to eliminate unwanted actions by
changing their class name.  Since cfengine assumes that any class it
does not understand is the name of some host, it will simply ignore
entries it does not recognize.  For example:

</P>

<PRE>
   myclass::
</PRE>

<P>
can be changed to

</P>

<PRE>
   Xmyclass::
</PRE>

<P>
Since <CODE>Xmyclass</CODE> no longer matches any defined classes, and is not
the name of any host it will simply be ignored.  The <CODE>-N</CODE> option
can also be used to the same effect.  See section <A HREF="cfengine.html#SEC141">Runtime Options</A>.
<A NAME="IDX106"></A>
<A NAME="IDX107"></A>
<A NAME="IDX108"></A>
<A NAME="IDX109"></A>

</P>



<H2><A NAME="SEC27" HREF="cfengine_toc.html#TOC27">Access control</A></H2>

<P>
It is sometimes convenient to be able to restrict the access of a
program to a handful of users.  This can be done by adding an access
list to the <CODE>control:</CODE> section of your program.  For example,

</P>

<PRE>
control:
    ...
    access = ( mark root )

</PRE>

<P>
would cause cfengine to refuse to run the program for any other users
except mark and root.  Such a restriction would be useful, for instance,
if you intended to make set-user-id scripts but only wished certain
users to be able to run them.  If the access list is absent, all users
can execute the program.
<A NAME="IDX110"></A>
<A NAME="IDX111"></A>
<A NAME="IDX112"></A>

</P>



<H2><A NAME="SEC28" HREF="cfengine_toc.html#TOC28">Regular expressions</A></H2>

<P>
Regular expressions can be used in cfengine in connection with
<CODE>editfiles</CODE> and <CODE>processes</CODE> to search for lines matching
certain expressions.  A regular expression is a generalized wildcard. In
cfengine wildcards, you can use the characters '*' and '?' to match any
character or number of characters.  Regular expressions are more
complicated than wildcards, but have far more flexibility.

</P>
<P>
<EM>NOTE: the special characters <SAMP>`*'</SAMP> and <SAMP>`?'</SAMP> 
used in wildcards do not have the
same meanings as regular expressions!</EM>.

</P>
<P>
Some regular expressions match only a single string. For example, every
string which contains no special characters is a regular expression
which matches only a string identical to itself. Thus the regular
expression <SAMP>`cfengine'</SAMP> would match only the string "cfengine", not
"Cfengine" or "cfengin" etc.  Other regular expressions could match more
general strings. For instance, the regular expression <SAMP>`c*'</SAMP> matches
any number of c's (including none). Thus this expression would match the
empty string, "c", "cccc", "ccccccccc", but not "cccx".

</P>
<P>
Here is a list of regular expression special characters and operators.

</P>
<DL COMPACT>

<DT><SAMP>`\'</SAMP>
<DD>
The backslash character normally has a special purpose: either to
introduce a special command, or to tell the expression interpreter that
the next character is not to be treated as a special character.
The backslash character stands for itself only when protected by square
brackets <CODE>[\]</CODE> or quoted with a backslash itself <SAMP>`\\'</SAMP>.

<DT><SAMP>`\b'</SAMP>
<DD>
Matches word boundary operator.

<DT><SAMP>`\B'</SAMP>
<DD>
Match within a word (operator).

<DT><SAMP>`\&#60;'</SAMP>
<DD>
Match beginning of word.

<DT><SAMP>`\&#62;'</SAMP>
<DD>
Match end of word.

<DT><SAMP>`\w'</SAMP>
<DD>
Match a character which can be part of a word.

<DT><SAMP>`\W'</SAMP>
<DD>
Match a character which cannot be part of a word.

<DT><SAMP>`<VAR>any character</VAR>'</SAMP>
<DD>
Matches itself.

<DT><SAMP>`.'</SAMP>
<DD>
Matches any character

<DT><SAMP>`*'</SAMP>
<DD>
Match zero or more instances of the previous object. e.g. <SAMP>`c*'</SAMP>.
If no object precedes it, it represents a literal asterisk.

<DT><SAMP>`+'</SAMP>
<DD>
Match one or more instances of the preceding object.

<DT><SAMP>`?'</SAMP>
<DD>
Match zero or one instance of the preceding object.

<DT><SAMP>`{ }'</SAMP>
<DD>
Number of matches operator. <SAMP>`{5}'</SAMP> would  match exactly 5
instances of the previous object. <SAMP>`{6,}'</SAMP> would match at least
6 instances of the previous object. <SAMP>`{7,12}'</SAMP> would match at least
7 instances of, but no more than 12 instances of the preceding object.
Clearly the first number must be less than the second to make a valid
search expression.

<DT><SAMP>`|'</SAMP>
<DD>
The logical OR operator, OR's any two regular expressions.

<DT><SAMP>`[<VAR>list</VAR>]'</SAMP>
<DD>
Defines a list of characters which are to be considered as a single
object (ORed). e.g. <SAMP>`[a-z]'</SAMP> matches any character in the range a to
z, <SAMP>`abcd'</SAMP> matches either a, b, c or d.  Most characters are
ordinary inside a list, but there are some exceptions: <SAMP>`]'</SAMP> ends the
list unless it is the first item, <SAMP>`\'</SAMP> quotes the next character,
<SAMP>`[:'</SAMP> and <SAMP>`:]'</SAMP> define a character class operator (see below),
and <SAMP>`-'</SAMP> represents a range of characters unless it is the first
or last character in the list.

<DT><SAMP>`[^<VAR>list</VAR>]'</SAMP>
<DD>
Defines a list of characters which are NOT to be matched. i.e.
match any character except those in the list.

<DT><SAMP>`<SAMP>`[:<VAR>class</VAR>:]'</SAMP>'</SAMP>
<DD>
Defines a class of characters, using the ctype-library.
  @table @code

  @item alnum
  Alpha numeric character

  @item alpha
  An alphabetic character

  @item blank
  A space or a TAB

  @item cntrl
  A control character.

  @item digit
  0-9

  @item graph
  same as print, without space

  @item lower
  a lower case letter

  @item print
  printable characters (non control characters)

  @item punct
  neither control nor alphanumeric symbols

  @item space
  space, cariage return, linefeed, vertical tab and form-feed.

  @item upper
  upper case letter

  @item xdigit
  a hexadecimal digit 0-9, a-f

  @end table

<DT><SAMP>`<SAMP>`(..)'</SAMP>'</SAMP>
<DD>
Groups together any number of operators.

<DT><SAMP>`\<VAR>digit</VAR>'</SAMP>
<DD>
Backreference operator (refer to the GNU regex documentation).

<DT><SAMP>`^'</SAMP>
<DD>
Match start of a line.

<DT><SAMP>`$'</SAMP>
<DD>
Match the end of a line.

</DL>

<P>
Here is a few examples. Remember that some commands look for
a regular expression match of part of a string, while others
require a match of the entire string See section <A HREF="cfengine.html#SEC75">editfiles</A>.

</P>

<PRE>

^#        match string beginning with the # symbol
^[^#]      match string not beginning with the # symbol
^[A-Z].+  match a string beginning with an uppercase letter
          followed by at least one other character  

</PRE>



<H1><A NAME="SEC29" HREF="cfengine_toc.html#TOC29">Designing a global system configuration</A></H1>

<P>
This chapter is about building strategies for putting together a
site configuration for your entire network.

</P>



<H2><A NAME="SEC30" HREF="cfengine_toc.html#TOC30">Cfengine's model for NFS-mounted filesystems</A></H2>
<P>
<A NAME="IDX113"></A>
<A NAME="IDX114"></A>

</P>
<P>
Most of the filesystems that you will want to make available across the
network are going to fall into one of two categories.  In cfengine
parlance these are called <EM>home directories</EM> and <EM>binary
directories</EM>.  A home directory is a place where users' login
directories are kept.  This is traditionally a directory called
<TT>`/home'</TT> or <TT>`/users'</TT> or some subdirectory of these.  A binary
directory is a place where compiled software is kept.  Such files (which
do not belong to the pure operating system release) are often placed in
a directory called <TT>`/usr/local'</TT> or simply <TT>`/local'</TT>.

</P>
<P>
In this chapter we shall consider a scheme for using cfengine to make NFS filesystem management
quite painless.

</P>



<H3><A NAME="SEC31" HREF="cfengine_toc.html#TOC31">NFS filesystem resources</A></H3>
<P>
<A NAME="IDX115"></A>

</P>
<P>
Using the Network File System (NFS) in a large workstation environment
requires a bit of planning.  The idea of NFS is to share files on one
host with other hosts.  In most cases, filesystems to be shared across
the network fall into two categories: <EM>binary</EM> filesystems (those
which contain compiled software) and <EM>user</EM> or <EM>home</EM>
filesystems (which contain users' login areas).

</P>
<P>
The most simple minded way to share resources would be to mount every
resource (each available NFS filesystem) onto every host.  To avoid
collisions, each filesystem would have to have a unique name.  This is
one possibility, but not a very intelligent one.  As experienced users
will realize, cross-mounting too many NFS filesystems is a recipe for
all kinds of trouble.

</P>
<P>
<A NAME="IDX116"></A>
<A NAME="IDX117"></A>
Cfengine offers a simple model which can help you pick out only the
resources you need from the list of NFS filesystems.  It will then mount
them automatically and edit the appropriate filesystem tables.  It does
this by defining classes of hosts.  For instance -- you really don't
need to mount a binary filesystem for an <CODE>ultrix</CODE> system onto an
<CODE>HPUX</CODE> system.  There would be no point -- binary rescources are
<EM>architecture</EM> or <EM>hardclass dependent</EM>.  But home directories
are architecture independent.

</P>
<P>
Cfengine lets you to define a list of allowed servers for various hosts
so that only filesystems from the servers will be considered for mounting!

</P>



<H3><A NAME="SEC32" HREF="cfengine_toc.html#TOC32">Unique filesystem mountpoints</A></H3>
<P>
<A NAME="IDX118"></A>
<A NAME="IDX119"></A>

</P>
<P>
The first step towards treating NFS filesystems as network resources is
to invent a naming scheme so that every filesystem has a unique name on
which it can be mounted.  If we don't sort this out now, we could find
two or more hosts with a filesystem called <CODE>/usr/local</CODE>, both of
which we might like to mount since they contain different software.

</P>
<P>
A simple but extremely useful naming scheme is the following.
<A NAME="DOCF2" HREF="cfengine_foot.html#FOOT2">(2)</A>  If you don't like this
scheme you can invent your own, but the remainder of the text will
encourage you to use this one.  Each filesystem is given a directory
name composed of three parts:

</P>

<PRE>

/site/host/contents

</PRE>

<P>
The first directory (which only exists to create a suitable mountpoint)
is the name of your local site.  If you are a physics department at a
university (with a separate setup) you could call this `physics'.  It
could be your company name or whatever.  The second piece is the name of
the host to which the disk space is physically attached.  The final
piece is the name of the filesystem.  Here are some typical examples:

</P>

<PRE>
/physics/einstein/local    # /usr/local for einstein@physics
/physics/newton/u1         # user partition 1 for newton@physcs
</PRE>

<P>
On the machines which are home to the `local' partition, it is better to
make a link to <CODE>/usr/local</CODE> than call the filesystem
<CODE>/usr/local</CODE> directly.  This is because it makes the procedure of
organizing the entire network much clearer.

</P>
<P>
It is worth noting that, when you ask cfengine to mount such a resource,
it will automatically make the mount directory and can easily be asked
to make a link to <CODE>/usr/local</CODE>, so this small amount of extra work
is really no work at all.

</P>
<P>
The whole naming convention is compactly summarized by defining a mount
point variable.  See section <A HREF="cfengine.html#SEC62">mountpattern</A>.  With the present scheme, this can
be defined as

</P>

<PRE>
mountpattern = ( /$(site)/$(host) )
</PRE>

<P>
so that it evaluates to the name of the host executing the file
regardless of who that may be.  This variable is used together with the
<CODE>homepattern</CODE> pattern variable, which is used to distinguish
between home directories and binary resources.  See section <A HREF="cfengine.html#SEC63">homepattern</A>.  You
can think of this as being part of the naming convention.  In this text,
we use the convention <CODE>u1 u2 u3...</CODE> for home disks.  You could
equally well use <CODE>home1 home2...</CODE> etc.  As long as the name is
unique, it doesn't matter.

</P>
<P>
The full list of named resources should now be listed in the
<CODE>mountables</CODE> list, which is simply a list of all the resources
available for mounting on the network.  See section <A HREF="cfengine.html#SEC96">mountables</A>.

</P>



<H3><A NAME="SEC33" HREF="cfengine_toc.html#TOC33">How does it work?</A></H3>
<P>
<A NAME="IDX120"></A>
<A NAME="IDX121"></A>
<A NAME="IDX122"></A>

</P>
<P>
Once you have defined your unique names, how does cfengine know what to
mount? The idea is now to define a list of servers for each class of
hosts.  See section <A HREF="cfengine.html#SEC47">binservers</A>.

</P>
<P>
Suppose we make a <CODE>binserver</CODE> declaration:

</P>

<PRE>

binservers:

  mygroup.sun4::

     einstein
     newton

</PRE>

<P>
This would tell cfengine that it should mount all binary resources from
hosts <CODE>einstein</CODE> or <CODE>newton</CODE> onto any host of type <CODE>sun4</CODE>
in the group <CODE>mygroup</CODE>.  Every filesystem which is listed in
<CODE>mountables</CODE> and is not a home directory will be mounted.
See section <A HREF="cfengine.html#SEC96">mountables</A>.

</P>
<P>
Home directories and binary resources are kept separate automatically by
cfengine, because a home directory is one whose contents-name matches
the <CODE>homepattern</CODE> pattern variable.  See section <A HREF="cfengine.html#SEC32">Unique filesystem mountpoints</A>.

</P>
<P>
A <CODE>homeserver</CODE> declaration:

</P>


<PRE>

homeservers:

  mygroup::
   
     einstein
     newton
     schwinger
     feynman
 
</PRE>

<P>
would correspondingly mean mount all the home directory resources on the
hosts in the list on all hosts in the group <CODE>mygroup</CODE>.  Clearly it
is unnecessary to distinguish between the architecture platform types of
the actual servers for user directories.

</P>
<P>
In each case, cfengine will mount filesystems, make the appropriate
directories for the mount point and edit the filesystem table.
See section <A HREF="cfengine.html#SEC65">actionsequence</A>.

</P>



<H3><A NAME="SEC34" HREF="cfengine_toc.html#TOC34">Special variables</A></H3>
<P>
<A NAME="IDX123"></A>
<A NAME="IDX124"></A>
<A NAME="IDX125"></A>
<A NAME="IDX126"></A>

</P>
<P>
Once you have mounted a resource on a unique directory, you have access
to all of the relevant filesystems on your network -- but you really
wanted the `local' filesystem to be mounted on <CODE>/usr/local</CODE>.  All
you need do now is to make a link:

</P>

<PRE>

links:

  any::

      /usr/local  -&#62; /$(site)/$(binserver)/local

</PRE>

<P>
The meaning of this is that, on any host, the directory
<CODE>/usr/local</CODE> should be a link to the `nearest' binary server's
`local' resource.  The <CODE>$(binserver)</CODE> variable can in principle
expand to any binary server in the list.  In practice, cfengine goes
through the list in order and picks the first filesystem resource which
matches.

</P>
<P>
Could this lead to a collision? Suppose we are on the host `einstein'
and we execute the above command.  The host `einstein' has a filesystem
<CODE>/physics/einstein/local</CODE> on its local disk -- it is in fact the
binary server for the network, so it certainly doesn't need to mount any
NFS filesystems.  But this is no problem because cfengine automatically
treats <CODE>$(host)</CODE> as the highest priority binary server for any
host.  That means that if you have a local filesystem, it will always
have priority.

</P>
<P>
<A NAME="IDX127"></A>
<A NAME="IDX128"></A>
<A NAME="IDX129"></A>
In contrast, if the host `schwinger' ran the command above, it would
find no local filesystem called <CODE>/physics/schwinger/local</CODE>, so it
would go along the list of defined binary servers, find `einstein' and
try again.  It will succeed in finding `einstein' <EM>provided all the
binary servers were mounted before the link command is executed</EM>.  This
means that you should structure the <CODE>actionsequence</CODE> so that all
filesystems are mounted before any links are made.

</P>
<P>
With a little practice, the cfengine model can lead to an enormous
simplification of the issue of NFS-mountable resources.

</P>
<P>
<A NAME="IDX130"></A>
NOTE: cfengine does not try to export filesystems, only mount already
exported filesystems.  If you want to automate this procedure also, you
can use the <CODE>editfiles</CODE> facility to add entries to
<TT>`/etc/exports'</TT> See section <A HREF="cfengine.html#SEC75">editfiles</A>.  In practice this is very
difficult to do and perhaps not desirable.

</P>


<H3><A NAME="SEC35" HREF="cfengine_toc.html#TOC35">Example programs for mounting resources</A></H3>

<P>
Let's write a very simple configuration for a network with only one
server called hal, where all the hosts are of the same operaing system
type.  In such an example we can avoid using classes altogether.

</P>

<PRE>

control:

  site   = ( univ )
  domain = ( univ.edu )

  actionsequence =
     (
     mountall
     mountinfo
     addmounts
     mountall
     links
     )

binservers:

   hal

homeservers:

   hal

mailserver:

   hal:/var/spool/mail

mountables:

   hal:/univ/home1
   hal:/univ/home2
   hal:/univ/local

links:

   /usr/local -&#62; /univ/local

</PRE>

<P>
In this example, we have only one type of host so the configuration is
the same for each of them: no class references are required.  If we look
through the action sequence we see that the program first mounts all the
filesystems which are already defined on each host.  It does this to be
sure that everything which is already set up to be mounted is mounted.
Let's assume that there are no problems with this.

</P>
<P>
The next thing that happens is that <CODE>mountinfo</CODE> builds a list of
the filesystems which each host has successfully mounted.  Then by
calling <CODE>addmounts</CODE> we ask cfengine to check whether the host is
missing any filesystems.  What happens is that cfengine first looks to
see what servers are defined for each host.  In this case all hosts on
the network have only one server: hal.  Hal is defined as a server for
both binary data and `home' data -- i.e.  users' home directories.  The
list <CODE>mountables</CODE> tells cfengine what filesystems are available
over the network for the server hal.  There are three filesystems which
can be mounted, called <TT>`/univ/home1'</TT>, <TT>`/univ/home2'</TT> and
<TT>`/univ/local'</TT>.  Cfengine checks to see whether each of these
filesystems is mounted and, if not, it builds the necessary directories,
edits the necessary files and mounts the filesystems.

</P>
<P>
Finally we come to <CODE>links</CODE> in the action sequence.  This tells
cfengine to look at the defined links.  There is one link defined: a
link from <TT>`/usr/local'</TT> to the mounted filesystem
<TT>`/univ/local'</TT>.  Cfengine checks and tries to make the link if
necessary.  If all goes well, each host on the network should now have
at least three filesystems mounted and a link from <TT>`/usr/local'</TT> to
<TT>`/univ/local'</TT>.

</P>

<P>
Here is another simple example program for checking and automatically
mounting an NFS based <CODE>/usr/local</CODE> and all home directories onto
all hosts on a small network.  Here we have several servers and must
therefore use some classes.

</P>

<PRE>
#
#  Mounts
#

control: 

   site      = ( mysite )
   domain    = ( mysite.country ) 
   sysadm    = ( mark ) 
   netmask   = ( 255.255.255.0 )

   actionsequence = 
      (
      mountall
      mountinfo
      addmounts
      mountall
      links
      )

   mountpattern = ( /$(site)/$(host) )
   homepattern   = ( u? )                # u1 u2 u3 etc..

groups:

   MyGroup =
      (
      host1
      host2
      binserver1
      binserver2
      )

######################################################################

homeservers:

   MyGroup:: host1

binservers:

   MyGroup.sun4::   server1
   MyGroup.ultrix:: server2

mailserver:

   host1:/usr/spool/mail

mountables:

   host1:/mysite/host1/u1
   host1:/mysite/host1/u2
   server1:/mysite/server1/local
   server2:/mysite/server2/local

##########################################################################

links:

      /usr/local  -&#62; /${site}/${binserver}/local

</PRE>

<P>
Let's suppose we run this program on host2 which is an ultrix machine.
This host belongs to the class <CODE>mygroup</CODE> and the hardclass
<CODE>ultrix</CODE>.  This tells us that its homeserver is host1, its binary
server is server2 and its mailserver is host1.  Moreover, since the
homepattern matches any filesystem ending in u-something, it recognizes
the two home directories in the mountables list -- and therefore the
two binary directories also.

</P>
<P>
The action sequence starts by mounting all of the filesystems currently
in the filesystem table <TT>`/etc/fstab'</TT>.  It then scans the list of
mounted filesystems to find out what is actually mounted.  Since the
homeserver is host1, we know that our host has to mount all
home-filesystems from this server, so it checks for
<TT>`host1:/mysite/host1/u1'</TT> and <TT>`host1:/mysite/host1/u2'</TT>.  If
they are not present they are added to <TT>`/etc/fstab'</TT><A NAME="DOCF3" HREF="cfengine_foot.html#FOOT3">(3)</A>.  Next, we know that the binary server is server1,
so we should check for <TT>`server1:/mysite/server1/local'</TT>.  The mail
server is also checked for and added if necessary.  Cfengine then tries
to mount all filesystems once again, so that the new filesystems should
be added.

</P>
<P>
Note that, in the process of adding the filesystems to
<TT>`/etc/fstab'</TT>, cfengine creates the directories up to and including
the point at which the filesystems should be mounted.  If something
prevents this -- if we try to mount on top of a plain file for instance
--- then this will result in an error.

</P>
<P>
Finally, we reach the link section and we try to expand the variables.
<CODE>$(site)</CODE> expands to <TT>`mysite'</TT>.  <CODE>$(binserver)</CODE> expands
first to the hostname (host2), but <TT>`/mysite/host2/local'</TT> does not
exist, so it then goes to the binserver list, which subsitutes server1
for the value of <CODE>$(binserver)</CODE>.  Since
<TT>`/mysite/server1/local'</TT> does exist and is now mounted, cfengine
makes a link to this directory from <TT>`/usr/local'</TT>.  The script is
then completed.

</P>
<P>
If the script is run again, everything should now be in place so nothing
happens.  If for some reason it failed the first time, it will fail
again.  At any rate it will either do the job once and for all or signal
an error which must be corrected by human intervention<A NAME="DOCF4" HREF="cfengine_foot.html#FOOT4">(4)</A>.

</P>



<H2><A NAME="SEC36" HREF="cfengine_toc.html#TOC36">Using the automounter</A></H2>
<P>
<A NAME="IDX131"></A>

</P>
<P>
The automounter is a daemon based service which replaces static mounting
of NFS filesystems with a dynamical model. When the automounter is
running, filesystems are mounted only when a user tries to access a file
which resides on one of those filesystem. After a given period (usually
five minutes) any filesystem which has not been accessed is
unmounted. The advantage of this scenario is that hanging servers do not
affect the behaviour of hosts which mount their filesystems, unless a
specific file is being accessed.  In both cases, filesystems must be
exported in order to be mountable.

</P>
<P>
It is not the purpose of this section to explain the use of the
automounter in detail, only to offer hints as to how cfengine can be
used to simplify and rationalize automount configuration for the already
initiated.  Let us begin by comparing the behaviour of the automounter
with the cfengine model for mounted filesystems.

</P>
<P>
The autmounter is designed to be used together with a global
configuration file, distributed by NIS (the network information
sevice). As such, all hosts read the same configuration
file. This makes it appear as though all hosts end up mounting every
filesystem in the automount configuration database, but this is not so
in practice because filesystems are only mounted if required. Thus a
system which does not require a filesystem will not attempt to mount it.
Moreover, the existence of a global configuration file does not affect
which hosts have the right to mount certain filesystems (which is specified
by exports or share on the relevant server), thus a request to mount
a non-exported filesystem will result in an access denial. The autmounter
is configured locally on each host in files named <TT>`/etc/auto_master'</TT>,
<TT>`auto_direct'</TT> etc.
<A NAME="IDX132"></A>
<A NAME="IDX133"></A>

</P>
<P>
In the cfengine static mounting scheme, you define a list of binary
and home servers. The filesystem table is modified on the basis of
these decisions, and filesystems are only added if cfengine deems it
appropriate to mount them on a given host. The idea here is to minimize
the number of filesystems mounted to those which are known to be required.
Again the issue of access permissions must be arranged separately. These
filesystems are placed directly in <TT>`/etc/fstab'</TT>, or the equivalent for
your system.

</P>
<P>
From cfengine, you can use the automounter instead of the static mount model
by

</P>

<UL>

<LI>

omitting <CODE>addmounts</CODE>, <CODE>mountinfo</CODE>, <CODE>mountall</CODE> 
from the actionsequence, in the control part
of your cfengine program,

<LI>

using <CODE>editfiles</CODE> to edit the relevant coonfiguration files
such as <TT>`/etc/auto_master'</TT>, <TT>`auto_direct'</TT> etc,

<LI>

using the <CODE>AutomountDirectResources</CODE> command in editfiles
to dump the list of cfengine class-based list of mountables
into a file of your choice in the correct format for
autmount's direct maps,

<LI>

using <CODE>processes</CODE> See section <A HREF="cfengine.html#SEC97">processes</A> to restart the autmounter
(send the hangup signal <CODE>hup</CODE>), or perhaps stop and restart
the daemon by sending the <CODE>term</CODE> signal (you should never
send the <CODE>kill</CODE> signal),

<LI>

using the multiple link facilities to link in indirect mounted
filesystems as required, and <CODE>files</CODE> or <CODE>tidy</CODE> to
clean up stale links afterwards,

<LI>

perhaps using <CODE>copy</CODE> to distribute basic automount configuration
files to multiple systems.

</UL>

<P>
The autmounter was created to solve certain problems which cfengine now
solves (in the author's opinion) better. For example, the use of the
`hosts' map in the autmounter mounts filesystems like 
<TT>`/usr/local'</TT> on different (uniquely named) mountpoints for each host
in order to avoid name space collisions. Using cfengine and a unique
naming scheme, you can achieve the same thing more cleanly, without all
of the gratuitous linking and unlinking which the automounter performs
by itself. Moreover, the idea of a unique namespace is better practice
and more in keeping with new global filesystem ideas such as AFS and DFS.
<A NAME="IDX134"></A>
<A NAME="IDX135"></A>
The only advantage of the automounter is that one avoids the annnoying
error messages from hung servers about "NFS server not responding".
In that respect, it seems sensible to use only direct mounts and a
unique name space.

</P>
<P>
<A NAME="IDX136"></A>
<A NAME="IDX137"></A>
<A NAME="IDX138"></A>
Some systems advocate grouping all users' login (home) directories
under a common directory called <TT>`/home'</TT> or <TT>`users'</TT>.
The automounter goes through all manner of contortions to achieve
this task. If you use a unique naming scheme like the one
advocated here, this is a trivial task. You simply arrange to mount
or automount all user directories, such as
<A NAME="IDX139"></A>

</P>

<PRE>
   /<VAR>site</VAR>/<VAR>host</VAR>/home1
   /<VAR>site</VAR>/<VAR>host</VAR>/home2
   ...
</PRE>

<P>
and then link them as follows:

</P>

<PRE>

   /home +&#62; /<VAR>site</VAR>/<VAR>host</VAR>/home1
   /home +&#62; /<VAR>site</VAR>/<VAR>host</VAR>/home2
   ...

</PRE>

<P>
Finally, you should be aware that the automounter does not like
to be mixed with static mount and unmount operations. Automounted
filesystems take priority over statically mounted filesystems, but
the autmounter can be confused by manually mounting or unmounting
filesystems while it is running.

</P>



<H2><A NAME="SEC37" HREF="cfengine_toc.html#TOC37">Using netgroups</A></H2>
<P>
<A NAME="IDX140"></A>
<A NAME="IDX141"></A>
<A NAME="IDX142"></A>
<A NAME="IDX143"></A>

</P>
<P>
If you use the network information service (NIS) on your local network
then you may already have defined <EM>netgroups</EM> consisting of lists
of hosts which belong to specific owners at your site.  If you have,
then you can use these groups within cfengine.  This means that you can
use the same groups in the <CODE>/etc/exports</CODE> file as you use to define
the mount groups and classes.  See section <A HREF="cfengine.html#SEC84">groups</A>.

</P>
<P>
A netgroup is a list of hostnames or user names which are registered in
the network information service (NIS) database under a specific name.
In our case we shall only be interested in lists of hostnames.

</P>
<P>
To make a netgroup you need to define a list in the file
<CODE>/etc/netgroup</CODE> on your NIS server.  If you are not the NIS
administrator, you will have to ask to have a netgroup installed.  The
form of a netgroup list of hosts is:

</P>

<PRE>

mylist-name      (host1,,) (host2,,) (host3,,) (host4,,)

norway-sun4-host (saga,,) (tor,,) (odin,,)
foes-linux-hosts (borg,,)

</PRE>

<P>
Each list item has three entries, but only the first is relevant for a
host list.  See the manual pages on netgroups for a full explanation of
the meaning of these fields.

</P>
<P>
The usefulness of netgroups is that they can be used to stand for a list
of hostnames in system files like <TT>`/etc/exports'</TT>.  This compresses
the amount of text in this file from a long list to a single name.  It
also means that if you use the same list of hosts from a netgroup inside
cfengine when defining groups and classes, you can be sure that you are
always using the same list.  In particular it means that you don't have
to update multiple copies of a list of hosts.

</P>
<P>
The netgroups can now be used in cfengine programs by using the <CODE>+</CODE>
or <CODE>@+</CODE> symbols in the <CODE>groups</CODE> section.  See section <A HREF="cfengine.html#SEC84">groups</A>.

</P>



<H2><A NAME="SEC38" HREF="cfengine_toc.html#TOC38">Files and links</A></H2>

<P>
File and link management takes several forms.
Actions are divided into three categories called
<CODE>files</CODE>, <CODE>tidy</CODE> and <CODE>links</CODE>. The first of
these is used to check the existence of, the ownership
and permissions of files. The second concerns the systematic
deletion of garbage files. The third is a link manager
which tests, makes and destroys links. The monitoring
of file access bits and ownership can be set up for
individual files and for directory trees, with controlled
recursion. Files which do not meet the specified criterea
can be `fixed' --i.e. automatically set to the correct
permissions, or can simply be brought to the attention of
the system admnistrator by a warning.
The syntax of such a command is as follows:

</P>

<PRE>

files:

  <VAR>class</VAR>::

    /<VAR>path</VAR> mode=<VAR>mode</VAR> owner=<VAR>owner</VAR> group=<VAR>group</VAR>

         recurse=<VAR>no-of-levels</VAR> action=<VAR>action</VAR>

</PRE>

<P>
The directory or file name is the point at which cfengine
begins looking for files. From this point the search for files
proceeds recursively into subdirectories with a maximum limit set by
the <CODE>recurse</CODE> directive, and various options for dealing with
symbolic links and device boundaries. The mode-string defines the
allowed filemode (by analogy with <SAMP>`chmod'</SAMP>) and the owner and group
may specify lists of acceptable user-ids and group-ids. The action
taken in response to a file which does not meet acceptable criterea is
specified in the action directive. It includes warning about or
directly fixing all files, or plain files or directories only. Safe
defaults exist for these directives so that in practice they may be
treated as options.

</P>
<P>
For example,

<PRE>
files:

  any::
       /usr/*/bin mode=a+rx,o-w own=root r=inf act=fixall

</PRE>

<P>
which (in abbreviated form) would check recursively all files and
directories starting from directories matching the wildcard 
(e.g. <TT>`/usr/local/bin'</TT>, <TT>`/usr/ucb/bin'</TT>).  By default, <CODE>fixall</CODE>
causes the permissions and ownership of the files to be fixed without
further warning. 

</P>
<P>
One problem with symbolic links is that the files they point to can
get deleted leaving a `hanging pointer'. Since cfengine can make
many hundreds of links without any effort, there is the danger that, in time,
the system could become full of links which don't point anywhere. To
comat this problem, you can set the option <CODE>links=tidy</CODE> in the files
section. If this is set, cfengine will remove any symbolic links which
do not point to existing files See section <A HREF="cfengine.html#SEC76">files</A>.

</P>
<P>
The creation of symbolic links is illustrated in figure 1 and
the checking algorithm was discussed in section 2. In addition to
the creation of single links, one may also specify the creation of
multiple links with a single command. The command

</P>

<PRE>
links:

   binaryhost::

      /local/elm/bin +&#62; /local/bin

</PRE>

<P>
links all of the files in <TT>`/local/elm/bin'</TT> to corresponding
files in <TT>`/local/bin'</TT>. This provides, amongst other things, one
simple way of installing software packages in regular `bin'
directories without controlling users' PATH variable. A further
facility makes use of cfengine's knowledge of available (mounted) binary
resources to search for matches to specific links. Readers are
referred to the full documentation concerning this feature.

</P>
<P>
The need to tidy junk files has become increasingly evident during the
history of cfengine. Files build up quickly in areas like <TT>`/tmp'</TT>,
<TT>`/var/tmp'</TT>. Many users use these areas for receiving large
ftp-files so that their disk usage will not be noticed!  To give
another example, just in the last few months the arrival of
netscape World Wide Web client, with its caching
facilities, has flooded harddisks at Oslo with hundreds of megabytes of
WWW files. In addition the regular appearence of <TT>`core'</TT> files<A NAME="DOCF5" HREF="cfengine_foot.html#FOOT5">(5)</A>
and compilation by-products (<SAMP>`.o'</SAMP> files and <SAMP>`.log'</SAMP> files
etc.) fills disks with large files which many users do not understand.
The problem is easily remedied by a few lines in the cfengine
configuration. Files can be deleted if they have not been accessed for
n-days. Recursive searches are both possible and highly practical
here. In following example:

</P>

<PRE>
tidy:

   AllHomeServers::

      home                 pattern=core       r=inf age=0
      home/.wastebacket    pattern=*          r=inf age=14
      home/.netscape-cache pattern=cache????* r=inf age=2
      home/.MCOM-cache     pattern=cache????* r=inf age=2
      home/.netscape       patern=cache????*  r=int age=2

</PRE>

<P>
all hosts in the group <SAMP>`AllHomeServers'</SAMP> are instructed to
iterate over all users' home directories (using the wildcard
<CODE>home</CODE>) and look for files matching special patterns.
Cfengine tests the <EM>access time</EM> of files and deletes
only files older than the specified limits. Hence all core
files, in this example, are deleted immediately, whereas files in the
subdirectory <TT>`.wastebasket'</TT> are deleted
only after they have lain there untouched for 14 days, and so on.

</P>
<P>
<A NAME="IDX144"></A>
<A NAME="IDX145"></A>

</P>
<P>
As a system administrator you should, of course, exercise great caution
when making rules which can delete users' files.  A single slip of the
hand can result in a rule which will irretreivably delete files.

</P>
<P>
When making a `tidy' strategy you should probably coordinate with your
backup policy.  You should not delete files until after you have taken a
backup, so that -- if the worst should happen -- you are covered
against possible accidents.

</P>
<P>
Cfengine helps to some extent to keep track of what files it deletes.
When tidying users' home directories it creates a log file of all files
which were deleted on the last tidy operation.  This log is called
<CODE>~/.cfengine.rm</CODE>.

</P>
<P>
You might consider tidying certain files only once a week, in which case
a command such as

</P>

<PRE>

tidy:

   AllHomeServers.Sunday::

       <VAR>files to tidy</VAR>

</PRE>

<P>
could be useful.  Nonsense files, such as `core' files could be tidied every night.

</P>
<P>
<A NAME="IDX146"></A>
<EM>NOTE! Be careful when telling cfengine to delete core files.  If
you write a wildcard like <CODE>core*</CODE>, then you could risk deleting
important system files such as <CODE>core.h</CODE>.</EM>

</P>


<H2><A NAME="SEC39" HREF="cfengine_toc.html#TOC39">Log files written by cfengine</A></H2>
<P>
<A NAME="IDX147"></A>
<A NAME="IDX148"></A>
<A NAME="IDX149"></A>
<A NAME="IDX150"></A>

</P>
<P>
Cfengine keeps two kinds of logfile.  The first is kept for every user
(every subdirectory of a home directory filesystem).  A file
<CODE>~/.cfengine.rm</CODE> keeps a list of all the files which were deleted
during the last pass of the <CODE>tidy</CODE> function.  This is useful for
users who want to know files have been removed without their blessing.

</P>
<P>
<A NAME="IDX151"></A>
Another file is built when cfengine searches through file trees in the
<CODE>files</CODE> action.  This is a list of all programs which are setuid
root, or setgid root.  Since such files are a potential security risk,
cfengine always prints a warning when it encounters a new one (one which
is not already in its list).  This allows the system administrator to
keep a watchful eye over new programs which appear and give users root
access.  The cfengine log is called <CODE>/etc/cfengine.log</CODE>.  The file
is not readable for general users.
<A NAME="IDX152"></A>
<A NAME="IDX153"></A>

</P>
<P>
<A NAME="IDX154"></A>
Cfengine keeps its current process identifier in <CODE>/etc/cfengine.pid</CODE>.

</P>



<H2><A NAME="SEC40" HREF="cfengine_toc.html#TOC40">Copying files</A></H2>

<P>
The administration of a system often requires the copying of files. The
reason for this is usually that we would like to distribute a copy of a
particular file, from some master location and ensure that all of the
copies are up to date. Another use for this is to install software from
one directory (perhaps on a CD ROM) to another.

</P>
<P>
Cfengine helps this process by allowing you to copy a single file or a
file tree, from one directory to another, perhaps checking the
permissions and owners of a file to adjust the copies in some special
way. The files are checked by cfengine using one of two methods.

</P>

<UL>

<LI>

A date-stamp comparison with a master file, using last-change times, can
be used to tell cfengine to recopy a file from the master if the master
file is newer than the copy.

<LI>

An MD5 checksum can be computed for each file and compared with one for
the master file. If the contents of the copy file differs in any way from
the master, the file will be re-copied.

</UL>

<P>
Cfengine allows you to do the following

</P>

<UL>

<LI>

Copy a single file to another file in a different location, perhaps with a
new name, new permissions and a different owner.

<LI>

Copy a single file to all users on the system, changing the owner of the
file for each user automatically. (This could be used to distribute and
update standard setup files.)

<LI>

Recursively copy an entire file tree, omitting files which match a list
of wildcard-patterns, or linking certain files instead of copying.

</UL>

<P>
You can find out more about copying in the reference section See section <A HREF="cfengine.html#SEC71">copy</A>.

</P>



<H2><A NAME="SEC41" HREF="cfengine_toc.html#TOC41">Iterating over lists</A></H2>

<P>
Shell list variables are normally defined by joining together a list
of directories using a concatenation character such as <SAMP>`:'</SAMP>. A
typical example of this is the PATH variable:

</P>

<PRE>

PATH=/usr/bin:/usr/local/bin:/usr/sbin

</PRE>

<P>
It is convenient to be able to use such variables to force cfengine to
iterative over a list. This gives us a compact way of writing repeated
operations and it allows a simple method of communication with the shell
environment. For security reasons, iteration is supported only in the
following contexts:

</P>


<UL>

<LI>

in the `to' field of a multiple link action,

<LI>

in the `from' field of a copy action,

<LI>

in the directory field of a tidy action,

<LI>

in the directory field of the files action,

<LI>

in the ignore action.

</UL>

<P>
This typically allows communication with PATH-like 
environment variables in the shell.
<A NAME="IDX155"></A>
<A NAME="IDX156"></A>
<A NAME="IDX157"></A>
<A NAME="IDX158"></A>

</P>
<P>
In these contexts, any variable which has the form of
a list joined together by colons will be iterated over
at compilation time. Note that you can change the value
of the list separator using the <CODE>split</CODE> variable
in the control section of the program See section <A HREF="cfengine.html#SEC58">split</A>.

</P>
<P>
For example, to link all of the binary files in the PATH
environment variable to a single directory, tidying
dead links in the process, you would
write

</P>

<PRE>

control:

  actionsequence = ( links tidy )

links:

  /allbin +&#62; $(PATH)

tidy:

  # Hopefully no-match matches nothing

  /allbin pattern=no-match age=0 links=tidy

</PRE>

<P>
<VAR>no-match</VAR> is not a reserved word in cfengine, this is
just a string you do not expect to match any file.

</P>
<P>
Alternatively, you might want to define an internal list using
a space as a separator:
<A NAME="IDX159"></A>

</P>

<PRE>

control:

   split = ( " " )

   mylist = ( "mark ricky bad-dude" )

tidy:

   /mnt/home1/$(mylist) pattern=*.cfsaved age=1

</PRE>

<P>
This example iterates the tidy action over the directories <TT>`/mnt/home1/mark'</TT>,
<TT>`/mnt/home1/ricky'</TT> and <TT>`/mnt/home1/bad-dude'</TT>. 

</P>
<P>
The number of list variables in any path or filename should normally be
restricted to one or two, since the haphazard combination of two lists
will seldom lead to any meaningful pattern.  The only obvious exception
is perhaps to iterate over a common set of child-directories like
<TT>`bin'</TT>, <TT>`lib'</TT> etc in several different package directories.
<A NAME="IDX160"></A>
<A NAME="IDX161"></A>
<A NAME="IDX162"></A>

</P>



<H2><A NAME="SEC42" HREF="cfengine_toc.html#TOC42">Editing Files</A></H2>

<P>
One of the characteristics of BSD/System 5 systems is that they are
configured primarily by human-readable textfiles. This makes it easy for
humans to configure the system and it also simplifies the automation of
the procedure.  Most configuration files are line-based text files, a
fact which explains the popularity of, for example, the Perl programming
language.  Cfengine does not attempt to compete with Perl or
its peers. Its internal editing functions operate at a higher level
which are designed for transparency rather than flexibilty.  Fortunately
most editing operations involve appending a few lines to a file,
commenting out certain lines or deleting lines.

</P>
<P>
An example of the use of these is the following. Each new GNU/Linux
installation contains a line in the start-up scripts which deletes the
contents of the `message of the day' file each time the system boots.
On a system which boots often this would be irritating.  This line could
be commented out for every GNU/Linux system on the network with a simple
command:

</P>

<PRE>

editfiles:

   linux::

      { /etc/rc.d/rc.S

      HashCommentLinesContaining "motd"
      }

</PRE>

<P>
Commands containing the word `Comment' are used to `comment out' certain
lines from a textfile--i.e. render a line impotent without actually
deleting it. Three types of comment were supported originally: shell
style (hash) <SAMP>`#'</SAMP>, <SAMP>`%'</SAMP> as used in TeX and on AIX systems, and
C++-style <SAMP>`//'</SAMP>.

</P>
<P>
A more flexible way of commenting is now possible, using directives
which first define strings which signify the start of a comment and the
end of a comment. A single command can then be used to render a comment.
Th default values of the comment-start string is <SAMP>`# '</SAMP> and
the default comment-end string is the empty string.
For instance, to define C style comments you could write:

</P>

<PRE>

  { <VAR>file</VAR>

  SetCommentStart "/* "
  SetCommentEnd   " */"

  # Comment out all lines containing printf!

  CommentLinesMatching ".*printf.*"
  }

</PRE>

<P>
Other applications for these editing commands include
monitoring and controlling root-access to hosts by editing files such as
<TT>`.rhosts'</TT> and setting up standard environment variables in
global shell resource files-- for example, to set the timezone.

</P>
<P>
Files are loaded into cfengine and edited in memory. They are
only saved again if modifications to the file are carried out,
in which case the old file is preserved by adding a suffix
to the filename. When files are edited, cfengine generates a
warning for the administrator's inspection so that the reason
for the change can be investigated.

</P>
<P>
The behaviour of cfengine should not be confused with that of <EM>sed</EM>
or <EM>perl</EM>.  Some functionality is reproduced for convenience, but
the specific functions have been chosen on the basis of (i) their
readability and (ii) the fact that they are
`frequently-required-functions'. A typical file editing session involves
the following points:

</P>

<UL>
<LI>Load file into memory.

<LI>Is the size of the file within sensible user-definable limits?

If not, file could be binary, refuse to edit.
<LI>Check each editing command and count the number of edits made.

<LI>If number of edits is greater than zero, rename the old file

and save the edited version in its place. Inform about the edit.
<LI>If no edits are made, do nothing, say nothing.

</UL>

<P>
Equivalent one-line sed operations involve editing the same file
perhaps many times to achieve the same results--without the
safety checks in addition.

</P>
<P>
NOTE: an extremely powerful feature of cfengine is the ability to
edit a similar file belonging to every user in the system. For example,
as a system administrator, you sometimes need to ensure that users
have a sensible login environment. Changes in the system might require
all users to define a new environment variable, for instance. This is
achieved the with <CODE>home</CODE> pseudo-wildcard. If one writes

</P>

<PRE>

  { home/.cshrc

  AppendIfNoSuchLine "# Sys admin/cfengine: put next line here"
  AppendIfNoSuchLine "setenv PRINTER newprinter"
  }

</PRE>

<P>
then the users' files are checked one-by-one for the given lines of
text, and edited if necessary.

</P>



<H2><A NAME="SEC43" HREF="cfengine_toc.html#TOC43">Disabling and the file repository</A></H2>

<P>
The existence of certain files can compromise the integrity of your
system and you may wish to ensure that they do not exist. For example,
some manufacturers sell their workstations with a <SAMP>`+'</SAMP> symbol in
the file <TT>`/etc/hosts.equiv'</TT>.
<A NAME="IDX163"></A>
This means that anyone in your NIS domain has password free access
to the system!! Since this is probably not a good idea, you will
want to disable this file by renaming it, or simply deleting it.

</P>

<PRE>

  disable:

     /etc/hosts.equiv

</PRE>

<P>
Other files compromise the system because they grow so large that they
fill an entire disk partition. This is typically true of log files such as
the system 5 files <TT>`/var/adm/wtmpx'</TT> and
<TT>`/var/lp/logs/lpsched'</TT>. Other files like <VAR>/var/adm/messages</VAR>
get "rotated" by the system so that they do not grow so large as to
fill the disk. You can make cfengine rotate these files too, by
writing
<A NAME="IDX164"></A>
<A NAME="IDX165"></A>

</P>

<PRE>

disable:

    Sunday::

    /var/lp/logs/lpsched  rotate=3

</PRE>

<P>
Now, when cfengine is run, it renamed the file <TT>`lpsched'</TT> to
a file called <TT>`lpsched.1'</TT>. It also renames <TT>`lpsched.1'</TT>
as <TT>`lpsched.2'</TT> and so on, until a maximum of 3 files are
kept. After passing 3, the files `fall off the end' and
are deleted permanently. This procedure prevents any log files
from growing too large. If you are not interested in keeping
back-logs, then you may write <CODE>rotate=empty</CODE> and cfengine
will simply empty the log file.
<A NAME="IDX166"></A>
<A NAME="IDX167"></A>

</P>
<P>
When ever cfengine disables a file (<CODE>disable</CODE> or <CODE>links</CODE> with
the <SAMP>`!'</SAMP>  operator), or saves a new file on top of an old one
(<CODE>copy</CODE> or <CODE>editfiles</CODE>), it makes a backup of the
original. Usually disabled files are renamed by appending the string
<TT>`.disabled'</TT> the the filename; copied files are saved by appending
the string <TT>`.cfsaved'</TT>. It is possible to switch off backup file
generation in the copy feature by setting the variable
<CODE>backup=false</CODE>, but a better way of managing disabled and backed-up
files is to use a directory in which you collect all such files for the
whole system. This directory is called the file repository and is set in
the control part of the program, as follows:

</P>

<PRE>

  control:

     repository = ( <VAR>directory-name</VAR> )
</PRE>

<P>
If this variable is defined, cfengine collects all backup and disabled files
(except for rotated files) in this directory, using a unique pathname.
You can then inspect these files in the repository and arrange to tidy
the repository for old files which are no longer interesting.

</P>



<H2><A NAME="SEC44" HREF="cfengine_toc.html#TOC44">Running user scripts</A></H2>

<P>
Above all, the aim of cfengine is to present a simple interface to
system administrators. The actions which are built into the engine are
aimed at solving the most pressing problems, not at solving every
problem.  In many cases administrators will still need to write
scripts to carry out more specific tasks. These scripts can still be
profitably run from cfengine. Variables and macros defined in cfengine
can be passed to scripts so that scripts can make maximal advantage of
the class based decisions. Also note that, since the days of the week
are also classes in cfengine, it is straightforward to run weekly
scripts from the cfengine environment (assuming that the configuration
program is executed daily). An obvious use for this is to update
databases, like the fast-find database one day of the week, or to run
quota checks on disks.

</P>

<PRE>
shellcommands:

   myhost.Sunday::

      "/usr/bin/find/updatedb"

</PRE>

<P>
Cfengine scripts can be passed variables using normal variable
substitution:

</P>

<PRE>
control:

   cfbin     = ( /local/gnu/lib/cfengine/bin )
   backupdir = ( /iu/dax/backup )   

shellcommands:
  
  "$(cfbin)/cfbackup -p -f $(backupdir) -s /iu/nexus/u1"

</PRE>

<P>
If you need to write a particularly complex script to expand cfengine's
capabilities, it might be useful to have full access to the defined
classes. You can do this in one of two ways:

</P>

<UL>

<LI>

Pass the variable <CODE>$(allclasses)</CODE> to the script. This contains a
list of all classes in the form of a string 


<PRE>

      CFALLCLASSES=<VAR>class1</VAR>:<VAR>class2</VAR>:...

</PRE>

This variable always contains an up to date list of the defined
classes.

<LI>

Use the command line option <SAMP>`-u'</SAMP> or <SAMP>`--use-env'</SAMP>. When this
is defined, cfengine defines an internal environment variable
called <SAMP>`CFALLCLASSES'</SAMP> which contains the same list as above.
Unfortunately, system 5 boxes don't seem to like having to update
an environment variable continuously and tend to dump core, so
this is not the default behaviour!

</UL>

<P>
          
    

</P>


<H2><A NAME="SEC45" HREF="cfengine_toc.html#TOC45">Managing processes</A></H2>

<P>
Cfengine allows you to check for the existence of processes on your
system, send those processes signals (such as kill) and perhaps
restart those processes. Typical applications for this are sending
<TT>`cron'</TT> and <TT>`inetd'</TT> the HUP signal, after editing their
configuration files, or killing unwanted processes (such as user
programs which hog the system at peak usage times).

</P>
<P>
You can read more about this in the reference section See section <A HREF="cfengine.html#SEC97">processes</A>.

</P>



<H1><A NAME="SEC46" HREF="cfengine_toc.html#TOC46">Command reference</A></H1>

<P>
In this section you will find each facet of a cfengine program listed
together with an appropriate explanation.  The commands are presented in
alphabetical order for ease of lookup. Use this section in conjunction
with the example program See section <A HREF="cfengine.html#SEC131">Example configuration files</A>.

</P>



<H2><A NAME="SEC47" HREF="cfengine_toc.html#TOC47">binservers</A></H2>
<P>
<A NAME="IDX168"></A>
<A NAME="IDX169"></A>
<A NAME="IDX170"></A>

</P>
<P>
The <CODE>binservers</CODE> declaration need only be used if you are using
cfengine's model for mounting NFS filesystems.  This declaration informs
hosts of which other hosts on the network possess filesystems containing
software (binary files) which client hosts should mount.  This includes
resources like programs in <CODE>/usr/local</CODE> and so on.  A host may have
several binary servers, since there may be several machines to which
disks are physically attached.  In most cases, on a well organized
network, there will be only one <EM>architecture server</EM> per UNIX
platform type, for instance a SunOS server, an ULTRIX server and so on.

</P>
<P>
Binary servers are defined as follows:

</P>

<PRE>

binservers:

   physics.sun4::   sunserver sunserver2
   physics.linux::  linuxserver 

</PRE>

<P>
The meaning of this declaration is the following.  All hosts of type
<CODE>sun4</CODE> which are members of the group <CODE>physics</CODE> should mount
any binaries declared in the <CODE>mountables</CODE> resource list which
belong to hosts <CODE>sunserver</CODE> or <CODE>sunserver2</CODE>.  Similarly all
<CODE>linux</CODE> machines should mount binary filesystems in the mountables
list from <CODE>linuxserver</CODE>.

</P>
<P>
Cfengine knows the difference between binaries and home directories in
the <CODE>mountables</CODE> list, because home directories match the pattern
given by <CODE>homepattern</CODE>.  See section <A HREF="cfengine.html#SEC63">homepattern</A>.  See section <A HREF="cfengine.html#SEC85">homeservers</A>.

</P>
<P>
Note that every host is a binary server for itself, so that the first
binary server (and that with highest priority) is always the current
host.  This ensures that local filesystems are always used in preference
to NFS mounted filesystems.  This is only relevant in connection with
the variable <CODE>$(binserver)</CODE>.
<A NAME="IDX171"></A>

</P>



<H2><A NAME="SEC48" HREF="cfengine_toc.html#TOC48">broadcast</A></H2>

<P>
<A NAME="IDX172"></A>
<A NAME="IDX173"></A>

</P>
<P>
This information is used to configure the network interface for each host.

</P>
<P>
Every local area network has a convention for determining which internet
address is used for broadcast requests.  Normally this is an address of
the form <CODE>aaa.bbb.ccc.255</CODE> or <CODE>aaa.bbb.ccc.0</CODE>.  The difference
between these two forms is whether all of the bits in the last number
are ones or zeroes respectively.  You must find out which convention is
used at your establishment and tell cfengine using a declaration of the
form:

</P>

<PRE>
broadcast:

  any::

     ones     # or zeros, or zeroes

</PRE>

<P>
<A NAME="IDX174"></A>
<A NAME="IDX175"></A>
<A NAME="IDX176"></A>
<A NAME="IDX177"></A>
<A NAME="IDX178"></A>

</P>
<P>
In most cases you can use the generic class <CODE>any</CODE>, since all of the
hosts on the same subnet have to use the same convention.  If your
configuration file encompasses several different subnets with different
conventions then you will need to use a more specific.

</P>
<P>
Cfengine computes the actual value of the broadcast address using the
value specified above and the netmask See section <A HREF="cfengine.html#SEC53">netmask</A>.

</P>



<H2><A NAME="SEC49" HREF="cfengine_toc.html#TOC49">control</A></H2>
<P>
<A NAME="IDX179"></A>
<A NAME="IDX180"></A>

</P>
<P>
The fundamental piece of any cfengine script or configuration file is
the control section.  If you omit this part of a cfengine script, it
will not do anything! The control section is used to define certain
variables, set default values and define the order in which the various
actions you have defined will be carried out.  Because cfengine is a
declarative or descriptive language, the order in which actions appear
in the file does not necessarily reflect the order in which they are
executed.

</P>
<P>
The control section is a sequence of declarations which looks something
like the following example:

</P>

<PRE>

control:

  site     = ( univ )
  domain   = ( univ.edu )
  sysadm   = ( admin@computing.univ.edu )
  netmask  = ( 255.255.252.0 )
  timezone = ( EDT )
  nfstype  = ( nfs )

  sensiblesize  = ( 1000 )
  sensiblecount = ( 2 )
  editfilesize  = ( 4000 )

  actionsequence =
     (
     links.some
     mountall
     links
     files
     )

  myvariable = ( something )
  mymacro    = ( somethingelse )

</PRE>

<P>
Parentheses are required when making a declaring information in cfengine.
<A NAME="IDX181"></A>
<A NAME="IDX182"></A>
<A NAME="IDX183"></A>
<A NAME="IDX184"></A>
<A NAME="IDX185"></A>
<A NAME="IDX186"></A>
<A NAME="IDX187"></A>
<A NAME="IDX188"></A>
<A NAME="IDX189"></A>
<A NAME="IDX190"></A>

</P>
<P>
The meaning of each of these lines is desribed below.

</P>



<H3><A NAME="SEC50" HREF="cfengine_toc.html#TOC50">site/faculty</A></H3>
<P>
<A NAME="IDX191"></A>
<A NAME="IDX192"></A>

</P>

<PRE>
  site    = ( <VAR>sitename</VAR> )
  faculty = ( <VAR>facultyname</VAR> )
</PRE>

<P>
This variable defines a convenient name for your site configuration.  It
is useful for making generic rules later on, because it means for
instance that you can define the name of a directory to be

</P>

<PRE>
/$(site)/$(host)/local
</PRE>

<P>
without having to redefine the rule for a specific site.  This is a
handy trick for making generic rules in your files which can be imported
into a configuration for any site.

</P>
<P>
<CODE>faculty</CODE> is a synonym for <CODE>site</CODE>.  The two names
may be used interchangeably.

</P>



<H3><A NAME="SEC51" HREF="cfengine_toc.html#TOC51">domain</A></H3>
<P>
<A NAME="IDX193"></A>
<A NAME="IDX194"></A>

</P>

<PRE>
  domain = ( <VAR>domain name</VAR> )
</PRE>

<P>
This variable defines the domainname for your site.  You must define it
here, because your system might not know its domainname when you run
cfengine for the first time.  The domainname can be used as a cfengine
variable subsequently by referring to $(domain).  The domainname
variable is used by the action <CODE>resolve</CODE>.

</P>



<H3><A NAME="SEC52" HREF="cfengine_toc.html#TOC52">sysadm</A></H3>
<P>
<A NAME="IDX195"></A>
<A NAME="IDX196"></A>

</P>

<PRE>
   sysadm = ( <VAR>mail address</VAR> )
</PRE>

<P>
The mail address of your system adminstrator should be placed here.
This is used in two instances.  If cfengine is invoked with the option
<CODE>-a</CODE>, then it simply prints out this value.  This is a handy
feature for making scripts.  See section <A HREF="cfengine.html#SEC125">Using the help scripts</A>.

</P>
<P>
The adminstrators mail adress is also written into the personal log
files which cfengine creates for each user after tidying files, so you
should make this an address which users can mail if they have troubles.

</P>



<H3><A NAME="SEC53" HREF="cfengine_toc.html#TOC53">netmask</A></H3>
<P>
<A NAME="IDX197"></A>
<A NAME="IDX198"></A>

</P>

<PRE>
   netmask = ( <VAR>aaa.bbb.ccc.ddd</VAR> )
</PRE>

<P>
The netmask variable defines the partitioning of the subnet addresses on
your network.  Its value is defined by your network administrator.  On
most systems it is likely to be <CODE>255.255.255.0</CODE>.  This is used to
configure the network interface in <CODE>netconfig</CODE>.
See section <A HREF="cfengine.html#SEC65">actionsequence</A>.

</P>

<P>
<A NAME="IDX199"></A>
<A NAME="IDX200"></A>
<A NAME="IDX201"></A>
<A NAME="IDX202"></A>
<A NAME="IDX203"></A>
Every host on the internet has its own unique address.  The addresses
are assigned hierachically.  Each network gets a <EM>domain name</EM> and
can attach something like 65,000 hosts to that network.  Since this is
usually too many to handle in one go, every such network may be divided
up into subnets.  The administrator of the network can decide how the
division into subnets is made.  The decision is a trade-off between
having many subnets with few hosts, or many hosts on few subnets.  This
choice is made by setting the value of a variable called <CODE>netmask</CODE>.
The netmask looks like an internet address.  It takes the form:

</P>

<PRE>

   aaa.bbb.ccc.mmm

</PRE>

<P>
The first two numbers <SAMP>`aaa.bbb'</SAMP> are the address of the domain.  The
renmainder <SAMP>`ccc.mmm'</SAMP> specifies both the subnet and the hostname.
The value of <CODE>netmask</CODE> tells all hosts on the network: how many of
the bits in the second half label different subnets and how many label
different hosts on each of the subnets?

</P>
<P>
The most common value for the netmask is <SAMP>`255.255.255.0'</SAMP>.  It is
most helpful to think of the netmask in terms of bits.  Each base-10
number between 0-255 represents 8 bits which are either set or not set.
Every bit which is set is a network address and every bit which is zero
is part of a host address.  The first two parts of the address
<SAMP>`255.255'</SAMP> always takes these values.  If the third number is
<SAMP>`255'</SAMP>, it means that the domain is divided up into 256 sub networks
and then the remaining bits which are zero can be used to give 255
different host addresses on each of the subnets.

</P>
<P>
If the value had been <SAMP>`255.255.255.254'</SAMP>, the network would be
divided up into @math{2^15} subnets, since fifteen of the sixteen bits
are one.  The remaining bit leaves enough room for two addresses 0 and
1.  One of those is reserved for <EM>broadcasts</EM> to all hosts, the
other can be an actual host -- there would only be room for one host
per subnet.  This is a stupid example of course, the main point with the
subnet mask is that it can be used to trade subnets for hosts per
subnet.  A value of <SAMP>`255.255.254.0'</SAMP> would allow 128 different
subnets with @math{2*256-1 = 511} hosts on each.

</P>
<P>
We needn't be concerned with the details of the netmask here.  Suffice
it to say that its value is determined for your entire domain by the
network administrator and each host has to be told what the value is.

</P>
<P>
Each host must also know what convention is used for the <EM>broadcast
address</EM>.  This is an address which hosts can send to if they wish to
send a message to every other host on their subnet simultanously.  It is
used a lot by services like NIS to ask if any hosts are willing to
perform a particular service.  There are two main conventions for the
broadcast address: address zero (all host bits are zero) and the highest
address on the subnet (all host bits are ones).  The convention can be
different on every subnet and it is decided by the network
administrator.  When you write a cfengine program you just specify the
convention used on your subnet and cfengine works out the value of the
broadcast address from the netmask and the host address
See section <A HREF="cfengine.html#SEC48">broadcast</A>.  Cfengine works out the value of the broadcast address
using the value of the netmask.

</P>



<H3><A NAME="SEC54" HREF="cfengine_toc.html#TOC54">timezone</A></H3>


<PRE>
   timezone = ( <VAR>3-character timezone</VAR> )
</PRE>

<P>
The timezone variable is a character string which defines your local
timezone.  Currently only the first three characters of this string are
checked against the timezone which cfengine manages to glean from the
system.  If a mismatch is detected a warning message is printed.
cfengine does not attempt to configure the timezone.  This feature works
only as a reminder, since the timezone should really be set once and for
all at the time the system is installed.  On some systems you can set
the timezone by editing a file, a procedure which you can automate with
cfengine See section <A HREF="cfengine.html#SEC75">editfiles</A>.

</P>
<P>
The value of the <CODE>timezone</CODE> can be accessed by variable substition
in the usual way:

</P>

<PRE>
shellcommands:

       "echo ${timezone} | mail ${sysadm}"

</PRE>



<H3><A NAME="SEC55" HREF="cfengine_toc.html#TOC55">nfstype</A></H3>
<P>
<A NAME="IDX204"></A>
<A NAME="IDX205"></A>
<A NAME="IDX206"></A>

</P>

<PRE>
   nfstype = ( <VAR>nfs-type</VAR> ) 
</PRE>

<P>
This variable is included only for future expansion.  If you do not
define this variable, its value defaults to "nfs".

</P>
<P>
At present cfengine operates only with NFS (the network file system).
When cfengine looks for network file systems to mount, it adds lines in
the filesystem table (<SAMP>`/etc/fstab'</SAMP>,<SAMP>`/etc/checklist'</SAMP> etc.)  to
try to mount filesystems of type "nfs".  In principle you might want
to use a completely different system for mounting filesystems over the
network, in which case the `mount type' would not be "nfs" but
something else.

</P>
<P>
At the time of writing certain insititutions are replacing NFS with AFS
(the Andrew filesystem) and DFS (from the distributed computing
environment).  The use of these filesystems really excludes the need to
use the mount protocol at all.  In other words if you are using AFS or
DFS, you don't need to use cfengine's mounting commands at all.
<A NAME="IDX207"></A>
<A NAME="IDX208"></A>
<A NAME="IDX209"></A>

</P>



<H3><A NAME="SEC56" HREF="cfengine_toc.html#TOC56">repository</A></H3>


<PRE>
   repository  = ( <VAR>directory</VAR> ) 
</PRE>

<P>
Defines a special directory where all backup and junk
files are collected. Files are assigned a unique filename
which indentifies the path from which they originate.
This affects files saved using <CODE>disable</CODE>, <CODE>copy</CODE>,
<CODE>links</CODE> and <CODE>editfiles</CODE> See section <A HREF="cfengine.html#SEC43">Disabling and the file repository</A>.

</P>



<H3><A NAME="SEC57" HREF="cfengine_toc.html#TOC57">repchar</A></H3>


<PRE>
   repchar  = ( <VAR>character</VAR> ) 
</PRE>

<P>
The value of this variable determines the characters which
is used  by cfengine in creating the unique filenames
in the file repository. Normally, its value is set to <SAMP>`_'</SAMP>
and each <SAMP>`/'</SAMP> in the path name of the file is changed
to <SAMP>`_'</SAMP> and stored in the repository. If you prefer a
different character, defined it here. Note that the character
can be quoted with either single or double quotes
in order to encompass spaces etc.
<A NAME="IDX210"></A>
<A NAME="IDX211"></A>
<A NAME="IDX212"></A>

</P>



<H3><A NAME="SEC58" HREF="cfengine_toc.html#TOC58">split</A></H3>


<PRE>
   split  = ( <VAR>character</VAR> ) 
</PRE>

<P>
The value of this variable is used to define the list separator in
variables which are expected to be treated as lists. The default value
of this variable is the colon <SAMP>`:'</SAMP>.  Cfengine treats variables
containing this character as lists to be broken up and iterated over in
the following cases:

</P>

<UL>

<LI>

in the `to' field of a multiple link action,

<LI>

in the `from' field of a copy action,

<LI>

in the directory field of a tidy action,

<LI>

in the directory field of the files action,

<LI>

in the ignore action.

</UL>

<P>
This typically allows communication with PATH-like 
environment variables in the shell.
<A NAME="IDX213"></A>
<A NAME="IDX214"></A>
<A NAME="IDX215"></A>
<A NAME="IDX216"></A>

</P>



<H3><A NAME="SEC59" HREF="cfengine_toc.html#TOC59">sensiblesize</A></H3>
<P>
<A NAME="IDX217"></A>
<A NAME="IDX218"></A>

</P>

<PRE>
   sensiblesize  = ( <VAR>size</VAR> ) 
</PRE>

<P>
This variable is used by the action <CODE>required</CODE>.  It defines for
cfengine what you consider to be the minimum size for a `required' file.
If you declare a file as being required, cfengine will check to see if
the file exists.  Of course, the file may exist but be empty, so the
size of the file is also checked against this constant.  If the file is
smaller than the value of <CODE>sensiblesize</CODE> a warning is issued.  The
default value for this variable is 1000 bytes.

</P>



<H3><A NAME="SEC60" HREF="cfengine_toc.html#TOC60">sensiblecount</A></H3>
<P>
<A NAME="IDX219"></A>
<A NAME="IDX220"></A>

</P>

<PRE>
   sensiblecount  = ( <VAR>count</VAR> ) 
</PRE>

<P>
This variable is used by the action <CODE>required</CODE>.  It defines for
cfengine what you consider to be the minimum number of files in a
`required' directory.  If you declare a directory as being required,
cfengine will check to see if it exists.  Then, if the directory
contains fewer than the value of <CODE>sensiblecount</CODE> files, a warning
is issued.  The default value for this variable is 2.

</P>



<H3><A NAME="SEC61" HREF="cfengine_toc.html#TOC61">editfilesize</A></H3>
<P>
<A NAME="IDX221"></A>
<A NAME="IDX222"></A>

</P>

<PRE>
   editfilesize  = ( <VAR>size</VAR> ) 
</PRE>

<P>
This variable is used by cfengine every time it becomes necessary to
edit a file.  Since file editing applies only to text files, the files
are probably going to be relatively small in most cases.  Asking to edit
a very large (perhaps binary) file could therefore be the result of an
error.

</P>
<P>
A check is therefore made as a security feature.  Cfengine will refuse
to edit a file which is larger than the value of <CODE>editfilesize</CODE> in
bytes.  This is to prevent possible accidents from occurring.  The
default value for this variable is 1000 bytes.  If you don't like this
feature, simply set the value to be a very large number.

</P>



<H3><A NAME="SEC62" HREF="cfengine_toc.html#TOC62">mountpattern</A></H3>
<P>
<A NAME="IDX223"></A>
<A NAME="IDX224"></A>
<A NAME="IDX225"></A>

</P>

<PRE>
   mountpattern  = ( <VAR>mount-point</VAR> ) 
</PRE>

<P>
The <CODE>mountpattern</CODE> list is used by the cfengine model for
mounting nfs filesystems.  See section <A HREF="cfengine.html#SEC30">Cfengine's model for NFS-mounted filesystems</A>.  
It is also used in the evaluation of the pseudo variable
<CODE>home</CODE>, See section <A HREF="cfengine.html#SEC76">files</A>, section <A HREF="cfengine.html#SEC101">tidy</A>.

</P>
<P>
It is used together with the value of <CODE>homepattern</CODE> to locate and
identify what filesystems are local to a given host and which are
mounted over the network.  For this list to make sense you need to
stick to a rigid convention for mounting your filesystems under a single
naming scheme as described in the section mentioned above.  If you
follow the recommended naming scheme then you will want to set the value
of mountpattern to

</P>

<PRE>
mountpattern = ( /$(site)/$(host) )
</PRE>

<P>
which implies that cfengine will look for local disk partitions under a
unique directory given by the name of the host and site.  Any
filesystems which are physically located on the current host lie in this
directory.  All mounted filesystems should lie elsewhere. If you
insist on keeping mounted file systems in more than one location, you
can make a list like this:

</P>

<PRE>
mountpattern = ( /$(site)/users /$(site)/projects )
</PRE>



<H3><A NAME="SEC63" HREF="cfengine_toc.html#TOC63">homepattern</A></H3>
<P>
<A NAME="IDX226"></A>
<A NAME="IDX227"></A>
<A NAME="IDX228"></A>

</P>

<PRE>
   homepattern  = ( <VAR>list of wildcards</VAR> ) 
</PRE>

<P>
The <CODE>homepattern</CODE> variable is used by the cfengine model for
mounting nfs filesystems.  See section <A HREF="cfengine.html#SEC30">Cfengine's model for NFS-mounted filesystems</A>.  
It is also used in the evaluation of the pseudo variable
<CODE>home</CODE>, See section <A HREF="cfengine.html#SEC76">files</A>, section <A HREF="cfengine.html#SEC101">tidy</A>.

</P>
<P>
<CODE>homepattern</CODE> is in fact a list and is used like a wildcard or
<EM>pattern</EM> to determine which filesystems in the list of mountables
are home directories.  See section <A HREF="cfengine.html#SEC96">mountables</A>.  This relies on your sticking
to a rigid naming convention as described in the first reference above.

</P>
<P>
For example, you might wish to mount (or locate directly if you are not
using a separate partition for home directories) your home directories
under <CODE>mountpattern</CODE> in directories <CODE>u1</CODE>, <CODE>u2</CODE> and so on.
In this case you would define <CODE>homepattern</CODE> to match these numbers:

</P>
<P>
<A NAME="IDX229"></A>
<A NAME="IDX230"></A>

<PRE>
homepattern = ( u? )
</PRE>

<P>
Cfengine now regards any directory matching
<CODE>$(mountpattern)/u?</CODE> as being a user login directory.

</P>
<P>
Here is another example in which you split up a single partition into
subdirectories.  Suppose you want to create mount home directories under
<CODE>$(mountpattern)/home</CODE> and make subdirectories for staff and
students.  Then you would write:

</P>

<PRE>
homepattern = ( home/staff home/students )
</PRE>

<P>
Or you could combine the two:

</P>

<PRE>
homepattern = ( u?/staff u?/students )
</PRE>



<H3><A NAME="SEC64" HREF="cfengine_toc.html#TOC64">addclasses</A></H3>
<P>
<A NAME="IDX231"></A>
<A NAME="IDX232"></A>
<A NAME="IDX233"></A>
<A NAME="IDX234"></A>

</P>

<PRE>
   addclasses  = ( <VAR>list of identifiers</VAR> ) 
</PRE>

<P>
The <CODE>addclasses</CODE> directive is used to define a list of class
attributes for the current host.  Normally only the hard classes defined
by the system are `true' for a given host.  It is convenient though to
be able to define classes of your own to label certain actions, mainly
so that they can later be excluded so as to cut short or filter out
certain actions.  This can be done in two ways.  See section <A HREF="cfengine.html#SEC65">actionsequence</A>.

</P>
<P>
To define a list of classes for the current session, you write:

</P>

<PRE>
addclasses = ( exclude shortversion )
</PRE>

<P>
This is equivalent to (though more permanent than) defining
classes on the command line with the <CODE>-D</CODE> option.  
<A NAME="IDX235"></A>
<A NAME="IDX236"></A>
<A NAME="IDX237"></A>
You can now use these to qualify actions.  For example

</P>

<PRE>

  any.exclude::
      ...
</PRE>

<P>
Under normal circumstances <CODE>exclude</CODE> is always true -- because you
have defined it to be so, but you can <EM>undefine</EM> it in two ways so
as to prevent the action from being carried out.  One way is to undefine
a class on the command line when you invoke cfengine:
<A NAME="IDX238"></A>
<A NAME="IDX239"></A>

</P>

<PRE>
host#  cfengine -N exclude
</PRE>

<P>
or

</P>

<PRE>
host#  cfengine -N exclude.shortversion

host#  cfengine -N a.b.c.d
</PRE>

<P>
These commands run cfengine with the named classes <EM>undefined</EM>.
That means that actions labelled with these classes are excluded during
that run.

</P>
<P>
Another way to restrict classes is to add a list of classes to be
undefined in the actionsequence.  See next section.

</P>



<H3><A NAME="SEC65" HREF="cfengine_toc.html#TOC65">actionsequence</A></H3>
<P>
<A NAME="IDX240"></A>
<A NAME="IDX241"></A>

</P>
<P>
The action sequence determines the order in which collective actions are
carried out.  Here is an example containing the full list of
possibilities:

</P>

<PRE>
   actionsequence = 
      (
      mountall               # mount filesystems in fstab
      mountinfo              # scan mounted filesystems
      checktimezone          # check timezone
      netconfig              # check net interface config
      resolve                # check resolver setup
      unmount                # unmount any filesystems
      shellcommands          # execute shell commands
      editfiles              # edit files
      addmounts              # add new filesystems to system
      directories            # make any directories
      links                  # check and maintain links
      mailcheck              # check mailserver
      mountall               # (again)
      required               # check required filesystems
      tidy                   # tidy files
      disable                # disable files
      files                  # check file permissions 
      copy                   # make a copy/image of a master file
      processes              # signal / check processes
      )

</PRE>

<P>
<A NAME="IDX242"></A>
<A NAME="IDX243"></A>
<A NAME="IDX244"></A>
<A NAME="IDX245"></A>
<A NAME="IDX246"></A>
<A NAME="IDX247"></A>
<A NAME="IDX248"></A>
<A NAME="IDX249"></A>
<A NAME="IDX250"></A>
<A NAME="IDX251"></A>
<A NAME="IDX252"></A>
<A NAME="IDX253"></A>
<A NAME="IDX254"></A>
<A NAME="IDX255"></A>
<A NAME="IDX256"></A>
<A NAME="IDX257"></A>
<A NAME="IDX258"></A>

</P>
<P>
Here is a more complete description of the meaning of these
keywords.

</P>
<DL COMPACT>

<DT><CODE>addmounts</CODE>
<DD>
causes cfengine to compute which NFS filesystems are missing from the
current host and add them. This includes editing the filesystem table,
creating the mount-directory, if required.  This command relies on
information provided by <CODE>mountinfo</CODE>, so it should normally only be
called after <CODE>mountinfo</CODE>. If the filesystem already appears
to be in the filesystem table, a warning is issued.

<DT><CODE>checktimezone</CODE>
<DD>
runs a check on the timezone defined for the shell running
cfengine.

<DT><CODE>directories</CODE>
<DD>
executes all the commands defined under the <CODE>directories</CODE>
section of the program. It builds new directories.

<DT><CODE>disable</CODE>
<DD>
executes all the commands defined under the <CODE>disable</CODE>
section of the program.

<DT><CODE>editfiles</CODE>
<DD>
executes all the commands defined under the <CODE>editfiles</CODE>
section of the program.

<DT><CODE>files</CODE>
<DD>
executes all the commands defined under the <CODE>files</CODE>
section of the program.

<DT><CODE>links</CODE>
<DD>
executes all the commands defined under the <CODE>links</CODE>
section of the program.

<DT><CODE>mailcheck</CODE>
<DD>
tests for the presence of the NFS-mounted mail spooling directory on the
current host. The name of the mail spool directory is defined in the
<CODE>mailserver</CODE> section of the cfengine program. If the current host
is the same as the mailserver (the host which has the physical spool
directory disk) nothing is done. Otherwise the filesystem table is
edited so as to include the mail directory.
  
<DT><CODE>mountall</CODE>
<DD>
mounts all filesystems defined in the hosts filesystem table.
This causes new NFS filesystems added by <CODE>addmounts</CODE> and
<CODE>mailcheck</CODE> to be actually mounted. This should probably
be called both before <CODE>mountinfo</CODE> and after <CODE>addmounts</CODE> etc.

<DT><CODE>mountinfo</CODE>
<DD>
builds internal information about which filesystems are
presently mounted on the current host. 
Cfengine assumes that required-filesystems which are not
found need to be mounted. 

<DT><CODE>netconfig</CODE>
<DD>
checks the netmask, hostname, IP address and broadcast
address for the current host. The correct values for
the netmask and broadcast address are set if there is
an error. The defaultroute is also added to the static
routing table.

<DT><CODE>required</CODE>
<DD>
executes all the commands defined under the <CODE>required</CODE>
section of the program. It checks for the absence of
important NFS resources.

<DT><CODE>resolve</CODE>
<DD>
checks and corrects the DNS domain name and the order
of nameservers in the file <TT>`/etc/resolv.conf'</TT>.

<DT><CODE>shellcommands</CODE>
<DD>
executes all the commands defined under the <CODE>shellcommands</CODE>
section of the program.

<DT><CODE>tidy</CODE>
<DD>
executes all the commands defined under the <CODE>tidy</CODE>
section of the program.

<DT><CODE>unmount</CODE>
<DD>
executes all the commands defined under the <CODE>unmount</CODE>
section of the program. The filesystem table is edited
so as to remove the unwanted filesystems and the unmount
operation is executed.

<DT><CODE>processes</CODE>
<DD>
executes commands defined under the <CODE>processes</CODE> section
of the program.

</DL>

<P>
Under normal circumstances this coarse ordering is enough to suit most
purposes.  In some cases you might want to, say, only perform half the
link operations before mounting filesystems and then, say, perform the
remainder.  You can do this (and similar things) by using the idea of
defining and undefining classes See section <A HREF="cfengine.html#SEC21">Defining classes and making exceptions</A>.

</P>
<P>
The syntax

</P>

<PRE>

actionsequence =
   (
   links.firstpass.include
   ...
   links.secondpass
   )
</PRE>

<P>
means that cfengine first executes <CODE>links</CODE> with the classes
<CODE>firstpass</CODE> and <CODE>include</CODE> <EM>defined</EM>.  Later it executes
<CODE>links</CODE> with <CODE>secondpass</CODE> defined.  You can use this method of
adding classes to distinguish more finely the flow of control in
programs.
<A NAME="IDX259"></A>

</P>

<P>
A note about style: if you define and undefine lots of classes to do
what you want to do, you might stop and ask yourself if your
<CODE>groups</CODE> are defined as well as they should be.  See section <A HREF="cfengine.html#SEC84">groups</A>.
Programming in cfengine is about doing a lot for only a little
writing.  If you find yourself writing a lot, you are probably not going
about things in the right way.

</P>



<H3><A NAME="SEC66" HREF="cfengine_toc.html#TOC66">access</A></H3>
<P>
<A NAME="IDX260"></A>
<A NAME="IDX261"></A>

</P>
<P>
The <CODE>access</CODE> list is a list of users who are to be allowed to
execute a cfengine program.  If the list does not exist then all users
are allowed to run a program.

</P>

<PRE>
   access = ( <VAR>user1</VAR> <VAR>user2</VAR> ...  )
</PRE>

<P>
The list may consist of either numerical user identifiers or valid
usernames from the password database.  For example:

</P>

<PRE>
   access = ( mark aurora 22 456 )
</PRE>

<P>
would restrict a script to users mark, aurora and user id
22 and 456.

</P>



<H3><A NAME="SEC67" HREF="cfengine_toc.html#TOC67">excludelinks</A></H3>
<P>
This list is used to define a global list of names or patterns
which are to excluded from linking operations. For example

</P>

<PRE>
excludelinks = ( *~ *% core )
</PRE>

<P>
The same facility can be specified for each individual
link operation using the <CODE>exclude</CODE> option See section <A HREF="cfengine.html#SEC88">links</A>.

</P>
<P>
Note that all entries defined under a specified class
are valid only as long as that class is defined. For instance

<PRE>
  <VAR>class</VAR>::

      excludelinks = ( <VAR>pattern</VAR> )
</PRE>

<P>
would define a pattern which was only valid when
<VAR>class</VAR> is defined.

</P>



<H3><A NAME="SEC68" HREF="cfengine_toc.html#TOC68">excludecopy</A></H3>
<P>
This list is used to define a global list of names or patterns
which are to excluded from copy operations. For example

</P>

<PRE>
excludecopy = ( *~ *% core )
</PRE>

<P>
The same facility can be specified for each individual
link operation using the <CODE>exclude</CODE> option See section <A HREF="cfengine.html#SEC71">copy</A>.

</P>
<P>
Note that all entries defined under a specified class
are valid only as long as that class is defined. For instance

<PRE>
  <VAR>class</VAR>::

      excludecopy = ( <VAR>pattern</VAR> )
</PRE>

<P>
would define a pattern which was only valid when
<VAR>class</VAR> is defined.

</P>



<H3><A NAME="SEC69" HREF="cfengine_toc.html#TOC69">copylinks</A></H3>
<P>
This list is used to define a global list of names or patterns
which are to be copied rather than linked symbollically. For example

</P>

<PRE>
copylinks = ( *.config )
</PRE>

<P>
The same facility can be specified for each individual
link operation using the <CODE>copy</CODE> option See section <A HREF="cfengine.html#SEC88">links</A>.
Copying is performed using a file age comparison.

</P>
<P>
Note that all entries defined under a specified class
are valid only as long as that class is defined. For instance

<PRE>
  <VAR>class</VAR>::

      copylinks = ( <VAR>pattern</VAR> )
</PRE>

<P>
would define a pattern which was only valid when
<VAR>class</VAR> is defined.

</P>



<H3><A NAME="SEC70" HREF="cfengine_toc.html#TOC70">linkcopies</A></H3>

<P>
This list is used to define a global list of names or patterns
which are to be linked symbolically rather than copied. For example

</P>

<PRE>
excludelinks = ( *.gif *.jpg )
</PRE>

<P>
The same facility can be specified for each individual
link operation using the <CODE>symlink</CODE> option See section <A HREF="cfengine.html#SEC71">copy</A>.

</P>
<P>
Note that all entries defined under a specified class
are valid only as long as that class is defined. For instance

<PRE>
  <VAR>class</VAR>::

      linkcopies = ( <VAR>pattern</VAR> )
</PRE>

<P>
would define a pattern which was only valid when
<VAR>class</VAR> is defined.

</P>



<H2><A NAME="SEC71" HREF="cfengine_toc.html#TOC71">copy</A></H2>
<P>
<A NAME="IDX262"></A>
<A NAME="IDX263"></A>
<A NAME="IDX264"></A>

</P>
<P>
Sometimes it is not enough to make a link to a configuration
file--sometimes it is better to copy the actual file itself. This might
be because the master file is on a different filesystem which might not
always be mounted, or because the file needs to be editable locally. The
copy facility is designed to help with this problem. The syntax is

</P>

<PRE>

copy:

   <VAR>class</VAR>::

      <VAR>master-file</VAR> dest=<VAR>destination-file</VAR> mode=<VAR>mode</VAR>
                owner=<VAR>owner</VAR> group=<VAR>group</VAR> action=<VAR>action</VAR>
                backup=<VAR>true/false</VAR> symlink=<VAR>pattern</VAR>
                exclude=<VAR>pattern</VAR> recurse=<VAR>number/inf</VAR>
                type=<VAR>ctime/checksum</VAR> linktype=<VAR>relative/absolute/hard</VAR>

</PRE>

<P>

</P>
<DL COMPACT>

<DT><CODE>dest</CODE>
<DD>
The destination file is the only obligatory item. This must be the name
of an object which matches the type of the master object i.e. if the
master is a plain file, the destination must also be the explicit name
of a plain file. An implicit `copy file to directory' syntax is not
allowed.  Symbolic links are copied as symbolic links, plain files are
copied as plain files and special files are copied as special files. If
the master and image are directories then all of the child files
<EM>which are not directories</EM> are copied from source to destnation.

<DT><CODE>mode, owner, group</CODE>
<DD>
The file mode, owner
and group of the images are specified as in the <CODE>files</CODE> function
See section <A HREF="cfengine.html#SEC76">files</A>. 

<DT><CODE>action</CODE>
<DD>
The action may take the values <CODE>warn</CODE> or
<CODE>silent</CODE>. The default action is fix, i.e.  copy files. If <CODE>warn</CODE>
is specified, only a warning is issued about files which require
updating. If <CODE>silent</CODE> is given, then cfengine will copy the files
but not report the fact. 

<DT><CODE>backup</CODE>
<DD>
If the <CODE>backup</CODE> option is set to "false", cfengine
will not make a backup copy of the file before copying.
<A NAME="IDX265"></A>
<A NAME="IDX266"></A>
<A NAME="IDX267"></A>

Copy makes a literal image of the master file at the destination,
checking whether the master is newer than the image. If the image needs
updating it is copied. Existing files are saved by appending
<CODE>.cfsaved</CODE> to the filename.

<DT><CODE>recurse</CODE>
<DD>
Specifies the depth of recursion when copying whole filetrees
recursively. The value may be a number or the keyword <CODE>inf</CODE>.
Cfengine crosses device boundaries or mounted filesystems when
descending recursively through file trees. To prevent
this it is simplest to specify a maximum level of recursion.
<A NAME="IDX268"></A>
<A NAME="IDX269"></A>

<DT><CODE>symlink</CODE>
<DD>
This option may be repeated a number of times to specify the
names of files, or wildcards which match files which are to
be symbolically linked instead of copied. A global list of
patterns can also be defined in the control section of the program
See section <A HREF="cfengine.html#SEC70">linkcopies</A>.

<DT><CODE>exclude</CODE>
<DD>
This option may be repeated a number of times to specify the
names of files, or wildcards which match files which are to
be excluded from a copy operation. A global list of
patterns can also be defined in the control section of the program
See section <A HREF="cfengine.html#SEC67">excludelinks</A>.

<DT><CODE>type</CODE>
<DD>
Normally cfengine uses the ctime date-stamps on files to determine
whether a file needs to be copied: a file is only copied if the
master is newer than the copy. If the type is set to <SAMP>`checksum'</SAMP>,
then a secure MD5 checksum is used to determine whether the source
and destination files are identical.

<DT><CODE>linktype</CODE>
<DD>
This option determines the type of link used to make links. This only
applies if the file is linked rather than copied because it matches
a pattern set by <CODE>symlink</CODE>. The default type is a direct symbolic
link. The values <SAMP>`relative'</SAMP> or <SAMP>`absolute'</SAMP> may be used, but
hard links may not be created in place of copied files, since hard links
must normally reside on the same filesystem as their files, and it
is assumed that most links will be between filesystems.

</DL>

<P>
Example:

</P>

<PRE>

copy:

      /local/etc/aliases dest=/etc/aliases m=644 o=root g=other
      /local/backup-etc  dest=/etc

   solaris::

      /local/etc/nsswitch.conf dest=/etc/nsswitch.conf

</PRE>

<P>
In the first example, a global aliases file is copied from the master
site file <TT>`/local/etc/aliases'</TT> to <TT>`/etc/aliases'</TT>, setting the
owner and protection as specified. The file gets installed if
<TT>`/etc/aliases'</TT> doesn't exist and updated if <TT>`/local/etc/aliases'</TT>
is newer than <TT>`/etc/aliases'</TT>. In the second example, <TT>`backup-etc'</TT>
is a directory containing master configuration files (for instance, <TT>`services'</TT>,
<TT>`aliases'</TT>, <TT>`passwd'</TT>...). Each of the files in <TT>`backup-etc'</TT>
is installed or updated under <TT>`/etc'</TT>. Finally, a global
<TT>`nsswitch.conf'</TT> file is kept up to date for solaris systems.

</P>
<P>
The <CODE>home</CODE> directive can be used as a destination, in which
case cfengine will copy files to every user on the system. This is
handy for distributing setup files and keeping them updated:

</P>

<PRE>

copy:

   /local/masterfiles/.cshrc  dest=home/.cshrc mode=0600

</PRE>

<P>
You can force the copying of files, regardless of the date stamps
by setting the option <CODE>force=true</CODE> or <CODE>force=on</CODE>. The default
is <CODE>force=false</CODE> or <CODE>force=off</CODE>.
<A NAME="IDX270"></A>
<A NAME="IDX271"></A>

</P>



<H2><A NAME="SEC72" HREF="cfengine_toc.html#TOC72">defaultroute</A></H2>

<P>
Dynamical routing is not configurable in cfengine, but for machines with
static routing tables it is useful to check that a default route is
configured to point to the nearest gateway or router.  The syntax for
this statement is simply:

</P>

<PRE>

defaultroute:

   <VAR>class</VAR>::

      my_gateway

</PRE>

<P>
For example:

</P>

<PRE>

defaultroute:

  most::

     129.240.22.1

  rest::
 
     small_gw

</PRE>

<P>
Gateways and routers usually have internet address <CODE>aaa.bbb.ccc.1</CODE>
--- i.e.  the first address on the subnet.  You may use the numerical
form or a hostname for the gateway.

</P>



<H2><A NAME="SEC73" HREF="cfengine_toc.html#TOC73">directories</A></H2>

<P>
<A NAME="IDX272"></A>
<A NAME="IDX273"></A>
<A NAME="IDX274"></A>
<A NAME="IDX275"></A>

</P>
<P>
Directories declarations consist of a number of directories to be
created.  Directories and files may also be checked and created using
the <CODE>touch</CODE> option in the <CODE>files</CODE> actions.  See section <A HREF="cfengine.html#SEC76">files</A>.

</P>
<P>
The form of a declaration is:

</P>

<PRE>

directories:

  <VAR>class</VAR>::

     <VAR>directory</VAR> <VAR>options</VAR>...

</PRE>

<P>
The form of the command is similar to that of <CODE>files</CODE> but this
command may only be used to create new directories.  Valid options are
<CODE>mode</CODE>, <CODE>owner</CODE>, <CODE>group</CODE> and are described under
<CODE>files</CODE> See section <A HREF="cfengine.html#SEC76">files</A>.

</P>
<P>
The creation of a path will fail if one of the links in the path
is a plain file.

</P>



<H2><A NAME="SEC74" HREF="cfengine_toc.html#TOC74">disable</A></H2>
<P>
<A NAME="IDX276"></A>
<A NAME="IDX277"></A>
<A NAME="IDX278"></A>

</P>
<P>
Disabling a file means renaming it so that it becomes harmless.  This
feature is useful if you want to prevent certain dangerous files from
being around, but you don't want to delete them-- a deleted file cannot
be examined later.  The syntax is

</P>

<PRE>

disable:

   <VAR>class</VAR>::

      <VAR>filename</VAR>

</PRE>

<P>
Cfengine renames a given file by appending the name of the file with the
suffix <TT>`.cf-disabled'</TT>.  A typical example of a file you would
probably want to disable would be the <CODE>/etc/hosts.equiv</CODE> file which
is often found with the <SAMP>`+'</SAMP> symbol written in it, opening the
system concerned to the entire NIS universe without password protection!
<A NAME="IDX279"></A>
Here is an example:

</P>

<PRE>

disable:

      /etc/hosts.equiv
      /etc/nologin
      /usr/lib/sendmail.fc

   sun4::

      /var/spool/cron/at.allow

</PRE>

<P>
Hint: The last example disables a file which restricts access to the
<CODE>at</CODE> utility.  Such a command could be followed by a file action:

</P>

<PRE>
files:

   some::

      /var/spool/cron/at.allow =0644 N [root] [wheel] touch

</PRE>

<P>
See section <A HREF="cfengine.html#SEC76">files</A> which would create an empty security file <TT>`at.allow'</TT>.
See also your system manual pages for the <CODE>at</CODE> command if you don't
understand why this could be useful.

</P>
<P>
Disabling a link deletes the link. If you wish you may use the
optional syntax

</P>

<PRE>

disable:

    /directory/name type=file

</PRE>

<P>
to specify that a file object should only be disabled if it is a plain
file. The optional element <CODE>type=</CODE> can take the values
<CODE>plain</CODE>, <CODE>file</CODE>, <CODE>link</CODE> or <CODE>links</CODE>. If one of
these is specified, cfengine checks the type and only disables
the object if there is a match. This allows you to disable a file
and replace it by a link to another file for instance.
<A NAME="IDX280"></A>
<A NAME="IDX281"></A>
<A NAME="IDX282"></A>

</P>
<P>
NOTE that if you regularly disable a file which gets recreated, the
disabled file <TT>`<VAR>filename</VAR>.cf-disabled'</TT> will be
overwritten each time cfengine disables the file and therefore the
contents of the original are lost each time. 
<A NAME="IDX283"></A>
<A NAME="IDX284"></A>
<A NAME="IDX285"></A>
<A NAME="IDX286"></A>

</P>
<P>
The disable feature can be used to control the size of system
log files, such as <TT>`/var/adm/messages'</TT> using a further
option <CODE>rotate</CODE>.
<A NAME="IDX287"></A>
<A NAME="IDX288"></A>
If the value rotate is set to 4, say, 

</P>

<PRE>

 disable:

    <VAR>filename</VAR>  rotate=4

</PRE>

<P>
then cfengine renames
the file concerned by appending `.1' to it and a new, empty file is
created inits place with the same owner and permissions. The next time
disable is executed `.1' is renamed to `.2' and the file
is renamed `.1' and a new empty file is created with the same
permissions. Cfengine continues to rotate the files like this
keeping a maximum of four files. This is similar to the behaviour
of syslog.

</P>
<P>
If you simply want to empty the contents of a log file, without
retaining a copy then you can use <CODE>rotate=empty</CODE>. For instance,
to keep control of your World Wide Web server logs:

</P>

<PRE>
disable:

   Sunday|Wednesday::

       /usr/local/httpd/logs/access_log  rotate=truncate
</PRE>

<P>
This keeps a running log which is emptied each Sunday and Wednesday.
<A NAME="IDX289"></A>

</P>



<H2><A NAME="SEC75" HREF="cfengine_toc.html#TOC75">editfiles</A></H2>

<P>
You can perform simple control or editing on textfiles using a number of
commands.  At the present time these are fairly limited but are
sufficient for many purposes.  The form of an editing command is

</P>

<PRE>

editfiles:

   <VAR>class</VAR>::

      { <VAR>file-to-be-edited</VAR>

      <VAR>action</VAR> "<VAR>quoted-string...</VAR>"
      }

</PRE>

<P>
Here are some examples:

</P>

<PRE>
editfiles:

   sun4::

      { /etc/netmasks

      DeleteLinesContaining "255.255.254.0"
      AppendIfNoSuchLine "128.39  255.255.255.0"
      }

   PrintServers::
      { /etc/hosts.lpd

      AppendIfNoSuchLine "tor"
      AppendIfNoSuchLine "odin"
      AppendIfNoSuchLine "borg"
      }

</PRE>

<P>
The first of these affects the file <TT>`/etc/netmasks'</TT> on all SunOS 4
systems, deleting any lines containing the string "255.255.254.0" and
Appending a single line to the file containing "128.39 255.255.255.0"
if none exists already.  The second affects only hosts in the class
`PrintServers' and adds the names of three hosts: tor, odin and borg to
the file <TT>`/etc/hosts.lpd'</TT> which specifices that they are allowed to
connect to the printer services on any host in the class `PrintServers'.

</P>
<P>
<A NAME="IDX290"></A>
<A NAME="IDX291"></A>
<A NAME="IDX292"></A>
Note that single or double quotes may be used to enclose strings
in cfengine. If you use single quotes, your strings may contain
double quotes and vice-versa. Otherwise a double quoted string
may not currently contain double quotes and likewise for
single quoted strings.

</P>

<P>
As of version 1.3.0, you can use the <SAMP>`home'</SAMP> directive in
edit filenames, enabling you to edit files for every user
on the system, provided they exist. For example, to edit
every user's login files, you would write

</P>

<PRE>

  { home/.cshrc

   AppendIfNoSuchLine "setenv PRINTER default-printer"
   AppendIfNoSuchLine "set path = ( $path /new/directory )"
  }

</PRE>

<P>
If a user does not possess the named file, cfengine just skips
that user. A new file is not created.

</P>
<P>
The meanings of the file-editing actions should be self-explanatory.
Commands containing the word 'comment' are used to `comment out' certain
lines in a file rather than deleting them.  <CODE>Hash</CODE> implies a shell
comment of the type

</P>

<PRE>
# comment
</PRE>

<P>
<CODE>Slash</CODE> implies a comment of the C++ type:

</P>

<PRE>
// comment
</PRE>

<P>
<CODE>Percent</CODE> implies a comment of the type:

</P>

<PRE>
% comment
</PRE>

<P>
More general commenting functions may be defined using the
<CODE>SetCommentStart</CODE>, <CODE>SetCommentEnd</CODE> and
<CODE>CommentLinesMatching</CODE>, <CODE>CommentLinesStarting</CODE>
functions.

</P>
<P>
Another group of editing commands is based on the GNU Regular Expression
package (from Emacs). It uses GNU regular expressions to search line
by line through text and perform various editing functions.
Some of these commands are based on the concept of a file pointer. The
pointer starts at line one of the file and can be reset by 'locating'
a certain line, or by using the reset-pointer commands. The current
position of the pointer is used by commands such as <CODE>InsertLine</CODE>
to allow a flexible way of editing the middle of files.

</P>
<P>
A simple decision mechanism is incorporated to allow certain editing
actions to be excluded. For instance, to insert a number of lines
in a file once only, you could write:

</P>

<PRE>

   { <VAR>file</VAR>

    LocateLineMatching "<VAR>insert point...</VAR>"
    IncrementPointer   "1"

    BeginGroupIfNoMatch "# cfengine - 2/Jan/95"

      InsertLine "# cfengine - 2/Jan/95"
      InsertLine "/local/bin/start-xdm"

    EndGroup
   }

</PRE>

<P>
Since the first inserted line matches the predicate on subsequent calls,
the grouped lines will only be carried out once.  

</P>

<P>
The full list of editing actions is given below in alphabetical order.
Note that some commands refer to regular expressions and some refer to
'literal strings' (i.e. any string which is not a regular
expression). Variable substitution is performed on all strings.  Be
aware that symbols such as <SAMP>`.'</SAMP>, <SAMP>`*'</SAMP> and so on are
meta-characters in regular expressions and a backslash must be used to
make them literal.  The regular expression matching functions are the
GNU regular expressions, as defined by the <CODE>regex-0.12</CODE>
package See section <A HREF="cfengine.html#SEC28">Regular expressions</A>. Readers are referred to the manual for this package for details
of the extended special features of GNU regular expressions. If you are
not familiar with regular expressions, then be aware that you may always
supply an exact string to be matched (this is the simplest regular
expression), but be careful about backslashing metacharacters!

</P>
<DL COMPACT>

<DT><CODE>AbortAtLineMatching <VAR>quoted-string</VAR></CODE>
<DD>
This command sets the value of a regular expression. In all editing
operations (except <CODE>FixEndOfLine</CODE> and <CODE>GotoLastLine</CODE>) which involve multiple
replacements and searches, this expression marks a boundary
beyond which cfengine will cease to look any further. In other
words, if cfengine encounters a line matching this regular
expression, it aborts the current action. BE CAREFUL with this
feature: once set, the string remains set for the remainder of
the current file. It might therefore interact in unsuspected ways
with other search parameters. Editing actions are always aborted
as soon as the abort expression is matched.
Use <CODE>UnsetAbort</CODE> to unset the feature.

<DT><CODE>Append <VAR>quoted-string</VAR></CODE>
<DD>
Add a line containing the quoted string to the end of the file.
This should be used in conjunction with the
decision structures <CODE>BeginGroupIfNoLineMatching</CODE> and
<CODE>BreakIfLineMatches</CODE>.

<DT><CODE>AppendIfNoSuchLine <VAR>quoted-string</VAR></CODE>
<DD>
Add a line containing the quoted string to the end of the file
if the file doesn't contain the exact line already.

<DT><CODE>AppendIfNoLineMatching  <VAR>quoted-string</VAR></CODE>
<DD>
A new version of the older <CODE>AppendIfNoSuchLine</CODE>
which uses a regular expression instead of a literal
string. The line which gets appended must be set
previously using <CODE>SetLine</CODE>.

<DT><CODE>AutomountDirectResources <VAR>quoted-string</VAR></CODE>
<DD>
This command is designed to assist with automounter configuration for
users wishing to use the autmounter for NFS filesystems, but still use
the cfengine mount model.
<A NAME="IDX293"></A>
<A NAME="IDX294"></A>
Applied to the current file, it is equivalent to saying: for each of the
mountable resources in the list See section <A HREF="cfengine.html#SEC96">mountables</A>, append if not found a
line for a direct automount map command, to the current file.  The
string which follows can be used to specify any special mount options
e.g. <CODE>"-nosuid"</CODE> for non setuid mounting (of all the
mountables). Note that this is added to the current file and not to a
file named <TT>`/etc/auto_direct'</TT>.

<DT><CODE>BeginGroupIfNoLineMatching <VAR>quoted-string</VAR></CODE>
<DD>
The lines following, up to the first <CODE>EndGroup</CODE>
are executed if the quoted regular expression
does not match any line in the file.

<DT><CODE>BeginGroupIfNoMatch <VAR>quoted-string</VAR></CODE>
<DD>
The lines following, up to the first <CODE>EndGroup</CODE>
are executed if the quoted regular expression does
not match the current line.

<DT><CODE>BeginGroupIfNoSuchLine <VAR>quoted-string</VAR></CODE>
<DD>
The lines following, up to the first <CODE>EndGroup</CODE>
are executed if the quoted literal string
does not match any line in the file.

<DT><CODE>BreakIfLineMatches  <VAR>quoted-string</VAR></CODE>
<DD>
Terminates further editing of the current
file if the current line matches the quoted
regular expression.

<DT><CODE>CommentLinesMatching  <VAR>quoted-string</VAR></CODE>
<DD>
Use the current value of the comment delimiters
set using <CODE>SetCommentStart</CODE> and <CODE>SetCommentEnd</CODE> to comment
out lines matching the given regular expression in quotes.

<DT><CODE>CommentLinesStarting  <VAR>quoted-string</VAR></CODE>
<DD>
Use the current value of the comment delimiters
set using <CODE>SetCommentStart</CODE> and <CODE>SetCommentEnd</CODE> to comment
out lines starting with the quoted literal string.

<DT><CODE>CommentNLines <VAR>quoted-string</VAR></CODE>
<DD>
Comments up to @math{N} lines from the current file, starting from the
location of the current line pointer. If the end of the file is reached
and less than @math{N} lines are deleted, a warning is issued, but
editing continues. The current value of the comment delimiters is
used to determine the method of commenting, (see <CODE>SetCommentStart</CODE>).
After the operation the pointer points to the line after the
commented lines.

<DT><CODE>CommentToLineMatching  <VAR>quoted-string</VAR></CODE>
<DD>
Use the current value of the comment delimiters set using
<CODE>SetCommentStart</CODE> and <CODE>SetCommentEnd</CODE> to comment out lines
from the current position in a file to a line matching the given regular
expression in quotes.

<DT><CODE>DeleteLinesContaining <VAR>quoted-string</VAR></CODE>
<DD>
Delete all lines containing the exact string quoted.

<DT><CODE>DeleteLinesMatching <VAR>quoted-string</VAR></CODE>
<DD>
Delete all lines matching the quoted regular expression.

<DT><CODE>DeleteLinesStarting <VAR>quoted-string</VAR></CODE>
<DD>
Delete all lines beginning with the exact string quoted.

<DT><CODE>DeleteNLines <VAR>quoted-string</VAR></CODE>
<DD>
Deletes up to @math{N} lines from the current file, starting from the
location of the current line pointer. If the end of the file is reached
and less than @math{N} lines are deleted, a warning is issued, but
editing continues.

<DT><CODE>DeleteToLineMatching <VAR>quoted-string</VAR></CODE>
<DD>
Delete lines from the current position, up to
but not including a line matching the regular expression
in the quoted string. If no line matches the
given expression, a warning is only printed in
verbose mode, but all edits are immediately
abandoned.

<DT><CODE>EmptyEntireFilePlease</CODE>
<DD>
Deletes all lines from the current file.

<DT><CODE>EndGroup</CODE>
<DD>
Terminates a begin-end conditional structure.

<DT><CODE>FixEndOfLine</CODE>
<DD>
The quoted string which follows may be either <SAMP>`dos'</SAMP>
or <SAMP>`unix'</SAMP> to fix the end of line character conventions
to match these systems. This command should be executed
last of all, since cfengine appends new lines with the conventions
of the system on which is was complied during edit operations.

<DT><CODE>GotoLastLine</CODE>
<DD>
Moves the file pointer to the last line in
the current file.

<DT><CODE>HashCommentLinesContaining <VAR>quoted-string</VAR></CODE>
<DD>
Add a <SAMP>`#'</SAMP> to the start of any line containing the quoted string.

<DT><CODE>HashCommentLinesMatching <VAR>quoted-string</VAR></CODE>
<DD>
Add a <SAMP>`#'</SAMP> to the start of any line exactly matching the quoted regular expression.

<DT><CODE>HashCommentLinesStarting <VAR>quoted-string</VAR></CODE>
<DD>
Add a <SAMP>`#'</SAMP> to the start of any line starting with the quoted string.

<DT><CODE>IncrementPointer <VAR>quoted-string</VAR></CODE>
<DD>
Increments the value (in lines) of the file pointer
by the number of lines specified in the quoted
string (as a denary number). e.g. <SAMP>`"4"'</SAMP>.

<DT><CODE>InsertFile <VAR>quoted-string</VAR></CODE>
<DD>
Inserts the named file after the current line position
in the file. This should be used in conjunction
with a begin-end construction in order to avoid
including the file every time cfengine is run.
If the file does not exist, or cannot be opened,
there is only a warning issued in verbose mode.
Note if the file is empty, or if the current line
pointer is not set, the file is inserted at the start
of the file.

<DT><CODE>InsertLine <VAR>quoted-string</VAR></CODE>
<DD>
Inserts the quoted string as a line at the current
position in the file. After the insert, the file
pointer is incremented by one so that subsequent
inserted lines are placed after the first.
This should probably be used in conjunction with the
conditional begin-end tests to avoid lines being
inserted on every run.

<DT><CODE>LocateLineMatching <VAR>quoted-string</VAR></CODE>
<DD>
Moves the current-position pointer to the start
of the line matching the quoted regular expression.
If there is no match, a warning is only issued in
verbose mode, but all editing is immediately
aborted. See also <CODE>WarnIfNoLineMatching</CODE>
so that you can get an explicit warning, even
out of verbose mode.

<DT><CODE>PercentCommentLinesContaining <VAR>quoted-string</VAR></CODE>
<DD>
Add a <SAMP>`%'</SAMP> to the start of any line containing the quoted string.

<DT><CODE>PercentCommentLinesMatching <VAR>quoted-string</VAR></CODE>
<DD>
Add a <SAMP>`%'</SAMP> to the start of any line exactly matching the quoted regular.

<DT><CODE>PercentCommentLinesStarting <VAR>quoted-string</VAR></CODE>
<DD>
Add a <SAMP>`%'</SAMP> to the start of any line starting with the quoted string.

<DT><CODE>Prepend <VAR>quoted-string</VAR></CODE>
<DD>
Add a line containing the quoted string to the start of the file.
This should be used in conjunction with the
decision structures <CODE>BeginGroupIfNoLineMatching</CODE> and
<CODE>BreakIfLineMatches</CODE>.

<DT><CODE>PrependIfNoLineMatching <VAR>quoted-string</VAR></CODE>
<DD>
A new version of the older <CODE>PrependIfNoSuchLine</CODE>
with uses a regular expression instead of a literal string.
The string prepended is the one set using <CODE>SetLine</CODE>.

<DT><CODE>PrependIfNoSuchLine <VAR>quoted-string</VAR></CODE>
<DD>
Add a line containing the quoted string to the start of the file
if the file doesn't contain the exact line already.

<DT><CODE>ReplaceLineWith <VAR>quoted-string</VAR></CODE>
<DD>
Replace the line at the current position with the
text in the quoted string. The file pointer remains
pointing to this line after the change.

<DT><CODE>ReplaceAll <VAR>quoted-string</VAR> With <VAR>quoted-string</VAR></CODE>
<DD>
Replace all instances of strings matching the regular expression in the
first quotes with the exact string in the second set of quotes,
throughout the current file. Note that cfengine matches on a left to
right basis, with the first match taking precedence, so if your regular
expression matches text ambiguously it is the first occurrance which is
replaced. For example, if you replace <SAMP>`cf.*'</SAMP> with <SAMP>`CFENGINE'</SAMP>
and cfengine encounters a line <SAMP>`hello cfengine cfengine'</SAMP>, then this
will be replaced with <SAMP>`hello CFENGINE'</SAMP> even though two possible
strings match the regular expression. On the other hand if the
expression is not ambigous, say replacing <SAMP>`cfengine'</SAMP> with
<SAMP>`CFENGINE'</SAMP>, then the result would be <SAMP>`hello CFENGINE CFENGINE'</SAMP>.

<DT><CODE>ResetSearch <VAR>quoted-string</VAR></CODE>
<DD>
Sets the current-position pointer to the line number
in the quoted string. <SAMP>`EOF'</SAMP> indicates the end of
the file.

<DT><CODE>RunScript <VAR>quoted-string</VAR></CODE>
<DD>
Executes the named script command. Before executing the script any edits
are saved to disk. After the script has executed,
cfengine reloads the file for any further editing
operations. The script (which may be any executable
program) is appended with two arguments: the name of the
file which is being edited and the system hard class
(e.g. sun4, ultrix etc.) of the system executing
the script.

CAUTION: cfengine knows nothing about
the success or failure of anything that is done during the
execution of user scripts. This feature is to be
used at the users own peril!

<DT><CODE>RunScriptIfLineMatching <VAR>quoted-string</VAR></CODE>
<DD>
Executes the script named with the <CODE>SetScript</CODE>
command only if the current file contains a line matching
the quoted regular expression.

CAUTION: cfengine knows nothing about
the success or failure of anything that is done during the
execution of user scripts. This feature is to be
used at the users own peril!

<DT><CODE>RunScriptIfNoLineMatching <VAR>quoted-string</VAR></CODE>
<DD>
Executes the script named with the <CODE>SetScript</CODE>
command if the current file contains no line matching
the quoted regular expression.

CAUTION: cfengine knows nothing about
the success or failure of anything that is done during the
execution of user scripts. This feature is to be
used at the users own peril!

<DT><CODE>SetCommentStart <VAR>quoted-string</VAR></CODE>
<DD>
Specify which string should be used for starting
a comment using the commands <CODE>CommentLineMatching</CODE>
and <CODE>CommentLineStarting</CODE>. The default is the hash
symbol <SAMP>`#'</SAMP> followed by a single space.

<DT><CODE>SetCommentEnd  <VAR>quoted-string</VAR></CODE>
<DD>
Specify which string should be used for ending
a comment using the commands <CODE>CommentLineMatching</CODE>
and <CODE>CommentLineStarting</CODE>. The default is the empty
string. For example, you could make C style comments
by setting CommentStart to <SAMP>`/*'</SAMP> and comment
end to <SAMP>`*/'</SAMP>.

<DT><CODE>SetLine <VAR>quoted-string</VAR></CODE>
<DD>
Sets a current line value which can be appended using
<CODE>AppendIfNoLineMatching</CODE> using a regular expression.

<DT><CODE>SetScript <VAR>quoted-string</VAR></CODE>
<DD>
Sets the name of a user-supplied script
for editing the current file.

<DT><CODE>SlashCommentLinesContaining <VAR>quoted-string</VAR></CODE>
<DD>
Add a <SAMP>`//'</SAMP> to the start of any line containing the quoted string.

<DT><CODE>SlashCommentLinesMatching <VAR>quoted-string</VAR></CODE>
<DD>
Add a <SAMP>`//'</SAMP> to the start of any line exactly matching the quoted regular expression.

<DT><CODE>SlashCommentLinesStarting <VAR>quoted-string</VAR></CODE>
<DD>
Add a <SAMP>`//'</SAMP> to the start of any line starting with the quoted string.

<DT><CODE>UnCommentLinesContaining  <VAR>quoted-string</VAR></CODE>
<DD>
Uncomment all lines in file containing the quoted string as a
substring. The comment delimiters are assumed to be those
set using SetCommentStart and SetCommentEnd.

<DT><CODE>UnCommentLinesMatching  <VAR>quoted-string</VAR></CODE>
<DD>
Uncomment all lines in file matching the quoted regular expression.  The
comment delimiters are assumed to be those set using SetCommentStart and
SetCommentEnd.

<DT><CODE>UnCommentNLines <VAR>quoted-string</VAR></CODE>
<DD>
Uncomments N lines starting from the current position, using
the currently defined method for commenting. Note that the
comment start and end symbols are removed independently, i.e.
they are not matched, so that a comment may be spread over
several lines. e.g. If using C style <SAMP>`/*'</SAMP> and <SAMP>`*/'</SAMP>
comments, the command <CODE>UnCommentNLines "3"</CODE> would
uncomment

<PRE>
 /* 1 */
 /* 2 */
 /* 3 */
</PRE>

and also

<PRE>
 /* 1 
    2
    3 */
</PRE>

<DT><CODE>UnsetAbort  <VAR>quoted-string</VAR></CODE>
<DD>
Switches off the feature <CODE>AbortAtLineMatching</CODE>.

<DT><CODE>WarnIfLineContaining <VAR>quoted-string</VAR></CODE>
<DD>
Issue a warning if the quoted string is found as a
substring of one or more lines in the file.

<DT><CODE>WarnIfLineMatching <VAR>quoted-string</VAR></CODE>
<DD>
Issue a warning if the quoted regular expression
matches one or more lines in the file.

<DT><CODE>WarnIfLineStarting <VAR>quoted-string</VAR></CODE>
<DD>
Issue a warning if the quoted string matches the start
of one or more lines in the file.

<DT><CODE>WarnIfNoLineContaining <VAR>quoted-string</VAR></CODE>
<DD>
Issue a warning if the quoted string is not contained
in one or more lines in the file.

<DT><CODE>WarnIfNoLineStarting <VAR>quoted-string</VAR></CODE>
<DD>
Issue a warning if the quoted string is not found
at the start of one or more lines in the file.

<DT><CODE>WarnIfNoSuchLine <VAR>quoted-string</VAR></CODE>
<DD>
Issue a warning if the quoted regular expression does not
match one or more lines in the file.

</DL>

<P>
It is suggested that you use these editing functions with
caution. Although all possible safeguards have been incorporated into
them, it is still possible through carelessness to do damage to
important files on your system. Always test editing programs carefully
before committing them to your global site configuration.

</P>



<H2><A NAME="SEC76" HREF="cfengine_toc.html#TOC76">files</A></H2>
<P>
<A NAME="IDX295"></A>
<A NAME="IDX296"></A>
<A NAME="IDX297"></A>
<A NAME="IDX298"></A>

</P>
<P>
The <CODE>files</CODE> facility allows you to touch (create), check for the
existence, owner and permissions of files, change the permissions and
test for setuid root programs.

</P>



<H3><A NAME="SEC77" HREF="cfengine_toc.html#TOC77">Syntax</A></H3>
<P>
<A NAME="IDX299"></A>

</P>
<P>
A files-statement can have several options.  We can begin by examining
the form of the statement in pseudo-code:

</P>

<PRE>
files:

myclass::

   <VAR>/directory</VAR> action=<VAR>action</VAR> <VAR>options</VAR> ...   

</PRE>

<P>
An example would be the following:

</P>

<PRE>
   any::

      /var/spool/printQ  mode=0775  r=0 o=daemon g=daemon  act=fixdirs

</PRE>

<P>
The meaning of these item is sketched out below and becomes clearer on
looking at a number of examples.  Note that, each of the options below
can be written in either upper or lower case and abbrieviated by any
unique abbreviation.
<A NAME="IDX300"></A>
<A NAME="IDX301"></A>
<A NAME="IDX302"></A>
<A NAME="IDX303"></A>
<A NAME="IDX304"></A>
<A NAME="IDX305"></A>
<A NAME="IDX306"></A>
<A NAME="IDX307"></A>
<A NAME="IDX308"></A>
<A NAME="IDX309"></A>
<A NAME="IDX310"></A>
<A NAME="IDX311"></A>

</P>

<DL COMPACT>

<DT><CODE><VAR>/directory</VAR></CODE>
<DD>
This is the only obligatory part of a file action.  This is a directory
at which a file search should begin.  This may be a single file or a
directory.  The recursion specifier may be used to force cfengine to
descend into subdirectories in a controlled fashion, starting from this
point, checking files there also.  The wildcard <CODE>home</CODE> may also be
used.  See section <A HREF="cfengine.html#SEC80"><CODE>home</CODE> directive</A>.
<A NAME="IDX312"></A>
<A NAME="IDX313"></A>
<A NAME="IDX314"></A>

<DT><CODE>mode=<VAR>modestring</VAR></CODE>
<DD>
Specifies what the allowed permissions for files are.  If cfengine finds
that the a file's mode is incorrect, the value of the <CODE>action</CODE>
option determines what will be done about it.  The modestring should
consist of either a three digit octal numbers with <SAMP>`+'</SAMP>, <SAMP>`-'</SAMP> or
<SAMP>`='</SAMP> symbols, or a text string like that used by the command
<CODE>chmod</CODE>.  For instance: <CODE>mode=u=rwx,og+rx</CODE> would mean set the
read/write and execute flags for the user (file owner) and add the
read/execute flags for others and group bits.  An example of the
numerical form might be <CODE>-002</CODE> which would mean that the
read-for-others flag should either not be set or should be unset,
depending on the action you choose.  <CODE>+2000</CODE> would mean that the
setuid flag should be present or set, depending on the action.
<CODE>+2000,-002</CODE> would be a combination of these.  The <SAMP>`='</SAMP> sign
sets to an absolute value, so <CODE>=755</CODE> would set the file mode to
mode 755.

<DT><CODE>recurse=<VAR>number/inf</VAR></CODE>
<DD>
This specifier tells cfengine whether or not to recurse into
subdirectories.  If the value is zero, only the named file or directory
is affected.  If the value is 1, it will open at most one level of
subdiretory and affect the files within this scope.  If the value is
<CODE>inf</CODE> then cfengine opens all subdirectories and files beginning
from the specified filename.See section <A HREF="cfengine.html#SEC78">Recursion</A>.

<DT><CODE>owner=<VAR>owner list</VAR></CODE>
<DD>
This is a list of allowed owners, or uids by number, separated by
commas.  For example <CODE>root,2,3,sysadm</CODE>.  In cases where you ask
cfengine to fix the ownership automatically, the owner will be set to
the first owner in the list if and only if it is not one of the named
uids in the list.

<DT><CODE>group=<VAR>group list</VAR></CODE>
<DD>
This is a list of allowed groups, or gids by number, separated by
commas.  For example <CODE>wheel,2,3,sysadm</CODE>.  In cases where you ask
cfengine to fix the ownership automatically, the group will be set to
the first group in the list if and only if it is not one of the named
gids in the list.

<DT><CODE>action=<VAR>action</VAR></CODE>
<DD>
The action is one of the following keywords.

<PRE>
warnall warndirs warnplain
fixall fixdirs fixplain
touch linkchildren
</PRE>

The upper line results only in warnings being issued.  The actions
beginning `fix' prompt cfengine to fix encountered problems without
bothering the user.  No message is issued unless in verbose mode.  The
special features on the third line will be explained separately.

<DT><CODE>links=<VAR>stop/traverse/tidy</VAR></CODE>
<DD>
Normally cfengine does not decsend into subdirectories which are pointed
to by symbolic links.  If you wish to force it to do so (without using
the <CODE>-l</CODE> command line option) you may give this option the value
<CODE>true</CODE>, or <CODE>traverse</CODE>, or <CODE>follow</CODE>.  To specify no
recursion you set the value <CODE>false</CODE> or <CODE>stop</CODE>.
<A NAME="IDX315"></A>
<A NAME="IDX316"></A>
<A NAME="IDX317"></A>
Note that the value set here in the cfengine program <EM>always
overrides</EM> the value set by the <CODE>-l</CODE> command line option, so you
can protect certain actions from this command line option by specifying
a negative value here.  If you specify no value here, the behaviour is
determined by what you specify on the command line.

The value <CODE>links=tidy</CODE> has the same effect as the <SAMP>`-L'</SAMP> command
line option except that here it may be specified per item rather than
globally.  Setting this value causes links which point to non-existent
files to be deleted.
<A NAME="IDX318"></A>
<A NAME="IDX319"></A>

If the warn directive is used (for directories, plain files or both)
then only a warning message is issued if the file being tested does not
match the specification given.  If the fix directives are used then
cfengine does not issue a warning, it simply fixes the value silently.
Non-existenct files are created by the <CODE>touch</CODE> command.  A
directory may be touched (created) by writing the filename
<CODE>/a/b/c/.</CODE> with a dot as the last character.  (This may also be
achieved with the <CODE>directories</CODE> directive.  See section <A HREF="cfengine.html#SEC73">directories</A>).

</DL>

<P>
The default values are <CODE>mode=+000</CODE>, <CODE>recurse=0</CODE>,
<CODE>action=warnall</CODE> and any owner or group is acceptable.  The default
for <CODE>links</CODE> is to not traverse links unless the <CODE>-l</CODE> option is
set on the command line.

</P>



<H3><A NAME="SEC78" HREF="cfengine_toc.html#TOC78">Recursion</A></H3>
<P>
<A NAME="IDX320"></A>
<A NAME="IDX321"></A>

</P>
<P>
The recursion specifier tells cfengine what to do, starting from
<CODE>/directory name</CODE>.  A value of <CODE>r=0</CODE> means `no recursion' and
any checking is limited only to the named file or directory.  A value of
<CODE>r=inf</CODE> implies unlimited recursion.  Cfengine then descends into
all subdirectories checking or setting the permissions of files until it
`bottoms out' at a plain file.  A value such as <CODE>R=4</CODE> means descend
recursively into subdirectories, but no more than four levels.  This is
a useful safety net in preventing unforseen accidents.  A recursive
search also bottoms out on device boundaries and symbolic links
(provided the <KBD>-l</KBD> option is not used).
<A NAME="IDX322"></A>
<A NAME="IDX323"></A>
<A NAME="DOCF6" HREF="cfengine_foot.html#FOOT6">(6)</A>
<A NAME="IDX324"></A>
<A NAME="IDX325"></A>

</P>


<H3><A NAME="SEC79" HREF="cfengine_toc.html#TOC79">Directory permissions</A></H3>
<P>
<A NAME="IDX326"></A>
<A NAME="IDX327"></A>

</P>
<P>
When you specify the permissions for a whole file tree, using the
recursion specifier it is awkward to have to remember that directories
must be executable.  cfengine will do this for you automatically.  If
you specify that a file tree is to have a read flag set, cfengine will
ensure that the corresponding execute flag is also set for directories
which live in the tree.  So the command

</P>

<PRE>
files:

  myclass::

      /dir  mode=a+rw r=inf fixall

</PRE>

<P>
would set all plain files to mode 644 and all directories to 755, that
is read/write for everyone on plain files and read/write/execute for
everyone on directories.

</P>


<H3><A NAME="SEC80" HREF="cfengine_toc.html#TOC80"><CODE>home</CODE> directive</A></H3>
<P>
<A NAME="IDX328"></A>
<A NAME="IDX329"></A>

</P>
<P>
If you want to check the files of all the users who have their login
areas on the current host, you can use a wildcard directive <CODE>home</CODE>
instead of a directory name.  In this case the file action iterates over
all home directories physically on the current host.  The home
directories are, of course, located by searching for files which match

</P>

<PRE>
$(mountpattern)/$(homepattern)
</PRE>

<P>
i.e.  the values which are specified in the <CODE>control</CODE> part of the
program.  For example the following line is a very useful service to
ignorant users.

</P>

<PRE>
files:

  any::
 
    home mode=o-w r=inf act=fixall

</PRE>

<P>
It ensures automatically that no user has files which can be written to
by other arbitrary users.

</P>
<P>
As a corollary to this, you may write something like

<PRE>

  any::

     home/www mode=a+r fixall

</PRE>

<P>
to specify a special subdirectory of every users' home directory.  This
statement would check that all of the files in users' world wide web
directories were readable for everyone.

</P>


<H3><A NAME="SEC81" HREF="cfengine_toc.html#TOC81">Owner and group wildcards</A></H3>
<P>
<A NAME="IDX330"></A>
<A NAME="IDX331"></A>

</P>
<P>
If you do not want to explicitly state the owner or group of a file you
may simply omit the group or owner options.

</P>

<PRE>

  /directory m=0664 r=inf

</PRE>

<P>
This example generate a warning if any files under the named directory
do not have permission read/write for all users.

</P>


<H3><A NAME="SEC82" HREF="cfengine_toc.html#TOC82">Files linkchildren</A></H3>
<P>
<A NAME="IDX332"></A>
<A NAME="IDX333"></A>

</P>
<P>
The <CODE>linkchildren</CODE> facility is almost identical to that already
described under <CODE>links</CODE>.  See section <A HREF="cfengine.html#SEC91">Link Children</A>.  The only
difference here is that the ownership and permissions on the links are
set all in one operation.  For example:

</P>

<PRE>
<VAR>myclass</VAR>::

   /local/lib/emacs m=0770 o=me g=mygroup act=linkchildren

</PRE>



<H3><A NAME="SEC83" HREF="cfengine_toc.html#TOC83">touch</A></H3>
<P>
<A NAME="IDX334"></A>
<A NAME="IDX335"></A>

</P>
<P>
The <CODE>touch</CODE> facility creates a new file with the
specified permissions and ownership, or corrects the
permissions and ownership of an existing file, in addition
to updating the time stamps.

</P>

<PRE>
<VAR>myclass</VAR>::

   /<VAR>newfile</VAR> mode=0644 action=touch

</PRE>



<H2><A NAME="SEC84" HREF="cfengine_toc.html#TOC84">groups</A></H2>
<P>
<A NAME="IDX336"></A>
<A NAME="IDX337"></A>
<A NAME="IDX338"></A>

</P>
<P>
The <CODE>groups</CODE> action is used to define classes which stand for
groups of hosts.  If you use the NIS (network information service)
facility for defining <EM>netgroups</EM> then this idea will already be
familiar to you and you can probably use your already-defined netgroups
in cfengine.

</P>
<P>
To define a group, you simply make a list and assign it a name.  Here is
an example of the syntax:

</P>

<PRE>

groups:
 
   science = ( saga tor odin )

   packages = ( saga ) 

   AllHomeServers   = ( saga )
   AllBinaryServers = ( saga )

   OIH_servers = ( saga )
   OIH_clients = ( tor odin )

</PRE>

<P>
To include a list of hosts from a NIS netgroup, you use the <SAMP>`+'</SAMP> symbol, or
the <SAMP>`+@'</SAMP> construction.  For example:

</P>
<P>
<A NAME="IDX339"></A>
<A NAME="IDX340"></A>
<A NAME="IDX341"></A>

</P>

<PRE>

groups:
 
   science = ( +science-allhosts )

   physics = ( +physics-allhosts )

   physics_theory = ( +@physics-theory-sun4 dirac feynman schwinger )

</PRE>

<P>
Using an enormous netgroup does not use up any space.  A group
declaration results in the storage of only the class name regardless of
how many hosts are in the list.  The rule is that the left hand side of
the assignment becomes defined (true) if the list on the right hand side
includes the host which is parsing the file -- i.e.  <CODE>$(host)</CODE>.

</P>
<P>
In some cases your netgroups will not correspond exactly to the list you
want, but it might be more convenient to use a netgroup <EM>except</EM>
for certain hosts.  You can `undefine' or remove hosts from the netgroup
list by using the minus `-' symbol.  For example:

</P>
<P>
<A NAME="IDX342"></A>
<A NAME="IDX343"></A>
<A NAME="IDX344"></A>

<PRE>

group = ( +mynetgroup -specialhost -otherhost )

</PRE>

<P>
which means, of course, all hosts in netgroup <CODE>mynetgroup</CODE> except
for <CODE>specialhost</CODE> and <CODE>otherhost</CODE>.  Finally, you may also
subtract two netgroups in the following manner.

</P>

<PRE>
group = ( +bignetgroup -smallnetgroup )
</PRE>

<P>
The `minus' command effectively eliminates its members from
<CODE>bignetgroup</CODE> if they exist within that group.  If none of the
hosts in <CODE>smallnetgroup</CODE> exist in <CODE>bignetgroup</CODE> then the
command has no effect.

</P>
<P>
<A NAME="IDX345"></A>
<A NAME="IDX346"></A>
<A NAME="IDX347"></A>
Groups may now contain previously defined cfengine groups too. This
allows one class to inherit the attributes of another class, for instance:

</P>

<PRE>

  AllSun4Hosts   = ( sonny sunny solar stella )
  AllUltrixHosts = ( ully olly wally golly )

  AllBSD = ( AllSun4Hosts AllUltrixHosts )

</PRE>

<P>
<A NAME="IDX348"></A>
<A NAME="IDX349"></A>
Finally, you can define groups (strictly classes) by the result of a shell
command. A shell command or program is deemed to be `true' if it
exits with a status of zero, i.e. it calls <CODE>exit(0)</CODE>. Any other
value is taken to be false. You can include shell commands as the members
of groups in order to define classes based on the outcomes of your
own scripts by enclosing the script in single or double quotes:

</P>

<PRE>

   have_cc = ( '/bin/test -f /usr/ucb/cc' )

</PRE>

<P>
The class <CODE>have_cc</CODE> will then be defined if the shell command returns
true. Of course, you can put any script or program in the single quotes as
long as they adhere to the convention that zero exit status means true.
If you have several members which are shell commands, then the effect is
to make the class the logical OR of the scripts' results.

</P>



<H2><A NAME="SEC85" HREF="cfengine_toc.html#TOC85">homeservers</A></H2>

<P>
<A NAME="IDX350"></A>
<A NAME="IDX351"></A>
<A NAME="IDX352"></A>

</P>
<P>
The <CODE>homeservers</CODE> declaration need only be used if you are using
cfengine's model for mounting NFS filesystems.  This declaration informs
hosts of which other hosts on the network possess filesystems containing
home directories (login areas) which client hosts should mount.

</P>
<P>
A sample homeserver declaration looks like this:

</P>

<PRE>

homeservers:

   Physics::  einstein 
   Math::     riemann euler

</PRE>

<P>
The meaning of this declaration is the following.  Any host which finds
itself to be a member of the classes on the left hand side of the
assignment need to mount all home directory resources from the hosts on
the right hand side of the assignment.  The pattern variable
<CODE>homepattern</CODE> is used to determine which resources are home
directories in the list of <CODE>mountables</CODE>.  See section <A HREF="cfengine.html#SEC96">mountables</A>.

</P>
<P>
Let us consider an example in which <CODE>homepattern</CODE> is set to the
wildcard value <SAMP>`home?'</SAMP> and the mountables list is given by

</P>

<PRE>
mountables:
   
   einstein:/mysite/einstein/home1
   einstein:/mysite/einstein/home2
   riemann:/mysite/riemann/local
   euler:/mysite/euler/home1
  
</PRE>

<P>
<A NAME="IDX353"></A>
<A NAME="IDX354"></A>

</P>
<P>
Any host in the group <CODE>Physics</CODE> would now want to mount all home
directories from the host <CODE>einstein</CODE>.  There are two of these.
Both the filesystems listed for <CODE>einstein</CODE> match the
<CODE>homepattern</CODE> variable since they end in <SAMP>`home?'</SAMP>.  cfengine
would therefore take this to mean that all hosts in <CODE>Physics</CODE>
should mount both of these filesystems.

</P>
<P>
Hosts in <CODE>Math</CODE>, on the other hand, should mount only
homedirectories from the hosts <CODE>riemann</CODE> and <CODE>euler</CODE>.  There
is only a single filesystem on <CODE>riemann</CODE> and it does not match
<CODE>homepattern</CODE>, so it is not mounted.  On <CODE>euler</CODE> there is a
match, so this filesystem will be added to the appropriate hosts.

</P>
<P>
<EM>Cfengine picks out home directory resources from the
<CODE>mountables</CODE> list by trying to match the <CODE>homepattern</CODE>
variable, starting from the end of the directory name.  You do not
therefore have to use the designation <CODE>/site/host/home?</CODE>  but this
is a simple choice and is highly recommended.</EM>

</P>



<H2><A NAME="SEC86" HREF="cfengine_toc.html#TOC86">ignore</A></H2>

<P>
When you specify a recursive search as part of a <CODE>files</CODE> action,
you would sometimes like to exclude certain directories from the list of
sub directories.  This can be accomplished by adding the directory to
the ignore-list.  For example:

</P>

<PRE>

ignore:

   any::

      #
      # Prevent tidying .X11 directores in /tmp where
      # window managers write semaphores
      #

      .X11

      #
      # Don't tidy emacs locks
      #

      !*
      /local/lib/gnu/emacs/lock/
      /local/tmp
      /local/bin/top
      /local/lib/tex/fonts
      /local/etc
      /local/www
      /local/mutils/etc/finger.log

</PRE>

<P>
None of the above directories will be checked unless a specific command
is initiated to search those directories with their names as the top of
the search tree.
<A NAME="IDX355"></A>

</P>
<P>
A handy tip if you are tidying <TT>`/tmp'</TT> recursively is to include the
directory <TT>`.X11'</TT> here.  This directory is used by the X-windows
system and deleting it while a window manager has an open session can
cause the user some trouble.

</P>
<P>
Ignore refers to all recursive searches in tidy, files, copy and links.

</P>



<H2><A NAME="SEC87" HREF="cfengine_toc.html#TOC87">import</A></H2>
<P>
<A NAME="IDX356"></A>
<A NAME="IDX357"></A>
<A NAME="IDX358"></A>
<A NAME="IDX359"></A>
<A NAME="IDX360"></A>

</P>
<P>
To break up a large configuration file into smaller files you can use
the include directive.  This conditionally reads in files if the class
on the left hand side of the assignment matches the host parsing the
file.  This enables also a variety of cfengine configuration scripts to
read in a standard set of default settings.  The syntax of the statement
is:

</P>

<PRE>

import:       

   any::
      
      cf.global_classes
 

   linux::
    
      cf.linux_classes
     

</PRE>

<P>
Note that, if you define variables in an imported file they will not be
defined for operations in their parent files. This because cfengine reads in all the
import files after the main file has been parsed--not at the place where you
call import in your script. This means that variables or macros defined in
imported files are only defined after the main program. Variables from earlier
files are inherited by later includes, but not <EM>vice-versa</EM>.

</P>
<P>
<A NAME="IDX361"></A>
<A NAME="IDX362"></A>

</P>



<H2><A NAME="SEC88" HREF="cfengine_toc.html#TOC88">links</A></H2>

<P>
<A NAME="IDX363"></A>
<A NAME="IDX364"></A>
<A NAME="IDX365"></A>

</P>

<P>
The symbolic links function is one of the greatest plusses in cfengine
as a system administration tool.  It allows you to do two things: check
single links for correctness and consistency (or make them if they do
not exist), and check or make links to every file in a designated
directory.  This latter feature is called multiple linking or linking
children.  The <CODE>linkchildren</CODE> feature is also available from the
<CODE>files</CODE> action  See section <A HREF="cfengine.html#SEC76">files</A>. The syntax of a link item is:

</P>

<PRE>

 <VAR>from-link</VAR> -&#62;[!] <VAR>to-object</VAR> 

            type=<VAR>hard/relative/absolute</VAR>
            copy=<VAR>pattern</VAR> exclude=<VAR>pattern</VAR>
            recurse=<VAR>number/inf</VAR> copytype=<VAR>checksum/ctime</VAR>
            action=<VAR>silent</VAR>

 <VAR>from-link</VAR> +&#62;[!] <VAR>to-object</VAR> 

</PRE>

<P>
<EM>The special variable <CODE>$(binserver)</CODE> can be used in <CODE>links</CODE>.</EM>

</P>



<H3><A NAME="SEC89" HREF="cfengine_toc.html#TOC89">Single links</A></H3>
<P>
<A NAME="IDX366"></A>
<A NAME="IDX367"></A>

</P>
<P>
To define a single link, you create an entry of the following
form:

</P>

<PRE>

links:

  <VAR>class</VAR>::

     <VAR>linkname</VAR> -&#62; <VAR>object_to_link_to</VAR>
     <VAR>linkname</VAR> -&#62; ./<VAR>relative_link</VAR>
     <VAR>linkname</VAR> -&#62; ../<VAR>relative_link</VAR>

</PRE>

<P>
When the <CODE>links</CODE> action is added to the <CODE>actionsequence</CODE>, such
a statement results in the testing of the named link and the file or
directory it points to.  If the link exists and is correct then no
action is taken.  If the link exists but points incorrectly then a
warning is issued.  If the link exists and points to a file which does
not exist a warning is issued unless the command line option <CODE>-L</CODE>
is used, in which case the link is deleted.  See section <A HREF="cfengine.html#SEC141">Runtime Options</A>.
<A NAME="IDX368"></A>
<A NAME="IDX369"></A>

</P>
<P>
Here is an example of some valid link statements.

</P>

<PRE>

links:

  Physics.sun4::
 
   /usr/local       -&#62; /$(site)/$(host)/local
   /home            -&#62; /$(site)/$(host)/u1
   /etc/sendmail.cf -&#62; /usr/local/mail/etc/global-sendmail.cf

   /usr/lib/sendmail -&#62;! /local/lib/sendmail 

</PRE>

<P>
cfengine makes any directories which are required leading up to the link
name on the left hand side of the arrow automatically. In the last
example the `pling' forces cfengine to make the link even if a
file for link exists previously. Plain files are saved by appending
<TT>`.cfsaved'</TT> to the filename whereas old links are removed.
The same effect can be enforced globally using the <CODE>-E</CODE> option,
but only if the program is run interactively. (In this case a prompt
is issued to make sure that you wish to use such a big hammer on your
system!)

</P>
<P>
The link operation accepts a number of parameters

</P>
<DL COMPACT>

<DT><CODE>type=<VAR>hard/relative/absolute</VAR></CODE>
<DD>
If the link type is hard, a hard link is created See section <A HREF="cfengine.html#SEC93">Hard Links</A>.
Symbolic links may specify two special types. If <CODE>relative</CODE>
is selected, and the `to' object is an absolute path name,
the link name will be rewritten as a pathname relative
to the source file, using <SAMP>`.'</SAMP> and <SAMP>`..'</SAMP> to move relative
to the current directory. For instance, a link from <TT>`/usr/local/file'</TT>
to <TT>`/usr/file'</TT> would be linked as <TT>`./../file'</TT>.
If the `to' object is already relative,
this has no effect. 

If <CODE>absolute</CODE> is specified, cfengine
will try to resolve the true path location of the `to' object,
expanding any symbolic links or dots in the path name, up to
a maximum of four levels of symbolic links. 

<A NAME="IDX370"></A>
<A NAME="IDX371"></A>
<A NAME="IDX372"></A>
<A NAME="IDX373"></A>
<A NAME="IDX374"></A>
<A NAME="IDX375"></A>

<DT><CODE>copy=<VAR>pattern</VAR></CODE>
<DD>
This option can be repeated any number of times to build up a list of
filenames or wildcards which are to be copied rather than linked
symbolically. The copy is made on an age-comparison basis. A global
variable may also be set to invoke this feature See section <A HREF="cfengine.html#SEC69">copylinks</A>.
Directories cannot be copied in this way.

<DT><CODE>copytype=<VAR>checksum/ctime</VAR></CODE>
<DD>
This specifies the basis for deciding whether to update a file
which is to be copied instead of linked See section <A HREF="cfengine.html#SEC71">copy</A>.

<DT><CODE>exclude=<VAR>pattern</VAR></CODE>
<DD>
This option can be repeated any number of times to build up a list of
filenames or wildcards which are to be excluded from the linking
process. A global variable may also be set to invoke this feature 
See section <A HREF="cfengine.html#SEC67">excludelinks</A>.

<DT><CODE>recurse=<VAR>number/</VAR>inf</CODE>
<DD>
This option can only be used with multiple link operations See section <A HREF="cfengine.html#SEC90">Multiple Links</A>.
If this option is specified, cfengine links only non-directory
objects. Directories are instead created and links within those
directories are also created. The value of this option specifies the
maximum number of levels to which cfengine should recursively descend a
link tree. <CODE>inf</CODE> means infinite recursion. Cfengine also ignores
files and directories in the ignore list See section <A HREF="cfengine.html#SEC86">ignore</A>.

</DL>

<P>
<A NAME="IDX376"></A>
<A NAME="IDX377"></A>
<A NAME="IDX378"></A>
The final feature of the links facility is connected to the use of the
cfengine model for mounting NFS filesystems.  In particular it concerns
the variable <CODE>$(binserver)</CODE>.  The easiest way to understand this
feature is to illustrate a couple of examples.  Consider the following:

</P>

<PRE>
links:

   any::

      /local -&#62; /${site}/${binserver}/local

</PRE>

<P>
The result of this command is quite different depending on which host is
executing it.  The variable <CODE>$(site)</CODE> clearly has a fixed value,
but the variable <CODE>$(binserver)</CODE> might expand to any valid binary
server for the host executing the program.  See section <A HREF="cfengine.html#SEC47">binservers</A>.  The
procedure cfengine adopts is to go through its list of mountables,
keeping only those mountable resources which belong to defined binary
servers for the current host.  It then attempts to match a filesystem by
subsituting <CODE>$(binserver)</CODE> with each of its valid binservers in
turn and it matches the first one binary server which yields an existing
file.

</P>
<P>
<A NAME="IDX379"></A>
Note that every host is a binary server for itself, so that the value of
<CODE>$(binserver)</CODE> which has absolute priority is alway the same as the
value of <CODE>$(host)</CODE>.  This ensures that the link will always be made
to a local filesystem if the rules of the model are upheld.

</P>



<H3><A NAME="SEC90" HREF="cfengine_toc.html#TOC90">Multiple Links</A></H3>
<P>
<A NAME="IDX380"></A>
<A NAME="IDX381"></A>

</P>
<P>
Using the link symbol <CODE>+&#62;</CODE>, you can choose to link all of the files
in a directory to another directory.  This is sometimes useful for
installing software.  In the example

</P>

<PRE>

links:

  myclass::

     /usr/local/bin +&#62;  /usr/local/lib/perl/bin
     /opt           +&#62;! /local

</PRE>

<P>
every file in the directory <CODE>/usr/local/lib/perl/bin</CODE> is linked
symbolically to a corresponding file in <CODE>/usr/local/bin</CODE>. The
`pling' character forces cfengine to replace old links or plain files
already existing. Old links are removed, whereas old files are saved
by appending <TT>`.cfsaved'</TT> to the filename See section <A HREF="cfengine.html#SEC56">repository</A>.

</P>
<P>
Each time cfengine runs it goes through all of the files in the
directory concerned and checks the appropriate link acordingly.  If new
files appear, new links will be added.  If a file disappears but the
link to it remains, a warning will be issued, unless the <CODE>-L</CODE>
command line option is used, in which case the link is deleted.
See section <A HREF="cfengine.html#SEC141">Runtime Options</A>.

</P>



<H3><A NAME="SEC91" HREF="cfengine_toc.html#TOC91">Link Children</A></H3>
<P>
<A NAME="IDX382"></A>
<A NAME="IDX383"></A>

</P>
<P>
The linkchildren directive is a closely related to the cfengine model
for NFS filesystems.  It is a way of making links which embodies a
rudimentary kind of `intelligence'.

</P>
<P>
<A NAME="IDX384"></A>
<A NAME="IDX385"></A>
<A NAME="IDX386"></A>
Consider the following:

</P>

<PRE>
links:

   any::

      /usr/local/lib/emacs +&#62; linkchildren

</PRE>

<P>
The word <CODE>linkchildren</CODE> automatically tells cfengine that it should
look for an appropriate file to link to on a binary server for the
current host.  The exact meaning of the above statement is as follows.
cfengine begins searching though the list of mountable resources,
discarding any filesystems which do not belong to valid binary servers.
It looks for a filesystem ending in `emacs' (the last link of the left
hand side).  If all is well, these file systems are already mounted and
they can be searched.  If no rescource is found ending in `emacs', we go
to the next link <CODE>lib</CODE> and look for a filesystem ending in `lib'.
If this is not found we go to <CODE>local</CODE> and so on.  When a match is
made, cfengine then tries to locate the file by checking whether it
exists relative to the matched filesystem.  For example, suppose `local'
matched with <CODE>host:/site/host/local</CODE>.  It would then try to locate
<CODE>host:/site/host/local/lib/emacs</CODE> and link all of the children
therein to the local file directory <CODE>/usr/local/lib/emacs</CODE>.

</P>
<P>
<A NAME="IDX387"></A>
<A NAME="IDX388"></A>
Here is another example which makes reference to the cfengine model for
mounting NFS filesystems.  Suppose you have a host with some spare disk
space.  You want to mount <CODE>/usr/local</CODE> from the binary architecture
server, but you also want to use the disk you have locally.  The
following lines

</P>

<PRE>
links:

   electron::

      /$(site)/electron/local +&#62; linkchildren

   any::

      /usr/local              -&#62; /$(site)/$(binserver)/local

</PRE>

<P>
have the effect of creating a directory <CODE>/$(site)/electron/local</CODE>
and filling it with links to all of the files and directories on the
binary server's mounted filesystem.  It results in an exact copy (by
linkage) on the local disk, but does not use up your local disk space.
The space you have remaining could, for example, be used for software
with a special license for that host.  The second link links
<CODE>/usr/local</CODE> to the `nearest' binary server.  But the nearest
binary server is always <CODE>$(host)</CODE> which means this evaluates to a
file which now exists because of the first command, so on the host
`electron' the directory <CODE>/usr/local</CODE> ends up being a link to
<CODE>/$(site)/electron/local</CODE> which is full of links to the binary
server.

</P>
<P>
If you've caught your breath after that mouthful you probably have mixed
feelings about creating a bunch of links in this way.  What happens if
the files they point to are removed? Then you are left with a lot of
useless links.  Actually this is no problem for cfengine, since you can
ask cfengine to simply remove links which point to non-existent files
See section <A HREF="cfengine.html#SEC76">files</A>.  Nevertheless, this feature clearly requires some caution
and is mainly a spice for advanced users of the cfengine model.

</P>



<H3><A NAME="SEC92" HREF="cfengine_toc.html#TOC92">Relative and absolute links</A></H3>

<P>
When specifying symbolic linking, you can ask cfengine
to change the link type to be either relative to the
source or to be an absolute path. What this means is the
following. Consider the following link:

<PRE>

   /var/tmp/cfengine -&#62; /local/cfengine

</PRE>

<P>
If we add the option <CODE>type=relative</CODE>, then instead
of creating a link which points to <TT>`/local/cfengine'</TT>,
the link is created pointing to the location

</P>

<PRE>
  ./../../local/cfengine
</PRE>

<P>
In other words, the link is relative to the calling
directory <TT>`/var/tmp'</TT>.

</P>
<P>
If a link is specified as being absolute with the option
<CODE>type=absolute</CODE>, then cfengine attempts to resolve
to value of the link so as to be the true path of the
target. If the target name contains a symbolic link, then
this is expanded as far as possible to give the true
path to the file. For example, if <TT>`/local'</TT> is
really a link to <TT>`/site/myhost/local'</TT> then the link
would point to <TT>`/site/myhost/local/cfengine'</TT>.

</P>



<H3><A NAME="SEC93" HREF="cfengine_toc.html#TOC93">Hard Links</A></H3>
<P>
<A NAME="IDX389"></A>
<A NAME="IDX390"></A>

</P>
<P>
Cfengine will also allow you to create hard links to regular files.  A
hard link is in every way identical to the original file, it merely has
a different name (technically, it is a duplicate inode). To create a
hard link you use the link-option <CODE>type=hard</CODE>. For example:

</P>

<PRE>

links:

   /<VAR>directory</VAR>/<VAR>newname</VAR> -&#62; /<VAR>directory</VAR>/<VAR>othername</VAR> type=hard

</PRE>

<P>
Cfengine will not create hard links to directories or other special files.
This is always a slightly dubious practice and is best avoided anyway.
POSIX says that the hard link can be on a different device to the file
it points to, but both BSD and System 5 restrict hard links to be on
the same device as their predecessors. Cfengine has no policy on this,
but--in the theoretical case in which the hard link and the predecessor
were on different file systems--it becomes near impossible to determine
with certainly between a hard link and a very similar regular file, and thus
cfengine issues a warning in verbose mode about this eventuality.
Provided both link and predecessor are on the same filesystem cfengine
determines the status of hard links by comparing the device and inode
numbers of the file pointed to.

</P>



<H2><A NAME="SEC94" HREF="cfengine_toc.html#TOC94">mailserver</A></H2>
<P>
<A NAME="IDX391"></A>
<A NAME="IDX392"></A>
<A NAME="IDX393"></A>

</P>
<P>
The <CODE>mailserver</CODE> declaration need only be used if you are using
cfengine's model for mounting NFS filesystems.  This declaration informs
hosts of which NFS filesystem contains mail for its users.  All hosts
apart from the mail-host itself must then mount the mail spool diretory
across the network.  The declaration looks like this:

</P>

<PRE>

mailserver:

   <VAR>class</VAR>::      mailhost:/var/spool/mail 

</PRE>

<P>
The result of the <CODE>checkmail</CODE> command in the action-sequence is now
to mount the filesystem <CODE>/var/spool/mail</CODE> on the host
<CODE>mailhost</CODE>.  This action is carried out on any machine which does
not already have that filesystem mounted.
<A NAME="IDX394"></A>

</P>
<P>
The mail spool directory is mounted, by default, onto the offical mail
spool directory for the system which is parsing the program.  In other
words, on an HPUX system, the spool directory is mounted on
<CODE>/usr/mail</CODE> by default, whereas on a Sun system it would be mounted
on <CODE>/var/spool/mail</CODE>.  The default location can be changed by using
the resource file.  See section <A HREF="cfengine.html#SEC111"><TT>`cfrc'</TT> resource file</A>.

</P>



<H2><A NAME="SEC95" HREF="cfengine_toc.html#TOC95">miscmounts</A></H2>
<P>
<A NAME="IDX395"></A>
<A NAME="IDX396"></A>
<A NAME="IDX397"></A>

</P>
<P>
If you do not use the cfengine model for statically mounting NFS
filesystems (or if there are filesystems which do not naturally fall
into the bounds of that model) then you can still statically mount
miscellaneous filesystems using a statement of the form:

</P>

<PRE>

miscmounts:

   <VAR>class</VAR>::

      <VAR>infohost</VAR>:<VAR>source-directory</VAR> <VAR>destination</VAR> <VAR>mode</VAR>

</PRE>

<P>
For example

<PRE>

   physics::

      libraryserver:/$(site)/libraryserver/data 
                          /$(site)/libraryserver/data ro

</PRE>

<P>
This statement would mount the directory
<TT>`/$(site)/libraryserver/data'</TT> physically attached to host
libraryserver onto a directory of the same name on all hosts in the
group <CODE>physics</CODE>.  The modes <CODE>ro</CODE> and <CODE>rw</CODE> signify
read-only and read-write respectively.

</P>



<H2><A NAME="SEC96" HREF="cfengine_toc.html#TOC96">mountables</A></H2>
<P>
<A NAME="IDX398"></A>
<A NAME="IDX399"></A>
<A NAME="IDX400"></A>

</P>
<P>
The <CODE>mountables</CODE> declaration need only be used if you are using
cfengine's model for mounting NFS filesystems.  This declaration informs
hosts of what filesystem resources are available for mounting.  This
list is used in conjunction with <CODE>binservers</CODE> and
<CODE>homeservers</CODE> to determine which filesystems a given host should
mount, according to the cfengine model.

</P>
<P>
The syntax of the list is:

</P>

<PRE>

mountables:

   <VAR>class</VAR>::

   server:/site/server/u1
   server:/site/server/local
   linuxhost:/site/linuxhost/local
   linuxhost:/site/linuxhost/u1

</PRE>

<P>
Notice that binary and home-directory filesystems are mixed freely here.
Cfengine determines which of the entries are homedirectories using the
<CODE>homepattern</CODE> variable.
<A NAME="IDX401"></A>
<A NAME="IDX402"></A>

</P>
<P>
Every time you add a disk or a mountable partition to your network, you
should add the partition to the list of mountables.

</P>
<P>
<EM>NOTE: This list is read in order, top down.  Cfengine looks for
the first filesystem matching a given binary server when expanding the
variable <CODE>$(binserver)</CODE>, so sometimes the ordering of filesystems
matters.</EM>

</P>
<P>
This list can be accessed in editfiles, to allow straightforward
configuration of the automounter, using the command <CODE>AutmountDirectResources</CODE>.

</P>



<H2><A NAME="SEC97" HREF="cfengine_toc.html#TOC97">processes</A></H2>
<P>
Using the processes facility, you can test for the existence of
processes, signal (kill) processes and optionally restart them
again. Cfengine opens a pipe from the system ps command and searches
through the output from this command using regular expressions to match
the lines of output from <SAMP>`ps'</SAMP>.  The regular expression does not
have to be an exact match, only a substring of the process line.  The
form of a process command is

</P>

<PRE>
processes:

    <VAR>"quoted regular expression"</VAR> restart <VAR>"shell command"</VAR> 
                        signal=<VAR>signal name</VAR>
                        matches=<VAR>number</VAR>
                        action=<VAR>signal/do/warn</VAR>

    SetOptionString <VAR>"quoted option string"</VAR>

</PRE>

<P>
By default, the options sent to ps are "-aux" for BSD systems and "-ef"
for system 5.  You can use the <CODE>SetOptionString</CODE> command to redefine
the option string. Cfengine assumes only that the first identifiable number
on each line is the process identifier for the processes, so you must not
choose options for ps which change this basic requirement (this is not a
problem in practice). Cfengine reads the output of the ps-command normally only
once, and searches through it in memory. The process table is only
reconsulted if <CODE>SetOptionString</CODE> is called. The options have the
following meanings:

</P>
<DL COMPACT>

<DT><CODE>signal=<VAR>signal name</VAR></CODE>
<DD>
This option defines the name of a signal which is to be sent to all processes
matching the quoted regular expression. If this option is omitted, no signal
is sent. The signal names have the usual
meanings. The full list, with largely standardized meanings, is


<PRE>
   hup       1   hang-up
   int       2   interrupt
   quit      3   quit
   ill       4   illegal instruction
   trap      5   trace trap
   iot       6   iot instruction
   emt       7   emt instruction
   fpe       8   floating point exception
   kill      9   kill signal
   bus      10   bus error
   segv     11   segmentation fault
   sys      12   bad argument to system call
   pipe     13   write to non existent pipe
   alrm     14   alarm clock
   term     15   software termination signal
   urg      16   urgent condition on I/O channel
   stop     17   stop signal (not from tty)
   tstp     18   stop from tty
   cont     19   continue
   chld     20   to parent on child exit/stop
   gttin    21   to readers pgrp upon background tty read
   gttou    22   like TTIN for output if (tp-&#62;t_local&#38;LTOSTOP)
   io       23   input/output possible signal
   xcpu     24   exceeded CPU time limit
   xfsz     25   exceeded file size limit
   vtalrm   26   virtual time alarm
   prof     27   profiling time alarm
   winch    28   window changed
   lost     29   resource lost (eg, record-lock lost) 
   usr1     30   user defined signal 1
   usr2     31   user defined signal 2

</PRE>

Note that cfengine will not attempt to signal or restart processes 0 to 3
on any system since such an attempt could bring down the system. The only
exception is that the hangup (hup) signal may be sent to process 1
(init) which normally forces init to reread its terminal configuration
files.
<A NAME="IDX403"></A>

<DT><CODE>restart <VAR>"shell command"</VAR></CODE>
<DD>
If the keyword `restart' appears, then the next quoted string is interpreted
as a shell command which is to be executed after any signals have been sent.
This could be used to restart a daemon for instance. Cfengine executes this
command and <EM>waits</EM> for its completion so you should normally only use
this feature to execute non-blocking commands, such as daemons which
dissociate themselves from the I/O stream and place themselves in the background.

<DT><CODE>matches=<VAR>number</VAR></CODE>
<DD>
This option may be used to set a maximum, minimum or exact number of
matches. If cfengine doesn't find a number of matches to the regular
expression which is in accordance with this value it signals a warning.
The <SAMP>`&#60;'</SAMP>, <SAMP>`&#62;'</SAMP> symbols are used  to specify upper and lower
limits. For example,


<PRE>
  matches=&#60;6  # warn number of matches not less than 6
  matches=1   # warn if not exactly 1 matching process
  matches=&#62;2  # warn if there are fewer than 2 matching processes
</PRE>

<A NAME="IDX404"></A>
<A NAME="IDX405"></A>

<DT><CODE>action=<VAR>signal/do/warn</VAR></CODE>
<DD>
The default value of this option is to silently send a signal
(if one was defined using the <CODE>signal</CODE> option) to matching
processes. This is equivalent to setting the value of this
parameter to <SAMP>`signal'</SAMP> or <SAMP>`do'</SAMP>. If you set this option
to <SAMP>`warn'</SAMP>, cfengine sends no signal, but prints a message
detailing the processes which match the regular expression.
<A NAME="IDX406"></A>
<A NAME="IDX407"></A>

</DL>

<P>
Here is an example script which sends the hang-up signal to cron,
forcing it to reread its crontab files:

</P>

<PRE>

processes:

   "cron" signal=hup

</PRE>

<P>
Here is a second example which may be used to restart the nameservice
on a solaris system:

</P>

<PRE>

processes:

   solaris::

       "named" signal=kill restart="/usr/sbin/in.named"

</PRE>

<P>
A more complex match could be used to look for processes belonging to
a particular user. Here is a script which kills ftp related processes
belonging to a particular user who is known to spend the whole day
FTP-ing files:

</P>

<PRE>

control:

    actionsequence = ( processes )

  #
  # Set a kill signal here for convenience
  #

    sig = ( kill )

  #
  # Better not find that dumpster here!
  #

    matches = ( 1 )

processes:

   #
   #  Look for Johnny Mnemonic trying to dump his head, user = jmnemon
   #

   ".*jmnemon.*ftp.*" signal=$(sig) matches=&#60;$(matches) action=$(do)

   # No mercy!

</PRE>

<P>
The regular expression <SAMP>`.*'</SAMP> matches any number of characters, so this
command searches for a line containing both the username and something to
do with ftp and sends these processes the kill signal.
Further examples may be found in the FAQ section See section <A HREF="cfengine.html#SEC114">FAQs and Tips</A>.

</P>



<H2><A NAME="SEC98" HREF="cfengine_toc.html#TOC98">required</A></H2>

<P>
This action tests for the existence of a file or filesystem.  It should
be called after all NFS filesystems have been mounted.  You may use the
special variable <CODE>$(binserver)</CODE> here.

</P>
<P>
Files or filesystems which you consider to be essential to the operation
of the system can be declared as `required'.  Cfengine will warn
if such files are not found, or if they look funny.

</P>
<P>
Suppose you mount your filesystem <CODE>/usr/local</CODE> via NFS from some
binary server.  You might want to check that this filesystem is not
empty! This might occur if the filesystem was actually <EM>not</EM>
mounted as expected, but failed for some reason.  It is therefore not
enough to check whether the directory <CODE>/usr/local</CODE> exists, one must
also check whether it contains anything sensible.

</P>
<P>
Cfengine uses two variables: <CODE>sensiblesize</CODE> and
<CODE>sensiblecount</CODE> to figure out whether a file or filsystem is
sensible or not.  You can change the default values of these variables
(which are 1000 and 2 respectively) in the <CODE>control</CODE> section.
See section <A HREF="cfengine.html#SEC49">control</A>.

</P>
<P>
If a file is smaller than <CODE>sensiblesize</CODE> or does not exist, it
fails the `required' test.  If a directory does not exist, or contains
fewer than <CODE>sensiblecount</CODE> files, then it also fails the test and a
warning is issued.

</P>

<PRE>

required:

   any::
      
      /$(site)/$(binserver)/local

</PRE>



<H2><A NAME="SEC99" HREF="cfengine_toc.html#TOC99">resolve</A></H2>

<P>
<A NAME="IDX408"></A>
<A NAME="IDX409"></A>
<A NAME="IDX410"></A>
<A NAME="IDX411"></A>

</P>
<P>
The file <CODE>/etc/resolv.conf</CODE> specifies the default nameserver for
each host, as well as the local domain name.  This file can also contain
other information, but these are the only two things cfengine currently
cares about.  In specifying nameservers you should use the dotted
numerical form of the IP addresses since your system may not understand
the text form if it is not correctly configured.  You may list as many
nameservers as you wish, with the default server at the top of the list.
The resolver normally ignores entries if you add more than three.  The
statement:

</P>

<PRE>

resolve:

  mygroup::

     129.240.22.35
     129.240.22.222
     129.240.2.3

</PRE>

<P>
declares a list of nameservers for hosts in the group or class
<CODE>mygroup</CODE>.  When you add the <CODE>resolve</CODE> command to the
<CODE>actionsequence</CODE>, this declaration together with the <CODE>domain</CODE>
variable (set here to <CODE>uio.no</CODE>) results in a
<CODE>/etc/resolv.conf</CODE> file of the form:

</P>

<PRE>

domain uio.no
nameserver 129.240.22.35
nameserver 129.240.22.222
nameserver 129.240.2.3

</PRE>

<P>
Note that the <CODE>resolve</CODE> action does not delete anything from the
file <CODE>/etc/resolv.conf</CODE>.  It adds nameservers which do not
previously exist and reorders the lines of servers which do exist.

</P>
<P>
As of version 1.3.11, you may use a quoted string to add non-nameserver
lines to this file. For example:

</P>

<PRE>

resolve:

  mygroup::

     129.240.22.35
     129.240.22.222
     "# Comment line"
     "order bind, files"

</PRE>

<P>
If the line begins with a non-numeric character, the word `nameserver'
is not added to the line.

</P>



<H2><A NAME="SEC100" HREF="cfengine_toc.html#TOC100">shellcommands</A></H2>

<P>
Cfengine focuses on fairly simple minded tasks in order to be as general
as possible.  In many cases you will therefore want to write a script to
do something special on your system.  You can still take advantage of
the classes you have defined by executing these scripts or shell
commands from this section.

</P>
<P>
The syntax is simply to quote the command you wish to be executed.
Variable substitution works within the strings.  Here are some examples.

</P>

<PRE>

shellcommands:

   sun4::

       "/usr/lib/find/updatedb"

   AllHomeServers.Sunday::

       "/dir/noseyparker /$(site)/$(host)/u1 $(sysadm) nomail"

   AllBinaryServers.sun4.Saturday::

      "/usr/etc/catman -w -M /usr/local/man"
      "/usr/etc/catman -w -M /usr/local/X11R5/man"
      "/usr/etc/catman -w -M /usr/man"
      "/usr/etc/catman -w -M /usr/local/gnu/man"

</PRE>

<P>
Some scripts, such as <CODE>noseyparker</CODE> and a
user-backup script, are included in the distribution to help you.
See section <A HREF="cfengine.html#SEC125">Using the help scripts</A>.

</P>
<P>
If you need to write more advanced scripts, which make detailed use of the
classes defined by cfengine, use the <CODE>$(allclasses)</CODE> variable to send
a complete list of classes to your script in the format

</P>

<PRE>

CFALLCLASSES=class1:class2:class3...

</PRE>

<P>
This variable is up to date at any given time with only the classes
which are defined.  The command line option <SAMP>`-u'</SAMP> or
<SAMP>`--use-env'</SAMP> defines an environment variable which is inherited by
all scripts and contains the same information.  This is not the standard
approach, since some system 5 systems cannot cope with this rapid change
of environment and generate a Bus Error.
<A NAME="IDX412"></A>
<A NAME="IDX413"></A>
<A NAME="IDX414"></A>
<A NAME="IDX415"></A>

</P>



<H2><A NAME="SEC101" HREF="cfengine_toc.html#TOC101">tidy</A></H2>
<P>
<A NAME="IDX416"></A>
<A NAME="IDX417"></A>
<A NAME="IDX418"></A>

</P>
<P>
The tidy function is used to delete (remove permanently) unwanted files
from a system.  It is useful for tidying up in <CODE>/tmp</CODE> or cleaning
out <CODE>core</CODE> files from users' home directories.  The form of an
entry is:

</P>

<PRE>
tidy:

  <VAR>class</VAR>::

      <VAR>/directory</VAR> pattern=<VAR>wildcard</VAR> recurse=<VAR>number/inf</VAR> 
                       age=<VAR>days</VAR> size=<VAR>number/empty</VAR>
                       type=<VAR>ctime/mtime/atime</VAR> 
                       dirlinks=<VAR>keep/tidy/delete</VAR>
                       rmdirs=<VAR>true/false</VAR>

</PRE>

<P>
Note that, each of the options below
can be written in either upper or lower case and abbrieviated by any
unique abbreviation.
<A NAME="IDX419"></A>
<A NAME="IDX420"></A>
<A NAME="IDX421"></A>
<A NAME="IDX422"></A>
<A NAME="IDX423"></A>
<A NAME="IDX424"></A>

</P>
<DL COMPACT>

<DT><CODE><VAR>/directory</VAR></CODE>
<DD>
This is the directory name to directories which mark the start of a
search for files matching certain wildcards.  The wildcard <CODE>home</CODE>
may be used instead of an explicit directory, in which case cfengine
iterates over all home directories.  It is compulsory to specify a
directory.

<DT><CODE>pattern=<VAR>wildcard</VAR></CODE>
<DD>
A wildcard or filename to match the files you wish to be deleted.  The
pattern may contain the special symbols <SAMP>`?'</SAMP> which matches a single
character and <SAMP>`*'</SAMP> which matches any number of characters as in the
shell.
<A NAME="IDX425"></A>

<DT><CODE>recurse=<VAR>number/inf</VAR></CODE>
<DD>
This specifier tells cfengine whether or not to recurse into
subdirectories.  If the value is zero, only the named file or directory
is affected.  If the value is 1, it will open at most one level of
subdiretory and affect the files within this scope.  If the value is
<CODE>inf</CODE> then cfengine opens all subdirectories and files beginning
from the specified filename.See section <A HREF="cfengine.html#SEC78">Recursion</A>.

<DT><CODE>age=<VAR>days</VAR></CODE>
<DD>
The age of a file in days represents a minimum <EM>access</EM> time
elapsed before the file will be deleted.  In other word a file will be
deleted if it has not been accessed for <VAR>days</VAR> days.

<DT><CODE>links=<VAR>stop/traverse/tidy</VAR></CODE>
<DD>
Normally cfengine does not decsend into subdirectories which are pointed
to by symbolic links.  If you wish to force it to do so (without using
the <CODE>-l</CODE> command line option) you may give this option the value
<CODE>true</CODE>, or <CODE>traverse</CODE>, or <CODE>follow</CODE>.  To specify no
recursion you set the value <CODE>false</CODE> or <CODE>stop</CODE>.
<A NAME="IDX426"></A>
<A NAME="IDX427"></A>
<A NAME="IDX428"></A>
Note that the value set here in the cfengine program <EM>always
overrides</EM> the value set by the <CODE>-l</CODE> command line option, so you
can protect certain actions from this command line option by specifying
a negative value here.  If you specify no value here, the behaviour is
determined by what you specify on the command line.

The value <CODE>links=tidy</CODE> has the same effect as the <SAMP>`-L'</SAMP> command
line option except that here it may be specified per item rather than
globally.  Setting this value causes links which point to non-existent
files to be deleted. This feature will not work on commands with the
<SAMP>`home'</SAMP> wildcard feature.  If you want to clean up old links you
should either user a <CODE>files</CODE> command or the command line option
which sets the tidy feature globally.
<A NAME="IDX429"></A>
<A NAME="IDX430"></A>

<DT><CODE>size=<VAR>number/empty</VAR></CODE>
<DD>
The value of this parameter decides the size in kilobytes of files
to be deleted. Files larger than this value will be deleted if they
also are older than the time specified in <CODE>age</CODE>. The default
size is zero. If the string <CODE>empty</CODE> is given, then empty
files will be deleted if older than <CODE>age</CODE>.
<A NAME="IDX431"></A>
<A NAME="IDX432"></A>

<DT><CODE>type=<VAR>ctime/mtime/atime</VAR></CODE>
<DD>
This value is used to set the type of time comparison made using
<CODE>age</CODE>. The default is to compare access times (atime) or
the last time the file was read. A comparison by modification 
time (mtime) uses the last time the contents of the file was
changed. The ctime parameter is the last time the contents, owner
or permissions of the file were changed.

<DT><CODE>dirlinks=<VAR>keep/tidy/delete</VAR></CODE>
<DD>
This value is used to decide whether cfengine will delete
links which point to directories. The default value is to keep
the links. Note that, if the travlinks option is switched on,
cfengine will not tidy or delete links which point to directories,
instead it follows them into the subdirectory.

<A NAME="IDX433"></A>
<A NAME="IDX434"></A>
<A NAME="IDX435"></A>
<A NAME="IDX436"></A>

<DT><CODE>rmdirs=<VAR>true/false</VAR></CODE>
<DD>
Normally cfengine will not delete diretories. If this option is
set to `true' then cfengine will delete any directories which
are <EM>empty</EM>. Non-empty directories will not be touched and no
message will be given unless in verbose mode. Note that this
option overrides the above option <CODE>dirlinks</CODE>, so that even
links which point to empty directories will be removed.

<A NAME="IDX437"></A>
<A NAME="IDX438"></A>
<A NAME="IDX439"></A>
<A NAME="IDX440"></A>

</DL>
<P>
Take a look at the following example:

</P>

<PRE>
tidy:

   AllHomeServers::

       home     pattern=core   R=inf age=0
       home     pattern=*~     R=inf age=7
       home     pattern=#*     R=inf age=30

   any::

       /tmp/    pat=*            R=inf   age=1
       /        pat=core         R=2     age=0
       /etc     pat=hosts.equiv  r=0     age=0

</PRE>

<P>
In the first example, all hosts in the group <CODE>AllHomeServers</CODE>
iterate a search over all user home directories looking for `core' files
(older than zero days) and <CODE>emacs</CODE> backup files <SAMP>`*~'</SAMP>,
<SAMP>`#*'</SAMP> older than seven days.

</P>
<P>
The default values for these options are the empty string for the
wildcard pattern, zero for the recursion and a specification of the age
is compulsory.

</P>
<P>
<A NAME="IDX441"></A>
<A NAME="IDX442"></A>
When cfengine tidies users' home directories, it keeps a log of all the
files it deletes each time it is run.  This means that, in case of
accidents, the user can see that the file has been deleted and restore
it from backup.  The log file is called <CODE>.cfengine.rm</CODE> and it is
placed in the home directory of each user.  The file is owned by root,
but is readable to the user concerned.

</P>
<P>
NOTE that, as of version 1.3.0, cfengine concatenates search patterns 
on the same search directory to avoid having to reparse the file tree more than once.

</P>



<H2><A NAME="SEC102" HREF="cfengine_toc.html#TOC102">unmount</A></H2>

<P>
<A NAME="IDX443"></A>
<A NAME="IDX444"></A>

</P>
<P>
The unmount function unmounts unrequired filesystems and removes the
appropriate entry from the filesystem table (<CODE>/etc/fstab</CODE> or
equivalent).  The syntax is simply

</P>

<PRE>
unmount:

   <VAR>class</VAR>::
 
      <VAR>mounthost</VAR>:<VAR>filesystem</VAR>

</PRE>

<P>
For example:

</P>

<PRE>
unmount:

   physics::

      libraryserver:/$(site)/libraryserver/data

</PRE>

<P>
If the device is busy then the actual unmount will not take place until
it becomes free, or the machine is rebooted.  This feature should work
on AIX systems, in spite of these machines inherent peculiarities in the
form of the filesystem table.

</P>



<H1><A NAME="SEC103" HREF="cfengine_toc.html#TOC103">Writing scripts for cfengine</A></H1>

<P>
<A NAME="IDX445"></A>
<A NAME="IDX446"></A>

</P>
<P>
Here is a gallery of simple-minded scripts to give you ideas for making your
own.  The absense of explicit testing in cfengine programs also
makes these scripts transparent while offering a higher level of
checking for no cost to the programmer.  Similar shell scripts with this
property would be complex indeed.

</P>



<H2><A NAME="SEC104" HREF="cfengine_toc.html#TOC104">User scripts for tidying old files</A></H2>

<P>
Here is an example script for tidying old files in your own login area.
If you want a long diagnostic, add the option <CODE>-v</CODE> to the first
line of the script, before <CODE>-f</CODE>.

</P>

<PRE>
#!/usr/local/bin/cfengine -f
#
# Tidy
#

control:

   actionsequence =
      (
      tidy
      )

files:

      $(HOME)        pat=core   r=inf  age=0
      $(HOME)        pat=*~     r=inf  age=1
      $(HOME)        pat=#*     r=inf  age=7
      $(HOME)/code   pat=*.o    r=inf  age=7
      $(HOME)/tex    pat=*.dvi  r=inf  age=7
      $(HOME)/tex    pat=*.log  r=inf  age=7
      $(HOME)/tex    pat=*.aux  r=inf  age=7

      $(HOME)/ftp    pat=*.zip  r=inf  age=7

</PRE>



<H2><A NAME="SEC105" HREF="cfengine_toc.html#TOC105">Controlled opening of files for friends and colleagues</A></H2>


<PRE>
#!/local/gnu/bin/cfengine -f
#
# Open my shared directory for others in my group
#
#

control:

  actionsequence =
     (
     files
     )

  gr = ( myshare )

files:

      $(HOME)       mode=0755 action=fixdirs r=0               
      $(HOME)/share mode=0664 action=fixall  r=inf group=$(gr)

</PRE>

<P>
In this example, first your home directory is opened for the world, then
all files in the subdirectory <CODE>share</CODE> and subdirectories are
opened to the group <CODE>myshare</CODE>.  This script could be made to run
from a login/logout script of some kind (either <CODE>.login</CODE> or
<CODE>.xsession</CODE>) so that any new files would automatically be
controlled.

</P>



<H2><A NAME="SEC106" HREF="cfengine_toc.html#TOC106">Root script for emergency disk clearing</A></H2>

<P>
A straightforward script could be used to clear space in cases where the
disk hits the overflow level.  This script tidies the whole system, not
just the affected disk.

</P>

<PRE>
#!/local/gnu/bin/cfengine -f
#
# Emergency tidyup!
#
# (Users read their cfengine.rm files to see what got deleted!)
#

control:

site = ( mysite )

mountpattern = ( $(site)/$(host) )
homepattern   = ( u? )

actionsequence =
   (
   tidy
   )

tidy:

      home            pattern=core   R=inf   age=0
      home            pattern=*~     R=inf   age=0
      home            pattern=*.dvi  R=inf   age=1
      home            pattern=*.o    R=inf   age=0
      /tmp            pattern=*      R=inf   age=0  # could be risky
      /usr/tmp        pattern=*      R=inf   age=0  #      "

ignore:

     .X11

</PRE>



<H2><A NAME="SEC107" HREF="cfengine_toc.html#TOC107">Script for making links</A></H2>

<P>
The following script could be used as part of a software installation procedure.
Note that the link types can be made relative to the from-link by using
<CODE>type=relative</CODE> See section <A HREF="cfengine.html#SEC88">links</A>.

</P>

<PRE>
#!/tmp/cfengine -v -f
#
# Simple example script to make links
#

control:

  actionsequence = ( links )

links:

 host::

   /usr/local/bin                  +&#62; /usr/local/lib/soft/bin
   /usr/local/X11/lib/app-defaults +&#62; /usr/local/lib/soft/app-defaults

</PRE>

<P>
It makes links from every binary file in the packages `bin' directory to
the more standard binary directory <CODE>/usr/local/bin</CODE>.  This avoids
having to place another search directory into the users' <CODE>path</CODE>
variable.  The second statement links the package's application defaults
files (for the X-windows system) to a directory in the
<CODE>XAPPLRESDIR</CODE> search path.

</P>
<P>
This script provides only one way of making the necessary files available
to users.  It is not the only solution to the problem.

</P>



<H2><A NAME="SEC108" HREF="cfengine_toc.html#TOC108">Ftp server</A></H2>

<P>
This script carries out the necessary for setting up a safe anonymous
ftp server on a sun workstation running SunOS4.1.

</P>

<PRE>
#!/local/gnu/bin/cfengine -f
##############################################################
#
# Cfengine script to set up an outgoing ftp server under
# SunOS 4.1.*.  Suitable for anonymous access.
#
###############################################################

control:

 addclasses = ( local global )

 actionsequence =
    (
    editfiles.global
    directories
    shellcommands
    files
    editfiles.local
    )

 ftp_root = ( /oih/saga/local/ftp )   # macro for convenience
 ftp_id   = ( 99 )                    # uid/gid for ftp

################################################################

editfiles:

 # Note the file /etc/ftpusers can contain a list of users
 # who can NOT use ftp to access files.

 global::

 { /etc/passwd

 AppendIfNoSuchLine "ftp:*:$(ftp_id):$(ftp_id): <EM>(line continues)</EM>
Anonymous ftp:$(ftp_root):/usr/ucb/ftp"
 }

 { /etc/group

 AppendIfNoSuchLine "ftp:*:$(ftp_id):"
 }

################################################################

directories:

  $(ftp_root)           mode=0555 owner=ftp
  $(ftp_root)/pub       mode=0555 owner=ftp
  $(ftp_root)/bin       mode=0555 owner=root
  $(ftp_root)/usr       mode=0555 owner=root
  $(ftp_root)/dev       mode=0555 owner=root
  $(ftp_root)/etc       mode=0555 owner=root
  $(ftp_root)/dev       mode=0555 owner=root
  $(ftp_root)/usr/lib   mode=0555 owner=root

###############################################################

shellcommands:

  "/bin/cp /bin/ls $(ftp_root)/bin/ls"
  "/bin/cp /lib/libc.so.1.8* $(ftp_root)/usr/lib"
  "/bin/cp /usr/lib/ld.so  $(ftp_root)/usr/lib"
  "/bin/cp /usr/lib/libdl.so.1.0 $(ftp_root)/usr/lib/libdl.so.1.0"
  "/usr/etc/mknod $(ftp_root)/dev/zero c 3 12 &#62; /dev/null 2&#62;&#38;1"

##########################################################################

files:

 $(ftp_root)/bin/ls     mode=111 owner=root action=fixall
 $(ftp_root)/usr/lib    mode=555 owner=root action=fixall r=1
 $(ftp_root)/etc/passwd mode=444 owner=root action=touch
 $(ftp_root)/etc/group  mode=444 owner=root action=touch
 $(ftp_root)/pub        mode=644 owner=root action=fixall

################################################################

editfiles:

 local::

 { $(ftp_root)/etc/passwd

 AppendIfNoSuchLine "ftp:*:$(ftp_id):$(ftp_id): <EM>(line continues)</EM>
Anonymous ftp:$(ftp_root):/usr/ucb/ftp"
 }

 { $(ftp_root)/etc/group

 AppendIfNoSuchLine "ftp:*:$(ftp_id):"
 }

</PRE>



<H1><A NAME="SEC109" HREF="cfengine_toc.html#TOC109">Problem solving, bugs, FAQs and tips</A></H1>



<H2><A NAME="SEC110" HREF="cfengine_toc.html#TOC110"><TT>`cf.preconf'</TT> bootstrap file</A></H2>
<P>
<A NAME="IDX447"></A>
<A NAME="IDX448"></A>
<A NAME="IDX449"></A>
<A NAME="IDX450"></A>
<A NAME="IDX451"></A>

</P>
<P>
In some cases you will want to run cfengine on a system to configure it
from scratch.  If the system is in a very bad way, it might not even be
able to parse the cfengine configuration file, perhaps because the
network was not properly configured or the DNS (Domain Name Service) was
out of action.  To help prevent this situation, cfengine looks for a
script called <CODE>cf.preconf</CODE> which gets executed prior to parsing and
can be used to perform any emergency tests.  This file needs only
contain enough to get the system to parse the configuration files.

</P>
<P>
<CODE>cf.preconf</CODE> may be any script in any language.  It need not exist
at all! It is fed one argument by cfengine, namely the system hardclass
for the current system (e.g.  <CODE>ultrix</CODE>).  Here is an example:

</P>

<PRE>
#!/bin/sh
#
# $CFINUTS/cf.preconf
#

if test $1 = "ultrix"
then
   # something
fi

if test $1 = "sun4"
then

  [ -r /lib/libc.so.1.8.3 ] &#38;&#38; \
  /bin/echo order hosts,bind,nis &#62; /etc/host.conf

fi

</PRE>

<P>
<A NAME="IDX452"></A>
<A NAME="IDX453"></A>
<A NAME="IDX454"></A>
<A NAME="IDX455"></A>

</P>



<H2><A NAME="SEC111" HREF="cfengine_toc.html#TOC111"><TT>`cfrc'</TT> resource file</A></H2>
<P>
<A NAME="IDX456"></A>
<A NAME="IDX457"></A>
<A NAME="IDX458"></A>

</P>
<P>
If, for some reason you are not satisfied with the defaults which
cfengine uses, then you can change them by making an entry in the
resource file.  The default values are defined in the source code file
<CODE>classes.c</CODE> in the distribution.  The format of the resource file
is:

</P>

<PRE>
hardclass.variable: value
</PRE>

<P>
For example, you might want to forget about where your HPUX system
mounts its mail directory and mount it under <CODE>/usr/spool/mail</CODE>.  In
this case you would add the line:

</P>

<PRE>
hpux.maildir: /usr/spool/mail
</PRE>

<P>
To redefine the filesystem table for GNU/linux, you would write:

<PRE>
linux.fstab: /etc/linuxfstab
</PRE>

<P>
The full list of redefinable resources is:

</P>

<PRE>
   mountcomm       # command used to mount filesystems
   unmountcomm     # command used to unmount filesystems
   ethernet        # name of the ethernet device
   mountopts       # options to above mount command
   fstab           # the name of the filesystemtable
   maildir         # the location of the mail directory
   netstat         # the full path to netstat and options
   pscomm          # the path to the system's ps command
   psopts          # the options used by ps (default aux/ef)
</PRE>

<P>
You should never need to redefine resources unless you decide to do something
non-standard.  Interested readers are referred to the values in <CODE>classes.c</CODE>.

</P>

<P>
<A NAME="IDX459"></A>
<A NAME="IDX460"></A>
<A NAME="IDX461"></A>

</P>
<P>
Cfengine is easily extensible so as to support a variety of
architectures.  You can even add your own.  To do so you need, first of
all, to define a new class for the operating system concerned.  The file
<EM>classes.c</EM> has been separated off from the remainder of the source
code so that you can easily see which data structures need to be
extended.

</P>
<P>
To make life as straightforward as possible, three unused classes have
been defined.  They are called (unremarkably) <EM>unused1</EM>,
<EM>unused2</EM> and <EM>unused3</EM>.  If you add any further classes, it
will be necessary to increase the constant <EM>clssattr</EM> defined in
<EM>cf.defs.h</EM> by one for every new addition.  You do not need to
change <EM>clssattr</EM> if you simple replace one of the unused classes
by a real class.

</P>
<P>
To see fully the impact of what you need to do, you should make a search
for the strings <EM>unused?</EM> in all of the source files.  Certain
special cases need to be handled for each operating system.  For
example, the form of the filesystem table is quite radically different
on some systems such as AIX.  One thing you must do is to fill in the
default values for the new operating system in the file
<EM>classes.c</EM>.

</P>
<P>
If you fill in the details for a new operating system before it finds
its way into a new release, you might consider sending the details to
the bug list in the next paragraph.

</P>



<H2><A NAME="SEC112" HREF="cfengine_toc.html#TOC112">Problems with installation</A></H2>

<P>
<A NAME="IDX462"></A>
<A NAME="IDX463"></A>
<A NAME="IDX464"></A>
<A NAME="IDX465"></A>

</P>
<P>
The installation of cfengine should not cause any problems on supported
systems. Early IRIX systems (irix 4) do not compile because the file
<TT>`/usr/include/vfs.h'</TT> does not exist. Unfortunately there is no
way to find out how to fix this (trivial) problem without having access
to an irix 4 system. If you know the answer (the appropriate header file
which replaces this) please send mail to <SAMP>`cfengine@iu.hioslo.no'</SAMP>.

</P>
<P>
Earlier versions of the GNU/Linux operating system do not have support
for some of the facilities which cfengine uses.  In particular, the
ability to use NIS netgroups is absent from earlier versions.  During
the installation procedure, the <CODE>configure</CODE> script tests for this
possibility and advises you if the facility cannot be used.  You can
still use cfengine in this case but netgroups will not be expanded.

</P>
<P>
Another problem concerns a special socket call to the TCP/IP network
interface.  This is a command which configures the static routing table
and appears to be absent from all versions of Linux.  If you are running
in verbose mode a warning message is printed, otherwise cfengine will
ignore attempts to set a default route on the system.

</P>
<P>
A number of users have experienced a problem using flex and bison
in place of lex and yacc. There appears to be a bug in one of these
programs which casues cfengine to compile correctly but misinterpret
its configuration files, generating an error of the form

</P>

<PRE>
cfengine:10:action contains invalid statement
</PRE>

<P>
for every line! The cure is to collect the latest verisons
of flex and bison from your nearest GNU site.

</P>
<P>
On really old systems, the configure program is not able to guess
what kind of system you are working on. This is true of SunOS 
versions 4.0.* and also of BSD 4.3 systems. In such cases, you might
be able to compile cfengine by using the autoconf option `host'
to specify the hosttype.

</P>

<PRE>

configure --host=sparc-sun-sunos4.0

</PRE>

<P>
Some other systems which will compile if forced are:

<PRE>
m68k-hp-bsd4.3
?-?-bsd4.3
romp-ibm-aos
?-?-aos
</PRE>

<P>
On some systems, problems arise when using flex. Flex might
generate a lexer file lex.yy.c which defines malloc or some other
function to be of a type which conflicts with the system definition.
If you obtain such a culture crash, edit the lexer file manually
and simply delete the offending definitions, then run make again.

</P>



<H2><A NAME="SEC113" HREF="cfengine_toc.html#TOC113">Bug reports and suggestions</A></H2>

<P>
<A NAME="IDX466"></A>
<A NAME="IDX467"></A>

</P>
<P>
If you experience a problem with cfengine, find a bug or have another
suggestion which you wish to air, you can send your thoughts to the
special mail address <CODE>bug-cfengine@gnu.ai.mit.edu</CODE>.

</P>
<P>
Always think a bit before sending a message to the list. This helps
to keep down the traffic improves the signal to noise ratio of your
thoughts! Try to solve the problem yourself first and look particularly
to see whether your system is clean or whether you have installed
software or patches which might conflict with cfengine (I can't really
imagine how this would happen--but it might). Always be clear
about what type of operating system you are running and whether or not
it is a complete installation.

</P>
<P>
Some vendors have begun the practice of distributing systems without key
programs like the C compiler, lex and yacc. If you have this problem,
you can pick up GNU replacements gcc, flex and bison from any GNU site.

</P>



<H2><A NAME="SEC114" HREF="cfengine_toc.html#TOC114">FAQs and Tips</A></H2>

<P>
Here is a problem solver: an encyclopaedia of suggestions and uses for
cfengine as accumulated over the years. If you have a contribution
to make, please send it to <CODE>cfengine@iu.hioslo.no</CODE>. Format
your submission like this:
<A NAME="IDX468"></A>
<A NAME="IDX469"></A>
<A NAME="IDX470"></A>
<A NAME="IDX471"></A>

</P>
<DL COMPACT>

<DT><EM>Q:</EM>
<DD>
<EM>How do I do....</EM>

<DT><EM>A:</EM>
<DD>
Very well thank-you....

</DL>
<P>
The table below is updated as the tips occur to me, or as others
contribute their own. Please note that any focusing on particular
operating systems is purely a matter of personal usage/experience and
should not be interpreted as a reflection of how many `bugs' these
systems may or may not contain.

</P>



<H3><A NAME="SEC115" HREF="cfengine_toc.html#TOC115">General</A></H3>

<DL COMPACT>

<DT><EM>Q:</EM>
<DD>
How can I check to see what cfengine will do without
going through the whole program using <SAMP>`-n'</SAMP>?

<DT><EM>A:</EM>
<DD>
Run cfengine with options:


<PRE>

  cfengine -p -d2

</PRE>

This just parses the file and dumps the contents of the
parser to the output. This is not an offical feature, so
don't expect a particularly user friendly output format.

<DT><EM>Q:</EM>
<DD>
<EM>Why doesn't cfengine have classes for each hour, instead
of just for days?</EM>
<A NAME="IDX472"></A>
<A NAME="IDX473"></A>
<A NAME="IDX474"></A>

<DT><EM>A:</EM>
<DD>
Cfengine isn't meant to be a time-keeping intstrument. The
best way to add run-dependent features is to define your
own classes using the <CODE>-D</CODE> or <CODE>-N</CODE> options.

<DT><EM>Q:</EM>
<DD>
<EM>How can I replace the stupid version of sendmail
my vendor ships with my OS with, say, Berkeley sendmail?</EM>
<A NAME="IDX475"></A>
<A NAME="IDX476"></A>
<A NAME="IDX477"></A>

<DT><EM>A:</EM>
<DD>
First of all, compile your new sendmail in a filesystem
which is held separate from the OS, for example
<TT>`/local/mail'</TT>. You can keep all the files
under this new file tree. Now you need to replace
<TT>`/usr/lib/sendmail'</TT> with the new version and
<TT>`/etc/sendmail.cf'</TT> or <TT>`/etc/mail/sendmail'</TT>
with the new files, so that the system can find them.


<PRE>

   links:
      /usr/lib/sendmail -&#62;! /local/mail/bin/sendmail
      /etc/sendmail.cf  -&#62;! /local/mail/etc/sendmail.cf

</PRE>

</DL>

<DL COMPACT>

<DT><EM>Q:</EM>
<DD>
<EM>How can I prevent big log-files like <TT>`/var/adm/wtmpx'</TT>
and <TT>`httpd/access_log'</TT> from filling up my partitions?</EM>
<A NAME="IDX478"></A>
<A NAME="IDX479"></A>
<A NAME="IDX480"></A>

<DT><EM>A:</EM>
<DD>
Add a line to disable the files once a week. That way
you still get a chance to look at them, but you keep the size
down:


<PRE>

   disable::

      Sunday::
<A NAME="IDX481"></A>
         #
         # Do this to throw away old entries
         #

         /var/adm/wtmpx rotate=truncate

         #
         # Or this to keep the last lot
         #

         /var/adm/wtmpx rotate=1

</PRE>

An alternative to using <CODE>disable</CODE> would be to use <CODE>tidy</CODE>,
but then you lose the file once and for all. Note though, that <TT>`wtmpx'</TT>
gets updated all the time, so an age <CODE>age=0</CODE> is necessary to have any
effect at all. Some daemons, like <TT>`httpd'</TT>, lose their ability to
write to a log file if you rename and create a new file. The <CODE>rotate=truncate</CODE>
option above ensures that the daemon will always be able to write to the
log file.
<A NAME="IDX482"></A>
<A NAME="IDX483"></A>
<A NAME="IDX484"></A>

</DL>

<DL COMPACT>

<DT><EM>Q:</EM>
<DD>
<EM>How can I fix exports in cfengine?</EM>
<A NAME="IDX485"></A>
<A NAME="IDX486"></A>
<A NAME="IDX487"></A>

<DT><EM>A:</EM>
<DD>
This is a complicated matter. There are lots of ways to
do it. The key is either to edit the file <TT>`/etc/exports'</TT>
(<TT>`/etc/dfs/dfstab'</TT> in solaris), or to execute an export
(share) command directly from <CODE>shellcommands</CODE>. Under Solaris
2 this is quite easy owing to the fact that the file <TT>`dfstab'</TT>
is just a script itself, rather than a configuration file
like the old <TT>`/etc/exports'</TT> file. Since
editing is limited and you need to specify a list of hosts
which might change in time, one of the following is probably
the best bet:


<PRE>

shellcommands:

   solaris::

      "/usr/sbin/share -F nfs -o rw=<VAR>netgroup</VAR> /var/mail"

</PRE>

On non-solaris systems:


<PRE>

editfiles:

   { /etc/exports

   AppendIfNoSuchLine "/<VAR>site</VAR>/<VAR>host</VAR>/<VAR>fs</VAR> -access=<VAR>netroup</VAR>"
   }

</PRE>

<DT><EM>Q:</EM>
<DD>
<EM>How can I distribute key setup files to users and keep
them up to date?</EM>
<A NAME="IDX488"></A>
<A NAME="IDX489"></A>
<A NAME="IDX490"></A>
<A NAME="IDX491"></A>
<A NAME="IDX492"></A>

<DT><EM>A:</EM>
<DD>
The copy facility will distribute to all users if you
use the <CODE>home</CODE> directive. For instance, to copy
a basic <TT>`.cshrc'</TT> file or <TT>`.xsession'</TT>, you could
write
<A NAME="IDX493"></A>
<A NAME="IDX494"></A>
<A NAME="IDX495"></A>


<PRE>

copy:

   /local/masterfiles/.cshrc     dest=home/.cshrc
   /local/masterfiles/.xsession  dest=home/.xsession

</PRE>

<DT><EM>Q:</EM>
<DD>
<EM>Some users set up their own IRC listen services called
"eggdrop" which fill up the disk with all kinds of garbage.
How can I kill all these processes?</EM>
<A NAME="IDX496"></A>
<A NAME="IDX497"></A>
<A NAME="IDX498"></A>
<A NAME="IDX499"></A>

<DT><EM>A:</EM>
<DD>

<PRE>

processes:

  #
  # Most users
  #

  "eggdrop"  signal=kill

  #
  # One wise-guy has renamed the daemon!
  #

  ".*wiseguy.*myegg.*"  signal=kill

</PRE>

<DT><EM>Q:</EM>
<DD>
<EM>My license server keeps crashing!
How can I check that it's ok?</EM>
<A NAME="IDX500"></A>
<A NAME="IDX501"></A>
<DT><EM>A:</EM>
<DD>

<PRE>

processes:

  #
  # BSD - often need long descriptove lines
  #       to find this daemon
  #

  SetOptionString "-ax"

  # Exactly one should be running

  "lmgrd" matches=1

</PRE>

<DT><EM>Q:</EM>
<DD>
<EM>I want to use cfengine to keep DNS tables up to date, using
editfiles. How can I make cfengine automatically restart
the name server after the edits?</EM>
<A NAME="IDX502"></A>

<DT><EM>A:</EM>
<DD>
This can be done in two ways. Probably, you need to
update a serial number as well as restarting the daemon.
You might use a Makefile to simplify this.


<PRE>

control:

  actionsequence = ( editfiles control )

  solaris::
           named = ( /usr/sbin/in.named)
  linux:
  freebsd:
           named = ( /usr/sbin/named )
  sun4:
           named = ( /usr/etc/named )

editfiles:

 # edit files here

shellcommands:

   #
   # If you use make to sort out the details
   #

  "/local/gnu/bin/make -f /local/named/Makefile &#62; /dev/null"

</PRE>

Or is you need to explicitly restart the name daemon, you could
supplement the above with an explicit restart command (this means
you lose the cache),


<PRE>

processes:

  "named" signal=kill restart "$(named)"

</PRE>

<DT><EM>Q:</EM>
<DD>
<EM>How can I edit all users' login files?</EM>
<A NAME="IDX503"></A>
<A NAME="IDX504"></A>
<A NAME="IDX505"></A>

<DT><EM>A:</EM>
<DD>
You can use the 'home' pseudo-variable to iterate over all users'
homedirectories:


<PRE>

editfiles:

    { home/.cshrc

    # Local fixes

    AppendIfNoSuchLine "alias lp  special-print-command"

    # Security

    DeleteLinesMatching "xhost +"
    }

</PRE>

<DT><EM>Q:</EM>
<DD>
How can I kill all processes except for root processes?

<DT><EM>A:</EM>
<DD>
The following regular expession matches lines which do not
contain the string root:


<PRE>

processes:

 "\(root\)\{0\}"  signal=term # or kill

</PRE>

<A NAME="IDX506"></A>
<A NAME="IDX507"></A>

<DT><EM>Q:</EM>
<DD>
How can I make cfengine distribute my <TT>`/etc/motd'</TT> file?
<A NAME="IDX508"></A>
<A NAME="IDX509"></A>
<A NAME="IDX510"></A>
<A NAME="IDX511"></A>

<DT><EM>A:</EM>
<DD>
You will need a master file which contains the text you want to put on
your servers. Let us define a variable `masterfile' which contains
this. This master file needs to be available on all hosts on a common
NFS filesystem, for instance.  (This will change when remote copying is
implemented in cfengine.) Now you can do something like the following
script. Note that we define a version number for motd which just
prevents cfengine from editing the file every single time.  You have to
change this version number yourself in the config file to force an
update. If you don't care about this, just leave out the Begin..End
parentheses.


<PRE>

control:

masterfile = ( /usr/local/admin/motd-master )
motd_version = ( "Message from mark 21 Aug 1996" )

editfiles:

   any::

      { /etc/motd

      BeginGroupIfNoSuchLine "$(motd_version)"
        EmptyEntireFilePlease
        InsertFile "$(masterfile)"
        PrependIfNoSuchLine "This system is running $(class):$(arch)"
        AppendIfNoSuchLine "$(motd_version)"
      EndGroup
      }

</PRE>

Note that, if you want special messages added just for, say, linux, then
you can single out linux using a special class, or add a special edit
after this one.

<A NAME="IDX512"></A>
<A NAME="IDX513"></A>
<DT><EM>bug-cfengine exchange: (Reply courtesy of David Masterson).</EM>
<DD>
&#62; I like cfengine a lot and it helps me very much, but I am a little concerned
&#62; about security. I'm using cfengine to keep some files like /etc/hosts
&#62; /etc/printcap /etc/mount etc. up to date. So cfengine is started by root in
&#62; a cron job and reads its cfengine.conf file and all the other information
&#62; from a filesystem which is common to all the systems.
&#62; If now somebody manage to alter the cfengine.conf file he can do everything
&#62; he wants.
&#62; Wouldn't it be a good idea to make the cfengine.conf file soemthing like a
&#62; pgp signed messages, so that cfengine can test if this file was created by
&#62; the right person? Or are there other tips to make it more secure?

I'm not sure, but I think you're overreacting or you need to be more specific
about where you think the holes are in CFEngine's security.  If you follow the
tips of any standard systems administrator using cfengine or not, there should
be few issues concerning security (ie. if security broke, there would be
little chance that cfengine could do anything about it anyway).

Ask yourself some of the standard questions with respect to security on UNIX:


<UL>
<LI>Who owns your script files?

<LI>Who can update those script files?

<LI>If those script files are updated by the wrong person, has your security

  been purposely broken or does it just have a hole in it?
</UL>

If you're still worried about the security of your script (be it a cfengine
script or not), you could always adjust your cron script to "decrypt" the
script file before executing it (see crypt(1)).

Personally, I think if you've set the permissions on your script files
properly, then, if someone breaks into those scripts, they've already broken
into your system to a point where they could do what they wanted anyway.

<DT><EM>Q:</EM>
<DD>
<DT><EM>A:</EM>
<DD>
</DL>



<H3><A NAME="SEC116" HREF="cfengine_toc.html#TOC116">AIX</A></H3>

<DL COMPACT>

<DT><EM>Q:</EM>
<DD>
<EM>Hints about AIX?</EM>

<DT><EM>A:</EM>
<DD>
Send then to <CODE>bug-cfengine@gnu.ai.mit.edu</CODE>.

<DT><EM>Q:</EM>
<DD>
One of our Sysadmins has noted a limitation with line length under
AIX. I'm not sure how easy it is to fix but it might be worth noting it
somewhere in the cfengine docs.  It appears that on the AIX machines the
maximum line length we can use for cfengine files is defined by the
constant YYLMAX which is set to be 200.  On the Suns this constant is
set to be the same as BUFSIZ which is currently set to be 1024.  This
manifested itself by very unusual behavior as cfengine variables began
to be overwritten when line lengths in the config file exceeded 200
bytes.  Peter can attest to this.  Be forwarned "keep line lengths in
cfengine less than 200 if you want them to work on AIX machines" Moral
of the story "AIX users beware" Do you think we could just recompile
cfengine and use larger buffer sizes all over, I don't know if this
constant is all that should be tweaked or if it is somehow tied into the
lexx implementation also, since lexx is used to create the parser for
the config files.
<A NAME="IDX514"></A>
<A NAME="IDX515"></A>
<A NAME="IDX516"></A>
<A NAME="IDX517"></A>

<DT><EM>A:</EM>
<DD>
This is a problem with lex and yacc, not with cfengine. The variable
BUFSIZ is a system quantity, not related to cfengine's internal
variable bufsize. I would recommend getting bison and flex and
doing away with the old lex and yacc from the system.

</DL>



<H3><A NAME="SEC117" HREF="cfengine_toc.html#TOC117">HPUX</A></H3>

<DL COMPACT>

<DT><EM>Q:</EM>
<DD>
<EM>What is the difference between the classes <SAMP>`hpux'</SAMP>
and <SAMP>`hpux10'</SAMP>?</EM>
<A NAME="IDX518"></A>

<DT><EM>A:</EM>
<DD>
In version 10 of HPUX, the file structure is reorganized
to look more like SVR4. If you have an HPUX-10 system,
the appropriate hardclass is <CODE>hpux10</CODE> rather than
<CODE>hpux</CODE>.

<DT><EM>Q:</EM>
<DD>
<EM>I set up the new sendmail but the configuration
file doesn't work.</EM>
<A NAME="IDX519"></A>
<A NAME="IDX520"></A>
<A NAME="IDX521"></A>
<A NAME="IDX522"></A>

<DT><EM>A:</EM>
<DD>
There could be a frozen configuration file around.
Try:


<PRE>
disable:

   hpux::

      /usr/lib/sendmail.fc
      
</PRE>

<DT><EM>Q:</EM>
<DD>
<EM>Why don't groups work in HPUX?</EM>
<A NAME="IDX523"></A>

<DT><EM>A:</EM>
<DD>
HPUX uses the file <TT>`/etc/logingroup'</TT> not <TT>`/etc/group'</TT>. Make
a link if you need to:


<PRE>
links:

  hpux::

     /etc/logingroup -&#62; /etc/group

</PRE>

</DL>



<H3><A NAME="SEC118" HREF="cfengine_toc.html#TOC118">IRIX</A></H3>

<DL COMPACT>

<DT><EM>Q:</EM>
<DD>
<EM>Hints about IRIX?</EM>

<DT><EM>A:</EM>
<DD>
Send them to <CODE>bug-cfengine@gnu.ai.mit.edu</CODE>.

</DL>



<H3><A NAME="SEC119" HREF="cfengine_toc.html#TOC119">LINUX</A></H3>

<DL COMPACT>

<DT><EM>Q:</EM>
<DD>
I keep getting segmentation fault from my cfengine scripts when I install
a completely new machine.
<A NAME="IDX524"></A>
<A NAME="IDX525"></A>
<A NAME="IDX526"></A>
<A NAME="IDX527"></A>

<DT><EM>A:</EM>
<DD>
There is a bug (apparently in Linux) which means that undefined groups
cause a segmentation fault. If a group is not in <TT>`/etc/group'</TT> or
in the NIS database, you should only get an error message, but linux
generates a core dump. I don't know of any fix except to edit group file
manually before running cfengine, or place a fix in editfiles and have this
run before files, directories etc, which make reference to the group.

<DT><EM>Q:</EM>
<DD>
<EM>Linux insists on rebuilding the message of the day file
each time it boots, but that means I keep losing the
messages I leave there.</EM>
<A NAME="IDX528"></A>
<A NAME="IDX529"></A>

<DT><EM>A:</EM>
<DD>
Add the following to your configuration files to comment out the
offending lines in the startup scripts:


<PRE>
editfiles:

   linux::

    { /etc/rc.d/rc.S
 
    HashCommentLinesContaining "motd"
    }

</PRE>

</DL>



<H3><A NAME="SEC120" HREF="cfengine_toc.html#TOC120">OSF</A></H3>

<DL COMPACT>

<DT><EM>Q:</EM>
<DD>
Hints about OSF/1?

<DT><EM>A:</EM>
<DD>
Send them to <CODE>bug-cfengine@gnu.ai.mit.edu</CODE>.

</DL>



<H3><A NAME="SEC121" HREF="cfengine_toc.html#TOC121">SUN3 (4.1.*)</A></H3>

<DL COMPACT>

<DT><EM>Q:</EM>
<DD>
<EM>How can I delete the <SAMP>`+'</SAMP> sign from the <TT>`/etc/hosts.equiv'</TT>
file to improve security?</EM>
<A NAME="IDX530"></A>
<A NAME="IDX531"></A>
<A NAME="IDX532"></A>
<A NAME="IDX533"></A>

<DT><EM>A:</EM>
<DD>
Use editfiles to delete it:


<PRE>
editfiles:

   sun4::

      { /etc/hosts.equiv

      DeleteLinesMatching "+"
      }

</PRE>

</DL>



<H3><A NAME="SEC122" HREF="cfengine_toc.html#TOC122">SUN4 (4.1.*)</A></H3>

<DL COMPACT>

<DT><EM>Q:</EM>
<DD>
<EM>How can I delete the <SAMP>`+'</SAMP> sign from the <TT>`/etc/hosts.equiv'</TT>
file to improve security?</EM>
<A NAME="IDX534"></A>
<A NAME="IDX535"></A>
<A NAME="IDX536"></A>

<DT><EM>A:</EM>
<DD>
Use editfiles to delete it:


<PRE>
editfiles:

   sun4::

      { /etc/hosts.equiv

      DeleteLinesMatching "+"
      }

</PRE>

</DL>



<H3><A NAME="SEC123" HREF="cfengine_toc.html#TOC123">SOLARIS 2</A></H3>

<DL COMPACT>

<DT><EM>Q:</EM>
<DD>
<EM>I keep getting a `bad address' error when cfengine tries
to reset the netmask and broadcast address.</EM>
<A NAME="IDX537"></A>
<A NAME="IDX538"></A>
<A NAME="IDX539"></A>
<A NAME="IDX540"></A>

<DT><EM>A:</EM>
<DD>
This is a bug in the sockets library on solaris. It is
supposed to be fixed in solaris 2.5.

</DL>

<DL COMPACT>

<DT><EM>Q:</EM>
<DD>
<EM>How can I add my own file `rc.local' to the startup bootfiles automatically?</EM>
<A NAME="IDX541"></A>
<A NAME="IDX542"></A>
<A NAME="IDX543"></A>

<DT><EM>A:</EM>
<DD>
For example, create a file called <TT>`/local/etc/rc.local'</TT> which
looks something like this:


<PRE>
#
# rc.local 
#
PATH=/local/gnu/bin:/bin:/usr/bin:/usr/sbin; export PATH

#!/bin/sh

if [ "`hostname`" = "net-server" ]; then

   echo Starting WWW server
   /local/httpd_1.4/httpd -d /local/httpd_1.4

   echo Starting GNU finger server
   /local/etc/fingerd

fi

echo Starting ypbind
/usr/lib/netsvc/yp/ypbind

echo Adding a default route and flushing table

route -f add default my-gateway 1

echo Starting xdm

/local/bin/start-xdm

</PRE>

Now add an entry to your <TT>`cfengine.conf'</TT> file like this


<PRE>

   solaris::
 
      { /etc/rc3.d/S15nfs.server
 
      AppendIfNoSuchLine "sh /local/etc/rc.local"
      }

</PRE>

Although this works just fine, it is not an offical way of adding your
own start-up commands--but Sun's implementation of inittab overloads
my cognitive array.  I can't make head nor tail of it, so if you know
a better way...write in.

</DL>

<DL COMPACT>

<DT><EM>Q:</EM>
<DD>
<EM>The solaris installation program creates <TT>`/tmp'</TT> without
the sticky bit set, so that any user can delete any files in <TT>`/tmp'</TT>.
It also means that a race condition can occur in the kernel which
can give away root access to any user!</EM>
<A NAME="IDX544"></A>
<A NAME="IDX545"></A>
<A NAME="IDX546"></A>
<A NAME="IDX547"></A>
<A NAME="IDX548"></A>
<A NAME="IDX549"></A>
<A NAME="IDX550"></A>

<DT><EM>A:</EM>
<DD>
Add the following line to the configuration immediately!


<PRE>

files:

   /tmp mode=1777 action=fixdirs

</PRE>

<DT><EM>Q:</EM>
<DD>
<EM>The ftp program will not allow me to log in to my own account!</EM>
<A NAME="IDX551"></A>
<A NAME="IDX552"></A>
<A NAME="IDX553"></A>
<A NAME="IDX554"></A>

<DT><EM>A:</EM>
<DD>
The problem is that your shell is not in the system file <TT>`/etc/shells'</TT>.
Add a line something like this:


<PRE>

editfiles:

   { /etc/shells

   AppendIfNoSuchLine "/local/bin/tcsh"
   }

</PRE>

<DT><EM>Q:</EM>
<DD>
<EM><CODE>tcsh</CODE> prints an error message on startup and will not read my
<TT>`.cshrc'</TT> file.</EM>
<A NAME="IDX555"></A>
<A NAME="IDX556"></A>
<A NAME="IDX557"></A>

<DT><EM>A:</EM>
<DD>
The problem is the central login file distributed with solaris. <TT>`tcsh'</TT>
can't understand it. Add a line


<PRE>

disable:

    /etc/.login type=file

</PRE>

You might want to replace this with a link to your own file.

<DT><EM>Q:</EM>
<DD>
<EM>Why does solaris fill up the routing table with hundreds of addresses
under the loopback interface? (see netstat -r)</EM>
<A NAME="IDX558"></A>
<A NAME="IDX559"></A>
<A NAME="IDX560"></A>
<A NAME="IDX561"></A>
<A NAME="IDX562"></A>

<DT><EM>A:</EM>
<DD>
First of all, get the latest patches for solaris, there are bugs in
the kernel of solaris 2.4 which makes this worse. Second, make
sure you have a file <TT>`/etc/defaultrouter'</TT> with the IP
address of your local gateway, if you don't intend to run your
system as a router. For instance:


<PRE>
files:

  solaris::

     /etc/defaultrouter o=root g=other m=644 act=touch

editfiles:

   solaris::

      { /etc/defaultrouter

      AppendIfNoSuchLine "xxx.xxx.xxx.1"
      }

</PRE>

where <CODE>xxx.xxx.xxx.1</CODE> is the IP address of your gateway.

<DT><EM>Q:</EM>
<DD>
When trying to boot the system, solaris fails with the
error message: <EM>fork: rescource temporarily unavailable/vfork failed</EM>.
The system then claims that there is something wrong with one of
the file systems.
<A NAME="IDX563"></A>
<A NAME="IDX564"></A>
<A NAME="IDX565"></A>
<A NAME="IDX566"></A>

<DT><EM>A:</EM>
<DD>
The file <TT>`/etc/system'</TT> has probably been corrupted. If this
file does not exist, solaris establish the kernel properly
and will not fork any processes. Things usually die early
on in the boot process. This causes the side effect that the
first fork the system needs to perform (to check the disk file
systems) fails and misinterprets the reason for failure of the
command. This makes it look as though something is wrong with
the disks. Add a line:


<PRE>

files:

   /etc/system o=root g=root m=0644 action=touch

</PRE>

</DL>



<H3><A NAME="SEC124" HREF="cfengine_toc.html#TOC124">FreeBSD</A></H3>

<DL COMPACT>

<DT><EM>Q:</EM>
<DD>
<EM>How can I stop my FreeBSD system from running the <TT>`/etc/daily'</TT> script
which mails me every single day, week and month?</EM>
<A NAME="IDX567"></A>
<A NAME="IDX568"></A>

<DT><EM>A:</EM>
<DD>
Add an editfiles command


<PRE>

 freebsd::

   { /etc/crontab
 
   HashCommentLinesContaining "daily"
   HashCommentLinesContaining "weekly"
   HashCommentLinesContaining "monthly"
   }
</PRE>

<DT><EM>Q:</EM>
<DD>
Why don't filesystems get mounted in the freebsd version of cfengine?
<A NAME="IDX569"></A>
<A NAME="IDX570"></A>

<DT><EM>A:</EM>
<DD>
Cfengine fixes the <TT>`/etc/fstab'</TT> file, but has to choose between
one of two courses of action when mounting, owing to a bug in
the mount command on FreeBSD machines. Cfengine mounts filesystems
each time it runs. On all other supported systems this causes no
problems,: once a filesystem is mounted it will not be mounted again.
Under FreeBSD however, a filesystem gets mounted again each time
mount is run, leading to multiple mount information in the mount table.
This causes cfengine to warn the the filesystem is mounted many times,
and could eventually result in a problem for the FreeBSD machine.
The policy is therefore to use mount options which do not cause this
behaviour, but an unfortunate side-effect is that newly defined
filesystems do not get mounted. You can override the mount options
if you want to force multiple mounting.

</DL>



<H1><A NAME="SEC125" HREF="cfengine_toc.html#TOC125">Using the help scripts</A></H1>
<P>
<A NAME="IDX571"></A>

</P>
<P>
The following Perl scripts are included as examples and helpful tools in
your system administration package.  If you do not have Perl, you should
get it -- it is a very useful language for system administration.

</P>



<H2><A NAME="SEC126" HREF="cfengine_toc.html#TOC126">cfwrap</A></H2>
<P>
<A NAME="IDX572"></A>
<A NAME="IDX573"></A>

</P>
<P>
It is useful to run cfengine on a daily basis from a <CODE>cron</CODE>
script.
<A NAME="IDX574"></A>
<A NAME="IDX575"></A>
<A NAME="IDX576"></A>
Use a line like the following one to start cfengine each night.  (Note the
curiosities of older BSD cronfiles).

<PRE>
0 0 * * * /usr/local/lib/cfengine-3.0/bin/cfwrap cfdaily
</PRE>

<P>
where <EM>cfdaily</EM> is a script which looks something like

</P>

<PRE>
#!/bin/sh

CFINPUTS=/usr/lib/cfengine/inputs

/usr/local/bin/cfengine
</PRE>

<P>
You will need to include full path names to the scripts in the cron file.
The syntax for using <CODE>cfwrap</CODE> is as follows.

</P>

<PRE>
host% cfwrap mycommand

host% cfwrap cfengine

host% cfwrap script_which_sets_CFINPUTS_and_calls_cfengine
</PRE>

<P>
When you run cfengine it normally only generates output if something is
wrong which needs your attention.  If you are running cfengine as a
<CODE>cron</CODE> job then the results of each job are normally mailed back to
you -- or to root.  But this causes problems in a networked
environment, since mail to root is usually redirected to some central
place which local system administrators cannot access.  Moreover, you
have no way of knowing which host sent the information.  The solution is
to use a script as a wrapper.  The script simply executes some command
and collects the output from that command into a file which then gets
mailed to some address.

</P>
<P>
<A NAME="IDX577"></A>
<A NAME="IDX578"></A>
The address to be mailed to is obtained directly from cfengine by
calling it with the <EM>-a</EM> switch.  The name of the host running
cfengine is prepended to the file before it is sent making it easy to
see where each message originated.  This is also transferred to the
subject header of the mail message.  <CODE>cfwrap</CODE> calls <CODE>cfmail</CODE>
in order to mail the result of the command back to the system
administrator.

</P>


<PRE>
#!/usr/local/bin/perl
##############################################################
#
# Script wrapper, mails output if there is any
#
# Mainly intended for running cfengine.
#
##############################################################

if ($&#60; != 0)
   {
   die "cfwrap: Bad luck, only root can run this one!\n";
   }

$mail = 0;
$sysadm = `cfengine -a`;

$CFHOME = "/usr/local/lib/cfengine";

$comm = join(" ",@ARGV);
@path = split(m;/;,$comm);
$suff = $path[$#path];
$tmpfile = "/tmp/cfwrap.$$";
$subjectfile = "/tmp/cfwrapsub.$$";

open (H,"/bin/hostname |") || die "cfwrap: Can't get hostname";
$hostname = &#60;H&#62;;
chop $hostname;
close(H);

open (SH,"$comm 2&#62;&#38;1 | ") || die "cfwrap: Can't start shell\n";
open (OUT,"&#62;/tmp/cfwrap.$$") || die "cfwrap: Can't open workfile\n";

while (&#60;SH&#62;)
   {
   if ( /\S/ )
      {
      print OUT "$_";
      $mail = 1;
      }
   }

if ($mail)
   {
   open (SUB,"&#62;$subjectfile") || die "Cannot open $subjectfile\n";
   print SUB "Subject: cfengine ($hostname)\n\n";
   print SUB "This message originates from host $hostname\n";
   print SUB "The full command issued was: $comm.\n\n";
   close(SUB);
   }

close(OUT);
close(SH);

if ($mail)
   {
   system ("/bin/cat $subjectfile $tmpfile | $CFHOME/bin/cfmail $sysadm");
   }

unlink ("$subjectfile");
unlink ("$tmpfile");

</PRE>



<H2><A NAME="SEC127" HREF="cfengine_toc.html#TOC127">cfmail</A></H2>
<P>
<A NAME="IDX579"></A>
<A NAME="IDX580"></A>

</P>

<P>
Because there are no standard mail-agents except for <EM>sendmail</EM>,
the wrapper script <EM>cfwrap</EM> calls its own simple mail agent
<EM>cfmail</EM> to send the message.  Note that the <EM>flags</EM> variable
in the script <EM>cfmail</EM> arranges for the mail message to be sent
with a return address other than "root".  This means that if the
recipient of the mail should decide to hit `r' for `reply' to reply to
the message, you have a chance of getting to see the message before it
vanishes along with the rest of the mail to <EM>root</EM> into the same
black hole that swallows up all those credit cards, house-keys and odd
socks that disappear on a daily basis.

</P>
<P>
You might have to tweak the scripts slightly to tailor them to your own needs.
They are used as follows:

</P>

<PRE>
host% echo test ....  | cfmail -s "Test message" mark 
</PRE>



<H2><A NAME="SEC128" HREF="cfengine_toc.html#TOC128">noseyparker and editquotas: software quotas</A></H2>
<P>
<A NAME="IDX581"></A>
<A NAME="IDX582"></A>

</P>
<P>
<EM>Noseyparker</EM> is a script which must be run by <EM>root</EM>.  It is used
to give a software warning about users who are hogging your disk.
It is run with the command:

<PRE>
noseyparker <VAR>homedir</VAR> $(sysadm) [nomail]
</PRE>

<P>
The directory <EM>homedir</EM> should be one of the directories in which
user's home directories reside.  This is searched for a list of
usernames.  <CODE>$(sysadm)</CODE> is the mail address of the system
administrator (which can be obtained from the cfengine variable of the
same name) and is used to send information about users who have exceeded
certain quotas.  The option <EM>nomail</EM> prevents <EM>noseyparker</EM>
from sending mail automatically to the users concerned.

</P>
<P>
Although many administrators use the quota checking facilities available
in UNIX, there are problems with these.  Many users need to generate
large temporary files (when generating postscript or TEX, or when
performing numerical calculations).  Using hard quotas prevents these
users from using their accounts effectively.  <EM>Noseyparker</EM> takes
the view that most users will tidy up files if they receive a polite
reminder -- and the few who cannot be dealt with by other means.

</P>
<P>
<EM>Noseyparker</EM> should be run once a week on each home directory on a
homeserver.  When you run <EM>noseyparker</EM>, the program generates
statistics which it keeps from week to week in order to find out how
fast data are growing.  If the number of kilobytes for a given user
exceeds a limit, a warning is generated: either a <EM>pre-warning</EM>, a
<EM>soft warning</EM> or a <EM>hard warning.</EM> If <EM>nomail</EM> is set,
only the system administrator gets a list of these users.  If it is not
set, then each user gets an automatic message telling him or her to tidy
up.  The `degree' of the message depends on the extent of the crime.
Every user gets at least three `soft warnings' before putting in the
boot.  The system administrator can see from the mail report which type
of warning each user has received.

</P>
<P>
A default quota is defined in the variable <CODE>$softlimit</CODE>.  A
pre-margin determines how early a pre-warning will be sent.  Special
quotas for particular users are set using the <EM>editquotas</EM> script

</P>

<PRE>
editquotas <VAR>homedir</VAR>
</PRE>

<P>
For example, to change the quota of a user whose home directory is on
<TT>`/mysite/myhost/u2'</TT>, one writes:

</P>

<PRE>
editquotas /mysite/myhost/u2
</PRE>

<P>
The file is edited so that it takes the form

</P>

<PRE>
<VAR>username</VAR> <VAR>quota</VAR>
<VAR>user2</VAR>    <VAR>quota2</VAR>
</PRE>

<P>
You can modify <EM>noseyparker</EM> to suit your own setup if necessary.

</P>
<P>
Here is a typical command to start <EM>noseyparker</EM>:

</P>

<PRE>
shellcommands: 
 
   homeservers.Sunday::
   
      "$(cfbin)/noseyparker /home/$(host) $(sysadm) nomail"
 
   homeservers.cfengine_model.Sunday::

      "$(cfbin)/noseyparker /$(site)/$(host)/u1 $(sysadm) nomail"

</PRE>



<H2><A NAME="SEC129" HREF="cfengine_toc.html#TOC129">cfbackup and cfrestore scripts</A></H2>
<P>
<A NAME="IDX583"></A>
<A NAME="IDX584"></A>
<A NAME="IDX585"></A>
<A NAME="IDX586"></A>
<A NAME="IDX587"></A>

</P>
<P>
Today, most people would agree that diskspace is cheap, whilst time
spent taking backups is expensive. The backup script included in the
<TT>`bin'</TT> directory solves this problem for us at Oslo College by
making automatic backups of users' directories using GNU-tar to
compressed tar files which are then placed in a spare partition of a
special disk.  The script is called up as follows:

</P>

<PRE>
shellcommands: 
 
  BackupHost.Sunday|BackupHost.Wednesday::
 
      #
      # Make a system backup of /iu/nexus/u? with Audun's script
      #
 
      "$(cfbin)/cfbackup -p -f /iu/dax/backup1 -s /iu/nexus/u1"
      "$(cfbin)/cfbackup -p -f /iu/dax/backup1 -s /iu/nexus/u2" 
      "$(cfbin)/cfbackup -p -f /iu/dax/backup2 -s /iu/nexus/u3"
      "$(cfbin)/cfbackup -p -f /iu/dax/backup2 -s /iu/nexus/u4" 
 
</PRE>

<P>
The directories to be taken backup of are listed using the <CODE>-s</CODE> option.
The directory which the files get saved to is coded in the variable <CODE>$destination</CODE>
of the (Perl) backup script. <CODE>-f</CODE> tells the script where to leave the
tar-ed backup file: in this case the user partitions are spread between two
backup areas.
The <CODE>-p</CODE> option makes sure that each user
owns his/her own backup file. This means that each user can access their backup
files themselves using the <CODE>cfrestore</CODE> script (see below).

</P>
<P>
As the backup files build up on the backup disk, you can delete older files
using the tidy function:

</P>

<PRE>

tidy:
 
   BackupHost::
 
      # Here we tidy old backup tar files from the backup area
 
      /iu/dax/backup1      pat=*  age=15
      /iu/dax/backup2      pat=*  age=15

</PRE>

<P>
This example would tidy all the old backupfiles after three
weeks.

</P>
<P>
Each user's directory (assumed to be a child of the directories named
using <CODE>-s</CODE>) is saved in a separate tar-file, labelled with the
date on which the backup was taken. They look like this:

</P>

<PRE>
backup.16.8.95.iu.nexus.u2.wiikl
backup.16.8.95.iu.nexus.u2.wullumt
backup.16.8.95.iu.nexus.u2.wux
backup.20.8.95.iu.nexus.u1.agneta
</PRE>

<P>
A file can then be recovered by typing a command like

<PRE>

cfrestore myfile

</PRE>

<P>
<A NAME="IDX588"></A>
<A NAME="IDX589"></A>
<A NAME="IDX590"></A>
<CODE>cfrestore</CODE> will then search through the tar-file for files
matching the file you request and place them in a special directory
under your home directory, labelled by the name (and date) of the tar
file from which the file was extracted.  If you know which backup file
(the date) from which you want to restore a file, you can use the
<CODE>-f <VAR>backupfile</VAR></CODE> option.

</P>
<P>
These scripts will at the very least require minor modifications for
a your local site configuration, but they can be used as a simple
and effective way of taking backups automatically.

</P>
<P>
NOTE: the scripts make convenient use of GNU tar and fileutils
packages.

</P>



<H2><A NAME="SEC130" HREF="cfengine_toc.html#TOC130">cfbg</A></H2>

<P>
Normally cfengine blocks in subprocesses. That means that when you
execute a shell command, cfengine waits for each command to exit before
continuing exuction. This serializes the execution of shellcommands.
On occasions, you might wish to force a process to dissociate from
from parent cfengine process and run in parallel. For example, you
might want the backup scripts (which can take quite a long time)
to not hold up cfengine. To do this, you can use a simple wrapper
script like <TT>`cfbg'</TT>. This command simply takes the remainder
of the command line (after cfbg) as a command to execute and
forks a new process for this command, without waiting. Cfengine is then
free to continue running. Here is an example

</P>

<PRE>
control:

  cfbin = ( /local/gnu/lib/cfengine/bin )

shellcommands:

  "$(cfbin)/cfbg $(cfbin)/cfbackup"

</PRE>

<P>
The default script writes the output of the standard out and standard error
to a file in the <TT>`/tmp'</TT> directory. Alternatively you might wish to
send the output directly to <TT>`/dev/null'</TT>.

</P>



<H1><A NAME="SEC131" HREF="cfengine_toc.html#TOC131">Example configuration files</A></H1>
<P>
<A NAME="IDX591"></A>

</P>
<P>
Here is a sample from a large configuration file, just to give you
some ideas. The file is broken up into manageable pieces for
convenience.

</P>



<H3><A NAME="SEC132" HREF="cfengine_toc.html#TOC132">cfengine.conf</A></H3>


<PRE>
<A NAME="IDX592"></A>#####################################################################
# 
#  CFENGINE CONFIGURATION FOR site = iu.hioslo.no
#
#  This file is for root only.
#
#  Contains local patches of a generic nature and imports
#  more specific files for special purposes.
#
######################################################################

###
#
# BEGIN cfengine.conf
#
###

groups:

   #
   # Define some groups
   #

   # All hosts
 
   iu = ( nexus ferengi regula borg dax lore axis worf )

   # Special groups

   diskless   = ( regula ferengi lore )
   standalone = ( nexus axis dax borg worf )

   AllHomeServers   = ( nexus )
   AllBinaryServers = ( nexus borg )

   XBootServer = ( nexus )
   WWWServers  = ( nexus )
   FTPserver   = ( nexus )
   NameServers = ( nexus )
   BackupHost  = ( nexus )
   NISserver   = ( nexus )

######################################################################

control: 

   access    = ( root )

   site      = ( iu )
   domain    = ( iu.hioslo.no )
   sysadm    = ( drift@iu.hioslo.no ) 

   netmask   = ( 255.255.255.0 )
   timezone  = ( MET )
   nfstype   = ( nfs )

   sensiblesize  = ( 1000 )
   sensiblecount = ( 2 )
   editfilesize  = ( 6000 )

   #
   # The regular action sequence
   #

   !Hourly::    

      actionsequence = 
         (
         mountall
         mountinfo
         checktimezone
         netconfig
         resolve
         unmount
         shellcommands
         addmounts
         links.basics
         files.basics
         directories
         links.others
         mailcheck
         mountall
         required
         tidy
         disable
         files
         copy
         editfiles
         )

   #
   # A shorter action sequence per hour
   #

   Hourly::

   actionsequence = 
      (
      copy
      editfiles
      tidy.somefiles
      )

   mountpattern = ( /$(site)/$(host) )
   homepattern = ( u? ) 

   addclasses = ( exclude )

   #
   # Macros &#38; constants are inherited downwards in imports
   # but are not passed up to parent files. Good idea to
   # define them all here
   #

   masterfiles = ( /iu/nexus/local/mutils )
   main_server = ( nexus )
   cfbin = ( /local/gnu/lib/cfengine/bin )
   gnu = ( /local/gnu )
   ftp = ( /local/ftp )

######################################################################

homeservers:

   iu:: nexus

binservers:

   iu.solaris::                 nexus
   iu.linux::                   borg

mailserver:

   any::
          nexus:/var/mail

mountables:

   any::

         nexus:/iu/nexus/u1
         nexus:/iu/nexus/u2
         nexus:/iu/nexus/local
         nexus:/opt/NeWSprint
         borg:/iu/borg/local

miscmounts:

   borg::   nexus:/iu/nexus/local /iu/nexus/local ro

######################################################################

import:

   #
   # Split things up to keep things tidy
   #

   any::            cf.site
   hpux::           cf.hpux
   linux::          cf.linux
   solaris::        cf.solaris
   sun4::           cf.sun4
   ultrix::         cf.ultrix
   AllHomeServers:: cf.users

######################################################################

broadcast:

  ones

defaultroute:

  iu-gw

######################################################################

resolve:

      128.39.89.10  # nexus
      158.36.85.10  # samson.hioslo.no
      129.241.1.99

######################################################################

tidy: 

   #
   # Some global tidy-ups
   #

   /tmp/                    pat=*             r=inf     A=1
   /var/tmp                 pat=*             r=inf     A=1
   /                        pat=core          r=1       A=0
   /etc                     pat=core          r=1       A=0
   /var/spool/cron/crontabs pat=root.cf*                a=0

######################################################################

ignore:                       # Don't check or tidy these directories

      /local/lib/gnu/emacs/lock/
      /local/tmp
      /local/ftp
      /local/bin/top
      /local/lib/tex/fonts
      /local/etc
      /local/www
      /local/httpd_1.4/conf
      /usr/tmp/locktelelogic
      /usr/tmp/lockIDE

<A NAME="IDX593"></A><A NAME="IDX594"></A>      #
      # Emacs lock files etc
      #

      !*

      #
      # X11 keeps X server data in /tmp/.X11
      # better not delete this!
      #
<A NAME="IDX595"></A><A NAME="IDX596"></A>
      .X11

      #
      # Some users like to give a file or two 777 protection here
      # so netsurfers can update a log or counter when running as
      # `nobody'
      #
<A NAME="IDX597"></A>
      www

#####################################################################

disable:

   /etc/hosts.equiv
   /etc/nologin
   /usr/lib/sendmail.fc

###
#
# END cfengine.conf
#
###
</PRE>



<H3><A NAME="SEC133" HREF="cfengine_toc.html#TOC133">cf.site</A></H3>
<P>
<A NAME="IDX598"></A>

</P>

<PRE>
#################################################################
#
# cf.site - for iu.hioslo.no
#
# This file contains site specific data
#
#################################################################

###
#
# BEGIN cf.site
#
###

links:

   basics::

      /local     -&#62; /$(site)/$(binserver)/local
      /usr/local -&#62; /local

   AllBinaryServers.solaris::

      /local/bin       +&#62; /local/perl5/bin

<A NAME="IDX599"></A><A NAME="IDX600"></A>   XBootServer::

      #
      # Set up a /local/tftpboot area where all X terminal
      # stuff will be kept.
      #

      /tftpboot                  -&#62; /local/tftpboot
      /etc/bootptab              -&#62; /tftpboot/bootptab
      /tftpboot/usr/lib/X11/td   -&#62; /tftpboot/td

   solaris::

      #
      # Some stuff to make things easier locally going from
      # sun4 to solaris
      #

      /var/spool/mail       -&#62;  /var/mail
      /etc/mail/sendmail.cf -&#62;! /local/mail/etc/sendmail.cf

<A NAME="IDX601"></A><A NAME="IDX602"></A>   NameServers::

      /etc/named.boot -&#62; /local/named/named.boot

   borg::

      /local/lib/irc -&#62; /iu/nexus/local/lib/irc

#############################################################

disable:

 WWWServers.Sunday::

   #
   # Disabling these log files weekly prevents them from
   # growing so enormous that they fill the disk!
   #

<A NAME="IDX603"></A>   /local/httpd_1.4/logs/access_log
   /local/httpd_1.4/logs/agent_log
   /local/httpd_1.4/logs/error_log
   /local/httpd_1.4/logs/referer_log

#################################################################

files:

      /etc/motd              m=0644 r=0 o=root act=fixplain
      /etc/motd              m=0644 r=0 o=root act=touch
      /.cshrc                m=0644 r=0 o=root act=touch

   NISserver::

      /local/etc/passwd m=0644 o=root g=other action=fixplain
      /local/etc/shadow m=0600 o=root g=other action=fixplain

   WWWServers.Sunday::

      #
      # Better touch these again since we disabled them
      #

      /local/www/cgi-bin-public/.               act=touch
      /local/httpd_1.4/logs/access_log          act=touch
      /local/httpd_1.4/logs/agent_log           act=touch
      /local/httpd_1.4/logs/error_log           act=touch
      /local/httpd_1.4/logs/referer_log         act=touch

   WWWServers::

      /local/www r=inf group=www mode=775 act=fixall

   FTPserver.solaris::
<A NAME="IDX604"></A><A NAME="IDX605"></A>
      #
      # Make sure anonymous ftp areas have the correct
      # protection, or logins won't be able to read
      # files - or perhaps a security risk. This is
      # solaris 2 specific...
      #

      $(ftp)/pub        mode=755 o=ftp g=ftp r=inf act=fixall
      $(ftp)/Obin       mode=111 o=root g=other act=fixall
      $(ftp)/etc        mode=111 o=root g=other act=fixdirs
      $(ftp)/usr/bin/ls mode=111 o=root g=other act=fixall
      $(ftp)/dev        mode=555 o=root g=other act=fixall
      $(ftp)/usr        mode=555 o=root g=other act=fixdirs

   basics::

      /etc/shells mode=0644 action=touch

   AllBinaryServers.exclude::

     /local m=-0002 r=inf o=root g=0,1,2,3,4,5,6,staff links=tidy

######################################################################

directories:

   solaris::

     #
     # httpd wants this defined
     #

      /usr/lib/X11/nls

   borg::

      #
      # Create a local tmp file for users who want
      # to make big files temporarily
      #

      /local/tmp  mode=1777 o=root g=0

#################################################################

tidy:

<A NAME="IDX606"></A>   BackupHost::

      # Here we tidy old backup tar files from the backup area
      # A special tmp area gets cleared every 4 days. The files
      # are created by Audun's backup help script (see shellcommands)

      /iu/nexus/backup      pat=*  age=21

   borg::

      #
      # Tidy the tmp area every 4 days
      #

      /local/tmp            pat=*             r=inf     age=4

#################################################################

shellcommands: 

<A NAME="IDX607"></A>  BackupHost.Sunday::

      #
      # Make a system backup of /iu/nexus/u? with Audun's script
      #

      "$(cfbin)/cfbackup -p -s /iu/nexus/u1 -s /iu/nexus/u2" 

<A NAME="IDX608"></A>  nexus.Sunday.exclude::

      #
      # See how much rubbish users have accumulated each Sunday
      #

      "$(cfbin)/noseyparker /iu/nexus/u1 $(sysadm) nomail"
      "$(cfbin)/noseyparker /iu/nexus/u2 $(sysadm) nomail" 

   nexus.exclude::

<A NAME="IDX609"></A><A NAME="IDX610"></A>      #
      # Update the GNU find/locate database each night
      #
 
      "$(gnu)/lib/locate/updatedb"

   AllBinaryServers.sun4.Saturday.exclude::

      #
      # Make sure the man -k / apropos data are up to date
      #
<A NAME="IDX611"></A><A NAME="IDX612"></A><A NAME="IDX613"></A>
      "/usr/bin/catman  -M /local/man"
      "/usr/bin/catman  -M /local/X11R5/man"
      "/usr/bin/catman  -M /usr/man"
      "/usr/bin/catman  -M /local/gnu/man"
      "/usr/bin/catman  -M /usr/openwin/share/man"
      "/usr/bin/catman  -M /local/X11R5/man"
      "/usr/bin/catman  -M /local/mutils/man"

<A NAME="IDX614"></A><A NAME="IDX615"></A>    solaris::

      #
      # A crude way to set the system clock from a known
      # reliable server. Would really like to have ntpd
      #

      "/usr/bin/rdate anyon.uio.no &#62; /dev/null"

###############################################################

editfiles:

   any::

<A NAME="IDX616"></A><A NAME="IDX617"></A><A NAME="IDX618"></A>      #
      # cfengine installs itself as a cron job - sneaky! :)
      #

      { /var/spool/cron/crontabs/root

      AppendIfNoSuchLine "0 0 * * * $(cfbin)/cfwrap $(cfbin)/cfdaily"
      }

      #
      # If tcsh (or other non standard shells) are not in /etc/shells
      # ftp won't allow logins...
      #

      { /etc/shells

      AppendIfNoSuchLine "/local/bin/tcsh"
      }

   solaris::

      #
      # A painless way to add an rc.local script to the rc files
      # under solaris without having to fight through inittab
      #

      { /etc/rc3.d/S15nfs.server

      AppendIfNoSuchLine "sh /local/etc/rc.local"
      }

   XBootServer::

      { /etc/inetd.conf

      AppendIfNoSuchLine "bootp dgram udp wait root /local/bin/bootpd bootpd -i -d"
      }

   NISserver::

<A NAME="IDX619"></A><A NAME="IDX620"></A>      #
      # Make sure the master NIS files contain some important stuff
      #

      { /local/etc/services

      WarnIfNoLineContaining "pop"
      AppendIfNoSuchLine     "bootpc          68/udp"
      AppendIfNoSuchLine     "bootp           67/udp"
      AppendIfNoSuchLine     "cfinger         2003/tcp"
      AppendIfNoSuchLine     "http            80/tcp          www"
      }

      { /local/etc/networks

      AppendIfNoSuchLine "iu-net          128.39.89"
      }

######################################################################

required:

   #
   # Any host must have a /local, /usr/local fs. Check that
   # it exists and looks sensible. (i.e. not empty)
   #

   /$(site)/$(binserver)/local

###
#
# END cf.site
#
###
</PRE>



<H3><A NAME="SEC134" HREF="cfengine_toc.html#TOC134">cf.users</A></H3>


<PRE>
#################################################################
#
# cf.users - for iu.hioslo.no
#
# This file contains user specific actions
#
#################################################################

###
#
# BEGIN cf.users
#
###

tidy:

<A NAME="IDX621"></A><A NAME="IDX622"></A>   exclude::

     #
     # Tidy up users' home dirs
     #

     home                 pat=core             r=inf       age=0
     home                 pat=a.out            r=inf       age=2
     home                 p=*%                 r=inf       age=2
     home                 p=*~                 r=inf       age=2
     home                 p=#*                 r=inf       age=1    
     home                 p=*.dvi              r=inf       age=14
     home                 p=*.log              r=inf       age=3
     home                 p=Log.*              r=inf       age=3
     home                 p=*.nfs              r=inf       age=1
     home                 p=CKP                r=inf       age=1
     home                 p=BAK                r=inf       age=1
     home                 p=log                r=inf       age=14
     home                 p=*.o                r=inf       age=7
     home                 p=*.aux              r=inf       age=3
     home/.deleted        p=*                  r=inf       age=2
     home/.wastebacket    p=*                  r=inf       age=14
<A NAME="IDX623"></A><A NAME="IDX624"></A>
     #
     # Clear the big cache files netscape creates
     #

     home/.netscape-cache p=cache????*         r=inf       age=2
     home/.MCOM-cache     p=cache????*         r=inf       age=2

#################################################################

files:

   exclude::

     #
     # Check users files are not writable to the world
     # and there are no stale links (pointing nowhere)
     #

     home mode=o-w recurse=inf action=fixall # links=tidy

#################################################################

<A NAME="IDX625"></A>copy:

   exclude::

   #
   # Make sure each user has an up to date standard
   # setup.  Cshrc just sources in a big standard file
   # which is kept in ~user/../.setupfiles/cshrc
   # to reduce disk wastage
   #

   $(masterfiles)/lib/Cshrc dest=home/.cshrc
   $(masterfiles)/lib/mwmrc dest=home/.mwmrc

   setup::

   $(masterfiles)/lib/xsession dest=home/.xsession mode=700

###
#
# END cf.users
#
###
</PRE>



<H3><A NAME="SEC135" HREF="cfengine_toc.html#TOC135">cf.sun4</A></H3>


<PRE>
#################################################################
#
# cf.sun4 - for iu.hioslo.no
#
# This file contains SunOS 4.1.x specific patches
#
#################################################################

###
#
# BEGIN cf.sun4
#
###

files:

   sun4::

      /etc/passwd    m=0644 r=0 o=root g=staff act=fixplain
      /etc/group     m=0644 r=0 o=root g=staff act=fixplain
      /dev/kmem      m=0640 r=0 o=root g=kmem  act=warnall

###
#
# BEGIN cf.sun4
#
###

</PRE>



<H3><A NAME="SEC136" HREF="cfengine_toc.html#TOC136">cf.solaris</A></H3>


<PRE>
#################################################################
#
# cf.solaris - for iu.hioslo.no
#
# This file contains solaris specific patches
#
#################################################################

###
#
# BEGIN cf.solaris
#
###

links:

      /usr/lib/sendmail     -&#62;! /local/mail/bin/sendmail
      /etc/mail/sendmail.cf -&#62;! /local/mail/etc/sendmail.cf
      /opt/gnu              -&#62; /local/gnu

##############################################################

tidy:

<A NAME="IDX626"></A><A NAME="IDX627"></A>   #
   # This file is ENORMOUS, don't let it fill disk
   #

   Wednesday::

       /var/adm   pat=wtmpx   a=0

##############################################################

copy:

   #
   # Some standard setup files, can't link because
   # machine won't boot if their not on / partition.
   #
<A NAME="IDX628"></A>
   diskless::

      /local/etc/nsswitch.diskless dest=/etc/nsswitch.conf

   standalone::

      /local/etc/nsswitch.standalone dest=/etc/nsswitch.conf

##############################################################

editfiles:

   solaris::

      { /etc/netmasks

      DeleteLinesContaining "255.255.254.0"
      AppendIfNoSuchLine "128.39  255.255.255.0"
      }

      { /etc/defaultroute

      AppendIfNoSuchLine "128.39.89.1"
      }

##############################################################

disable:

 solaris::

    /etc/.login type=file

##############################################################

files:

    #
    # If this doesn't exist, solaris can't fork any
    # processes and you can't even run the rc scripts
    # at boot time!
    #

    /etc/system       m=0644 o=root g=root action=fixplain

    /etc/passwd       m=0644 o=root g=other action=fixplain
    /etc/shadow       m=0600 o=root g=other action=fixplain
    /etc/defaultroute m=644 o=root g=other  action=touch
    /var/adm/wtmpx    m=0644 o=adm g=adm    action=touch
    /var/adm/wtmpx    m=0644 o=adm g=adm    action=fixplain
    /tmp m=1777                             action=fixdirs

###
#
# END cf.solaris
#
###
</PRE>



<H3><A NAME="SEC137" HREF="cfengine_toc.html#TOC137">cf.ultrix</A></H3>


<PRE>
#################################################################
#
# cf.ultrix - for iu.hioslo.no
#
# This file contains ultrix specific patches
#
#################################################################

###
#
# BEGIN cf.ultrix
#
###

files:

   ultrix::

      /etc/passwd          m=0644 r=0 o=root g=system act=fixplain
      /etc/group           m=0644 r=0 o=root g=system act=fixplain
      /dev/kmem            m=0640 r=0 o=root g=kmem   act=warnall
      /usr/lib/sendmail.cf m=0644 r=0 o=root g=system act=fixall
      /etc/sendmail.cf     m=0644 r=0 o=root g=system act=fixall
###
#
# END cf.ultrix
#
###

</PRE>



<H3><A NAME="SEC138" HREF="cfengine_toc.html#TOC138">cf.hpux</A></H3>


<PRE>
#################################################################
#
# cf.hpux - for iu.hioslo.no
#
# This file contains hpux specific patches
#
#################################################################

###
#
# BEGIN cf.hpux
#
###

links:

<A NAME="IDX629"></A><A NAME="IDX630"></A><A NAME="IDX631"></A><A NAME="IDX632"></A>    hpux::

       #
       # To make hpux more like other OSs
       #

       /var/spool      -&#62; /usr/spool
       /usr/spool/mail -&#62; /usr/mail
       /etc/logingroup -&#62; /etc/group
       /bin/wall       -&#62; /etc/wall

#################################################################

files:

   hpux::

      /etc/passwd           m=0644 r=0 o=root g=sys act=fixplain
      /etc/group            m=0644 r=0 o=root g=sys act=fixplain
      /dev/kmem             m=0640 r=0 o=bin  g=sys act=warnall
      /usr/lib/sendmail.cf  m=0644 r=0 o=root g=sys,other act=fixall      

###
#
# END cf.hpux
#
###

</PRE>



<H3><A NAME="SEC139" HREF="cfengine_toc.html#TOC139">cf.linux</A></H3>


<PRE>
#################################################################
#
# cf.linux - for iu.hioslo.no
#
# This file contains linux specific patches
#
#################################################################

###
#
# BEGIN cf.linux
#
###

links:

    /local/bin/tcsh   -&#62;  /bin/tcsh
    /local/bin/perl   -&#62;  /usr/bin/perl

    /etc/aliases      -&#62;! /local/mail/aliases/aliases.oih   
    /etc/sendmail.cf  -&#62;! /local/mail/etc/sendmail.linux.cf

########################################################################

editfiles:

    { /etc/rc.d/rc.6

    WarnIfNoSuchLine   "exec /local/mutils/bin/start-xdm"
    WarnIfLineStarting "exec /usr/X11/bin/xdm"
    }

    { /etc/rc.d/rc.S

    HashCommentLinesContaining "motd"
    }

    { /.rhosts

    AppendIfNoSuchLine "$(main_server)"
    AppendIfNoSuchLine "$(main_server).$(domain)"
    }

    { /etc/csh.cshrc

    AppendIfNoSuchLine "setenv TZ MET"
    }

<A NAME="IDX633"></A><A NAME="IDX634"></A>    { /etc/host.conf

    PrependIfNoSuchLine "order hosts,bind,nis"
    DeleteLinesStarting "order hosts, bind"
    }

<A NAME="IDX635"></A><A NAME="IDX636"></A>   { /etc/services

   AppendIfNoSuchLine "cfinger         2003/tcp"
   }

#########################################################################

shellcommands:

  borg::

     #
     # Find/locate database
     #

     "/usr/bin/updatedb"

#########################################################################

directories:

   #
   # Make printer spool directories...
   #

   /var/spool/VirtualLight  o=root g=other mode=755

#########################################################################

copy:

   /iu/nexus/local/gnu/lib/cfengine/inputs dest=$(gnu)/lib/cfengine/inputs
   $(masterfiles)/etc/printcap.client      dest=/etc/printcap mode=0644

###
#
# END cf.linux
#
###
</PRE>



<H3><A NAME="SEC140" HREF="cfengine_toc.html#TOC140">cf.freebsd</A></H3>


<PRE>

#################################################################
#
# cf.bsd - for iu.hioslo.no
#
# This file contains bsd specific patches
#
#################################################################

###
#
# BEGIN cf.bsd
#
###

links:

    /usr/spool        -&#62;  /var/spool
    /local/bin/tcsh   -&#62;  /bin/tcsh
    /local/bin/perl   -&#62;  /usr/bin/perl
    /usr/lib/sendmail -&#62;  /usr/sbin/sendmail

#################################################################

editfiles:

   { /etc/inetd.conf

   AppendIfNoSuchLine "finger  stream tcp nowait daemon /local/etc/in.fingerd in.fingerd"
   AppendIfNoSuchLine "cfinger stream tcp nowait daemon /local/etc/in.cfingerd in.cfingerd"
   }

   #
   # Comment out all lines to shut up this annoying cfengine-like
   # script, which sends mail every day!!!
   #

   { /etc/crontab

   HashCommentLinesContaining "daily"
   HashCommentLinesContaining "weekly"
   HashCommentLinesContaining "monthly"
   }

#################################################################

directories:

   #
   # Make printer spool directories...
   #

   /var/spool/VirtualLight  o=root g=other mode=755

#########################################################################

copy:

      $(masterfiles)/etc/printcap.client      dest=/etc/printcap mode=0644

#########################################################################

shellcommands:

     "/local/iu/bin/BSD-pw-update"

  !Hourly::

    "/usr/libexec/locate.updatedb"
    "/usr/bin/makewhatis /usr/share/man:/usr/X11R6/man:/usr/local/man:/local/gnu/man"

###
#
# END cf.bsd
#
###

</PRE>



<H1><A NAME="SEC141" HREF="cfengine_toc.html#TOC141">Runtime Options</A></H1>

<P>
Note that GNU long options are available with the syntax
<CODE>--longoption</CODE>.  The long names are given in brackets.
 
<DL COMPACT>

 
<DT><SAMP>`-a'</SAMP>
<DD>
(<CODE>--sysadm</CODE>) Print only the name of the system administrator then quit.

<DT><SAMP>`-c'</SAMP>
<DD>
(<CODE>--no-check-files</CODE>) Do not check file systems for ownership / permissions etc.

<DT><SAMP>`-C'</SAMP>
<DD>
(<CODE>--no-check-mounts</CODE>) Check mount points for consistency.  If this
option is specified then directories which lie in the "mount point"
area are checked to see whether there is anything mounted on them.
Normally this is <EM>off</EM> since not all machines use mounted file
systems in the same way.  e.g.  HPUX does not generally operate with
partitions, but nevertheless one might wish to mimick a partition-like
environment there, but it would be irritating to be informed that
nothing was mounted on the mount point.

<DT><SAMP>`-d'</SAMP>
<DD>
(<CODE>--debug</CODE>) Enable debugging output.  Normally you will want to
send this to a file using the shell script command or a pipe.
 -d1 shows only parsing output.  -d2 shows only
runtime action output.  -d0 shows both levels. Debugging ouput is
intended mainly for the author's convenience and is not a supported
feature. The details of this output may change at any time.

<DT><SAMP>`-D'</SAMP>
<DD>
(<CODE>--define</CODE>) Define a compound class symbol of the form
<EM>alpha.beta.gamma</EM>.

<DT><SAMP>`-e'</SAMP>
<DD>
(<CODE>--no-edits</CODE>) Suppress file editing.

<DT><SAMP>`-E'</SAMP>
<DD>
(<CODE>--enforce-links</CODE>) Globally force links to be created where plain
files or links already exist. The plain file is first saved by appending
the string `.cfenginesaved' to the filename. Since this option
is a big hammer, you have to use it in interactive mode and
answer a yes/no query before cfengine will run like this.

<DT><SAMP>`-f'</SAMP>
<DD>
(<CODE>--file</CODE>) Parse filename after this switch.  By default cfengine
looks for a file called <EM>cfengine.conf</EM> in the current directory.
 
<DT><SAMP>`-h'</SAMP>
<DD>
(<CODE>--help</CODE>) Help information.  Display version banner and options
summary.

<DT><SAMP>`-H'</SAMP>
<DD>
(<CODE>--no-hard-classes</CODE>). Prevents cfengine from generating any internal
class name information. Can be used for emulation purposes.
<A NAME="IDX637"></A>
<A NAME="IDX638"></A>
 
<DT><SAMP>`-i'</SAMP>
<DD>
(<CODE>--no-ifconfig</CODE>) Do not attempt to configure the local area
network interface.
 
<DT><SAMP>`-k'</SAMP>
<DD>
(<CODE>--no-copy</CODE>) Do not copy/image any files.

<DT><SAMP>`-l'</SAMP>
<DD>
(<CODE>--traverse-links</CODE>) Normally cfengine does not follow symbolic
links when recursively parsing directories.  This option will force it
to do so.
 

<DT><SAMP>`-L'</SAMP>
<DD>
(<CODE>--delete-stale-links</CODE>) Delete links which do not point to
existing files (except in user home directories, which are not touched).

<DT><SAMP>`-m'</SAMP>
<DD>
(<CODE>--no-mount</CODE>) Do not attempt to mount file systems or edit the
filesystem table.

<DT><SAMP>`-n'</SAMP>
<DD>
(<CODE>--recon</CODE>,<CODE>--dry-run</CODE>,<CODE>--just-print</CODE>) No action.  Only
print what has to be done without actually doing it.

 @item -N (<CODE>--negate</CODE>,<CODE>--undefine</CODE>) Cancel a set of classes,
or undefine (set value to <EM>false</EM>) a compound class of the form
<EM>alpha.beta.gamma</EM>.

<DT><SAMP>`-p'</SAMP>
<DD>
(<CODE>--parse-only</CODE>) Parse file and then stop.  Used for checking the
syntax of a program.  You do not have to be superuser to use this
option.

<DT><SAMP>`-s'</SAMP>
<DD>
(<CODE>--no-commands</CODE>) Do not execute scripts or shell commands.
<DT><SAMP>`-S'</SAMP>
<DD>
(<CODE>--silent</CODE>) Silence run time warnings.

<DT><SAMP>`-t'</SAMP>
<DD>
(<CODE>--no-tidy</CODE>) Do not tidy file systems.

<DT><SAMP>`-u'</SAMP>
<DD>
(<CODE>--use-env</CODE>) Causes cfengine to generate an environment variable
<SAMP>`CFALLCLASSES'</SAMP> which can be read by child processes (scripts). This
variable contains a summary of all the currently defined classes at any
given time. This option causes some system 5 systems to generate a Bus
Error or segmentation fault. The same information is available from the
cfengine internal variable <CODE>$(allclasses)</CODE> and can be passed as a
parameter to scripts.
<A NAME="IDX639"></A>
<A NAME="IDX640"></A>

<DT><SAMP>`-U'</SAMP>
<DD>
(<CODE>--underscore-classes</CODE>). When this option is set, cfengine adds
an underscore to the beginning of all hard system classes (like <CODE>_sun4</CODE>, <CODE>_linux</CODE>
etc.) This can be used to avoid naming conflicts if you are so
unjudicious as to name a host by the name of a hard class. Other classes
are not affected.

<DT><SAMP>`-v'</SAMP>
<DD>
(<CODE>--verbose</CODE>) Verbose mode.  Prints detailed information about
actions and state.

<DT><SAMP>`-V'</SAMP>
<DD>
(<CODE>--version</CODE>) Print only the version string and then quit.

<DT><SAMP>`-x'</SAMP>
<DD>
(<CODE>--no-preconf</CODE>) Do not execute the <TT>`cf.preconf'</TT> net
configuration file.

<DT><SAMP>`-X'</SAMP>
<DD>
(<CODE>--no-links</CODE>) Do not execute the <CODE>links</CODE> section of a
program.

<DT><SAMP>`-w'</SAMP>
<DD>
(<CODE>--no-warn</CODE>,<CODE>--quiet</CODE>) Do not print warning
messages.
</DL>



<H1><A NAME="SEC142" HREF="cfengine_toc.html#TOC142">Variable Index</A></H1>

<P>
<H2>!</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX52">!</A>
</DIR>
<H2>"</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX102">"</A>
</DIR>
<H2>'</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX103">'</A>
</DIR>
<H2>+</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX341">+</A>
</DIR>
<H2>-</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX98">-a option</A>, <A HREF="cfengine.html#IDX578">-a option</A>
<LI><A HREF="cfengine.html#IDX48">-D option</A>, <A HREF="cfengine.html#IDX235">-D option</A>
<LI><A HREF="cfengine.html#IDX32">-f option</A>, <A HREF="cfengine.html#IDX38">-f option</A>
<LI><A HREF="cfengine.html#IDX36">-h option</A>
<LI><A HREF="cfengine.html#IDX369">-L</A>
<LI><A HREF="cfengine.html#IDX316">-l</A>, <A HREF="cfengine.html#IDX427">-l</A>
<LI><A HREF="cfengine.html#IDX47">-N option</A>, <A HREF="cfengine.html#IDX106">-N option</A>, <A HREF="cfengine.html#IDX238">-N option</A>
<LI><A HREF="cfengine.html#IDX31">-n option</A>
<LI><A HREF="cfengine.html#IDX33">-v option</A>
<LI><A HREF="cfengine.html#IDX455">-x option</A>
</DIR>
<H2>.</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX442">.cfengine.rm</A>
</DIR>
<H2>/</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX151">/etc/cfengine.log</A>
<LI><A HREF="cfengine.html#IDX154">/etc/cfengine.pid</A>
<LI><A HREF="cfengine.html#IDX142">/etc/exports</A>
<LI><A HREF="cfengine.html#IDX453">/etc/host.conf</A>
</DIR>
<H2>`</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX104">`</A>
</DIR>
<H2>a</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX306">a=</A>, <A HREF="cfengine.html#IDX421">a=</A>
<LI><A HREF="cfengine.html#IDX307">action</A>
<LI><A HREF="cfengine.html#IDX190">actionsequence</A>, <A HREF="cfengine.html#IDX241">actionsequence</A>
<LI><A HREF="cfengine.html#IDX234">addclasses</A>
<LI><A HREF="cfengine.html#IDX250">addmounts</A>
<LI><A HREF="cfengine.html#IDX422">age</A>
<LI><A HREF="cfengine.html#IDX63">any</A>
</DIR>
<H2>b</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX266">backup=</A>
<LI><A HREF="cfengine.html#IDX76">binserver</A>, <A HREF="cfengine.html#IDX126">binserver</A>, <A HREF="cfengine.html#IDX129">binserver</A>, <A HREF="cfengine.html#IDX378">binserver</A>, <A HREF="cfengine.html#IDX386">binserver</A>
<LI><A HREF="cfengine.html#IDX170">binservers</A>
<LI><A HREF="cfengine.html#IDX173">broadcast</A>
</DIR>
<H2>c</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX448">cf.preconf</A>
<LI><A HREF="cfengine.html#IDX85">CFALLCLASSES</A>, <A HREF="cfengine.html#IDX640">CFALLCLASSES</A>
<LI><A HREF="cfengine.html#IDX458">cfrc</A>
<LI><A HREF="cfengine.html#IDX394">checkmail</A>
<LI><A HREF="cfengine.html#IDX244">checktimezone</A>
<LI><A HREF="cfengine.html#IDX180">control</A>
<LI><A HREF="cfengine.html#IDX96">cr</A>
</DIR>
<H2>d</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX251">directoriess</A>
<LI><A HREF="cfengine.html#IDX256">disable</A>, <A HREF="cfengine.html#IDX278">disable</A>
<LI><A HREF="cfengine.html#IDX79">domain</A>, <A HREF="cfengine.html#IDX182">domain</A>, <A HREF="cfengine.html#IDX194">domain</A>
</DIR>
<H2>e</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX249">editfiles</A>
<LI><A HREF="cfengine.html#IDX189">editfilesize</A>, <A HREF="cfengine.html#IDX222">editfilesize</A>
<LI><A HREF="cfengine.html#IDX288">empty</A>
</DIR>
<H2>f</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX75">faculty</A>
<LI><A HREF="cfengine.html#IDX257">files</A>, <A HREF="cfengine.html#IDX298">files</A>
<LI><A HREF="cfengine.html#IDX271">force=</A>
</DIR>
<H2>g</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX310">g=</A>
<LI><A HREF="cfengine.html#IDX311">group</A>
<LI><A HREF="cfengine.html#IDX336">groups</A>
</DIR>
<H2>h</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX314">home</A>
<LI><A HREF="cfengine.html#IDX401">homepattern</A>
<LI><A HREF="cfengine.html#IDX352">homeservers</A>
<LI><A HREF="cfengine.html#IDX228">hompat</A>
<LI><A HREF="cfengine.html#IDX77">host</A>
</DIR>
<H2>i</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX360">import</A>
</DIR>
<H2>l</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX302">l=</A>
<LI><A HREF="cfengine.html#IDX95">lf</A>
<LI><A HREF="cfengine.html#IDX303">link</A>
<LI><A HREF="cfengine.html#IDX332">linkchildren</A>, <A HREF="cfengine.html#IDX383">linkchildren</A>
<LI><A HREF="cfengine.html#IDX252">links</A>, <A HREF="cfengine.html#IDX365">links</A>
</DIR>
<H2>m</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX300">m=</A>
<LI><A HREF="cfengine.html#IDX253">mailcheck</A>
<LI><A HREF="cfengine.html#IDX393">mailserver</A>
<LI><A HREF="cfengine.html#IDX397">miscmounts</A>
<LI><A HREF="cfengine.html#IDX301">mode</A>
<LI><A HREF="cfengine.html#IDX353">mountables</A>, <A HREF="cfengine.html#IDX400">mountables</A>
<LI><A HREF="cfengine.html#IDX242">mountall</A>
<LI><A HREF="cfengine.html#IDX243">mountinfo</A>
<LI><A HREF="cfengine.html#IDX225">mountpattern</A>
</DIR>
<H2>n</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX245">netconfig</A>
<LI><A HREF="cfengine.html#IDX184">netmask</A>, <A HREF="cfengine.html#IDX198">netmask</A>
<LI><A HREF="cfengine.html#IDX186">nfstype</A>, <A HREF="cfengine.html#IDX206">nfstype</A>
</DIR>
<H2>o</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX308">o=</A>
<LI><A HREF="cfengine.html#IDX174">ones</A>
<LI><A HREF="cfengine.html#IDX309">owner</A>
</DIR>
<H2>p</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX419">p=</A>
<LI><A HREF="cfengine.html#IDX420">pattern</A>
<LI><A HREF="cfengine.html#IDX258">processes</A>
</DIR>
<H2>r</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX305">r=</A>, <A HREF="cfengine.html#IDX423">r=</A>
<LI><A HREF="cfengine.html#IDX304">recurse</A>, <A HREF="cfengine.html#IDX424">recurse</A>
<LI><A HREF="cfengine.html#IDX210">repchar</A>
<LI><A HREF="cfengine.html#IDX254">required</A>
<LI><A HREF="cfengine.html#IDX246">resolve</A>, <A HREF="cfengine.html#IDX411">resolve</A>
<LI><A HREF="cfengine.html#IDX261">Restricting access</A>
<LI><A HREF="cfengine.html#IDX287">rotate=</A>
</DIR>
<H2>s</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX187">sensiblecount</A>, <A HREF="cfengine.html#IDX220">sensiblecount</A>
<LI><A HREF="cfengine.html#IDX188">sensiblesize</A>, <A HREF="cfengine.html#IDX218">sensiblesize</A>
<LI><A HREF="cfengine.html#IDX248">shellcommands</A>
<LI><A HREF="cfengine.html#IDX74">site</A>, <A HREF="cfengine.html#IDX181">site</A>, <A HREF="cfengine.html#IDX192">site</A>
<LI><A HREF="cfengine.html#IDX93">spc</A>
<LI><A HREF="cfengine.html#IDX158">split</A>, <A HREF="cfengine.html#IDX216">split</A>
<LI><A HREF="cfengine.html#IDX80">sysadm</A>, <A HREF="cfengine.html#IDX183">sysadm</A>, <A HREF="cfengine.html#IDX196">sysadm</A>
</DIR>
<H2>t</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX94">tab</A>
<LI><A HREF="cfengine.html#IDX255">tidy</A>, <A HREF="cfengine.html#IDX418">tidy</A>
<LI><A HREF="cfengine.html#IDX78">timezone</A>, <A HREF="cfengine.html#IDX185">timezone</A>
<LI><A HREF="cfengine.html#IDX334">touch</A>
<LI><A HREF="cfengine.html#IDX281">type=</A>, <A HREF="cfengine.html#IDX390">type=</A>
</DIR>
<H2>u</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX88">underscoreclasses</A>
<LI><A HREF="cfengine.html#IDX247">unmount</A>, <A HREF="cfengine.html#IDX444">unmount</A>
</DIR>
<H2>w</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX425">Wildcards</A>
</DIR>
<H2>z</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX175">zeroes</A>
<LI><A HREF="cfengine.html#IDX176">zeros</A>
</DIR>

</P>


<H1><A NAME="SEC143" HREF="cfengine_toc.html#TOC143">Concept Index</A></H1>

<P>
<H2></H2>
<DIR>
<LI><A HREF="cfengine.html#IDX405"></A>
</DIR>
<H2>!</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX53">!</A>
</DIR>
<H2>+</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX530"><SAMP>`+'</SAMP> symbol in <TT>`/etc/hosts.equiv'</TT></A>, <A HREF="cfengine.html#IDX534"><SAMP>`+'</SAMP> symbol in <TT>`/etc/hosts.equiv'</TT></A>
</DIR>
<H2>-</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX577">-a option</A>
<LI><A HREF="cfengine.html#IDX236">-D option</A>
<LI><A HREF="cfengine.html#IDX35">-h option</A>
<LI><A HREF="cfengine.html#IDX317">-l option</A>, <A HREF="cfengine.html#IDX428">-l option</A>
<LI><A HREF="cfengine.html#IDX368"><CODE>-L</CODE> option</A>
<LI><A HREF="cfengine.html#IDX107">-N option</A>
<LI><A HREF="cfengine.html#IDX454">-x option</A>
</DIR>
<H2>.</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX148">.cfengine.rm</A>, <A HREF="cfengine.html#IDX441">.cfengine.rm</A>
<LI><A HREF="cfengine.html#IDX493"><TT>`.cshrc'</TT>, distributing</A>
<LI><A HREF="cfengine.html#IDX355">.X11 directory</A>
<LI><A HREF="cfengine.html#IDX494"><TT>`.xsession'</TT>, distributing</A>
</DIR>
<H2>/</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX149">/etc/cfengine.log</A>
<LI><A HREF="cfengine.html#IDX150">/etc/cfengine.pid</A>
<LI><A HREF="cfengine.html#IDX560"><TT>`/etc/defaultroute'</TT></A>
<LI><A HREF="cfengine.html#IDX634"><TT>`/etc/host.conf'</TT></A>
<LI><A HREF="cfengine.html#IDX452">/etc/host.conf</A>
<LI><A HREF="cfengine.html#IDX163"><TT>`/etc/hosts.equiv'</TT></A>, <A HREF="cfengine.html#IDX279"><TT>`/etc/hosts.equiv'</TT></A>
<LI><A HREF="cfengine.html#IDX630"><TT>`/etc/logingroup'</TT></A>
<LI><A HREF="cfengine.html#IDX602"><TT>`/etc/named.boot'</TT></A>
<LI><A HREF="cfengine.html#IDX619"><TT>`/etc/services'</TT></A>
<LI><A HREF="cfengine.html#IDX552"><TT>`/etc/shells'</TT></A>
<LI><A HREF="cfengine.html#IDX137"><TT>`/home'</TT></A>
<LI><A HREF="cfengine.html#IDX600"><TT>`/tftpboot'</TT></A>
<LI><A HREF="cfengine.html#IDX596"><TT>`/tmp'</TT></A>
<LI><A HREF="cfengine.html#IDX544"><TT>`/tmp'</TT> under solaris</A>
<LI><A HREF="cfengine.html#IDX138"><TT>`/users'</TT></A>
<LI><A HREF="cfengine.html#IDX164"><TT>`/var/adm/wtmpx'</TT></A>, <A HREF="cfengine.html#IDX627"><TT>`/var/adm/wtmpx'</TT></A>
<LI><A HREF="cfengine.html#IDX165"><TT>`/var/lp/logs/lpsched'</TT></A>
</DIR>
<H2>a</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX373">Absolute links</A>
<LI><A HREF="cfengine.html#IDX111">Access control</A>, <A HREF="cfengine.html#IDX260">Access control</A>
<LI><A HREF="cfengine.html#IDX240">action sequence</A>
<LI><A HREF="cfengine.html#IDX20">Actions, order of</A>
<LI><A HREF="cfengine.html#IDX232">Adding defined classes</A>
<LI><A HREF="cfengine.html#IDX459">Adding new classes</A>
<LI><A HREF="cfengine.html#IDX134">AFS</A>, <A HREF="cfengine.html#IDX207">AFS</A>
<LI><A HREF="cfengine.html#IDX413">allclasses variable</A>
<LI><A HREF="cfengine.html#IDX208">Andrew filesystem</A>
<LI><A HREF="cfengine.html#IDX108">Annulling entries when debugging</A>
<LI><A HREF="cfengine.html#IDX613">apropos setup</A>
<LI><A HREF="cfengine.html#IDX436">atime tidies</A>
<LI><A HREF="cfengine.html#IDX133"><TT>`auto_direct'</TT></A>
<LI><A HREF="cfengine.html#IDX132"><TT>`auto_master'</TT></A>
<LI><A HREF="cfengine.html#IDX585">Automatic backup</A>
<LI><A HREF="cfengine.html#IDX589">Automatic restoring of lost files</A>
<LI><A HREF="cfengine.html#IDX131">automount</A>
<LI><A HREF="cfengine.html#IDX294">automounter</A>
</DIR>
<H2>b</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX583">Backing up filesystems</A>
<LI><A HREF="cfengine.html#IDX265">Backup of files in copy</A>
<LI><A HREF="cfengine.html#IDX145">Backup policy</A>
<LI><A HREF="cfengine.html#IDX586">Backup, automatic</A>
<LI><A HREF="cfengine.html#IDX606">Backup, users</A>, <A HREF="cfengine.html#IDX607">Backup, users</A>
<LI><A HREF="cfengine.html#IDX537">Bad address error in solaris</A>
<LI><A HREF="cfengine.html#IDX477">Berkeley sendmail</A>
<LI><A HREF="cfengine.html#IDX116">Binary server</A>
<LI><A HREF="cfengine.html#IDX127">Binary server, matching</A>
<LI><A HREF="cfengine.html#IDX376">Binary servers and links</A>, <A HREF="cfengine.html#IDX384">Binary servers and links</A>
<LI><A HREF="cfengine.html#IDX120">Binary servers, declaring</A>
<LI><A HREF="cfengine.html#IDX168">Binary servers, defining</A>
<LI><A HREF="cfengine.html#IDX171">Binary servers, priority</A>, <A HREF="cfengine.html#IDX379">Binary servers, priority</A>
<LI><A HREF="cfengine.html#IDX128">binserver variable and actionsequence</A>
<LI><A HREF="cfengine.html#IDX449">Bootstrap file</A>
<LI><A HREF="cfengine.html#IDX172">Broadcast address</A>
<LI><A HREF="cfengine.html#IDX539">Broadcast with solaris 2.4</A>
<LI><A HREF="cfengine.html#IDX466">Bugs, reporting</A>
</DIR>
<H2>c</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX624">Cache files, netscape</A>
<LI><A HREF="cfengine.html#IDX611">catman</A>
<LI><A HREF="cfengine.html#IDX447">cf.preconf bootstrap file</A>
<LI><A HREF="cfengine.html#IDX598"><TT>`cf.site'</TT></A>
<LI><A HREF="cfengine.html#IDX84">CFALLCLASSES</A>, <A HREF="cfengine.html#IDX412">CFALLCLASSES</A>
<LI><A HREF="cfengine.html#IDX587">cfbackup</A>
<LI><A HREF="cfengine.html#IDX113">cfengine model</A>
<LI><A HREF="cfengine.html#IDX122">cfengine model, how it works</A>
<LI><A HREF="cfengine.html#IDX513">Cfengine security worries</A>
<LI><A HREF="cfengine.html#IDX618">cfengine, crontabs</A>
<LI><A HREF="cfengine.html#IDX616">cfengine, installs itself</A>
<LI><A HREF="cfengine.html#IDX27">cfengine, starting</A>
<LI><A HREF="cfengine.html#IDX30"><TT>`cfengine.conf'</TT></A>, <A HREF="cfengine.html#IDX43"><TT>`cfengine.conf'</TT></A>, <A HREF="cfengine.html#IDX592"><TT>`cfengine.conf'</TT></A>
<LI><A HREF="cfengine.html#IDX39">CFINPUTS variable</A>
<LI><A HREF="cfengine.html#IDX456">cfrc resource file</A>
<LI><A HREF="cfengine.html#IDX588">cfrestore</A>
<LI><A HREF="cfengine.html#IDX572">cfwrap, wrapper script</A>
<LI><A HREF="cfengine.html#IDX86">Class data and scripts</A>
<LI><A HREF="cfengine.html#IDX349">Class decided by shell command</A>
<LI><A HREF="cfengine.html#IDX346">Class dependencies</A>
<LI><A HREF="cfengine.html#IDX415">Class information, passing to scripts</A>
<LI><A HREF="cfengine.html#IDX65">Class, generic any</A>
<LI><A HREF="cfengine.html#IDX44">Classes</A>
<LI><A HREF="cfengine.html#IDX59">Classes based on shell commands</A>
<LI><A HREF="cfengine.html#IDX233">Classes, adding and defining</A>
<LI><A HREF="cfengine.html#IDX46">Classes, compound</A>
<LI><A HREF="cfengine.html#IDX49">Classes, defining and undefining</A>
<LI><A HREF="cfengine.html#IDX17">Comments</A>
<LI><A HREF="cfengine.html#IDX45">Compound classes</A>
<LI><A HREF="cfengine.html#IDX29">Config file, default name</A>
<LI><A HREF="cfengine.html#IDX1">Control files</A>
<LI><A HREF="cfengine.html#IDX179">control section</A>
<LI><A HREF="cfengine.html#IDX479">Controlling logfiles</A>
<LI><A HREF="cfengine.html#IDX284">Controlling the size of log files</A>
<LI><A HREF="cfengine.html#IDX262">copy</A>, <A HREF="cfengine.html#IDX488">copy</A>
<LI><A HREF="cfengine.html#IDX263">Copying files</A>
<LI><A HREF="cfengine.html#IDX146">core files, caution!</A>
<LI><A HREF="cfengine.html#IDX617">cron</A>
<LI><A HREF="cfengine.html#IDX574">cron script to start cfengine</A>
<LI><A HREF="cfengine.html#IDX434">ctime tidies</A>
</DIR>
<H2>d</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX609">Database, updating</A>
<LI><A HREF="cfengine.html#IDX450">Deadlock</A>
<LI><A HREF="cfengine.html#IDX109">Debugging, annulling entries</A>
<LI><A HREF="cfengine.html#IDX28">Default file</A>
<LI><A HREF="cfengine.html#IDX561"><TT>`defaultroute'</TT></A>
<LI><A HREF="cfengine.html#IDX169">Defining a binary server</A>
<LI><A HREF="cfengine.html#IDX351">Defining a home server</A>
<LI><A HREF="cfengine.html#IDX392">Defining a mail server</A>
<LI><A HREF="cfengine.html#IDX399">Defining a mountable</A>
<LI><A HREF="cfengine.html#IDX231">Defining classes</A>, <A HREF="cfengine.html#IDX237">Defining classes</A>
<LI><A HREF="cfengine.html#IDX337">Defining groups</A>
<LI><A HREF="cfengine.html#IDX439">Deleting directories</A>
<LI><A HREF="cfengine.html#IDX417">Deleting files</A>
<LI><A HREF="cfengine.html#IDX318">Deleting stale links</A>, <A HREF="cfengine.html#IDX429">Deleting stale links</A>
<LI><A HREF="cfengine.html#IDX347">Dependencies</A>
<LI><A HREF="cfengine.html#IDX268">Device boundaries</A>
<LI><A HREF="cfengine.html#IDX322">Device boundaries and files</A>
<LI><A HREF="cfengine.html#IDX135">DFS</A>, <A HREF="cfengine.html#IDX209">DFS</A>
<LI><A HREF="cfengine.html#IDX440">Directories, deleting</A>
<LI><A HREF="cfengine.html#IDX272">Directories, making</A>
<LI><A HREF="cfengine.html#IDX67">Directory Names, use of wildcards</A>
<LI><A HREF="cfengine.html#IDX326">Directory permissions</A>
<LI><A HREF="cfengine.html#IDX482">disable, problems with logging afterwards</A>
<LI><A HREF="cfengine.html#IDX484">disable, trimming log files</A>
<LI><A HREF="cfengine.html#IDX282">Disabling file types</A>
<LI><A HREF="cfengine.html#IDX276">Disabling files</A>
<LI><A HREF="cfengine.html#IDX489">Distributing files</A>
<LI><A HREF="cfengine.html#IDX495">Distributing user files</A>, <A HREF="cfengine.html#IDX625">Distributing user files</A>
<LI><A HREF="cfengine.html#IDX9">DNS</A>, <A HREF="cfengine.html#IDX408">DNS</A>
<LI><A HREF="cfengine.html#IDX193">domain</A>
<LI><A HREF="cfengine.html#IDX199">Domain name</A>
<LI><A HREF="cfengine.html#IDX324">DOMAIN OS</A>
<LI><A HREF="cfengine.html#IDX55">Dots in hostnames</A>
<LI><A HREF="cfengine.html#IDX292">Double quotes</A>
</DIR>
<H2>e</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX504">Editing users login files</A>
<LI><A HREF="cfengine.html#IDX594">Emacs, lock files</A>
<LI><A HREF="cfengine.html#IDX431">Empty files</A>
<LI><A HREF="cfengine.html#IDX639">Environment variable CFALLCLASSES</A>
<LI><A HREF="cfengine.html#IDX40">Environment variable, CFINPUTS</A>
<LI><A HREF="cfengine.html#IDX73">Environment variables</A>, <A HREF="cfengine.html#IDX83">Environment variables</A>
<LI><A HREF="cfengine.html#IDX591">Example configuration files</A>
<LI><A HREF="cfengine.html#IDX57">Exceptions</A>
<LI><A HREF="cfengine.html#IDX58">Excluding actions in a controlled way</A>
<LI><A HREF="cfengine.html#IDX239">Excluding classes</A>
<LI><A HREF="cfengine.html#IDX130">Exporting filesystems</A>, <A HREF="cfengine.html#IDX143">Exporting filesystems</A>
<LI><A HREF="cfengine.html#IDX485">exports, fixing</A>
</DIR>
<H2>f</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX468">FAQs</A>
<LI><A HREF="cfengine.html#IDX264">File images (copy)</A>
<LI><A HREF="cfengine.html#IDX295">File management</A>
<LI><A HREF="cfengine.html#IDX41">File search paths</A>
<LI><A HREF="cfengine.html#IDX359">Files, breaking up into several</A>
<LI><A HREF="cfengine.html#IDX11">Files, checking permissions</A>, <A HREF="cfengine.html#IDX296">Files, checking permissions</A>
<LI><A HREF="cfengine.html#IDX3">Files, configuration</A>
<LI><A HREF="cfengine.html#IDX2">Files, control</A>
<LI><A HREF="cfengine.html#IDX329">Files, home wildcard</A>
<LI><A HREF="cfengine.html#IDX358">Files, importing</A>
<LI><A HREF="cfengine.html#IDX331">Files, ownership</A>
<LI><A HREF="cfengine.html#IDX321">Files, recursion</A>
<LI><A HREF="cfengine.html#IDX297">Files, setting owner</A>
<LI><A HREF="cfengine.html#IDX299">Files, syntax</A>
<LI><A HREF="cfengine.html#IDX610">find database</A>
<LI><A HREF="cfengine.html#IDX636">Finger protocol, GNU</A>
<LI><A HREF="cfengine.html#IDX464">Flex and bison problem</A>
<LI><A HREF="cfengine.html#IDX270">Force copying</A>
<LI><A HREF="cfengine.html#IDX563">Fork error in solaris</A>
<LI><A HREF="cfengine.html#IDX23">Format</A>
<LI><A HREF="cfengine.html#IDX21">Free format</A>
<LI><A HREF="cfengine.html#IDX569">FreeBSD mount problem</A>
<LI><A HREF="cfengine.html#IDX469">Frequently asked questions</A>
<LI><A HREF="cfengine.html#IDX521">Frozen configuration files</A>
<LI><A HREF="cfengine.html#IDX553">ftp and alternative shells</A>
<LI><A HREF="cfengine.html#IDX551">ftp login problems</A>
<LI><A HREF="cfengine.html#IDX604">ftp server, solaris</A>
<LI><A HREF="cfengine.html#IDX54">Fully qualified names</A>
</DIR>
<H2>g</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX635">GNU finger protocol</A>
<LI><A HREF="cfengine.html#IDX345">Group dependencies</A>
<LI><A HREF="cfengine.html#IDX338">Groups, defining</A>
<LI><A HREF="cfengine.html#IDX632">Groups, HPUX</A>
</DIR>
<H2>h</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX92">Hard class name collision</A>
<LI><A HREF="cfengine.html#IDX13">Hard links</A>
<LI><A HREF="cfengine.html#IDX389">Hardlinks</A>
<LI><A HREF="cfengine.html#IDX34">Help</A>
<LI><A HREF="cfengine.html#IDX571">Help scripts</A>
<LI><A HREF="cfengine.html#IDX470">Hints and Tips</A>
<LI><A HREF="cfengine.html#IDX328">home directive</A>
<LI><A HREF="cfengine.html#IDX136">Home directories and automount</A>
<LI><A HREF="cfengine.html#IDX226">Home path</A>
<LI><A HREF="cfengine.html#IDX117">Home server</A>
<LI><A HREF="cfengine.html#IDX121">Home servers, declaring</A>
<LI><A HREF="cfengine.html#IDX350">Home servers, defining</A>
<LI><A HREF="cfengine.html#IDX312">home wildcard</A>
<LI><A HREF="cfengine.html#IDX402">Homepattern variable.</A>
<LI><A HREF="cfengine.html#IDX56">Host name gets truncated</A>
<LI><A HREF="cfengine.html#IDX633"><TT>`host.conf'</TT></A>
<LI><A HREF="cfengine.html#IDX91">Hostname collision</A>
<LI><A HREF="cfengine.html#IDX532"><TT>`hosts.equiv'</TT></A>, <A HREF="cfengine.html#IDX536"><TT>`hosts.equiv'</TT></A>
<LI><A HREF="cfengine.html#IDX474">Hour classes</A>
<LI><A HREF="cfengine.html#IDX509">How can I make cfengine distribute my <TT>`/etc/motd'</TT> file?</A>
<LI><A HREF="cfengine.html#IDX631">HPUX, groups</A>
<LI><A HREF="cfengine.html#IDX483">httpd problem with logging</A>
<LI><A HREF="cfengine.html#IDX451">Hung machine</A>
</DIR>
<H2>i</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX4">ifconfig</A>
<LI><A HREF="cfengine.html#IDX362">Import files, variables in</A>
<LI><A HREF="cfengine.html#IDX356">Importing files</A>
<LI><A HREF="cfengine.html#IDX637">Internal classes, switching off</A>
<LI><A HREF="cfengine.html#IDX201">Internet address</A>
<LI><A HREF="cfengine.html#IDX25">Invoking cfengine</A>
<LI><A HREF="cfengine.html#IDX200">IP address</A>
<LI><A HREF="cfengine.html#IDX156">Iteration over lists</A>, <A HREF="cfengine.html#IDX214">Iteration over lists</A>
</DIR>
<H2>k</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX507">Kill processes not owned by root</A>
<LI><A HREF="cfengine.html#IDX496">Killing processes</A>
</DIR>
<H2>l</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX514">lex and yacc problems</A>
<LI><A HREF="cfengine.html#IDX333">Linkchildren</A>, <A HREF="cfengine.html#IDX382">Linkchildren</A>
<LI><A HREF="cfengine.html#IDX123">Linking to binservers</A>
<LI><A HREF="cfengine.html#IDX12">Links</A>
<LI><A HREF="cfengine.html#IDX377">Links and binary servers</A>, <A HREF="cfengine.html#IDX385">Links and binary servers</A>
<LI><A HREF="cfengine.html#IDX372">Links, absolute</A>, <A HREF="cfengine.html#IDX375">Links, absolute</A>
<LI><A HREF="cfengine.html#IDX319">Links, deleting stale</A>, <A HREF="cfengine.html#IDX430">Links, deleting stale</A>
<LI><A HREF="cfengine.html#IDX364">Links, making</A>
<LI><A HREF="cfengine.html#IDX381">Links, multiple</A>
<LI><A HREF="cfengine.html#IDX367">Links, single</A>
<LI><A HREF="cfengine.html#IDX315">Links, traversing in searches</A>, <A HREF="cfengine.html#IDX426">Links, traversing in searches</A>
<LI><A HREF="cfengine.html#IDX462">Linux, installing</A>
<LI><A HREF="cfengine.html#IDX388">Local disk space, make use of</A>
<LI><A HREF="cfengine.html#IDX542">Local startup file for solaris</A>
<LI><A HREF="cfengine.html#IDX593">Lock files, emacs</A>
<LI><A HREF="cfengine.html#IDX147">Log files</A>
<LI><A HREF="cfengine.html#IDX285">Log files, controlling the size of</A>
<LI><A HREF="cfengine.html#IDX167">Log files, rotating</A>
<LI><A HREF="cfengine.html#IDX478">Logfiles, preventing overflow</A>
<LI><A HREF="cfengine.html#IDX51">Logical NOT</A>
<LI><A HREF="cfengine.html#IDX505">Login files, editing for all users</A>
<LI><A HREF="cfengine.html#IDX629"><TT>`logingroup'</TT></A>
</DIR>
<H2>m</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX82">Macros</A>
<LI><A HREF="cfengine.html#IDX579">Mail agent</A>
<LI><A HREF="cfengine.html#IDX580">Mail from scripts</A>
<LI><A HREF="cfengine.html#IDX391">Mail server, defining</A>
<LI><A HREF="cfengine.html#IDX274">Making directories</A>
<LI><A HREF="cfengine.html#IDX363">Making links</A>
<LI><A HREF="cfengine.html#IDX275">Making paths</A>
<LI><A HREF="cfengine.html#IDX387">Making use of local disk space</A>
<LI><A HREF="cfengine.html#IDX612">Manual pages</A>
<LI><A HREF="cfengine.html#IDX491">Master files, updating from</A>
<LI><A HREF="cfengine.html#IDX511">Message of the day files</A>
<LI><A HREF="cfengine.html#IDX396">Miscellaneous mount operations</A>
<LI><A HREF="cfengine.html#IDX10">Monitoring important files</A>
<LI><A HREF="cfengine.html#IDX223">Mount paths</A>
<LI><A HREF="cfengine.html#IDX118">Mount points</A>
<LI><A HREF="cfengine.html#IDX269">Mounted filesystems</A>
<LI><A HREF="cfengine.html#IDX395">Mounting filesystems.</A>
<LI><A HREF="cfengine.html#IDX354">Moutable rescources, defining</A>, <A HREF="cfengine.html#IDX398">Moutable rescources, defining</A>
<LI><A HREF="cfengine.html#IDX435">mtime tidies</A>
<LI><A HREF="cfengine.html#IDX380">Multiple links</A>
<LI><A HREF="cfengine.html#IDX160">Multiple package configuration</A>
<LI><A HREF="cfengine.html#IDX14">Musts in cfengine</A>
</DIR>
<H2>n</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX90">Name collision</A>
<LI><A HREF="cfengine.html#IDX8">Name server</A>
<LI><A HREF="cfengine.html#IDX601">Nameserver</A>
<LI><A HREF="cfengine.html#IDX119">Naming convention</A>
<LI><A HREF="cfengine.html#IDX259">Negating classes</A>
<LI><A HREF="cfengine.html#IDX343">Negating entries from netgroups</A>
<LI><A HREF="cfengine.html#IDX339">Netgroups</A>
<LI><A HREF="cfengine.html#IDX140">netgroups</A>
<LI><A HREF="cfengine.html#IDX463">Netgroups and Linux</A>
<LI><A HREF="cfengine.html#IDX344">Netgroups, negating entries</A>
<LI><A HREF="cfengine.html#IDX197">netmask</A>
<LI><A HREF="cfengine.html#IDX202">Netmask</A>
<LI><A HREF="cfengine.html#IDX538">Netmask with solaris 2.4</A>
<LI><A HREF="cfengine.html#IDX623">Netscape cache files</A>
<LI><A HREF="cfengine.html#IDX6">network configuration</A>
<LI><A HREF="cfengine.html#IDX5">network interface</A>
<LI><A HREF="cfengine.html#IDX461">New systems, support for</A>
<LI><A HREF="cfengine.html#IDX7">NFS</A>
<LI><A HREF="cfengine.html#IDX204">nfs</A>
<LI><A HREF="cfengine.html#IDX293">NFS mount model and automounter</A>
<LI><A HREF="cfengine.html#IDX114">NFS mounted filesystems</A>
<LI><A HREF="cfengine.html#IDX325">NFS problems with DOMAIN OS</A>
<LI><A HREF="cfengine.html#IDX115">NFS resources</A>
<LI><A HREF="cfengine.html#IDX205">nfstype</A>
<LI><A HREF="cfengine.html#IDX141">NIS</A>
<LI><A HREF="cfengine.html#IDX340">NIS, netgroup support</A>
<LI><A HREF="cfengine.html#IDX50">NOT operator</A>
<LI><A HREF="cfengine.html#IDX628"><TT>`nsswitch.conf'</TT>, standardizing</A>
</DIR>
<H2>o</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX177">ones</A>
<LI><A HREF="cfengine.html#IDX24">Optional features in cfengine</A>
<LI><A HREF="cfengine.html#IDX18">Order of actions</A>
<LI><A HREF="cfengine.html#IDX330">Ownership of files</A>
</DIR>
<H2>p</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX161">Package configuration, multiple</A>
<LI><A HREF="cfengine.html#IDX227">Path to home directories</A>
<LI><A HREF="cfengine.html#IDX42">Path to input files</A>
<LI><A HREF="cfengine.html#IDX224">Path to mounted filesystems</A>
<LI><A HREF="cfengine.html#IDX273">Paths, making</A>
<LI><A HREF="cfengine.html#IDX69">Patterns</A>
<LI><A HREF="cfengine.html#IDX327">Permissions, directories</A>
<LI><A HREF="cfengine.html#IDX403">Processes, 0 to 3</A>
<LI><A HREF="cfengine.html#IDX500">Processes, check if running</A>
<LI><A HREF="cfengine.html#IDX406">Processes, checking existence of</A>
<LI><A HREF="cfengine.html#IDX404">Processes, counting</A>
<LI><A HREF="cfengine.html#IDX497">Processes, killing</A>
<LI><A HREF="cfengine.html#IDX407">Processes, signalling</A>
<LI><A HREF="cfengine.html#IDX22">Program format</A>
<LI><A HREF="cfengine.html#IDX15">Program structure</A>
</DIR>
<H2>q</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX582">Quotas, soft</A>, <A HREF="cfengine.html#IDX608">Quotas, soft</A>
<LI><A HREF="cfengine.html#IDX290">Quoted strings</A>
<LI><A HREF="cfengine.html#IDX101">Quoting strings</A>
</DIR>
<H2>r</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX541"><TT>`rc.local'</TT> in solaris</A>
<LI><A HREF="cfengine.html#IDX614">rdate</A>
<LI><A HREF="cfengine.html#IDX320">Recursion in files</A>
<LI><A HREF="cfengine.html#IDX370">Relative links</A>
<LI><A HREF="cfengine.html#IDX438">Removing directories</A>
<LI><A HREF="cfengine.html#IDX342">Removing entries from netgroups</A>
<LI><A HREF="cfengine.html#IDX277">Renaming files</A>
<LI><A HREF="cfengine.html#IDX280">Replacing file by link</A>
<LI><A HREF="cfengine.html#IDX467">Reporting bugs</A>
<LI><A HREF="cfengine.html#IDX211">Repository filenames, changing</A>
<LI><A HREF="cfengine.html#IDX410">resolv.conf</A>
<LI><A HREF="cfengine.html#IDX409">Resolver configuration</A>
<LI><A HREF="cfengine.html#IDX457">Resource file</A>
<LI><A HREF="cfengine.html#IDX112">Restricting access</A>
<LI><A HREF="cfengine.html#IDX221">Restricting the size of files to be edited</A>
<LI><A HREF="cfengine.html#IDX590">Retrieving backed-up files</A>
<LI><A HREF="cfengine.html#IDX437">rmdirs</A>
<LI><A HREF="cfengine.html#IDX166">Rotating files</A>
<LI><A HREF="cfengine.html#IDX286">Rotating log files</A>
<LI><A HREF="cfengine.html#IDX558">routed</A>
<LI><A HREF="cfengine.html#IDX576">Running cfengine, cron script</A>
</DIR>
<H2>s</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX414">Scripts and class information</A>
<LI><A HREF="cfengine.html#IDX446">Scripts, examples</A>
<LI><A HREF="cfengine.html#IDX87">Scripts, passing classes to</A>
<LI><A HREF="cfengine.html#IDX445">Scripts, writing</A>
<LI><A HREF="cfengine.html#IDX230">Searching for home directories</A>
<LI><A HREF="cfengine.html#IDX19">Sections, order of</A>
<LI><A HREF="cfengine.html#IDX545">Security under solaris</A>
<LI><A HREF="cfengine.html#IDX531">Security with NIS</A>, <A HREF="cfengine.html#IDX535">Security with NIS</A>
<LI><A HREF="cfengine.html#IDX525">Segmentation fault in files and dirs</A>
<LI><A HREF="cfengine.html#IDX476">sendmail</A>, <A HREF="cfengine.html#IDX520">sendmail</A>
<LI><A HREF="cfengine.html#IDX522"><TT>`sendmail.fc'</TT></A>
<LI><A HREF="cfengine.html#IDX217">Sensible file sizes</A>
<LI><A HREF="cfengine.html#IDX219">Sensible limits on files in a directory</A>
<LI><A HREF="cfengine.html#IDX620">Services</A>
<LI><A HREF="cfengine.html#IDX153">setgid root log</A>
<LI><A HREF="cfengine.html#IDX152">setuid root log</A>
<LI><A HREF="cfengine.html#IDX110">Setuid scripts</A>
<LI><A HREF="cfengine.html#IDX357">Several files</A>
<LI><A HREF="cfengine.html#IDX486">sharing filesystems</A>
<LI><A HREF="cfengine.html#IDX348">Shell command to decide class</A>
<LI><A HREF="cfengine.html#IDX60">Shell commands which define classes</A>
<LI><A HREF="cfengine.html#IDX366">Single links</A>
<LI><A HREF="cfengine.html#IDX291">Single quotes</A>
<LI><A HREF="cfengine.html#IDX191">site</A>
<LI><A HREF="cfengine.html#IDX581">Software quotas</A>
<LI><A HREF="cfengine.html#IDX556">Solaris and tcsh</A>
<LI><A HREF="cfengine.html#IDX559">Solaris routing bug</A>
<LI><A HREF="cfengine.html#IDX547">Solaris, <TT>`/tmp'</TT></A>
<LI><A HREF="cfengine.html#IDX605">Solaris, ftp server</A>
<LI><A HREF="cfengine.html#IDX546">Solaris, security</A>
<LI><A HREF="cfengine.html#IDX124">Special variables</A>
<LI><A HREF="cfengine.html#IDX155">split</A>, <A HREF="cfengine.html#IDX213">split</A>
<LI><A HREF="cfengine.html#IDX26">Starting cfengine</A>
<LI><A HREF="cfengine.html#IDX575">Starting cfengine, cron script</A>
<LI><A HREF="cfengine.html#IDX100">Strings</A>
<LI><A HREF="cfengine.html#IDX16">Structure of a program</A>
<LI><A HREF="cfengine.html#IDX203">Subnet mask</A>
<LI><A HREF="cfengine.html#IDX460">Support for new systems</A>
<LI><A HREF="cfengine.html#IDX267">Switching off backup in copy</A>
<LI><A HREF="cfengine.html#IDX638">Switching off internal classes</A>
<LI><A HREF="cfengine.html#IDX374">Symbolic links, absolute</A>
<LI><A HREF="cfengine.html#IDX371">Symbolic links, relative</A>
<LI><A HREF="cfengine.html#IDX195">sysadm</A>
<LI><A HREF="cfengine.html#IDX99">System administrator, name</A>
</DIR>
<H2>t</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX555">tcsh and solaris</A>
<LI><A HREF="cfengine.html#IDX433">Tidy by ctime, mtime, atime</A>
<LI><A HREF="cfengine.html#IDX622">Tidy, user areas</A>
<LI><A HREF="cfengine.html#IDX432">Tidying empty files</A>
<LI><A HREF="cfengine.html#IDX144">Tidying files</A>, <A HREF="cfengine.html#IDX416">Tidying files</A>
<LI><A HREF="cfengine.html#IDX473">Time classes, hours</A>
<LI><A HREF="cfengine.html#IDX615">Time, setting</A>
<LI><A HREF="cfengine.html#IDX471">Tips using cfengine</A>
<LI><A HREF="cfengine.html#IDX335">Touching files</A>
<LI><A HREF="cfengine.html#IDX283">Truncating log files</A>
</DIR>
<H2>u</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX89">underscoreclasses</A>
<LI><A HREF="cfengine.html#IDX443">Unmounting filesystems</A>
<LI><A HREF="cfengine.html#IDX490">Updating files from master source</A>
<LI><A HREF="cfengine.html#IDX584">User backups</A>
<LI><A HREF="cfengine.html#IDX61">User programs which define classes</A>
<LI><A HREF="cfengine.html#IDX621">Users, tidying</A>
</DIR>
<H2>v</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX70">Variable substitution</A>
<LI><A HREF="cfengine.html#IDX81">Variables and Macros</A>
<LI><A HREF="cfengine.html#IDX361">Variables in import files</A>
<LI><A HREF="cfengine.html#IDX72">Variables, cfengine</A>
<LI><A HREF="cfengine.html#IDX125">Variables, cfengine model</A>
<LI><A HREF="cfengine.html#IDX71">Variables, environment</A>
<LI><A HREF="cfengine.html#IDX97">Variables, using</A>
<LI><A HREF="cfengine.html#IDX37">Verifying with -n option</A>
</DIR>
<H2>w</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX313">Wildcard home</A>
<LI><A HREF="cfengine.html#IDX64">Wildcard, any class</A>
<LI><A HREF="cfengine.html#IDX68">Wildcards</A>
<LI><A HREF="cfengine.html#IDX229">Wildcards in homepattern</A>
<LI><A HREF="cfengine.html#IDX66">Wildcards, in directory names</A>
<LI><A HREF="cfengine.html#IDX573">Wrapper script</A>
<LI><A HREF="cfengine.html#IDX481">wtmpx</A>
<LI><A HREF="cfengine.html#IDX626"><TT>`wtmpx'</TT></A>
<LI><A HREF="cfengine.html#IDX603">WWW log files, controlling</A>
<LI><A HREF="cfengine.html#IDX597">WWW protection</A>
<LI><A HREF="cfengine.html#IDX289">WWW server logs</A>
</DIR>
<H2>x</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX599">X-terminals</A>
<LI><A HREF="cfengine.html#IDX595">X11 server data in <TT>`/tmp'</TT></A>
<LI><A HREF="cfengine.html#IDX323">xdev (File system boundaries)</A>
</DIR>
<H2>y</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX515">yacc problems</A>
</DIR>
<H2>z</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX178">zeros</A>
</DIR>

</P>


<H1><A NAME="SEC144" HREF="cfengine_toc.html#TOC144">FAQ Index</A></H1>

<P>
<H2>/</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX527"><TT>`/etc/groups'</TT> in linux</A>
<LI><A HREF="cfengine.html#IDX566"><TT>`/etc/system'</TT> missing in solaris.</A>
</DIR>
<H2>a</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX465">Action contains invalid statement problem</A>
</DIR>
<H2>b</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX540">Bad address error in solaris</A>
</DIR>
<H2>c</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX512">Cfengine security worries</A>
<LI><A HREF="cfengine.html#IDX212">Changing repository name conventions</A>
<LI><A HREF="cfengine.html#IDX162">Configure multiple packages</A>
</DIR>
<H2>d</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX567">Daily mail in FreeBSD</A>
<LI><A HREF="cfengine.html#IDX62">Define classes based on result of user program</A>
<LI><A HREF="cfengine.html#IDX533">Delete + in hosts.equiv</A>
<LI><A HREF="cfengine.html#IDX518">Difference between hpux and hpux10</A>
<LI><A HREF="cfengine.html#IDX492">Distribute key set up files to users</A>
</DIR>
<H2>e</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX503">Edit all users login files</A>
<LI><A HREF="cfengine.html#IDX502">Edit and restart DNS</A>
</DIR>
<H2>f</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX487">Fix exports in cfengine</A>
<LI><A HREF="cfengine.html#IDX548">Fixinf /tmp permissions in solaris</A>
<LI><A HREF="cfengine.html#IDX564">Fork: resource unavailable in solaris</A>
<LI><A HREF="cfengine.html#IDX568">FreeBSD daily mail</A>
<LI><A HREF="cfengine.html#IDX570">FreeBSD mount doesn't work</A>
<LI><A HREF="cfengine.html#IDX519">Frozen configuration files</A>
<LI><A HREF="cfengine.html#IDX554">ftp, can't log in</A>
</DIR>
<H2>g</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX523">Groups in hpux</A>
</DIR>
<H2>h</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX508">How can I make cfengine distribute my <TT>`/etc/motd'</TT> file?</A>
<LI><A HREF="cfengine.html#IDX105">How do I quote quotes?</A>
<LI><A HREF="cfengine.html#IDX139">How to keep all users in <TT>`/home'</TT></A>
</DIR>
<H2>i</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX157">Iterating over lists</A>, <A HREF="cfengine.html#IDX215">Iterating over lists</A>
</DIR>
<H2>k</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX506">Kill all processes except root</A>
<LI><A HREF="cfengine.html#IDX499">Kill user processes</A>
<LI><A HREF="cfengine.html#IDX498">Killing "eggdrop"</A>
</DIR>
<H2>l</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX517">Lex and yacc in AIX</A>
<LI><A HREF="cfengine.html#IDX501">License server crashes</A>
<LI><A HREF="cfengine.html#IDX516">Line length bug in AIX</A>
<LI><A HREF="cfengine.html#IDX526">Linux segmentation fault with groups</A>
</DIR>
<H2>m</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX510">Message of the day files</A>
<LI><A HREF="cfengine.html#IDX528">Message of the day in linux</A>
<LI><A HREF="cfengine.html#IDX529">motd in linux</A>
<LI><A HREF="cfengine.html#IDX565">Mount filesystems fails in solaris</A>
</DIR>
<H2>p</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX480">Prevent big log-files</A>
</DIR>
<H2>r</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX543">rc.local in solaris</A>
<LI><A HREF="cfengine.html#IDX475">Replace the stupid version of sendmail..?</A>
<LI><A HREF="cfengine.html#IDX562">Routing problem in solaris</A>
</DIR>
<H2>s</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX524">Segmentation fault in files and dirs</A>
<LI><A HREF="cfengine.html#IDX549">Solaris /tmp sticky bit</A>
<LI><A HREF="cfengine.html#IDX159">split, using a space</A>
<LI><A HREF="cfengine.html#IDX550">Sticky bit in solaris /tmp</A>
</DIR>
<H2>t</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX557">tcsh and solaris error</A>
</DIR>
<H2>w</H2>
<DIR>
<LI><A HREF="cfengine.html#IDX472">Why doesn't cfengine have classes for each hour..?</A>
</DIR>

</P>

<P><HR><P>
This document was generated on 5 November 1996 using the
<A HREF="http://wwwcn.cern.ch/dci/texi2html/">texi2html</A>
translator version 1.50.</P>
</BODY>
</HTML>
