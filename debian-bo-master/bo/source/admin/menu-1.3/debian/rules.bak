#! /usr/bin/make -f
#   -*- mode: makefile; -*-
#
# Last updated: Sat Dec 17 10:52:20 EST 1994 by imurdock.
#
# To make the binary distribution package, the ``Debianized'' source package
# and the context diff to the original package, type `./debian.rules dist'.
# Make sure that `debian.rules' is executable before the final distribution
# is made.
#
# Invoke each target with `./debian.rules <target>'.  All targets should be
# invoked with the package root as the current directory.
#
# The `binary' target must be run as root, as it needs to install files with
# specific ownerships.  The `diff' target assumes that you have the original
# source package available, unpacked, in ../$(p)-$(v).orig, or that you have
# the previous revision of the ``Debianized'' source package and context diff
# in the parent directory.

CC = gcc
CFLAGS = -O2
LDFLAGS = -s

p = menu


build:
	make -C .
	make -C fvwmgen
	touch build


clean:	
	#Undoes the effect of `make -f debian.rules build'.
	#make distclean
	#rm -f docs/Makefile docs/latextut/Makefile
	-rm -rf debian/tmp build menu
	make -C . clean
	make -C fvwmgen clean

binary-indep:   checkroot build
        $(checkdir)
# There are no architecture-independent files to be uploaded
# generated by this package.  If there were any they would be
# made here.


binary-arch:
	rm -rf debian/tmp
	install -d -g root -m 755 -o root debian/tmp
	install -d -g root -m 755 -o root debian/tmp/DEBIAN
	install -d -g root -m 755 -o root debian/tmp/usr/bin
	install -d -g root -m 755 -o root debian/tmp/usr/sbin
	install -d -g root -m 755 -o root debian/tmp/usr/lib/menu/default
	install -d -g root -m 755 -o root debian/tmp/usr/doc/menu/examples
	install -d -g root -m 755 -o root debian/tmp/etc/menu-methods
	install -d -g root -m 755 -o root debian/tmp/etc/menu
	#
	strip update-menus fvwmgen/fvwmgen
	#
	install -g root -o root -m 755 \
	   debian/postinst debian/tmp/DEBIAN/postinst
	install -g root -o root -m 755 \
	   debian/prerm debian/tmp/DEBIAN/prerm
	#
	install -g root -o root -m 755 \
	   update-menus debian/tmp/usr/bin/update-menus
	install -g root -o root -m 755 \
           fvwmgen/fvwmgen  debian/tmp/usr/sbin/install-fvwmgenmenu
	#
	for wm in fvwm fvwm2 afterstep twm; do\
          mkdir debian/tmp/usr/doc/menu/examples/$$wm;\
	  cp $$wm/* debian/tmp/usr/doc/menu/examples/$$wm;\
	done
	install -g root -o root -m 644\
	   README.examples debian/tmp/usr/doc/menu/examples/README
	#
	install -g root -o root -m 644 \
	   README debian/tmp/usr/doc/menu/README
	install -g root -o root -m 644 \
	   README.config-menus debian/tmp/etc/menu/README
	install -g root -o root -m 644 \
	   README.default-menus debian/tmp/usr/lib/menu/default/README
	install -g root -o root -m 644 \
	   README.package-menus debian/tmp/usr/lib/menu/README
	install -g root -o root -m 644 \
	   debian/copyright debian/tmp/usr/doc/menu/copyright
	#

	./make-menus default-menus debian/tmp/usr/lib/menu/default
	#
	dpkg-shlibdeps ./update-menus ./fvwmgen/fvwmgen
	dpkg-gencontrol
	chown -R root.root debian/tmp
	chmod -R g-ws debian/tmp
	dpkg --build debian/tmp ..

binary:	 binary-indep binary-arch


checkroot:
	$(checkdir)
	test root = "`whoami`"



