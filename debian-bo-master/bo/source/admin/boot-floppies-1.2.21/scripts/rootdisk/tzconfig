#!/bin/sh

if [ -f /etc/timezone ]; then
	echo "Your current time zone is set to `cat /etc/timezone`"
	echo -n "Do you want to change that? [n]: "
	read ans
	if [ "x$ans" = "x" -o "$ans" = "n" -o "$ans" = "no" ]; then
		echo "Your time zone will not be changed"
		exit 0
	fi
fi

timezones=`cd /usr/lib/zoneinfo ; find . -type f | sed -e 's/^.\///' | sort`

valid=no
while [ $valid = no ]; do
	cat <<EOF

Please enter the number of the geographic area in which you live:


	1) Africa			6) Australia

	2) America (excluding USA)	7) Europe

	3) US time zones		8) Indian Ocean

	4) Asia				9) Pacific Ocean

	5) Atlantic Ocean		10) Use System V style time zones

			11) None of the above


Then you will be shown a list of cities which represent the time zone
in which they are located. You should choose a city in your time zone.

EOF
	echo -n "Number: " ; read area
	valid=yes
	case $area in
		1) continent=Africa ;;
		2) continent=America ;;
		3) continent=US ;;
		4) continent=Asia ;;
		5) continent=Atlantic ;;
		6) continent=Australia ;;
		7) continent=Europe ;;
		8) continent=Indian ;;
		9) continent=Pacific ;;
		10) continent=SystemV ;;
		11) continent=Etc ;;
		*) valid=no
	esac
done

if [ -x /usr/bin/fmt ]; then fmt_bin=/usr/bin/fmt
else fmt_bin=/bin/more ; fi

valid=no
name=""

while [ $valid = no ]; do
	if [ -n "$name" ]; then
		number=`echo $timezones | grep -i -c "^$continent/$name" `
		if [ $number -eq 1 ]; then
			name=`echo $timezones | grep -i "^$continent/$name"`
			echo "Your default time zone is set to $name"
			valid=yes
			break
		fi
	fi
	echo
	grep -i "^$continent/$name" $TIMEZONES | cut -d/ -f2- | $fmt_bin
	echo
	echo "Please enter the name of one of these cities or zones"
	echo "You just need to type enough letters to resolve ambiguities"
	echo "Press Enter to view all of them again"
	echo -n "Name: [$name] " ; read name
done

echo $name > /etc/timezone
rm -f /etc/localtime ; ln -s /usr/lib/zoneinfo/$name /etc/localtime
rm -f $TIMEZONES
