#!/bin/sh

echo "Making KISS distribution."

VER=`head -1 src/version.h | sed 's/.*VERSION "//' | sed 's/\"//'`
echo "Version: $VER"

echo "Cleaning up src directory."
make -C src clean

echo "Making archive."
cd ..
tar -c -v -z \
    --exclude 'kiss/src/*.o' \
    --exclude 'kiss/src/getline/*.o' \
    --exclude 'kiss/src/getline/lib*.a' \
    -f kiss-$VER.tar.gz kiss

echo "Uploading to ftp."

ftp -n << ENDFTP
    open ftp
    user ftp karel@
    cd /pub/incoming/general
    bin
    put kiss-$VER.tar.gz
    put kiss/kiss.lsm kiss.lsm
    quit
ENDFTP

echo "Remember to move stuff from /pub/incoming/general to /pub/unix"
echo "and to upload to std ftp sites!!"
